/*!
 * This file is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor. 
 * Copyright (c) 2010-2012 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php 
 * 
 * Aloha Editor is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or any later version.
 *
 * Aloha Editor is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 * 
 * As an additional permission to the GNU GPL version 2, you may distribute
 * non-source (e.g., minimized or compacted) forms of the Aloha-Editor
 * source code without the copy of the GNU GPL normally required,
 * provided you include this license notice and a URL through which
 * recipients can access the Corresponding Source.
 */(function(){function Sanitize(){var e,t,n;n=arguments[0]||{},this.jQuery=arguments[1]||{},this.config={},this.config.elements=n.elements?n.elements:[],this.config.attributes=n.attributes?n.attributes:{},this.config.attributes[Sanitize.ALL]=this.config.attributes[Sanitize.ALL]?this.config.attributes[Sanitize.ALL]:[],this.config.allow_comments=n.allow_comments?n.allow_comments:!1,this.allowed_elements={},this.config.protocols=n.protocols?n.protocols:{},this.config.add_attributes=n.add_attributes?n.add_attributes:{},this.dom=n.dom?n.dom:document;for(e=0;e<this.config.elements.length;e++)this.allowed_elements[this.config.elements[e]]=!0;this.config.remove_element_contents={},this.config.remove_all_contents=!1;if(n.remove_contents)if(n.remove_contents instanceof Array)for(e=0;e<n.remove_contents.length;e++)this.config.remove_element_contents[n.remove_contents[e]]=!0;else this.config.remove_all_contents=!0;this.transformers=n.transformers?n.transformers:[],this.filters=n.filters?n.filters:[]}var JSON;JSON||(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("util/json2",[],function(){return JSON}),define("aloha/rangy-core",[],function(){var e=function(){function u(n,r){var i=typeof n[r];return i==t||i==e&&!!n[r]||i=="unknown"}function a(t,n){return typeof t[n]==e&&!!t[n]}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function d(e){return e&&c(e,o)&&p(e,s)}function m(e){window.alert("Rangy not supported in your browser. Reason: "+e),v.initialized=!0,v.supported=!1}function g(e){var t="Rangy warning: "+e;v.config.alertOnWarn?window.alert(t):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(t)}function w(){if(v.initialized)return;var e,t=!1,n=!1;u(document,"createRange")&&(e=document.createRange(),c(e,i)&&p(e,r)&&(t=!0),e.detach());var s=a(document,"body")?document.body:document.getElementsByTagName("body")[0];s&&u(s,"createTextRange")&&(e=s.createTextRange(),d(e)&&(n=!0)),!t&&!n&&m("Neither Range nor TextRange are implemented"),v.initialized=!0,v.features={implementsDomRange:t,implementsTextRange:n};var o=b.concat(y);for(var f=0,l=o.length;f<l;++f)try{o[f](v)}catch(h){a(window,"console")&&u(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}function S(e){e=e||window,w();for(var t=0,n=E.length;t<n;++t)E[t](e)}function x(e){this.name=e,this.initialized=!1,this.supported=!1}var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],c=l(u),h=l(a),p=l(f),v={version:"1.2.1",initialized:!1,supported:!0,util:{isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!0}};v.fail=m,v.warn=g,{}.hasOwnProperty?v.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:m("hasOwnProperty not supported");var y=[],b=[];v.init=w,v.addInitListener=function(e){v.initialized?e(v):y.push(e)};var E=[];v.addCreateMissingNativeApiListener=function(e){E.push(e)},v.createMissingNativeApi=S,x.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},x.prototype.warn=function(e){v.warn("Module "+this.name+": "+e)},x.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},v.createModule=function(e,t){var n=new x(e);v.modules[e]=n,b.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},v.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=v.modules[i];if(!r||!(r instanceof x))throw new Error("Module '"+i+"' not found");if(!r.supported)throw new Error("Module '"+i+"' not supported")}};var T=!1,N=function(e){T||(T=!0,v.initialized||w())};if(typeof window==n){m("No window found");return}if(typeof document==n){m("No document found");return}return u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),u(window,"addEventListener")?window.addEventListener("load",N,!1):u(window,"attachEvent")?window.attachEvent("onload",N):m("Window does not have required addEventListener or attachEvent method"),v}();return e.createModule("DomUtil",function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling)t++;return t}function l(e){var t;return d(e)?e.length:(t=e.childNodes)?t.length:0}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function p(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function d(e){var t=e.nodeType;return t==3||t==4||t==8}function v(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function m(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),v(n,e),n}function g(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return g(e.parentNode);throw new Error("getDocument: no document found for node")}function y(e){var t=g(e);if(typeof t.defaultView!=n)return t.defaultView;if(typeof t.parentWindow!=n)return t.parentWindow;throw new Error("Cannot get a window object for node")}function b(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function w(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function E(e){return r.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function S(e){var t;while(t=e.parentNode)e=t;return e}function x(e){if(!e)return;return e.previousSibling?e.previousSibling.nextSibling:e.nextSibling?e.nextSibling.previousSibling:e.parentNode?e.parentNode.firstChild:e}function T(e,t,n,r){e=x(e),n=x(n);var i,s,o,u,a;if(e==n)return t===r?0:t<r?-1:1;if(i=p(n,e,!0))return t<=f(i)?-1:1;if(i=p(e,n,!0))return f(i)<r?-1:1;s=c(e,n),o=e===s?s:p(e,s,!0),u=n===s?s:p(n,s,!0);if(o===u)throw new Error("comparePoints got to case 4 and childA and childB are the same!");a=s.firstChild;while(a){if(a===o)return-1;if(a===u)return 1;a=a.nextSibling}throw new Error("Should not be here!")}function N(e){var t=g(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function C(e){if(!e)return"[No node]";if(d(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function k(e){this.root=e,this._next=e}function L(e){return new k(e)}function A(e,t){this.node=e,this.offset=t}function O(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElement("div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1};k.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+C(this.node)+":"+this.offset+")]"}},O.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},O.prototype.toString=function(){return this.message},e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,getClosestAncestorIn:p,isCharacterDataNode:d,insertAfter:v,splitDataNode:m,getDocument:g,getWindow:y,getIframeWindow:w,getIframeDocument:b,getBody:E,getRootContainer:S,comparePoints:T,inspectNode:C,fragmentFromNodeChildren:N,createIterator:L,DomPosition:A},e.DOMException=O}),e.createModule("DomRange",function(e,t){function s(e,t){return e.nodeType!=3&&(n.isAncestorOf(e,t.startContainer,!0)||n.isAncestorOf(e,t.endContainer,!0))}function o(e){return n.getDocument(e.startContainer)}function u(e,t,n){var r=e._listeners[t];if(r)for(var i=0,s=r.length;i<s;++i)r[i].call(e,{target:e,args:n})}function a(e){return new r(e.parentNode,n.getNodeIndex(e))}function f(e){return new r(e.parentNode,n.getNodeIndex(e)+1)}function l(e,t,r){var i=e.nodeType==11?e.firstChild:e;return n.isCharacterDataNode(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:n.splitDataNode(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function c(e){var t;for(var n,r=o(e.range).createDocumentFragment(),s;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(s=e.getSubtreeIterator(),n.appendChild(c(s)),s.detach(!0));if(n.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function h(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),h(u,t,r),u.detach(!0);if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function p(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),p(t),t.detach(!0)):e.remove()}function d(e){for(var t,n=o(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(d(r)),r.detach(!0)):e.remove();if(t.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function v(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var o=[];return h(new g(e,!1),function(e){(!r||i.test(e.nodeType))&&(!s||n(e))&&o.push(e)}),o}function m(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&n.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!n.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:n.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!n.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:n.getClosestAncestorIn(this.ec,r,!0))}}function y(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function b(e,t,n){this.nodes=v(e,t,n),this._next=this.nodes[0],this._position=0}function N(e){return function(t,r){var i,s=r?t:t.parentNode;while(s){i=s.nodeType;if(n.arrayContains(e,i))return s;s=s.parentNode}return null}}function O(e,t){if(A(e,t))throw new y("INVALID_NODE_TYPE_ERR")}function M(e){if(!e.startContainer)throw new i("INVALID_STATE_ERR")}function _(e,t){if(!n.arrayContains(t,e.nodeType))throw new y("INVALID_NODE_TYPE_ERR")}function D(e,t){if(t<0||t>(n.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new i("INDEX_SIZE_ERR")}function P(e,t){if(k(e,!0)!==k(t,!0))throw new i("WRONG_DOCUMENT_ERR")}function H(e){if(L(e,!0))throw new i("NO_MODIFICATION_ALLOWED_ERR")}function B(e,t){if(!e)throw new i(t)}function j(e){return!n.arrayContains(E,e.nodeType)&&!k(e,!0)}function F(e,t){return t<=(n.isCharacterDataNode(e)?e.length:e.childNodes.length)}function I(e){M(e);if(j(e.startContainer)||j(e.endContainer)||!F(e.startContainer,e.startOffset)||!F(e.endContainer,e.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function Z(){}function et(e){e.START_TO_START=X,e.START_TO_END=V,e.END_TO_END=$,e.END_TO_START=J,e.NODE_BEFORE=K,e.NODE_AFTER=Q,e.NODE_BEFORE_AND_AFTER=G,e.NODE_INSIDE=Y}function tt(e){et(e),et(e.prototype)}function nt(e,t){return function(){I(this);var r=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,o=new g(this,!0),u,a;r!==s&&(u=n.getClosestAncestorIn(r,s,!0),a=f(u),r=a.node,i=a.offset),h(o,H),o.reset();var l=e(o);return o.detach(),t(this,r,i,r,i),l}}function rt(t,r,i){function o(e,t){return function(n){M(this),_(n,w),_(C(n),E);var r=(e?a:f)(n);(t?u:l)(this,r.node,r.offset)}}function u(e,t,i){var s=e.endContainer,o=e.endOffset;if(t!==e.startContainer||i!==this.startOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==1)s=t,o=i;r(e,t,i,s,o)}}function l(e,t,i){var s=e.startContainer,o=e.startOffset;if(t!==e.endContainer||i!==this.endOffset){if(C(t)!=C(s)||n.comparePoints(t,i,s,o)==-1)s=t,o=i;r(e,s,o,t,i)}}function c(e,t,n){(t!==e.startContainer||n!==this.startOffset||t!==e.endContainer||n!==this.endOffset)&&r(e,t,n,t,n)}t.prototype=new Z,e.util.extend(t.prototype,{setStart:function(e,t){M(this),O(e,!0),D(e,t),u(this,e,t)},setEnd:function(e,t){M(this),O(e,!0),D(e,t),l(this,e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){I(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){M(this),O(e,!0),r(this,e,0,e,n.getNodeLength(e))},selectNode:function(e){M(this),O(e,!1),_(e,w);var t=a(e),n=f(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:nt(d,r),deleteContents:nt(p,r),canSurroundContents:function(){I(this),H(this.startContainer),H(this.endContainer);var e=new g(this,!0),t=e._first&&s(e._first,this)||e._last&&s(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset,o=e===i;n.isCharacterDataNode(i)&&s>0&&s<i.length&&n.splitDataNode(i,s),n.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=n.splitDataNode(e,t),o?(s-=t,i=e):i==e.parentNode&&s>=n.getNodeIndex(e)&&s++,t=0),r(this,e,t,i,s)},normalizeBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,s=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,s=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},u=function(r){var o=r.previousSibling;if(o&&o.nodeType==r.nodeType){e=r;var u=r.length;t=o.length,r.insertData(0,o.data),o.parentNode.removeChild(o);if(e==i)s+=t,i=e;else if(i==r.parentNode){var a=n.getNodeIndex(r);s==a?(i=r,s=u):s>a&&s--}}},a=!0;if(n.isCharacterDataNode(i))i.length==s&&o(i);else{if(s>0){var f=i.childNodes[s-1];f&&n.isCharacterDataNode(f)&&o(f)}a=!this.collapsed}if(a){if(n.isCharacterDataNode(e))t==0&&u(e);else if(t<e.childNodes.length){var l=e.childNodes[t];l&&n.isCharacterDataNode(l)&&u(l)}}else e=i,t=s;r(this,e,t,i,s)},collapseToPoint:function(e,t){M(this),O(e,!0),D(e,t),c(this,e,t)}}),tt(t)}function it(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function st(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!==n,o=e.endContainer!==r||e.endOffset!==i;e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,it(e),u(e,"boundarychange",{startMoved:s,endMoved:o})}function ot(e){M(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,u(e,"detach",null),e._listeners=null}function ut(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},it(this)}e.requireModules(["DomUtil"]);var n=e.dom,r=n.DomPosition,i=e.DOMException;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,n.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,r;!n.isCharacterDataNode(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,r=e===this.ec?this.eo:e.length,t!=r&&e.deleteData(t,r-t))},isPartiallySelectedSubtree:function(){var e=this._current;return s(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new ut(o(this.range));var t=this._current,r=t,i=0,s=t,u=n.getNodeLength(t);n.isAncestorOf(t,this.sc,!0)&&(r=this.sc,i=this.so),n.isAncestorOf(t,this.ec,!0)&&(s=this.ec,u=this.eo),st(e,r,i,s,u)}return new g(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},y.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},y.prototype.toString=function(){return this.message},b.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var w=[1,3,4,5,7,8,10],E=[2,9,11],S=[5,6,10,12],x=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],C=n.getRootContainer,k=N([9,11]),L=N(S),A=N([6,10,12]),q=document.createElement("style"),R=!1;try{q.innerHTML="<b>x</b>",R=q.firstChild.nodeType==3}catch(U){}e.features.htmlParsingConforms=R;var z=R?function(e){var t=this.startContainer,r=n.getDocument(t);if(!t)throw new i("INVALID_STATE_ERR");var s=null;return t.nodeType==1?s=t:n.isCharacterDataNode(t)&&(s=n.parentElement(t)),s===null||s.nodeName=="HTML"&&n.isHtmlNamespace(n.getDocument(s).documentElement)&&n.isHtmlNamespace(s)?s=r.createElement("body"):s=s.cloneNode(!1),s.innerHTML=e,n.fragmentFromNodeChildren(s)}:function(e){M(this);var t=o(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},W=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],X=0,V=1,$=2,J=3,K=0,Q=1,G=2,Y=3;Z.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){I(this),P(this.startContainer,t.startContainer);var r,i,s,o,u=e==J||e==X?"start":"end",a=e==V||e==X?"start":"end";return r=this[u+"Container"],i=this[u+"Offset"],s=t[a+"Container"],o=t[a+"Offset"],n.comparePoints(r,i,s,o)},insertNode:function(e){I(this),_(e,x),H(this.startContainer);if(n.isAncestorOf(e,this.startContainer,!0))throw new i("HIERARCHY_REQUEST_ERR");var t=l(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){I(this);var e,t;if(this.collapsed)return o(this).createDocumentFragment();if(this.startContainer===this.endContainer&&n.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=o(this).createDocumentFragment(),t.appendChild(e),t;var r=new g(this,!0);return e=c(r),r.detach(),e},canSurroundContents:function(){I(this),H(this.startContainer),H(this.endContainer);var e=new g(this,!0),t=e._first&&s(e._first,this)||e._last&&s(e._last,this);return e.detach(),!t},surroundContents:function(e){_(e,T);if(!this.canSurroundContents())throw new y("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);l(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){I(this);var e=new ut(o(this)),t=W.length,n;while(t--)n=W[t],e[n]=this[n];return e},toString:function(){I(this);var e=this.startContainer;if(e===this.endContainer&&n.isCharacterDataNode(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new g(this,!0);return h(r,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){I(this);var t=e.parentNode,r=n.getNodeIndex(e);if(!t)throw new i("NOT_FOUND_ERR");var s=this.comparePoint(t,r),o=this.comparePoint(t,r+1);return s<0?o>0?G:K:o>0?Q:Y},comparePoint:function(e,t){return I(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:n.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:z,toHtml:function(){I(this);var e=o(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){I(this),B(e,"NOT_FOUND_ERR");if(n.getDocument(e)!==o(this))return!1;var r=e.parentNode,i=n.getNodeIndex(e);B(r,"NOT_FOUND_ERR");var s=n.comparePoints(r,i,this.endContainer,this.endOffset),u=n.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?s<=0&&u>=0:s<0&&u>0},isPointInRange:function(e,t){return I(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&n.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){I(this);if(o(e)!=o(this))throw new i("WRONG_DOCUMENT_ERR");var r=n.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),s=n.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?r<=0&&s>=0:r<0&&s>0},intersection:function(e){if(this.intersectsRange(e)){var t=n.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=n.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return t==-1&&i.setStart(e.startContainer,e.startOffset),r==1&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return n.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),n.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new y("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==Y},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,n.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return I(this),new b(this,e,t)},getNodes:function(e,t){return I(this),v(this,e,t)},getDocument:function(){return o(this)},collapseBefore:function(e){M(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){M(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return ut.rangesEqual(this,e)},inspect:function(){return m(this)}},rt(ut,st,ot),e.rangePrototype=Z.prototype,ut.rangeProperties=W,ut.RangeIterator=g,ut.copyComparisonConstants=tt,ut.createPrototypeRange=rt,ut.inspect=m,ut.getRangeDocument=o,ut.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=ut,e.RangeException=y}),e.createModule("WrappedRange",function(e,t){function o(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=i==s?i:r.getCommonAncestor(i,s);return o==t?o:r.getCommonAncestor(t,o)}function u(e){return e.compareEndPoints("StartToEnd",e)==0}function a(e,t,n,s){var o=e.duplicate();o.collapse(n);var u=o.parentElement();r.isAncestorOf(t,u,!0)||(u=t);if(!u.canHaveHTML)return new i(u.parentNode,r.getNodeIndex(u));var a=r.getDocument(u).createElement("span"),f,l=n?"StartToStart":"StartToEnd",c,h,p,d;do u.insertBefore(a,a.previousSibling),o.moveToElementText(a);while((f=o.compareEndPoints(l,e))>0&&a.previousSibling);d=a.nextSibling;if(f==-1&&d&&r.isCharacterDataNode(d)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);var v;if(/[\r\n]/.test(d.data)){var m=o.duplicate(),g=m.text.replace(/\r\n/g,"\r").length;v=m.moveStart("character",g);while((f=m.compareEndPoints("StartToEnd",m))==-1)v++,m.moveStart("character",1)}else{var y=o.text.replace(/\u00a0/g," "),b=d.data.replace(/\u00a0/g," ");if(b.indexOf(y)!==0){while(y.length>0&&b.indexOf(y)!==0)y=y.substr(1);v=y.length}else v=o.text.length}p=new i(d,v)}else c=(s||!n)&&a.previousSibling,h=(s||n)&&a.nextSibling,h&&r.isCharacterDataNode(h)?p=new i(h,0):c&&r.isCharacterDataNode(c)?p=new i(c,c.length):p=new i(u,r.getNodeIndex(a));return a.parentNode.removeChild(a),p}function f(e,t){var n,i,s=e.offset,o=r.getDocument(e.node),u,a,f=o.body.createTextRange(),l=r.isCharacterDataNode(e.node);l?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?i.insertBefore(u,n):i.appendChild(u);try{f.moveToElementText(u),f.collapse(!t)}catch(c){}return i.removeChild(u),l&&f[t?"moveStart":"moveEnd"]("character",s),f}e.requireModules(["DomUtil","DomRange"]);var n,r=e.dom,i=r.DomPosition,s=e.DomRange;if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange))(function(){function u(e){var t=i.length,n;while(t--)n=i[t],e[n]=e.nativeRange[n]}function a(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i;if(s||o)e.setEnd(r,i),e.setStart(t,n)}function f(e){e.nativeRange.detach(),e.detached=!0;var t=i.length,n;while(t--)n=i[t],e[n]=null}var t,i=s.rangeProperties,o,l;n=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,u(this)},s.createPrototypeRange(n,a,f),t=n.prototype,t.selectNode=function(e){this.nativeRange.selectNode(e),u(this)},t.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},t.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},t.collapse=function(e){this.nativeRange.collapse(e),u(this)},t.cloneRange=function(){return new n(this.nativeRange.cloneRange())},t.refresh=function(){u(this)},t.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");r.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0),h.setEnd(c,0);try{h.setStart(c,1),o=!0,t.setStart=
function(e,t){this.nativeRange.setStart(e,t),u(this)},t.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},l=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(p){o=!1,t.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},t.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}t.setStartBefore=l("setStartBefore","setEndBefore"),t.setStartAfter=l("setStartAfter","setEndAfter"),t.setEndBefore=l("setEndBefore","setStartBefore"),t.setEndAfter=l("setEndAfter","setStartAfter"),h.selectNodeContents(c),h.startContainer==c&&h.endContainer==c&&h.startOffset==0&&h.endOffset==c.length?t.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),u(this)}:t.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,s.getEndOffset(e))},h.selectNodeContents(c),h.setEnd(c,3);var d=document.createRange();d.selectNodeContents(c),d.setEnd(c,4),d.setStart(c,2),h.compareBoundaryPoints(h.START_TO_END,d)==-1&h.compareBoundaryPoints(h.END_TO_START,d)==1?t.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(h,"createContextualFragment")&&(t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),r.getBody(document).removeChild(c),h.detach(),d.detach()})(),e.createNativeRange=function(e){return e=e||document,e.createRange()};else if(e.features.implementsTextRange){n=function(e){this.textRange=e,this.refresh()},n.prototype=new s(document),n.prototype.refresh=function(){var e,t,n=o(this.textRange);u(this.textRange)?t=e=a(this.textRange,n,!0,!0):(e=a(this.textRange,n,!0,!1),t=a(this.textRange,n,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},s.copyComparisonConstants(n);var l=function(){return this}();typeof l.Range=="undefined"&&(l.Range=n),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}e.features.implementsTextRange&&(n.rangeToTextRange=function(e){if(e.collapsed){var t=f(new i(e.startContainer,e.startOffset),!0);return t}var n=f(new i(e.startContainer,e.startOffset),!0),s=f(new i(e.endContainer,e.endOffset),!1),o=r.getDocument(e.startContainer).body.createTextRange();return o.setEndPoint("StartToStart",n),o.setEndPoint("EndToEnd",s),o}),n.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createRange=function(t){return t=t||document,new n(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new s(e)},e.createIframeRange=function(t){return e.createRange(r.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(r.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),e.createModule("WrappedSelection",function(e,t){function p(e){return(e||window).getSelection()}function d(e){return(e||window).document.selection}function L(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function A(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function O(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function M(t){var n;return t instanceof o?(n=t._selectionNativeRange,n||(n=e.createNativeRange(i.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof u?n=t.nativeRange:e.features.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function _(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}function D(e){var t=e.getNodes();if(!_(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function P(e){return!!e&&typeof e.text!="undefined"}function H(e,t){var n=new u(t);e._ranges=[n],L(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function B(t){t._ranges.length=0;if(t.docSelection.type=="None")O(t);else{var n=t.docSelection.createRange();if(P(n))H(t,n);else{t.rangeCount=n.length;var r,s=i.getDocument(n.item(0));for(var o=0;o<t.rangeCount;++o)r=e.createRange(s),r.selectNode(n.item(o)),t._ranges.push(r);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,L(t,t._ranges[t.rangeCount-1],!1)}}}function j(e,t){var n=e.docSelection.createRange(),r=D(t),s=i.getDocument(n.item(0)),o=i.getBody(s).createControlRange();for(var u=0,a=n.length;u<a;++u)o.add(n.item(u));try{o.add(r)}catch(f){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),B(e)}function I(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function R(e,t){var n=i.getDocument(t[0].startContainer),r=i.getBody(n).createControlRange();for(var s=0,o;s<rangeCount;++s){o=D(t[s]);try{r.add(o)}catch(u){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),B(e)}function V(e,t){if(e.anchorNode&&i.getDocument(e.anchorNode)!==i.getDocument(t))throw new a("WRONG_DOCUMENT_ERR")}function $(e){var t=[],n=new f(e.anchorNode,e.anchorOffset),r=new f(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var s=0,u=e.rangeCount;s<u;++s)t[s]=o.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var n="boolean",r="_rangySelection",i=e.dom,s=e.util,o=e.DomRange,u=e.WrappedRange,a=e.DOMException,f=i.DomPosition,l,c,h="Control",v=e.util.isHostMethod(window,"getSelection"),m=e.util.isHostObject(document,"selection"),g=m&&(!v||e.config.preferTextRange);g?(l=d,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return n.type!="None"||i.getDocument(n.createRange().parentElement())==t}):v?(l=p,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=l;var y=l(),b=e.createNativeRange(document),w=i.getBody(document),E=s.areHostObjects(y,["anchorNode","focusNode"]&&s.areHostProperties(y,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=E;var S=s.isHostMethod(y,"extend");e.features.selectionHasExtend=S;var x=typeof y.rangeCount=="number";e.features.selectionHasRangeCount=x;var T=!1,N=!0;s.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount=="number"&&e.features.implementsDomRange&&function(){var e=document.createElement("iframe");w.appendChild(e);var t=i.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=i.getIframeWindow(e).getSelection(),r=t.documentElement,s=r.lastChild,o=s.firstChild,u=t.createRange();u.setStart(o,1),u.collapse(!0),n.addRange(u),N=n.rangeCount==1,n.removeAllRanges();var a=u.cloneRange();u.setStart(o,0),a.setEnd(o,2),n.addRange(u),n.addRange(a),T=n.rangeCount==2,u.detach(),a.detach(),w.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=T,e.features.collapsedNonEditableSelectionsSupported=N;var C=!1,k;w&&s.isHostMethod(w,"createControlRange")&&(k=w.createControlRange(),s.areHostProperties(k,["item","add"])&&(C=!0)),e.features.implementsControlRange=C,E?c=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:c=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var F;s.isHostMethod(y,"getRangeAt")?F=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:E&&(F=function(t){var n=i.getDocument(t.anchorNode),r=e.createRange(n);return r.setStart(t.anchorNode,t.anchorOffset),r.setEnd(t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&(r.setStart(t.focusNode,t.focusOffset),r.setEnd(t.anchorNode,t.anchorOffset)),r}),e.getSelection=function(e){e=e||window;var t=e[r],n=l(e),i=m?d(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh(e)):(t=new I(n,i,e),e[r]=t),t},e.getIframeSelection=function(t){return e.getSelection(i.getIframeWindow(t))};var q=I.prototype;if(!g&&E&&s.areHostMethods(y,["removeAllRanges","addRange"])){q.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),O(this)};var U=function(t,n){var r=o.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(M(i)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};x?q.addRange=function(t,n){if(C&&m&&this.docSelection.type==h)j(this,t);else if(n&&S)U(this,t);else{var r;T?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(M(t)),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=F(this.nativeSelection,this.rangeCount-1);i&&!o.rangesEqual(i,t)&&(t=new u(i))}this._ranges[this.rangeCount-1]=t,L(this,t,X(this.nativeSelection)),this.isCollapsed=c(this)}else this.refresh()}}:q.addRange=function(e,t){t&&S?U(this,e):(this.nativeSelection.addRange(M(e)),this.refresh())},q.setRanges=function(e){if(C&&e.length>1)R(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(s.isHostMethod(y,"empty")&&s.isHostMethod(b,"select")&&C&&g))return t.fail("No means of selecting a Range or TextRange was found"),!1;q.removeAllRanges=function(){try{var e=jQuery.browser.msie&&jQuery.browser.version<8&&typeof document.documentMode=="undefined";e||this.docSelection.empty();if(this.docSelection.type!="None"){e&&this.docSelection.empty();var t;if(this.anchorNode)t=i.getDocument(this.anchorNode);else if(this.docSelection.type==h){var n=this.docSelection.createRange();n.length&&(t=i.getDocument(n.item(0)).body.createTextRange())}if(t){var r=t.body.createTextRange();r.select(),this.docSelection.empty()}}}catch(s){}O(this)},q.addRange=function(e){if(this.docSelection.type==h)j(this,e);else try{u.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,e,!1)}catch(t){}},q.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?R(this,e):t&&this.addRange(e[0])}}q.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new a("INDEX_SIZE_ERR");return this._ranges[e]};var z;if(g)z=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=i.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==h?B(t):P(n)?H(t,n):O(t)};else if(s.isHostMethod(y,"getRangeAt")&&typeof y.rangeCount=="number")z=function(t){if(C&&m&&t.docSelection.type==h)B(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));L(t,t._ranges[t.rangeCount-1],X(t.nativeSelection)),t.isCollapsed=c(t)}else O(t)}};else{if(!E||typeof y.isCollapsed!=n||typeof b.collapsed!=n||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;z=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=F(n,0),e._ranges=[t],e.rangeCount=1,A(e),e.isCollapsed=c(e)):O(e)}}q.refresh=function(e){var t=e?this._ranges.slice(0):null;z(this);if(e){var n=t.length;if(n!=this._ranges.length)return!1;while(n--)if(!o.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var W=function(e,t){var n=e.getAllRanges(),r=!1;e.removeAllRanges();for(var i=0,s=n.length;i<s;++i)r||t!==n[i]?e.addRange(n[i]):r=!0;e.rangeCount||O(e)};C?q.removeRange=function(e){if(this.docSelection.type==h){var t=this.docSelection.createRange(),n=D(e),r=i.getDocument(t.item(0)),s=i.getBody(r).createControlRange(),o,u=!1;for(var a=0,f=t.length;a<f;++a)o=t.item(a),o!==n||u?s.add(t.item(a)):u=!0;s.select(),B(this)}else W(this,e)}:q.removeRange=function(e){W(this,e)};var X;!g&&E&&e.features.implementsDomRange?(X=function(e){var t=!1;return e.anchorNode&&(t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t},q.isBackwards=function(){return X(this)}):X=q.isBackwards=function(){return!1},q.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},q.collapse=function(t,n){V(this,t);var r=e.createRange(i.getDocument(t));r.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(r),this.isCollapsed=!0},q.collapseToStart=function(){if(!this.rangeCount)throw new a("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},q.collapseToEnd=function(){if(!this.rangeCount)throw new a("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},q.selectAllChildren=function(t){V(this,t);var n=e.createRange(i.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},q.deleteFromDocument=function(){if(C&&m&&this.docSelection.type==h){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}},q.getAllRanges=function(){return this._ranges.slice(0)},q.setSingleRange=function(e){this.setRanges([e])},q.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},q.toHtml=function(){var e="";if(this.rangeCount){var t=o.getRangeDocument(this._ranges[0]).createElement("div");for(var n=0,r=this._ranges.length;n<r;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},q.getName=function(){return"WrappedSelection"},q.inspect=function(){return $(this)},q.detach=function(){this.win[r]=null,this.win=this.anchorNode=this.focusNode=null},I.inspect=$,e.Selection=I,e.selectionPrototype=q,e.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),window.rangy=e,e}),define("util/class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(){function u(){!e&&this._constructor&&this._constructor.apply(this,arguments)}var n=this.prototype;e=!0;var r=new this;e=!1;for(var i=0;i<arguments.length;i++){var s=arguments[i];for(var o in s)r[o]=typeof s[o]=="function"&&typeof n[o]=="function"&&t.test(s[o])?function(e,t){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);return this._super=r,i}}(o,s[o]):s[o]}return u.prototype=r,u.constructor=u,u.extend=arguments.callee,u},this.Class}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/lang",[],function(){}),function(e,t){var n=e.alohaQuery||e.jQuery,r=n,i=e.GENTICS,s=e.Class,o=e.console;i.Utils.applyProperties=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},i.Utils.uniqeString4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},i.Utils.guid=function(){var e=i.Utils.uniqeString4;return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(window),define("aloha/ecma5shims",[],function(){function r(e){var t=null;if(e)do t=e;while(e=e.parentNode);return t}function i(e,t){return(e.contains(t)&&16)+(t.contains(e)&&8)+(e.sourceIndex>=0&&t.sourceIndex>=0?(e.sourceIndex<t.sourceIndex&&4)+(e.sourceIndex>t.sourceIndex&&2):1)}function s(e){return"sourceIndex"in e?e:e.parentNode.insertBefore(document.createComment(""),e)}var e={bind:function(e){var t=this.obj||this,n=Function.prototype.bind,r=Array.prototype.slice.call(arguments,1);return n?n.apply(t,arguments):function(){return t.apply(e,arguments.length===0?r:r.concat(Array.prototype.slice.call(arguments)))}},trim:function(){var e=this.obj||this,t=String.prototype.trim;return t?t.call(e):e.replace(/^\s+/,"").replace(/\s+$/,"")},indexOf:function(e,t){var n=this.obj||this,r=Array.prototype.indexOf;if(r)return r.call(n,e,t);t===undefined&&(t=0),t<0&&(t+=n.length),t<0&&(t=0);for(var i=n.length;t<i;t++)if(t in n&&n[t]===e)return t;return-1},forEach:function(e,t){var n=this.obj||this,r=Array.prototype.forEach;if(r)return r.call(n,e,t);for(var i=0,s=n.length;i<s;i++)i in n&&e.call(t,n[i],i,n)},map:function(e,n,r){var i=this.obj||this,s=Array.prototype.map,o=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,u=[];if(s)u=s.call(i,e,n);else{var a=new Array(i.length);for(var f=0,l=i.length;f<l;f++)f in i&&(a[f]=e.call(n,i[f],f,i));u=a}return o?t(u):u},filter:function(e,n,r){var i=this.obj||this,s=Array.prototype.filter,o=typeof arguments[arguments.length-1]=="boolean"?Array.prototype.pop.call(arguments):!1,u=[];if(s)u=s.call(i,e,n);else{var a=[],f;for(var l=0,c=i.length;l<c;l++)l in i&&e.call(n,f=i[l],l,i)&&a.push(f);u=a}return o?t(u):u},every:function(e,t){var n=this.obj||this,r=Array.prototype.every;if(r)return r.call(n,e,t);for(var i=0,s=n.length;i<s;i++)if(i in n&&!e.call(t,n[i],i,n))return!1;return!0},some:function(e,t){var n=this.obj||this,r=Array.prototype.some;if(r)return r.call(n,e,t);for(var i=0,s=n.length;i<s;i++)if(i in n&&e.call(t,n[i],i,n))return!0;return!1},hasAttribute:function(e){var t=this.obj||this,n=t.hasAttribute;return n?t.hasAttribute(e):!!t.getAttribute(e)}},t=function(t){var n=function(){};n.prototype=e;var r=new n;return r.obj=t,r};for(var n in e)t[n]=e[n];return typeof Node!="undefined"?t.Node=Node:t.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},t.compareDocumentPosition=function(e,t){if("compareDocumentPosition"in document.documentElement)return e.compareDocumentPosition(t);if("contains"in document.documentElement){if(e==t)return 0;if(r(e)!=r(t))return 1;if("sourceIndex"in e&&"sourceIndex"in t)return i(e,t);if(e==document)return 20;if(t==document)return 10;var n=s(e),o=s(t),u=i(n,o);return e!=n&&n.parentNode.removeChild(n),t!=o&&o.parentNode.removeChild(o),u}throw"neither compareDocumentPosition nor contains is supported by this browser."},t.getComputedStyle=function(e,t){return"getComputedStyle"in window?window.getComputedStyle(e,t):e.currentStyle?e.currentStyle:null},t}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/dom",["jquery","util/class","aloha/ecma5shims"],function(e,t,n){var r=window.GENTICS,i={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32},s={P:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,LI:!0},o=t.extend({wordRegex:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,nonWordRegex:/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,mergeableTags:["b","code","del","em","i","ins","strong","sub","sup","#text"],nonWordBoundaryTags:["a","b","code","del","em","i","ins","span","strong","sub","sup","#text"],nonEmptyTags:["br"],tags:{flow:["a","abbr","address","area","article","aside","audio","b","bdi","bdo","blockquote","br","button","canvas","cite","code","command","datalist","del","details","dfn","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","menu","meter","nav","noscript","object","ol","output","p","pre","progress","q","ruby","s","samp","script","section","select","small","span","strong","style","sub","sup","svg","table","textarea","time","u","ul","var","video","wbr","#text"],phrasing:["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","command","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","samp","script","select","small","span","strong","sub","sup","svg","textarea","time","u","var","video","wbr","#text"]},children:{a:"phrasing",abbr:"phrasing",address:"flow",area:"empty",article:"flow",aside:"flow",audio:"source",b:"phrasing",base:"empty",bdo:"phrasing",blockquote:"phrasing",body:"flow",br:"empty",button:"phrasing",canvas:"phrasing",caption:"flow",cite:"phrasing",code:"phrasing",col:"empty",colgroup:"col",command:"empty",datalist:["phrasing","option"],dd:"flow",del:"phrasing",div:"flow",details:["summary","flow"],dfn:"flow",dl:["dt","dd"],dt:"phrasing",em:"phrasing",embed:"empty",fieldset:["legend","flow"],figcaption:"flow",figure:["figcaption","flow"],footer:"flow",form:"flow",h1:"phrasing",h2:"phrasing",h3:"phrasing",h4:"phrasing",h5:"phrasing",h6:"phrasing",header:"flow",hgroup:["h1","h2","h3","h4","h5","h6"],hr:"empty",i:"phrasing",iframe:"#text",img:"empty",input:"empty",ins:"phrasing",kbd:"phrasing",keygen:"empty",label:"phrasing",legend:"phrasing",li:"flow",link:"empty",map:"area",mark:"phrasing",menu:["li","flow"],meta:"empty",meter:"phrasing",nav:"flow",noscript:"phrasing",object:"param",ol:"li",optgroup:"option",option:"#text",output:"phrasing",p:"phrasing",param:"empty",pre:"phrasing",progress:"phrasing",q:"phrasing",rp:"phrasing",rt:"phrasing",ruby:["phrasing","rt","rp"],s:"phrasing",samp:"pharsing",script:"#script",section:"flow",select:["option","optgroup"],small:"phrasing",source:"empty",span:"phrasing",strong:"phrasing",style:"phrasing",sub:"phrasing",summary:"phrasing",sup:"phrasing",table:["caption","colgroup","thead","tbody","tfoot","tr"],tbody:"tr",td:"flow",textarea:"#text",tfoot:"tr",th:"phrasing",thead:"tr",time:"phrasing",title:"#text",tr:["th","td"],track:"empty",u:"phrasing",ul:"li","var":"phrasing",video:"source",wbr:"empty"},blockLevelElements:["p","h1","h2","h3","h4","h5","h6","blockquote","div","pre"],listElements:["li","ol","ul"],split:function(t,n,r){var i=e(t.startContainer),s=t.startOffset,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;r&&(i=e(t.endContainer),s=t.endOffset),n.length<1&&(n=e(document.body)),o=!t.isCollapsed()&&!r,a=i.parents().get(),a.unshift(i.get(0)),e.each(a,function(e,t){var r=n.filter(function(){return this==t}).length;if(r)return e>0&&(u=a.slice(0,e)),!1});if(!u)return!0;u=u.reverse();for(h=0,p=u.length;h<p;++h){d=u[h];if(h===p-1)d.nodeType===3?(c=document.createTextNode(d.data.substring(s,d.data.length)),d.data=d.data.substring(0,s)):(v=e(d),m=v.contents(),g=v.clone(!1).empty(),c=g.append(m.slice(s,m.length)).get(0)),o&&t.endContainer===d&&(t.endContainer=c,t.endOffset-=s,t.clearCaches()),l?l.prepend(c):e(d).after(c);else{g=e(d).clone(!1).empty(),f?l.prepend(g):f=g,l=g;for(;;){y=u[h+1].nextSibling;if(!y)break;l.append(y)}if(o&&t.endContainer===d){t.endContainer=g.get(0),b=u[h+1],w=0;for(;;){b=b.previousSibling;if(!b)break;w++}t.endOffset-=w,t.clearCaches()}}}return e(u[0]).after(f),e([u[0],f?f.get(0):c])},allowsNesting:function(t,n){if(!t||!t.nodeName||!n||!n.nodeName)return!1;var r=t.nodeName.toLowerCase(),i=n.nodeName.toLowerCase();return this.children[r]?this.children[r]==i?!0:e.isArray(this.children[r])&&e.inArray(i,this.children[r])>=0?!0:e.isArray(this.tags[this.children[r]])&&e.inArray(i,this.tags[this.children[r]])>=0?!0:!1:!1},addMarkup:function(t,n,r){t.startContainer.nodeType===3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length&&this.split(t,e(t.startContainer).parent(),!1),t.endContainer.nodeType===3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length&&this.split(t,e(t.endContainer).parent(),!0);var i=t.getRangeTree();this.recursiveAddMarkup(i,n,t,r),this.doCleanup({merge:!0,removeempty:!0},t)},recursiveAddMarkup:function(t
,n,i,s){var o,u,a;for(o=0,a=t.length;o<a;++o)t[o].type=="full"&&this.allowsNesting(n.get(0),t[o].domobj)?(s||t[o].domobj.nodeName!=n.get(0).nodeName)&&(t[o].domobj.nodeType!==3||e.trim(t[o].domobj.data).length!==0)&&(e(t[o].domobj).wrap(n),!s&&t[o].domobj.nodeType!==3&&(u=new r.Utils.RangeObject,u.startContainer=u.endContainer=t[o].domobj.parentNode,u.startOffset=0,u.endOffset=u.endContainer.childNodes.length,this.removeMarkup(u,n,e(t[o].domobj.parentNode)))):(s||t[o].domobj&&t[o].domobj.nodeName!==n.get(0).nodeName)&&t[o].children&&t[o].children.length>0&&this.recursiveAddMarkup(t[o].children,n)},findHighestElement:function(e,t,n){t=t.toLowerCase();var r,i=e,s=n?function(){return n.filter(function(){return i==this}).length}:function(){return!1};while(!s()&&i)i.nodeName.toLowerCase()===t&&(r=i),i=i.parentNode;return r},removeMarkup:function(t,n,r){var i=n.get(0).nodeName,s=this.findHighestElement(t.startContainer,i,r),o=this.findHighestElement(t.endContainer,i,r),u=!1,a,f,l;s&&t.startOffset>0&&(this.split(t,e(s).parent(),!1),u=!0),o&&(t.endContainer.nodeType===3&&t.endOffset<t.endContainer.data.length&&(this.split(t,e(o).parent(),!0),u=!0),t.endContainer.nodeType===1&&t.endOffset<t.endContainer.childNodes.length&&(this.split(t,e(o).parent(),!0),u=!0)),u&&t.correctRange(),a=this.findHighestElement(t.getCommonAncestorContainer(),i,r),f=a?a.parentNode:t.getCommonAncestorContainer(),f&&(l=t.getRangeTree(f),this.recursiveRemoveMarkup(l,n),this.doCleanup({merge:!0,removeempty:!0},t,f))},recursiveRemoveMarkup:function(t,n){var r,i,s;for(r=0,i=t.length;r<i;++r)t[r].type=="full"&&t[r].domobj.nodeName==n.get(0).nodeName&&(s=e(t[r].domobj).contents(),s.length>0?s.first().unwrap():e(t[r].domobj).remove()),t[r].children&&this.recursiveRemoveMarkup(t[r].children,n)},doCleanup:function(t,n,i){var s=this,o,u,a,f,l;return typeof t=="undefined"&&(t={}),typeof t.merge=="undefined"&&(t.merge=!1),typeof t.removeempty=="undefined"&&(t.removeempty=!1),typeof i=="undefined"&&n&&(i=n.getCommonAncestorContainer()),o=!1,u=!1,a=e(i),f=n.startOffset,l=n.endOffset,a.contents().each(function(){var i,c;try{c=this.nodeType,i=s.getIndexInParent(this)}catch(h){return}switch(c){case 1:if(o&&o.nodeName==this.nodeName)n.startContainer===a&&f>i&&(n.startOffset-=1,u=!0),n.endContainer===a&&l>i&&(n.endOffset-=1,u=!0),e(o).append(e(this).contents()),u|=s.doCleanup(t,n,o),e(this).remove();else{u|=s.doCleanup(t,n,this);var p=!1;t.removeempty&&(r.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length===0&&(p=!0),e.inArray(this.nodeName.toLowerCase(),s.mergeableTags)>=0&&e(this).text().length===0&&this.childNodes.length===0&&(p=!0)),p?(n.startContainer===this.parentNode&&f>i&&(n.startOffset=n.startOffset-1,u=!0),n.endContainer===this.parentNode&&l>i&&(n.endOffset=n.endOffset-1,u=!0),e(this).remove()):e.inArray(this.nodeName.toLowerCase(),s.mergeableTags)>=0?o=this:o=!1}break;case 3:if(o&&o.nodeType===3&&t.merge)n.startContainer===this?(n.startContainer=o,n.startOffset+=o.nodeValue.length,u=!0):n.startContainer===o.parentNode&&n.startOffset===s.getIndexInParent(o)+1&&(n.startContainer=o,n.startOffset=o.nodeValue.length,u=!0),n.endContainer===this?(n.endContainer=o,n.endOffset+=o.nodeValue.length,u=!0):n.endContainer===o.parentNode&&n.endOffset===s.getIndexInParent(o)+1&&(n.endContainer=o,n.endOffset=o.nodeValue.length,u=!0),o.data+=this.data;else if(this.nodeValue!==""||!t.removeempty)if(this.nodeValue!==""||!t.removeempty){o=this;break}n.startContainer===this.parentNode&&n.startOffset>i&&(n.startOffset=n.startOffset-1,u=!0),n.endContainer===this.parentNode&&n.endOffset>i&&(n.endOffset=n.endOffset-1,u=!0),e(this).remove();if(o&&(!o.nextSibling||o.nextSibling.nodeType!==3)){var d;for(d=o.data.length-1;d>=0&&o.data.length>1;d--)o.data.charAt(d)===""&&(o.deleteData(d,1),n.startContainer===o&&n.startOffset>d&&(n.startOffset--,u=!0),n.endContainer===o&&n.endOffset>d&&(n.endOffset--,u=!0))}}}),u&&n.clearCaches(),u},getIndexInParent:function(e){if(!e)return!1;var t=0,n=e.previousSibling;while(n)t++,n=n.previousSibling;return t},isBlockLevelElement:function(t){return t?t.nodeType===1&&e.inArray(t.nodeName.toLowerCase(),this.blockLevelElements)>=0?!0:!1:!1},isLineBreakElement:function(e){return e?e.nodeType===1&&e.nodeName.toLowerCase()=="br":!1},isListElement:function(t){return t?t.nodeType===1&&e.inArray(t.nodeName.toLowerCase(),this.listElements)>=0:!1},isSplitObject:function(e){return e.nodeType===1&&s.hasOwnProperty(e.nodeName)},searchAdjacentTextNode:function(t,n,r,i){if(!t||t.nodeType!==1||n<0||n>t.childNodes.length)return!1;typeof i=="undefined"&&(i={blocklevel:!0,list:!0,linebreak:!0}),typeof i.blocklevel=="undefined"&&(i.blocklevel=!0),typeof i.list=="undefined"&&(i.list=!0),typeof i.linebreak=="undefined"&&(i.linebreak=!0),typeof r=="undefined"&&(r=!0);var s,o=t;r&&n>0&&(s=t.childNodes[n-1]),!r&&n<t.childNodes.length&&(s=t.childNodes[n]);while(o)if(!s){if(i.blocklevel&&this.isBlockLevelElement(o))return!1;if(i.list&&this.isListElement(o))return!1;s=r?o.previousSibling:o.nextSibling,o=o.parentNode}else{if(s.nodeType===3&&e.trim(s.data).length>0)return s;if(i.blocklevel&&this.isBlockLevelElement(s))return!1;if(i.linebreak&&this.isLineBreakElement(s))return!1;if(i.list&&this.isListElement(s))return!1;s.nodeType===3?s=r?s.previousSibling:s.nextSibling:(o=s,s=r?s.lastChild:s.firstChild)}},insertIntoDOM:function(t,n,r,i,s){var o=n.getContainerParents(r,i),u=this,a,f,l,c,h;return r||(r=e(document.body)),o.length===0?a=r.get(0):e.each(o,function(e,n){if(u.allowsNesting(n,t.get(0)))return a=n,!1}),typeof a=="undefined"&&r.length>0&&(a=r.get(0)),!this.allowsNesting(a,t.get(0))&&!s?!1:typeof a!="undefined"?(c=this.split(n,e(a),i),c===!0?(f=n.startContainer,l=n.startOffset,i&&(f=n.endContainer,l=n.endOffset),l===0?(h=e(f).contents(),h.length>0?h.eq(0).before(t):e(f).append(t),!0):(e(f).contents().eq(l-1).after(t),!0)):c?(c.eq(0).after(t),!0):!1):!1},removeFromDOM:function(t,n,r){if(r){var i=this.getIndexInParent(t),s=e(t).contents().length,o=t.parentNode;n.startContainer==o&&n.startOffset>i?n.startOffset+=s-1:n.startContainer==t&&(n.startContainer=o,n.startOffset=i+n.startOffset),n.endContainer==o&&n.endOffset>i?n.endOffset+=s-1:n.endContainer==t&&(n.endContainer=o,n.endOffset=i+n.endOffset),e(t).contents().unwrap(),this.doCleanup({merge:!0},n,o)}},removeRange:function(t){if(!t)return!1;if(t.isCollapsed())return!1;t.startContainer.nodeType==3&&t.startOffset>0&&t.startOffset<t.startContainer.data.length&&this.split(t,e(t.startContainer).parent(),!1),t.endContainer.nodeType==3&&t.endOffset>0&&t.endOffset<t.endContainer.data.length&&this.split(t,e(t.endContainer).parent(),!0);var n=t.getRangeTree();t.endContainer=t.startContainer,t.endOffset=t.startOffset,this.recursiveRemoveRange(n,t),this.doCleanup({merge:!0},t),t.clearCaches()},recursiveRemoveRange:function(t,n){for(var r=0;r<t.length;++r)t[r].type=="full"?(e(n.startContainer).parents().andSelf().filter(t[r].domobj).length>0&&(n.startContainer=n.endContainer=t[r].domobj.parentNode,n.startOffset=n.endOffset=this.getIndexInParent(t[r].domobj)),e(t[r].domobj).remove()):t[r].type=="partial"&&t[r].children&&this.recursiveRemoveRange(t[r].children,n)},extendToWord:function(e,t){var n=this.searchWordBoundary(e.startContainer,e.startOffset,!0),r=this.searchWordBoundary(e.endContainer,e.endOffset,!1);if(!t){if(e.startContainer==n.container&&e.startOffset==n.offset)return;if(e.endContainer==r.container&&e.endOffset==r.offset)return}e.startContainer=n.container,e.startOffset=n.offset,e.endContainer=r.container,e.endOffset=r.offset,e.correctRange(),e.clearCaches()},isWordBoundaryElement:function(t){return!t||!t.nodeName?!1:e.inArray(t.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1},searchWordBoundary:function(e,t,n){typeof n=="undefined"&&(n=!0);var r=!1,i,s,o;while(!r)if(e.nodeType===3)if(!n)i=e.data.substring(t).search(this.nonWordRegex),i!=-1?(t+=i,r=!0):(t=this.getIndexInParent(e)+1,e=e.parentNode);else{i=e.data.substring(0,t).search(this.nonWordRegex),s=i;while(s!=-1)i=s,s=e.data.substring(i+1,t).search(this.nonWordRegex),s!=-1&&(s=s+i+1);i!=-1?(t=i+1,r=!0):(t=this.getIndexInParent(e),e=e.parentNode)}else e.nodeType===1&&(n?t>0?this.isWordBoundaryElement(e.childNodes[t-1])?r=!0:(e=e.childNodes[t-1],t=e.nodeType===3?e.data.length:e.childNodes.length):this.isWordBoundaryElement(e)?r=!0:(t=this.getIndexInParent(e),e=e.parentNode):t<e.childNodes.length?this.isWordBoundaryElement(e.childNodes[t])?r=!0:(e=e.childNodes[t],t=0):this.isWordBoundaryElement(e)?r=!0:(t=this.getIndexInParent(e)+1,e=e.parentNode));return e.nodeType!==3&&(o=this.searchAdjacentTextNode(e,t,!n),o&&(e=o,t=n?0:e.data.length)),{container:e,offset:t}},isEmpty:function(t){if(!t)return!0;if(e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)!=-1)return!1;if(t.nodeType===3)return t.data.search(/\S/)==-1;for(var n=0,r=t.childNodes.length;n<r;++n)if(!this.isEmpty(t.childNodes[n]))return!1;return!0},setCursorAfter:function(e){var t=new r.Utils.RangeObject,n=this.getIndexInParent(e),i,s;return e.nodeType==3?(i=e,s=i.nodeValue.length):e.nextSibling&&e.nextSibling.nodeType==3?(i=e.nextSibling,s=0):(i=e.parentNode,s=this.getIndexInParent(e)+1),t.startContainer=t.endContainer=i,t.startOffset=t.endOffset=s,t.select(),t},selectDomNode:function(e){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=e.parentNode,t.startOffset=this.getIndexInParent(e),t.endOffset=t.startOffset+1,t.select()},setCursorInto:function(e){var t=new r.Utils.RangeObject;t.startContainer=t.endContainer=e,t.startOffset=t.endOffset=0,t.select()},isEditingHost:function(e){return e&&e.nodeType==1&&(e.contentEditable=="true"||e.parentNode&&e.parentNode.nodeType==9&&e.parentNode.designMode=="on")},isEditable:function(e){return e&&!this.isEditingHost(e)&&(e.nodeType!=1||e.contentEditable!="false")&&(this.isEditingHost(e.parentNode)||this.isEditable(e.parentNode))},getEditingHostOf:function(e){if(this.isEditingHost(e))return e;if(this.isEditable(e)){var t=e.parentNode;while(!this.isEditingHost(t))t=t.parentNode;return t}return null},inSameEditingHost:function(e,t){return this.getEditingHostOf(e)&&this.getEditingHostOf(e)==this.getEditingHostOf(t)},isBlockNode:function(e){return e&&(e.nodeType==n.Node.ELEMENT_NODE&&n(["inline","inline-block","inline-table","none"]).indexOf(n.getComputedStyle(e).display)==-1||e.nodeType==n.Node.DOCUMENT_NODE||e.nodeType==n.Node.DOCUMENT_FRAGMENT_NODE)},getFirstVisibleChild:function(t,r){if(!t)return null;if(t.nodeType==n.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==n.Node.ELEMENT_NODE&&t.offsetHeight==0&&e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(t.nodeType==n.Node.TEXT_NODE||t.nodeType==n.Node.ELEMENT_NODE&&t.childNodes.length==0||!e(t).contentEditable())return r?t:null;for(var i=0;i<t.childNodes.length;++i){var s=this.getFirstVisibleChild(t.childNodes[i],!0);if(s!=null)return s}return null},getLastVisibleChild:function(t,r){if(!t)return null;if(t.nodeType==n.Node.TEXT_NODE&&this.isEmpty(t)||t.nodeType==n.Node.ELEMENT_NODE&&t.offsetHeight==0&&e.inArray(t.nodeName.toLowerCase(),this.nonEmptyTags)===-1)return null;if(t.nodeType==n.Node.TEXT_NODE||t.nodeType==n.Node.ELEMENT_NODE&&t.childNodes.length==0||!e(t).contentEditable())return r?t:null;for(var i=t.childNodes.length-1;i>=0;--i){var s=this.getLastVisibleChild(t.childNodes[i],!0);if(s!=null)return s}return null}});return r.Utils.Dom=new o,r.Utils.Dom}),define("aloha/pluginmanager",["jquery","util/class"],function(e,t){return new(t.extend({plugins:{},init:function(e,t){var n=this,r=Aloha&&Aloha.settings?Aloha.settings.plugins||{}:{},i,s,o;for(o in r)r.hasOwnProperty(o)&&(s=this.plugins[o]||!1,s&&(s.settings=r[o]||{}));if(!t.length)for(o in this.plugins)this.plugins.hasOwnProperty(o)&&t.push(o);for(i=0;i<t.length;++i)o=t[i],s=this.plugins[o]||!1,s&&(s.settings=s.settings||{},typeof s.settings.enabled=="undefined"&&(s.settings.enabled=!0),s.settings.enabled&&s.checkDependencies()&&s.init());e()},register:function(e){if(!e.name)throw new Error("Plugin does not have an name.");if(this.plugins[e.name])throw new Error('Already registered the plugin "'+e.name+'"!');this.plugins[e.name]=e},makeClean:function(e){var t,n;for(n in this.plugins)this.plugins.hasOwnProperty(n)&&(Aloha.Log.isDebugEnabled()&&Aloha.Log.debug(this,"Passing contents of HTML Element with id { "+e.attr("id")+" } for cleaning to plugin { "+n+" }"),this.plugins[n].makeClean(e))},toString:function(){return"pluginmanager"}}))}),define("aloha/core",["jquery","aloha/pluginmanager"],function(e,t){return e.extend(!0,Aloha,{version:"${version}",editables:[],activeEditable:null,settings:{},defaults:{},ui:{},OSName:"Unknown",stage:"loadingAloha",loadedPlugins:[],_pluginBaseUrlByName:{},init:function(){Aloha.stage="initAloha",Aloha.initAloha(function(){Aloha.stage="initPlugins",Aloha.initPlugins(function(){Aloha.stage="initGui",Aloha.initGui(function(){Aloha.stage="alohaReady",Aloha.trigger("aloha-ready")})})})},getLoadedPlugins:function(){return this.loadedPlugins},isPluginLoaded:function(t){var n=!1;return e.each(this.loadedPlugins,function(){t.toString()===this.toString()&&(n=!0)}),n},initAloha:function(t){var n=e("html");(e.browser.webkit&&parseFloat(e.browser.version)<532.5||e.browser.mozilla&&parseFloat(e.browser.version)<1.9||e.browser.msie&&e.browser.version<7||e.browser.opera&&e.browser.version<11)&&window.console&&window.console.log&&window.console.log("Your browser is not supported."),e("html").mousedown(function(t){Aloha.activeEditable&&!e(".aloha-dialog").is(":visible")&&!Aloha.eventHandled&&(Aloha.activeEditable.blur(),Aloha.activeEditable=null)}).mouseup(function(e){Aloha.eventHandled=!1}),e.browser.webkit?n.addClass("aloha-webkit"):e.browser.opera?n.addClass("aloha-opera"):e.browser.msie?n.addClass("aloha-ie"+parseInt(e.browser.version,10)):e.browser.mozilla&&n.addClass("aloha-mozilla"),Aloha.settings.base=Aloha.getAlohaUrl(),Aloha.Log.init(),Aloha.settings.errorhandling&&(window.onerror=function(e,t,n){return Aloha.Log.error(Aloha,"Error message: "+e+"\nURL: "+t+"\nLine Number: "+n),!0}),navigator.appVersion.indexOf("Win")!=-1&&(Aloha.OSName="Win"),navigator.appVersion.indexOf("Mac")!=-1&&(Aloha.OSName="Mac"),navigator.appVersion.indexOf("X11")!=-1&&(Aloha.OSName="Unix"),navigator.appVersion.indexOf("Linux")!=-1&&(Aloha.OSName="Linux");try{var r;try{r=document.queryCommandSupported("enableObjectResizing")}catch(i){r=!1,Aloha.Log.log("enableObjectResizing is not supported.")}r&&(document.execCommand("enableObjectResizing",!1,!1),Aloha.Log.log("enableObjectResizing disabled."))}catch(i){Aloha.Log.error(i,"Could not disable enableObjectResizing")}t()},initPlugins:function(e){t.init(e,this.getLoadedPlugins())},initGui:function(e){Aloha.RepositoryManager.init();for(var t=0,n=Aloha.editables.length;t<n;t++)Aloha.editables[t].ready||Aloha.editables[t].init();e()},activateEditable:function(e){for(var t=0,n=Aloha.editables.length;t<n;t++)Aloha.editables[t]!=e&&Aloha.editables[t].isActive&&Aloha.editables[t].blur();Aloha.activeEditable=e},getActiveEditable:function(){return Aloha.activeEditable},deactivateEditable:function(){if(typeof Aloha.activeEditable=="undefined"||Aloha.activeEditable===null)return;Aloha.activeEditable.blur(),Aloha.activeEditable=null},getEditableById:function(t){e("#"+t).get(0).nodeName.toLowerCase()==="textarea"&&(t+="-aloha");for(var n=0,r=Aloha.editables.length;n<r;n++)if(Aloha.editables[n].getId()==t)return Aloha.editables[n];return null},isEditable:function(e){for(var t=0,n=Aloha.editables.length;t<n;t++)if(Aloha.editables[t].originalObj.get(0)===e)return!0;return!1},log:function(e,t,n){typeof Aloha.Log!="undefined"&&Aloha.Log.log(e,t,n)},registerEditable:function(e){Aloha.editables.push(e)},unregisterEditable:function(t){var n=e.inArray(t,Aloha.editables);n!=-1&&Aloha.editables.splice(n,1)},toString:function(){return"Aloha"},isModified:function(){for(var e=0;e<Aloha.editables.length;e++)if(Aloha.editables[e].isModified&&Aloha.editables[e].isModified())return!0;return!1},getAlohaUrl:function(e){return Aloha.settings.baseUrl},getPluginUrl:function(e){var t;return e&&(t=Aloha.settings._pluginBaseUrlByName[e],t&&(t.match("^(/|http[s]?:).*")||(t=Aloha.getAlohaUrl()+"/"+t))),t}}),Aloha}),define("aloha/console",["aloha/core","util/class","jquery"],function(e,t,n){var r=window.console,i=t.extend({init:function(){if(typeof e.settings.logLevels=="undefined"||!e.settings.logLevels)e.settings.logLevels={error:!0,warn:!0};if(typeof e.settings.logHistory=="undefined"||!e.settings.logHistory)e.settings.logHistory={};e.settings.logHistory.maxEntries||(e.settings.logHistory.maxEntries=100),e.settings.logHistory.highWaterMark||(e.settings.logHistory.highWaterMark=90),e.settings.logHistory.levels||(e.settings.logHistory.levels={error:!0,warn:!0}),this.flushLogHistory(),e.trigger("aloha-logger-ready")},logHistory:[],highWaterMarkReached:!1,log:function(t,n,i){typeof n=="undefined"&&(i=t),typeof n!="string"&&n&&n.toString&&(n=n.toString()),typeof i=="undefined"&&(i=n,n=undefined);if(typeof t=="undefined"||!t)t="log";t=t.toLowerCase();if(typeof e.settings.logLevels=="undefined")return;if(!e.settings.logLevels[t])return;n=n||"Unkown Aloha Component",this.addToLogHistory({level:t,component:n,message:i,date:new Date});switch(t){case"error":window.console&&r.error&&(!n&&!i?r.error("Error occured without message and component"):r.error(n+": "+i));break;case"warn":window.console&&r.warn&&r.warn(n+": "+i);break;case"info":window.console&&r.info&&r.info(n+": "+i);break;case"debug":window.console&&r.log&&r.log(n+" ["+t+"]: "+i);break;default:window.console&&r.log&&r.log(n+" ["+t+"]: "+i)}},error:function(e,t){this.log("error",e,t)},warn:function(e,t){this.log("warn",e,t)},info:function(e,t){this.log("info",e,t)},debug:function(e,t){this.log("debug",e,t)},deprecated:function(t,n){this.log("warn",t,n);if(e.settings.logLevels.deprecated)throw new Error(n)},isLogLevelEnabled:function(t){return e.settings&&e.settings.logLevels&&e.settings.logLevels[t]},isErrorEnabled:function(){return this.isLogLevelEnabled("error")},isWarnEnabled:function(){return this.isLogLevelEnabled("warn")},isInfoEnabled:function(){return this.isLogLevelEnabled("info")},isDebugEnabled:function(){return this.isLogLevelEnabled("debug")},addToLogHistory:function(t){e.settings.logHistory||this.init();if(e.settings.logHistory.maxEntries<=0||!e.settings.logHistory.levels[t.level])return;this.logHistory.push(t),this.highWaterMarkReached||this.logHistory.length>=e.settings.logHistory.maxEntries*e.settings.logHistory.highWaterMark/100&&(e.trigger("aloha-log-full"),this.highWaterMarkReached=!0);while(this.logHistory.length>e.settings.logHistory.maxEntries)this.logHistory.shift()},getLogHistory:function(){return this.logHistory},flushLogHistory:function(){this.logHistory=[],this.highWaterMarkReached=!1}});return i=new i,e.Log=e.Console=i}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/range",["jquery","util/dom","util/class","aloha/console","aloha/rangy-core"],function(e,t,n,r,i){function o(e,t){var n=[],r;1===e.nodeType?r=e:r=e.parentNode;for(;;){if(!r||r===t||9===r.nodeType)break;1===r.nodeType&&n.push(r),r=r.parentNode}return n}function o(e,t){var n=[],r;1===e.nodeType?r=e:r=e.parentNode;for(;;){if(!r||r===t||9===r.nodeType)break;1===r.nodeType&&n.push(r),r=r.parentNode}return n}var s=window.GENTICS;return s.Utils.RangeObject=n.extend({_constructor:function(e){typeof e=="object"?(typeof e.startContainer!="undefined"&&(this.startContainer=e.startContainer),typeof e.startOffset!="undefined"&&(this.startOffset=e.startOffset),typeof e.endContainer!="undefined"&&(this.endContainer=e.endContainer),typeof e.endOffset!="undefined"&&(this.endOffset=e.endOffset)):e===!0&&this.initializeFromUserSelection()},startContainer:undefined,startOffset:undefined,endContainer:undefined,endOffset:undefined,deleteContents:function(){t.removeRange(this)},log:function(e){r.deprecated("Utils.RangeObject",'log() is deprecated. use console.log() from module "aloha/console" instead: '+e)},isCollapsed:function(){return!this.endContainer||this.startContainer===this.endContainer&&this.startOffset===this.endOffset},getCommonAncestorContainer:function(){return this.commonAncestorContainer?this.commonAncestorContainer:(this.updateCommonAncestorContainer(),this.commonAncestorContainer)},getContainerParents:function(t,n){var r=n?this.endContainer:this.startContainer;return r?e(o(r,t?t[0]:null)):!1},getStartContainerParents:function(e){return this.getContainerParents(e,!1)},getEndContainerParents:function(e){return this.getContainerParents(e,!0)},updateCommonAncestorContainer:function(e){if(!e){var t=this.getStartContainerParents(),n=this.getEndContainerParents(),i;if(!(t.length>0&&n.length>0))return r.warn("aloha/range","could not find commonAncestorContainer"),!1;for(i=0;i<t.length;i++)if(n.index(t[i])!=-1){this.commonAncestorContainer=t[i];break}}else this.commonAncestorContainer=e;return r.debug(e?"commonAncestorContainer was set successfully":"commonAncestorContainer was calculated successfully"),!0},getCollapsedIERange:function(e,t){var n=document.body.createTextRange(),r,i,s,o;return o=this.searchElementToLeft(e,t),o.element?(r=document.body.createTextRange(),r.moveToElementText(o.element),n.setEndPoint("StartToEnd",r),o.characters!==0?n.moveStart("character",o.characters):(n.moveStart("character",1),n.moveStart("character",-1))):(i=this.searchElementToRight(e,t),s=e.nodeType==3?e.parentNode:e,r=document.body.createTextRange(),r.moveToElementText(s),n.setEndPoint("StartToStart",r),o.characters!==0&&n.moveStart("character",o.characters)),n.collapse(),n},select:function(){var e,t,n,s,o;if(typeof this.startContainer=="undefined"||typeof this.endContainer=="undefined")return r.warn("can not select an empty range"),!1;s=i.createRange(),s.setStart(this.startContainer,this.startOffset),s.setEnd(this.endContainer,this.endOffset),o=i.getSelection(),o.setSingleRange(s)},searchElementToLeft:function(e,t){var n,r=0;e.nodeType===3?(r=t,n=e.previousSibling):t>0&&(n=e.childNodes[t-1]);while(n&&n.nodeType===3)r+=n.data.length,n=n.previousSibling;return{element:n,characters:r}},searchElementToRight:function(e,t){var n,r=0;e.nodeType===3?(r=e.data.length-t,n=e.nextSibling):t<e.childNodes.length&&(n=e.childNodes[t]);while(n&&n.nodeType===3)r+=n.data.length,n=n.nextSibling;return{element:n,characters:r}},update:function(e){r.debug("now updating rangeObject"),this.initializeFromUserSelection(e),this.updateCommonAncestorContainer()},initializeFromUserSelection:function(e){var t=i.getSelection(),n;if(!t)return!1;if(!t.rangeCount)return!1;n=t.getRangeAt(0);if(!n)return!1;this.startContainer=n.startContainer,this.endContainer=n.endContainer,this.startOffset=n.startOffset,this.endOffset=n.endOffset,this.correctRange();return},correctRange:function(){var e,t,n,r,i;this.clearCaches();if(this.isCollapsed()){if(this.startContainer.nodeType===1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset-1],this.startOffset=this.startContainer.data.length,this.endContainer=this.startContainer,this.endOffset=this.startOffset;return}if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===1){e=s.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!0);if(e){this.startContainer=this.endContainer=e,this.startOffset=this.endOffset=e.data.length;return}e=s.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,!1);if(e){this.startContainer=this.endContainer=e,this.startOffset=this.endOffset=0;return}}if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0,this.endContainer=this.startContainer,this.endOffset=0;return}}this.startContainer.nodeType===3&&this.startOffset===0&&(e=s.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,s.Utils.Dom.getIndexInParent(this.startContainer),!0),e&&(this.startContainer=this.endContainer=e,this.startOffset=this.endOffset=e.data.length))}else{if(this.startContainer.nodeType===1)if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3)this.startContainer=this.startContainer.childNodes[this.startOffset],this.startOffset=0;else if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===1){t=!1,n=this.startContainer.childNodes[this.startOffset];while(t===!1&&n.childNodes&&n.childNodes.length>0)n=n.childNodes[0],n.nodeType===3&&(t=n);t!==!1&&(this.startContainer=t,this.startOffset=0)}this.startContainer.nodeType===3&&this.startOffset===this.startContainer.data.length&&(e=s.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,s.Utils.Dom.getIndexInParent(this.startContainer)+1,!1),e&&(this.startContainer=e,this.startOffset=0));if(this.endContainer.nodeType===3&&this.endOffset===0)if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===3)this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length;else if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===1&&this.endContainer.parentNode){r=this.endContainer.parentNode;for(i=0;i<r.childNodes.length;++i)if(r.childNodes[i]==this.endContainer){this.endOffset=i;break}this.endContainer=r}this.endContainer.nodeType==1&&this.endOffset===0&&this.endContainer.previousSibling&&(this.endContainer.previousSibling.nodeType===3?(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.data.length):this.endContainer.previousSibling.nodeType===1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0&&(this.endContainer=this.endContainer.previousSibling,this.endOffset=this.endContainer.childNodes.length));if(this.endContainer.nodeType==1)if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===3)this.endContainer=this.endContainer.childNodes[this.endOffset-1],this.endOffset=this.endContainer.data.length;else if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===1){t=!1,n=this.endContainer.childNodes[this.endOffset-1];while(t===!1&&n.childNodes&&n.childNodes.length>0)n=n.childNodes[n.childNodes.length-1],n.nodeType===3&&(t=n);t!==!1&&(this.endContainer=t,this.endOffset=this.endContainer.data.length)}}},clearCaches:function(){this.commonAncestorContainer=undefined},getRangeTree:function(e){return typeof e=="undefined"&&(e=this.getCommonAncestorContainer()),this.inselection=!1,this.recursiveGetRangeTree(e)},recursiveGetRangeTree:function(t){var n=e(t),r=0,i=this,o=[];return n.contents().each(function(e){var n="none",u=!1,a=!1,f=!1,l=!1,c=!1,h=!1,p;i.isCollapsed()&&t===i.startContainer&&i.startOffset===e&&(o[r]=new s.Utils.RangeTree,o[r].type="collapsed",o[r].domobj=undefined,i.inselection=!1,f=!0,r++);if(!i.inselection&&!f)switch(this.nodeType){case 3:this===i.startContainer&&(i.inselection=!0,n=i.startOffset>0?"partial":"full",u=i.startOffset,a=this.length);break;case 1:this===i.startContainer&&i.startOffset===0&&(i.inselection=!0,n="full"),t===i.startContainer&&i.startOffset===e&&(i.inselection=!0,n="full")}if(i.inselection&&!f){n=="none"&&(n="full");switch(this.nodeType){case 3:this===i.endContainer&&(i.inselection=!1,i.endOffset<this.length&&(n="partial"),u===!1&&(u=0),a=i.endOffset);break;case 1:this===i.endContainer&&i.endOffset===0&&(i.inselection=!1)}t===i.endContainer&&i.endOffset<=e&&(i.inselection=!1,n="none")}o[r]=new s.Utils.RangeTree,o[r].domobj=this,o[r].type=n,n=="partial"&&(o[r].startOffset=u,o[r].endOffset=a),o[r].children=i.recursiveGetRangeTree(this);if(o[r].children.length>0){for(p=0;p<o[r].children.length;++p)switch(o[r].children[p].type){case"none":l=!0;break;case"full":h=!0;break;case"partial":c=!0}c||h&&l?o[r].type="partial":h&&!c&&!l&&(o[r].type="full")}r++}),this.isCollapsed()&&t===this.startContainer&&this.startOffset==t.childNodes.length&&(o[r]=new s.Utils.RangeTree,o[r].type="collapsed",o[r].domobj=undefined),o},findMarkup:function(e,t,n){var r=n?this.endContainer:this.startContainer,t=t?t[0]:null,i,s,u;if(!r)return;i=o(r,t);for(s=0,u=i.length;s<u;s++)if(e.apply(i[s]))return i[s];return!1},getText:function(){return this.isCollapsed()?"":this.recursiveGetText(this.getRangeTree())},recursiveGetText:function(t){if(!t)return"";var n=this,r="";return e.each(t,function(){this.type=="full"?r+=e(this.domobj).text():this.type=="partial"&&this.domobj.nodeType===3?r+=e(this.domobj).text().substring(this.startOffset,this.endOffset):this.type=="partial"&&this.domobj.nodeType===1&&this.children&&(r+=n.recursiveGetText(this.children))}),r}}),s.Utils.RangeTree=n.extend({domobj:{},type:null,children:[]}),s.Utils.RangeObject}),define("util/arrays",[],function(){"use strict";function e(e,t){var n;if(t){e.sort(t);for(n=1;n<e.length;n++)0===t(e[n],e[n-1])&&e.splice(n--,1)}else{e.sort();for(n=1;n<e.length;n++)e[n]==e[n-1]&&e.splice(n--,1)}return e}function t(e,t,n){var r=0,i=e.length;if(i!==t.length)return!1;if(n){for(;r<i;r++)if(!n(e[r],t[r]))return!1}else for(;r<i;r++)if(e[r]!==t[r])return!1;return!0}function n(e,t){var n,r,i=[];for(n=0,r=e.length;n<r;n++)i.push(t(e[n]));return i}function r(e,t){return e.map(t)}return{sortUnique:e,equal:t,map:Array.prototype.map?r:n}}),define("util/strings",["jquery"],function(e){function t(t){var n=e.trim(t).split(/[\r\n\t\s]+/);return n.length&&n[0]===""?[]:n}function n(e){return e.replace(/[-]([a-z])/gi,function(e,t){return t.toUpperCase()})}function r(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}return{words:t,dashesToCamelCase:n,camelCaseToDashes:r}}),define("PubSub",[],function(){function r(n){return t[n]&&e[t[n].channel]}function i(n,r){if(!e[n])return 0;r?typeof r!="object"&&(r={data:r}):r={},r.channel=n;var i=e[n].slice(),s;for(s=0;s<i.length;++s)t[i[s]].callback(r);return s}var e={},t={},n=0,s={sub:function(r,i){if(typeof i!="function")return-1;var s=e[r];return s||(s=e[r]=[]),s.push(++n),t[n]={channel:r,callback:i},n},unsub:function(e){if(-1===e||!t[e])return!1;var n=r(e);delete t[e];var i=n.length;while(i)if(n[--i]===e)return n.splice(i,1),!0;return!1},pub:function(e,t){var n=e.split("."),r,s=n.length,o="",u=0;for(r=0;r<s;++r)o+=(0===r?"":".")+n[r],u+=i(o,t);return u}};return s}),define("aloha/engine",["aloha/ecma5shims","jquery"],function(e,t){function o(e){if(!e)return 0;if(!e.style)return 0;if(typeof e.style.length!="undefined")return e.style.length;var t=0;for(var n in e.style)e.style[n]&&e.style[n]!==0&&e.style[n]!=="false"&&t++;return t}function u(e){if(!e)return null;var t=[],n,r=e.length;for(n=r>>>0;n--;)t[n]=e[n];return t}function a(e){return e.hasChildNodes()?e.firstChild:l(e)}function f(t){if(t.previousSibling){t=t.previousSibling;while(t.hasChildNodes())t=t.lastChild;return t}return t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE?t.parentNode:null}function l(e){while(e&&!e.nextSibling)e=e.parentNode;return e?e.nextSibling:null}function c(t,n){return t&&n&&Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_CONTAINED_BY)}function h(e,t){return(e||t)&&(e==t||c(e,t))}function p(t,n){return n&&t&&Boolean(e.compareDocumentPosition(n,t)&e.Node.DOCUMENT_POSITION_CONTAINED_BY)}function d(t,n){return Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_FOLLOWING)}function v(t,n){return Boolean(e.compareDocumentPosition(t,n)&e.Node.DOCUMENT_POSITION_PRECEDING)}function m(e){var t=[];while(e.parentNode)t.unshift(e.parentNode),e=e.parentNode;return t}function g(e){var t=[],n=l(e);while((e=a(e))&&e!=n)t.push(e);return t}function y(e){var t={fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textDecoration:"text-decoration"};return typeof t[e]!="undefined"?t[e]:e}function b(e){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[e]}function w(e){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[e]}function E(e){return e===null||!e||e===n}function S(e){return e.dir=="ltr"?"ltr":e.dir=="rtl"?"rtl":q(e.parentNode)?S(e.parentNode):"ltr"}function x(e){var t=0;while(e.previousSibling)t++,e=e.previousSibling;return t}function T(t){switch(t.nodeType){case e.Node.PROCESSING_INSTRUCTION_NODE:case e.Node.DOCUMENT_TYPE_NODE:return 0;case e.Node.TEXT_NODE:case e.Node.COMMENT_NODE:return t.length;default:return t.childNodes.length}}function N(t,n,r,i){if(t==r){if(n==i)return"equal";if(n<i)return"before";if(n>i)return"after"}if(e.compareDocumentPosition(r,t)&e.Node.DOCUMENT_POSITION_FOLLOWING){var s=
N(r,i,t,n);if(s=="before")return"after";if(s=="after")return"before"}if(e.compareDocumentPosition(r,t)&e.Node.DOCUMENT_POSITION_CONTAINS){var o=r;while(o.parentNode!=t)o=o.parentNode;if(x(o)<n)return"after"}return"before"}function C(e){var t=e;while(t.parentNode!=null)t=t.parentNode;return t}function k(e,t){var n=N(e,0,t.startContainer,t.startOffset),r=N(e,T(e),t.endContainer,t.endOffset);return C(e)==C(t.startContainer)&&n=="after"&&r=="before"}function L(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;n.hasChildNodes()&&e.startOffset<n.childNodes.length?n=n.childNodes[e.startOffset]:e.startOffset==T(n)?n=l(n):n=a(n);var r=e.endContainer;r.hasChildNodes()&&e.endOffset<r.childNodes.length?r=r.childNodes[e.endOffset]:r=l(r);var i=[];while(d(n,r)){if(k(n,e)&&t(n)){i.push(n),n=l(n);continue}n=a(n)}return i}function A(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;n.hasChildNodes()&&e.startOffset<n.childNodes.length?n=n.childNodes[e.startOffset]:e.startOffset==T(n)?n=l(n):n=a(n);var r=e.endContainer;r.hasChildNodes()&&e.endOffset<r.childNodes.length?r=r.childNodes[e.endOffset]:r=l(r);var i=[];while(d(n,r))k(n,e)&&t(n)&&i.push(n),n=a(n);return i}function O(t){if(t.toLowerCase()=="currentcolor")return null;var n=document.createElement("span");document.body.appendChild(n),n.style.color="black";var r=document.createElement("span");n.appendChild(r),r.style.color=t,t=e.getComputedStyle(r).color;if(t=="rgb(0, 0, 0)"){n.color="white",t=e.getComputedStyle(r).color;if(t!="rgb(0, 0, 0)")return null}return document.body.removeChild(n),/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(t)?t.replace("rgba","rgb").replace(", 1)",")"):t=="transparent"?"rgba(0, 0, 0, 0)":t}function M(t){t=t.toLowerCase();if(e(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(t)!=-1)return t;t=O(t);var n=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(t);return n?"#"+parseInt(n[1]).toString(16).replace(/^.$/,"0$&")+parseInt(n[2]).toString(16).replace(/^.$/,"0$&")+parseInt(n[3]).toString(16).replace(/^.$/,"0$&"):null}function D(e,t,n,r){_==0&&typeof n!="undefined"?i=n:_==0&&(i=null,i=n);if(e in s){if(t=="enabled"||t in s[e]){_++;try{var o=r()}catch(u){throw _--,u}return _--,o}throw"INVALID_ACCESS_ERR"}throw"NOT_SUPPORTED_ERR"}function P(e,t,n,r){e=e.toLowerCase();if(arguments.length==1||arguments.length>=4&&typeof t=="undefined")t=!1;if(arguments.length<=2||arguments.length>=4&&typeof n=="undefined")n="";return D(e,"action",r,function(e,t,n){return function(){return H(e)?(s[e].action(n,r),it(r),!0):!1}}(e,t,n))}function H(t,n){return t=t.toLowerCase(),D(t,"action",n,function(t){return function(){return e(["copy","cut","paste","selectall","stylewithcss","usecss"]).indexOf(t)!=-1||n!==null}}(t))}function B(e,t){return e=e.toLowerCase(),D(e,"indeterm",t,function(e){return function(){return H(e,t)?s[e].indeterm(t):!1}}(e))}function j(e,t){return e=e.toLowerCase(),D(e,"state",t,function(e){return function(){return H(e,t)?typeof ot(e,t)!="undefined"?ot(e,t):s[e].state(t):!1}}(e))}function F(e){return e=e.toLowerCase(),e in s}function I(e,t){return e=e.toLowerCase(),D(e,"value",t,function(){return H(e,t)?e=="fontsize"&&ft("fontsize",t)!==undefined?Rt(ft("fontsize",t)):typeof ft(e,t)!="undefined"?ft(e,t):s[e].value(t):""})}function q(t,n){return typeof n=="string"&&(n=[n]),typeof n=="object"&&(n=e(n).map(function(e){return e.toUpperCase()})),t&&t.nodeType==e.Node.ELEMENT_NODE&&E(t.namespaceURI)&&(typeof n=="undefined"||e(n).indexOf(t.tagName)!=-1)}function U(e){return q(e,R)}function z(t){return t&&(t.nodeType==e.Node.ELEMENT_NODE&&e(["inline","inline-block","inline-table","none"]).indexOf(e.getComputedStyle(t).display)==-1||t.nodeType==e.Node.DOCUMENT_NODE||t.nodeType==e.Node.DOCUMENT_FRAGMENT_NODE)}function W(e){return e&&!z(e)}function X(t){return t&&t.nodeType==e.Node.ELEMENT_NODE&&(t.contentEditable=="true"||t.parentNode&&t.parentNode.nodeType==e.Node.DOCUMENT_NODE&&t.parentNode.designMode=="on")}function V(n){return n&&!X(n)&&(n.nodeType!=e.Node.ELEMENT_NODE||n.contentEditable!="false"||t(n).hasClass("aloha-table-wrapper"))&&(X(n.parentNode)||V(n.parentNode))}function $(e){for(var t=0;t<e.childNodes.length;t++)if(V(e.childNodes[t])||$(e.childNodes[t]))return!0;return!1}function J(e){if(X(e))return e;if(V(e)){var t=e.parentNode;while(!X(t))t=t.parentNode;return t}return null}function K(e,t){return J(e)&&J(e)==J(t)}function Q(n){if(!q(n,"br"))return!1;var r=n.parentNode;while(e.getComputedStyle(r).display=="inline")r=r.parentNode;var i={height:r.style.height,maxHeight:r.style.maxHeight,minHeight:r.style.minHeight};r.style.height="auto",r.style.maxHeight="none",t.browser.msie&&t.browser.version<8||(r.style.minHeight="0");var s=document.createTextNode(""),o=r.offsetHeight;if(o==0)throw"isCollapsedLineBreak: original height is zero, bug?";n.parentNode.insertBefore(s,n.nextSibling);var u=r.offsetHeight;return s.parentNode.removeChild(s),r.style.height=i.height,r.style.maxHeight=i.maxHeight,t.browser.msie&&t.browser.version<8||(r.style.minHeight=i.minHeight),o<u-5}function G(n){if(!q(n,"br"))return!1;if(q(n.parentNode,"li")&&n.parentNode.childNodes.length==1)return!1;var r=n.parentNode;while(e.getComputedStyle(r).display=="inline")r=r.parentNode;var i={height:r.style.height,maxHeight:r.style.maxHeight,minHeight:r.style.minHeight,contentEditable:r.contentEditable};r.style.height="auto",r.style.maxHeight="none",r.style.minHeight="0",t.browser.msie&&t.browser.version<=7&&(r.contentEditable="false");var s=r.offsetHeight;if(s==0)throw"isExtraneousLineBreak: original height is zero, bug?";var o=n.style.display;n.style.display="none";var u=r.offsetHeight;return r.style.height=i.height,r.style.maxHeight=i.maxHeight,r.style.minHeight=i.minHeight,t.browser.msie&&t.browser.version<=7&&(r.contentEditable=i.contentEditable),n.style.display=o,s==u}function Y(t){return t&&t.nodeType==e.Node.TEXT_NODE&&(t.data==""||/^[\t\n\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE&&e(["normal","nowrap"]).indexOf(e.getComputedStyle(t.parentNode).whiteSpace)!=-1||/^[\t\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE&&e.getComputedStyle(t.parentNode).whiteSpace=="pre-line"||/^[\t\n\r ]+$/.test(t.data)&&t.parentNode&&t.parentNode.nodeType==e.Node.DOCUMENT_FRAGMENT_NODE)}function Z(t,n){if(!V(t)&&!X(t))return;if(!t||t.nodeType!==e.Node.TEXT_NODE)return;if(e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(t.parentNode).whiteSpace)!=-1)return;if(!/[\t\n\r ]{2,}/.test(t.data))return;var r="",i=n.startContainer==t,s=n.endContainer==t,o=!1;for(var u=0;u<t.data.length;++u)/[\t\n\r ]/.test(t.data.substr(u,1))?o?(i&&r.length<n.startOffset&&n.startOffset--,s&&r.length<n.endOffset&&n.endOffset--):(r+=" ",o=!0):(r+=t.data.substr(u,1),o=!1);t.data=r}function et(t){if(!Y(t))return!1;if(t.data=="")return!0;var n=t.parentNode;if(!n)return!0;if(e(m(t)).some(function(t){return t.nodeType==e.Node.ELEMENT_NODE&&e.getComputedStyle(t).display=="none"}))return!0;while(!z(n)&&n.parentNode)n=n.parentNode;var r=t;while(r!=n){r=f(r);if(z(r)||q(r,"br"))return!0;if(r.nodeType==e.Node.TEXT_NODE&&!Y(r)||q(r,"img"))break}r=t;var i=l(n);while(r!=i){r=a(r);if(z(r)||q(r,"br"))return!0;if(r&&r.nodeType==e.Node.TEXT_NODE&&!Y(r)||q(r,"img"))break}return!1}function tt(t){if(!t)return!1;if(e(m(t).concat(t)).filter(function(t){return t.nodeType==e.Node.ELEMENT_NODE},!0).some(function(t){return e.getComputedStyle(t).display=="none"}))return!1;if(z(t)||t.nodeType==e.Node.TEXT_NODE&&!et(t)||q(t,"img")||q(t,"br")&&!G(t))return!0;for(var n=0;n<t.childNodes.length;n++)if(tt(t.childNodes[n]))return!0;return!1}function nt(e){return e&&!tt(e)}function rt(t){if(Q(t)&&!G(t))return!0;if(!W(t)||t.nodeType!=e.Node.ELEMENT_NODE)return!1;var n=!1;for(var r=0;r<t.childNodes.length;r++){if(!nt(t.childNodes[r])&&!rt(t.childNodes[r]))return!1;rt(t.childNodes[r])&&(n=!0)}return n}function it(e){var t=new window.GENTICS.Utils.RangeObject;t.startContainer=e.startContainer,t.startOffset=e.startOffset,t.endContainer=e.endContainer,t.endOffset=e.endOffset,t.select()}function st(){var t;if(i)t=i;else{if(!Aloha.getSelection().rangeCount)return null;t=Aloha.getSelection().getRangeAt(0)}if(e([e.Node.TEXT_NODE,e.Node.ELEMENT_NODE]).indexOf(t.startContainer.nodeType)==-1||e([e.Node.TEXT_NODE,e.Node.ELEMENT_NODE]).indexOf(t.endContainer.nodeType)==-1||!t.startContainer.ownerDocument||!t.endContainer.ownerDocument||!p(t.startContainer,t.startContainer.ownerDocument)||!p(t.endContainer,t.endContainer.ownerDocument))throw"Invalid active range; test bug?";return t}function ht(t,n,r,i){r==-1&&(r=n.childNodes.length);var s=t.parentNode,o=x(t),u=[i];for(var a=0;a<Aloha.getSelection().rangeCount;a++)u.push(Aloha.getSelection().getRangeAt(a));var f=[];e(u).forEach(function(e){f.push([e.startContainer,e.startOffset]),f.push([e.endContainer,e.endOffset])}),e(f).forEach(function(e){e[0]==n&&e[1]>r&&e[1]++,e[0]==s&&(e[1]==o||e[1]==o+1)&&(e[0]=n,e[1]+=r-o),e[0]==s&&e[1]>o+1&&e[1]--}),n.childNodes.length==r?n.appendChild(t):n.insertBefore(t,n.childNodes[r]);if(f[0][1]>f[0][0].childNodes.length&&f[1][1]>f[1][0].childNodes.length)i.setStart(t,0),i.setEnd(t,0);else{i.setStart(f[0][0],f[0][1]),i.setEnd(f[1][0],f[1][1]),Aloha.getSelection().removeAllRanges();for(var a=1;a<u.length;a++){var l=Aloha.createRange();l.setStart(f[2*a][0],f[2*a][1]),l.setEnd(f[2*a+1][0],f[2*a+1][1]),Aloha.getSelection().addRange(l)}l&&(i=l)}}function pt(e,n){t.browser.msie&&t.browser.version>=7&&typeof e.attributes[t.expando]!="undefined"&&t(e).removeAttr(t.expando);var r=e.attributes;for(var i=0;i<r.length;i++){var s=r[i];if(typeof s.specified=="undefined"||s.specified)typeof n.setAttributeNS=="function"?n.setAttributeNS(s.namespaceURI,s.name,s.value):n.setAttribute(s.name,s.value)}}function dt(e,t,n){if(q(e,t.toUpperCase()))return e;if(!e.parentNode)return e;var r=e.ownerDocument.createElement(t);e.parentNode.insertBefore(r,e),pt(e,r);while(e.childNodes.length)ht(e.firstChild,r,r.childNodes.length,n);return e.parentNode.removeChild(e),n.startContainer===e&&(n.startContainer=r),n.endContainer===e&&(n.endContainer=r),r}function vt(e){var t=e.previousSibling;if(!t)return;while(t.hasChildNodes())t=t.lastChild;while(nt(t)&&!G(t)&&t!=e.parentNode)t=f(t);V(t)&&G(t)&&t.parentNode.removeChild(t)}function mt(e){var t=e;while(t.hasChildNodes())t=t.lastChild;while(nt(t)&&!G(t)&&t!=e)t=f(t);V(t)&&G(t)&&t.parentNode.removeChild(t)}function gt(e){vt(e),mt(e)}function yt(e,t,n,r){typeof t=="undefined"&&(t=function(){return!1}),typeof n=="undefined"&&(n=function(){return null});if(!e.length||!V(e[0]))return null;W(e[e.length-1])&&!q(e[e.length-1],"br")&&q(e[e.length-1].nextSibling,"br")&&e.push(e[e.length-1].nextSibling);var s;V(e[0].previousSibling)&&t(e[0].previousSibling)?s=e[0].previousSibling:V(e[e.length-1].nextSibling)&&t(e[e.length-1].nextSibling)?s=e[e.length-1].nextSibling:s=n();if(!s)return null;if(!s.parentNode){e[0].parentNode.insertBefore(s,e[0]);var o=r.startContainer,u=r.startOffset,a=r.endContainer,f=r.endOffset;o==s.parentNode&&u>=x(s)&&r.setStart(o,u+1),a==s.parentNode&&f>=x(s)&&r.setEnd(a,f+1),i&&i!==r&&(o=i.startContainer,u=i.startOffset,a=i.endContainer,f=i.endOffset,o==s.parentNode&&u>=x(s)&&i.setStart(o,u+1),a==s.parentNode&&f>=x(s)&&i.setEnd(a,f+1))}var l=e[0].parentNode;if(d(s,e[0])){!W(s)&&W(s.lastChild)&&W(e[0])&&!q(s.lastChild,"BR")&&s.appendChild(s.ownerDocument.createElement("br"));for(var c=0;c<e.length;c++)ht(e[c],s,-1,r)}else{!W(s)&&W(s.firstChild)&&W(e[e.length-1])&&!q(e[e.length-1],"BR")&&s.insertBefore(s.ownerDocument.createElement("br"),s.firstChild);for(var c=e.length-1;c>=0;c--)ht(e[c],s,0,r)}V(l)&&!l.hasChildNodes()&&l.parentNode.removeChild(l);if(V(s.nextSibling)&&t(s.nextSibling)){!W(s)&&W(s.lastChild)&&W(s.nextSibling.firstChild)&&!q(s.lastChild,"BR")&&s.appendChild(s.ownerDocument.createElement("br"));while(s.nextSibling.hasChildNodes())ht(s.nextSibling.firstChild,s,-1,r);s.parentNode.removeChild(s.nextSibling)}return gt(s),s}function wt(e){return q(e,bt)}function Et(t,n){if((e(["colgroup","table","tbody","tfoot","thead","tr"]).indexOf(n)!=-1||q(n,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof t=="object"&&t.nodeType==e.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(t.data))return!1;if(e(["script","style","plaintext","xmp"]).indexOf(n)==-1&&!q(n,["script","style","plaintext","xmp"])||typeof t=="object"&&t.nodeType==e.Node.TEXT_NODE){if(typeof t!="object"||t.nodeType!=e.Node.DOCUMENT_NODE&&t.nodeType!=e.Node.DOCUMENT_FRAGMENT_NODE&&t.nodeType!=e.Node.DOCUMENT_TYPE_NODE){q(t)&&(t=t.tagName.toLowerCase());if(typeof t!="string")return!0;if(q(n)){var r=n;while(r){if(t=="a"&&q(r,"a"))return!1;if(e(R).indexOf(t)!=-1&&wt(r))return!1;if(/^h[1-6]$/.test(t)&&q(r)&&/^H[1-6]$/.test(r.tagName))return!1;r=r.parentNode}n=n.tagName.toLowerCase()}if(typeof n!="object"||n.nodeType!=e.Node.ELEMENT_NODE&&n.nodeType!=e.Node.DOCUMENT_FRAGMENT_NODE){if(typeof n!="string")return!1;switch(n){case"colgroup":return t=="col";case"table":return e(["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]).indexOf(t)!=-1;case"tbody":case"thead":case"tfoot":return e(["td","th","tr"]).indexOf(t)!=-1;case"tr":return e(["td","th"]).indexOf(t)!=-1;case"dl":return e(["dt","dd"]).indexOf(t)!=-1;case"dir":case"ol":case"ul":return e(["dir","li","ol","ul"]).indexOf(t)!=-1;case"hgroup":return/^h[1-6]$/.test(t)}if(e(["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"]).indexOf(t)!=-1)return!1;if(e(["dd","dt"]).indexOf(t)!=-1&&n!="dl")return!1;if(t=="li"&&n!="ol"&&n!="ul")return!1;var i=[[["a"],["a"]],[["dd","dt"],["dd","dt"]],[["h1","h2","h3","h4","h5","h6"],["h1","h2","h3","h4","h5","h6"]],[["li"],["li"]],[["nobr"],["nobr"]],[bt,R],[["td","th"],["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]]];for(var s=0;s<i.length;s++)if(e(i[s][0]).indexOf(n)!=-1&&e(i[s][1]).indexOf(t)!=-1)return!1;return!0}return!0}return!1}return!1}function St(t,n){return n.collapsed?!1:k(t,n)?!0:t==n.startContainer&&t.nodeType==e.Node.TEXT_NODE&&T(t)!=n.startOffset?!0:t==n.endContainer&&t.nodeType==e.Node.TEXT_NODE&&n.endOffset!=0?!0:t.hasChildNodes()&&e(t.childNodes).every(function(e){return St(e,n)})&&(!p(n.startContainer,t)||n.startContainer.nodeType!=e.Node.TEXT_NODE||n.startOffset==0)&&(!p(n.endContainer,t)||n.endContainer.nodeType!=e.Node.TEXT_NODE||n.endOffset==T(n.endContainer))?!0:!1}function xt(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;while(St(n.parentNode,e))n=n.parentNode;var r=l(e.endContainer),i=[];while(d(n,r)){if(St(n,e)&&t(n)){i.push(n),n=l(n);continue}n=a(n)}return i}function Tt(e,t){typeof t=="undefined"&&(t=function(){return!0});var n=e.startContainer;while(St(n.parentNode,e))n=n.parentNode;var r=l(e.endContainer),i=[];while(d(n,r))St(n,e)&&t(n)&&i.push(n),n=a(n);return i}function Nt(t){if(!q(t))return!1;if(e(["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(t.tagName)!=-1){if(t.attributes.length==0)return!0;if(t.attributes.length==1&&e(t).hasAttribute("style"))return!0}if(t.tagName=="FONT"||t.tagName=="A"){var n=t.attributes.length;e(t).hasAttribute("style")&&n--,t.tagName=="FONT"&&(e(t).hasAttribute("color")&&n--,e(t).hasAttribute("face")&&n--,e(t).hasAttribute("size")&&n--),t.tagName=="A"&&e(t).hasAttribute("href")&&n--;if(n==0)return!0}return!1}function Ct(t){return q(t)?e(["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"]).indexOf(t.tagName)==-1?!1:t.attributes.length==0?!0:t.attributes.length>1?!1:e(t).hasAttribute("style")&&o(t)==0?!0:t.tagName=="A"&&e(t).hasAttribute("href")?!0:t.tagName=="FONT"&&(e(t).hasAttribute("color")||e(t).hasAttribute("face")||e(t).hasAttribute("size"))?!0:t.tagName!="B"&&t.tagName!="STRONG"||!e(t).hasAttribute("style")||o(t)!=1||t.style.fontWeight==""?t.tagName!="I"&&t.tagName!="EM"||!e(t).hasAttribute("style")||o(t)!=1||t.style.fontStyle==""?t.tagName!="A"&&t.tagName!="FONT"&&t.tagName!="SPAN"||!e(t).hasAttribute("style")||o(t)!=1||t.style.textDecoration!=""?e(["A","FONT","S","SPAN","STRIKE","U"]).indexOf(t.tagName)==-1||!e(t).hasAttribute("style")||o(t)!=1||t.style.textDecoration!="line-through"&&t.style.textDecoration!="underline"&&t.style.textDecoration!="overline"&&t.style.textDecoration!="none"?!1:!0:!0:!0:!0:!1}function kt(e,t,n){return t===null&&n===null?!0:typeof t!="string"||typeof n!="string"||t!=n||"equivalentValues"in s[e]?typeof t=="string"&&typeof n=="string"&&"equivalentValues"in s[e]&&s[e].equivalentValues(t,n)?!0:!1:!0}function Lt(t,n,r){if(kt(t,n,r))return!0;if(t!="fontsize"||typeof n!="string"||typeof r!="string")return!1;var i=Lt;if(i.sizeMap===undefined){i.sizeMap={};var s=document.createElement("font");document.body.appendChild(s),e(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(t){s.size=b(t),i.sizeMap[t]=e.getComputedStyle(s).fontSize}),document.body.removeChild(s)}return n===i.sizeMap[r]||r===i.sizeMap[n]}function At(t,n){if(t.nodeType==e.Node.ELEMENT_NODE||!!t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE){if(t.nodeType!=e.Node.ELEMENT_NODE)return At(t.parentNode,n);if(n=="createlink"||n=="unlink"){while(t&&(!q(t)||t.tagName!="A"||!e(t).hasAttribute("href")))t=t.parentNode;return t?t.getAttribute("href"):null}if(n=="backcolor"||n=="hilitecolor"){while((e.getComputedStyle(t).backgroundColor=="rgba(0, 0, 0, 0)"||e.getComputedStyle(t).backgroundColor===""||e.getComputedStyle(t).backgroundColor=="transparent")&&t.parentNode&&t.parentNode.nodeType==e.Node.ELEMENT_NODE)t=t.parentNode;return e.getComputedStyle(t).backgroundColor=="rgba(0, 0, 0, 0)"||e.getComputedStyle(t).backgroundColor===""||e.getComputedStyle(t).backgroundColor=="transparent"?"rgb(255, 255, 255)":e.getComputedStyle(t).backgroundColor}if(n=="subscript"||n=="superscript"){var r=!1,i=!1;while(W(t)){var o=e.getComputedStyle(t).verticalAlign;q(t,"sub")?r=!0:q(t,"sup")&&(i=!0),t=t.parentNode}return r&&i?"mixed":r?"subscript":i?"superscript":null}if(n=="strikethrough"){do{if(e.getComputedStyle(t).textDecoration.indexOf("line-through")!=-1)return"line-through";t=t.parentNode}while(t&&t.nodeType==e.Node.ELEMENT_NODE);return null}if(n=="underline"){do{if(e.getComputedStyle(t).textDecoration.indexOf("underline")!=-1)return"underline";t=t.parentNode}while(t&&t.nodeType==e.Node.ELEMENT_NODE);return null}if("relevantCssProperty"in s[n])return e.getComputedStyle(t)[s[n].relevantCssProperty].toString();throw"Bug: no relevantCssProperty for "+n+" in getEffectiveCommandValue"}return null}function Ot(t,n){if(n!="backcolor"&&n!="hilitecolor"||e.getComputedStyle(t).display=="inline"){if(n=="createlink"||n=="unlink")return q(t)&&t.tagName=="A"&&e(t).hasAttribute("href")?t.getAttribute("href"):null;if(n=="subscript"||n=="superscript")return q(t,"sup")?"superscript":q(t,"sub")?"subscript":null;if(n=="strikethrough"&&t.style.textDecoration!="")return t.style.textDecoration.indexOf("line-through")!=-1?"line-through":null;if(n=="strikethrough"&&q(t,["S","STRIKE"]))return"line-through";if(n=="underline"&&t.style.textDecoration!="")return t.style.textDecoration.indexOf("underline")!=-1?"underline":null;if(n=="underline"&&q(t,"U"))return"underline";var r=s[n].relevantCssProperty;if(r===null)return null;if(t.style[r]!="")return t.style[r];if(E(t.namespaceURI)&&t.tagName=="FONT"){if(r=="color"&&e(t).hasAttribute("color"))return t.color;if(r=="fontFamily"&&e(t).hasAttribute("face"))return t.face;if(r=="fontSize"&&e(t).hasAttribute("size")){var i=parseInt(t.size);return i<1&&(i=1),i>7&&(i=7),{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[i]}}return r!="fontWeight"||t.tagName!="B"&&t.tagName!="STRONG"?r!="fontStyle"||t.tagName!="I"&&t.tagName!="EM"?null:"italic":"bold"}return null}function Mt(e,t,n,r){var i=e;while(Nt(i)&&i.childNodes.length==1&&Nt(i.firstChild)&&(!Ct(i)||!kt(t,Ot(i,t),n)))i=i.firstChild;if(i==e||!Ct(i)||!kt(t,Ot(i,t),n)||!Lt(t,At(i,t),n))return;while(i.hasChildNodes())ht(i.firstChild,i.parentNode,x(i),r);e.parentNode.insertBefore(i,e.nextSibling),ht(e,i,-1,r)}function _t(t){var n=[];return e(t).forEach(function(t){e(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(r){var i=t;i.nodeType!=e.Node.ELEMENT_NODE&&(i=i.parentNode);while(i&&i.nodeType==e.Node.ELEMENT_NODE&&Ot(i,r)===null)i=i.parentNode;i&&i.nodeType==e.Node.ELEMENT_NODE?n.push([t,r,Ot(i,r)]):n.push([t,r,null])})}),n}function Dt(t,n){e(t).forEach(function(t){var r=t[0],i=t[1],s=t[2],o=r;if(!o||o.nodeType!=e.Node.ELEMENT_NODE)o=o.parentNode;while(o&&o.nodeType==e.Node.ELEMENT_NODE&&Ot(o,i)===null)o=o.parentNode;s===null&&o&&o.nodeType==e.Node.ELEMENT_NODE?Ht(r,i,null,n):(o&&o.nodeType==e.Node.ELEMENT_NODE&&!kt(i,Ot(o,i),s)||(!o||o.nodeType!=e.Node.ELEMENT_NODE)&&s!==null)&&Bt(r,i,s,n)})}function Pt(e,t,n){if(!V(e))return[];if(Ot(e,t)===null)return[];if(Ct(e)){var r=Array.prototype.slice.call(u(e.childNodes));for(var i=0;i<r.length;i++)ht(r[i],e.parentNode,x(e),n);return e.parentNode.removeChild(e),r}return t=="strikethrough"&&e.style.textDecoration.indexOf("line-through")!=-1&&(e.style.textDecoration=="line-through"?e.style.textDecoration="":e.style.textDecoration=e.style.textDecoration.replace("line-through",""),e.getAttribute("style")==""&&e.removeAttribute("style")),t=="underline"&&e.style.textDecoration.indexOf("underline")!=-1&&(e.style.textDecoration=="underline"?e.style.textDecoration="":e.style.textDecoration=e.style.textDecoration.replace("underline",""),e.getAttribute("style")==""&&e.removeAttribute("style")),s[t].relevantCssProperty!==null&&(e.style[s[t].relevantCssProperty]="",e.getAttribute("style")==""&&e.removeAttribute("style")),E(e.namespaceURI)&&e.tagName=="FONT"&&(t=="forecolor"&&e.removeAttribute("color"),t=="fontname"&&e.removeAttribute("face"),t=="fontsize"&&e.removeAttribute("size")),q(e,"A")&&(t=="createlink"||t=="unlink")&&e.removeAttribute("href"),Ot(e,t)===null?[]:[dt(e,"span",n)]}function Ht(t,n,r,i){if(!t.parentNode||t.parentNode.nodeType!=e.Node.ELEMENT_NODE)return;if(Lt(n,At(t,n),r))return;var s=t.parentNode,o=[];while(V(s)&&s.nodeType==e.Node.ELEMENT_NODE&&!Lt(n,At(s,n),r))o.push(s),s=s.parentNode;if(!o.length)return;var a=Ot(o[o.length-1],n);if(a===null&&a!=r)return;if(r!==null&&!Lt(n,At(o[o.length-1].parentNode,n),r))return;while(o.length){var s=o.pop();Ot(s,n)!==null&&(a=Ot(s,n));var f=Array.prototype.slice.call(u(s.childNodes));Ot(s,n)!==null&&Pt(s,n,i);for(var l=0;l<f.length;l++){var c=f[l];if(c==t)continue;if(c.nodeType==e.Node.ELEMENT_NODE&&Ot(c,n)!==null&&!kt(n,a,Ot(c,n)))continue;if(c==o[o.length-1])continue;Bt(c,n,a,i)}}}function Bt(n,i,o,u){if(!n.parentNode)return;if(o===null)return;Et(n,"span")&&(Mt(n.previousSibling,i,o,u),Mt(n.nextSibling,i,o,u),yt([n],function(e){return Ct(e)&&kt(i,Ot(e,i),o)&&Lt(i,At(e,i),o)},function(){return null},u));if(Lt(i,At(n,i),o))return;if(!Et(n,"span")){var a=[];for(var f=0;f<n.childNodes.length;f++){if(n.childNodes[f].nodeType==e.Node.ELEMENT_NODE){var l=Ot(n.childNodes[f],i);if(l!==null&&!kt(i,o,l))continue}a.push(n.childNodes[f])}for(var f=0;f<a.length;f++)Bt(a[f],i,o,u);return}if(Lt(i,At(n,i),o))return;var c=null;r||(i=="bold"&&(o=="bold"||o=="700")&&(c=n.ownerDocument.createElement("b")),i=="italic"&&o=="italic"&&(c=n.ownerDocument.createElement("i")),i=="strikethrough"&&o=="line-through"&&(c=n.ownerDocument.createElement("s")),i=="underline"&&o=="underline"&&(c=n.ownerDocument.createElement("u")),i=="forecolor"&&M(o)&&(c=n.ownerDocument.createElement("span"),t(c).css("color",M(o))),i=="fontname"&&(c=n.ownerDocument.createElement("font"),c.face=o));if(i=="createlink"||i=="unlink"){c=n.ownerDocument.createElement("a"),c.setAttribute("href",o);var h=n.parentNode;while(h)q(h,"A")&&(h=dt(h,"span",u)),h=h.parentNode}i=="fontsize"&&e(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(o)!=-1&&(!r||o=="xxx-large")&&(c=n.ownerDocument.createElement("font"),c.size=b(o)),(i=="subscript"||i=="superscript")&&o=="subscript"&&(c=n.ownerDocument.createElement("sub")),(i=="subscript"||i=="superscript")&&o=="superscript"&&(c=n.ownerDocument.createElement("sup")),c||(c=n.ownerDocument.createElement("span")),n.parentNode.insertBefore(c,n);var p=s[i].relevantCssProperty;p!==null&&!Lt(i,At(c,i),o)&&(c.style[p]=o),i=="strikethrough"&&o=="line-through"&&At(c,"strikethrough")!="line-through"&&(c.style.textDecoration="line-through"),i=="underline"&&o=="underline"&&At(c,"underline")!="underline"&&(c.style.textDecoration="underline"),ht(n,c,c.childNodes.length,u);if(n.nodeType==e.Node.ELEMENT_NODE&&!kt(i,At(n,i),o)){ht(n,c.parentNode,x(c),u),c.parentNode.removeChild(c);var a=[];for(var f=0;f<n.childNodes.length;f++){if(n.childNodes[f].nodeType==e.Node.ELEMENT_NODE){var l=Ot(n.childNodes[f],i);if(l!==null&&!kt(i,o,l))continue}a.push(n.childNodes[f])}for(var f=0;f<a.length;f++)Bt(a[f],i,o,u)}}function jt(t,n,r){r=r||st();if(!e(Tt(r)).filter(function(t){return t.nodeType==e.Node.TEXT_NODE},!0).some(V)){"inlineCommandActivatedValues"in s[t]&&ut(t,e(s[t].inlineCommandActivatedValues).indexOf(n)!=-1,r),t=="subscript"&&at("superscript",r),t=="superscript"&&at("subscript",r),n===null?ct(t,r):"value"in s[t]&&lt(t,n,r);return}if(V(r.startContainer)&&r.startContainer.nodeType==e.Node.TEXT_NODE&&r.startOffset!=0&&r.startOffset!=T(r.startContainer)){var i=r.startContainer.splitText(r.startOffset),o=Aloha.createRange();if(r.startContainer==r.endContainer){var u=r.endOffset-r.startOffset;o.setEnd(i,u),r.setEnd(i,u)}o.setStart(i,0),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(o),r.setStart(i,0)}if(V(r.endContainer)&&r.endContainer.nodeType==e.Node.TEXT_NODE&&r.endOffset!=0&&r.endOffset!=T(r.endContainer)){var a=r,f=[a.startContainer,a.startOffset],l=[a.endContainer,a.endOffset];a.endContainer.splitText(a.endOffset),a.setStart(f[0],f[1]),a.setEnd(l[0],l[1]),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(a)}e(Tt(st(),function(t){return V(t)&&t.nodeType==e.Node.ELEMENT_NODE})).forEach(function(e){Pt(e,t,r)}),e(Tt(r,V)).forEach(function(e){Ht(e,t,n,r),Bt(e,t,n,r)})}function Ft(t,n){if(t.nodeType===e.Node.TEXT_NODE&&n<t.length)for(var r=n;r<t.length;r++)if(t.data.charAt(r)!=="	"&&t.data.charAt(r)!=="\r"&&t.data.charAt(r)!=="\n"||t.data.charCodeAt(r)===160)return!1;if(t.nextSibling&&t.nextSibling.className&&t.nextSibling.className.indexOf("aloha-table-wrapper")>=0)return t.nextSibling;if(t.parentNode&&t.parentNode.nextSibling&&t.parentNode.nextSibling.className&&t.parentNode.nextSibling.className.indexOf("aloha-table-wrapper")>=0)return t.parentNode.nextSibling;if(t.parentNode&&t.parentNode.nextSibling&&Y(t.parentNode.nextSibling)&&t.parentNode.nextSibling.nextSibling&&t.parentNode.nextSibling.nextSibling.className&&t.parentNode.nextSibling.nextSibling.className.indexOf("aloha-table-wrapper")>=0)return t.parentNode.nextSibling.nextSibling}function It(t,n){if(t.nodeType===e.Node.TEXT_NODE&&n>0)for(var r=n-1;r>=0;r--)if(t.data.charAt(r)!=="	"&&t.data.charAt(r)!=="\r"&&t.data.charAt(r)!=="\n"||t.data.charCodeAt(r)===160)return!1;return t.previousSibling&&t.previousSibling.className&&t.previousSibling.className.indexOf("aloha-table-wrapper")>=0?t.previousSibling:t.parentNode&&t.parentNode.previousSibling&&t.parentNode.previousSibling.className&&t.parentNode.previousSibling.className.indexOf("aloha-table-wrapper")>=0?t.parentNode.previousSibling:t.parentNode&&t.parentNode.previousSibling&&Y(t.parentNode.previousSibling)&&t.parentNode.previousSibling.previousSibling&&t.parentNode.previousSibling.previousSibling.className&&t.parentNode.previousSibling.previousSibling.className.indexOf("aloha-table-wrapper")>=0?t.parentNode.previousSibling.previousSibling:!1}function qt(t){t=e(t).trim();if(/^[-+]?[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?$/.test(t)){var n;t[0]=="+"?(t=t.slice(1),n="relative-plus"):t[0]=="-"?(t=t.slice(1),n="relative-minus"):n="absolute";var r=parseInt(t);n=="relative-plus"&&(r+=3),n=="relative-minus"&&(r=3-r),r<1&&(r=1),r>7&&(r=7),t={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[r]}return t}function Rt(t){t=qt(t);if(e(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(t)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(t))return null;var n=document.createElement("font");document.body.appendChild(n),t=="xxx-large"?n.size=7:n.style.fontSize=t;var r=parseInt(e.getComputedStyle(n).fontSize);document.body.removeChild(n);var i=1;while(i<7){var n=document.createElement("font");n.size=i,document.body.appendChild(n);var s=parseInt(e.getComputedStyle(n).fontSize);n.size=1+i;var o=parseInt(e.getComputedStyle(n).fontSize);document.body.removeChild(n);var u=(o+s)/2;if(r<u)return String(i);i++}return"7"}function Ut(e){if(!q(e))return!1;if(e.tagName=="BLOCKQUOTE")return!0;if(e.tagName!="DIV")return!1;if(typeof e.style.length!="undefined"){for(var t=0;t<e.style.length;t++)if(/^(-[a-z]+-)?margin/.test(e.style[t]))return!0}else for(var n in e.style)if(/^(-[a-z]+-)?margin/.test(n)&&e.style[n]&&e.style[n]!==0)return!0;return!1}function zt(t){if(!Ut(t))return!1;if(t.tagName!="BLOCKQUOTE"&&t.tagName!="DIV")return!1;for(var n=0;n<t.attributes.length;n++)if(!E(t.attributes[n].namespaceURI)||e(["style","class","dir"]).indexOf(t.attributes[n].name)==-1)return!1;if(typeof t.style.length!="undefined"){for(var n=0;n<t.style.length;n++)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(t.style[n]))return!1}else for(var r in t.style)if(!/^(-[a-z]+-)?(margin|border|padding)/.test(r)&&t.style[r]&&t.style[r]!==0&&t.style[r]!=="false")return!1;return!0}function Wt(e){return q(e,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function Xt(e){return Wt(e)||q(e,["li","dt","dd"])}function $t(n,r){if(!V(n))return;if(e(m(n)).every(function(e){return!K(n,e)||!Et(n,e)})&&!q(n,Vt)){if(q(n,["dd","dt"])){yt([n],function(e){return q(e,"dl")&&!e.attributes.length},function(){return document.createElement("dl")},r);return}if(!U(n))return;n=dt(n,Vt,r),wn(n),$t(n,r);var i=g(n);for(var s=0;s<i.length;s++)$t(i[s],r);return}var o=_t([n]);while(!Et(n,n.parentNode)){for(var s=n.parentNode.childNodes.length-1;s>=0;--s)n.parentNode.childNodes[s].nodeType==3&&n.parentNode.childNodes[s].data.length==0&&(n.parentNode.removeChild(n.parentNode.childNodes[s]),r.startContainer==n.parentNode&&r.startOffset>s&&r.startOffset--,r.endContainer==n.parentNode&&r.endOffset>s&&r.endOffset--);if(n.parentNode.childNodes.length==1){var u=r.startOffset,a=r.endOffset;r.startContainer===n.parentNode&&r.startOffset>x(n)&&(u=r.startOffset+(t(n).contents().length-1)),r.endContainer===n.parentNode&&r.endOffset>x(n)&&(a=r.endOffset+(t(n).contents().length-1)),t(n).contents().unwrap(),r.startOffset=u,r.endOffset=a;break}var f=n.parentNode;fn([n],r);if(f===n.parentNode){var u=r.startOffset,a=r.endOffset;r.startContainer===n.parentNode&&r.startOffset>x(n)&&(u=r.startOffset+(t(n).contents().length-1)),r.endContainer===n.parentNode&&r.endOffset>x(n)&&(a=r.endOffset+
(t(n).contents().length-1)),t(n).contents().unwrap(),r.startOffset=u,r.endOffset=a;break}}Dt(o,r)}function Jt(t,n){if(!q(t,"LI")||!V(t)||!V(t.parentNode))return;var r=null;while(e(t.childNodes).some(function(e){return q(e,["OL","UL"])})){var i=t.lastChild;q(i,["OL","UL"])||!r&&i.nodeType==e.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(i.data)?(r=null,ht(i,t.parentNode,1+x(t),n)):(r||(r=t.ownerDocument.createElement("li"),t.parentNode.insertBefore(r,t.nextSibling)),ht(i,r,0,n))}}function Kt(e,n){if(!q(e,["OL","UL"])||!V(e))return;var r=t(e);r.children("ol,ul").each(function(e,t){q(t.previousSibling,"LI")&&ht(t,t.previousSibling,t.previousSibling.childNodes.length,n)})}function Qt(){var t=tn(st()),n=L(t,function(e){return V(e)&&!Ut(e)&&(q(e,["ol","ul"])||q(e.parentNode,["ol","ul"])||Et(e,"li"))});if(!n.length)return"none";if(e(n).every(function(e){return q(e,"ol")||q(e.parentNode,"ol")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ol")})&&!e(n).some(function(e){return q(e,"ul")||"querySelector"in e&&e.querySelector("ul")}))return"ol";if(e(n).every(function(e){return q(e,"ul")||q(e.parentNode,"ul")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ul")})&&!e(n).some(function(e){return q(e,"ol")||"querySelector"in e&&e.querySelector("ol")}))return"ul";var r=e(n).some(function(e){return q(e,"ol")||q(e.parentNode,"ol")||"querySelector"in e&&e.querySelector("ol")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ol")}),i=e(n).some(function(e){return q(e,"ul")||q(e.parentNode,"ul")||"querySelector"in e&&e.querySelector("ul")||q(e.parentNode,"li")&&q(e.parentNode.parentNode,"ul")});return r&&i?"mixed":r?"mixed ol":i?"mixed ul":"none"}function Gt(t){while(t&&t.nodeType!=e.Node.ELEMENT_NODE||t.nodeType==e.Node.ELEMENT_NODE&&e(["inline","none"]).indexOf(e.getComputedStyle(t).display)!=-1)t=t.parentNode;if(!t||t.nodeType!=e.Node.ELEMENT_NODE)return"left";var n=e.getComputedStyle(t).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");return n=="start"?S(t)=="ltr"?"left":"right":n=="end"?S(t)=="ltr"?"right":"left":e(["center","justify","left","right"]).indexOf(n)!=-1?n:"left"}function Yt(e,t){return!e.parentNode&&t==0||0<=t-1&&t-1<e.childNodes.length&&tt(e.childNodes[t-1])&&(z(e.childNodes[t-1])||q(e.childNodes[t-1],"br"))}function Zt(e,t){return!e.parentNode&&t==T(e)||t<e.childNodes.length&&tt(e.childNodes[t])&&z(e.childNodes[t])}function en(e,t){return Yt(e,t)||Zt(e,t)}function tn(t){var n=t.startContainer,r=t.startOffset,i=t.endContainer,s=t.endOffset,o=e(m(n).concat(n)).filter(function(e){return q(e,"li")}).slice(-1);o.length&&(r=x(o[0]),n=o[0].parentNode);if(!Yt(n,r))do r==0?(r=x(n),n=n.parentNode):r--;while(!en(n,r));while(r==0&&n.parentNode)r=x(n),n=n.parentNode;var o=e(m(i).concat(i)).filter(function(e){return q(e,"li")}).slice(-1);o.length&&(s=1+x(o[0]),i=o[0].parentNode);if(!Zt(i,s))do s==T(i)?(s=1+x(i),i=i.parentNode):s++;while(!en(i,s));while(s==T(i)&&i.parentNode)s=1+x(i),i=i.parentNode;var u=Aloha.createRange();return u.setStart(n,r),u.setEnd(i,s),u}function nn(e){var t=0;while(!en(e,t)){if(0<=t-1&&t-1<e.childNodes.length&&tt(e.childNodes[t-1]))return!1;t==0||!e.hasChildNodes()?(t=x(e),e=e.parentNode):(e=e.childNodes[t-1],t=T(e))}return!0}function rn(e){var t=T(e);while(!en(e,t)){if(t<e.childNodes.length&&tt(e.childNodes[t]))return!1;t==T(e)||!e.hasChildNodes()?(t=1+x(e),e=e.parentNode):(e=e.childNodes[t],t=0)}return!0}function sn(t){var n=[];return ft("createlink",t)!==undefined&&n.push(["createlink",ft("createlink",t)]),e(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(e){ot(e,t)!==undefined&&n.push([e,ot(e,t)])}),e(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(e){ft(e,t)!==undefined&&n.push([e,ft(e,t)])}),n}function on(t){var n=[],r=e(Tt(t)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];return r?(n.push(["createlink",s.createlink.value(t)]),e(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(t){e(s[t].inlineCommandActivatedValues).indexOf(At(r,t))!=-1?n.push([t,!0]):n.push([t,!1])}),e(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(e){n.push([e,s[e].value(t)])}),n.push(["fontsize",At(r,"fontsize")]),n):n}function un(t,n){var r=e(Tt(n)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];if(r)for(var i=0;i<t.length;i++){var s=t[i][0],o=t[i][1];if(typeof o=="boolean"&&j(s,n)!=o)P(s);else if(typeof o=="string"&&s!="fontsize"&&!kt(s,I(s,n),o))P(s,!1,o,n);else{if(typeof o!="string"||s!="fontsize"||!(ft("fontsize",n)!==undefined&&ft("fontsize",n)!==o||ft("fontsize",n)===undefined&&!Lt(s,At(r,"fontsize"),o)))continue;P("fontsize",!1,o,n)}r=e(Tt(n)).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0]||r}else for(var i=0;i<t.length;i++){var s=t[i][0],o=t[i][1];typeof o=="boolean"&&ut(s,o,n),typeof o=="string"&&lt(s,o,n)}}function an(){var t,n={};arguments.length<3?t=arguments[0]:(t=Aloha.createRange(),t.setStart(arguments[0],arguments[1]),t.setEnd(arguments[2],arguments[3])),arguments.length==2&&(n=arguments[1]),arguments.length==5&&(n=arguments[4]);var r="blockMerging"in n?!!n.blockMerging:!0,i="stripWrappers"in n?!!n.stripWrappers:!0;if(!t)return;var s=t.startContainer,o=t.startOffset,a=t.endContainer,f=t.endOffset;while(s.hasChildNodes()){if(o==T(s)&&K(s,s.parentNode)&&W(s)){o=1+x(s),s=s.parentNode;continue}if(o==T(s))break;var l=s.childNodes[o];if(z(l)||l.nodeType==e.Node.ELEMENT_NODE&&!l.hasChildNodes()||l.nodeType!=e.Node.ELEMENT_NODE&&l.nodeType!=e.Node.TEXT_NODE)break;s=l,o=0}while(a.hasChildNodes()){if(f==0&&K(a,a.parentNode)&&W(a)){f=x(a),a=a.parentNode;continue}if(f==0)break;var l=a.childNodes[f-1];if(z(l)||l.nodeType==e.Node.ELEMENT_NODE&&!l.hasChildNodes()||l.nodeType!=e.Node.ELEMENT_NODE&&l.nodeType!=e.Node.TEXT_NODE)break;a=l,f=T(l)}if(N(a,f,s,o)!=="after"){t.setEnd(t.startContainer,t.startOffset);return}s.nodeType==e.Node.TEXT_NODE&&o==0&&s!=a,a.nodeType==e.Node.TEXT_NODE&&f==T(a)&&s!=a&&(f=1+x(a),a=a.parentNode),t.setStart(s,o),t.setEnd(a,f);var h=t.startContainer;while(K(h,h.parentNode)&&W(h))h=h.parentNode;if(!z(h)&&!X(h)||!Et("span",h)||q(h,["td","th"]))h=null;var d=t.endContainer;while(K(d,d.parentNode)&&W(d))d=d.parentNode;if(!z(d)&&!X(d)||!Et("span",d)||q(d,["td","th"]))d=null;var v=on(t);if(s==a&&V(s)&&s.nodeType==e.Node.TEXT_NODE){var m=s.parentNode;s.deleteData(o,f-o),o>0&&s.data.substr(o-1,1)===" "&&o<s.data.length&&s.data.substr(o,1)===" "&&s.replaceData(o-1,1,""),hn(s,o),t.setStart(t.startContainer,t.startOffset),t.setEnd(t.startContainer,t.startOffset),un(v,t),(V(m)||X(m))&&!W(m)&&wn(m);return}V(s)&&s.nodeType==e.Node.TEXT_NODE&&s.deleteData(o,T(s)-o);var g=L(t,function(e){return V(e)&&!q(e,["thead","tbody","tfoot","tr","th","td"])});for(var y=0;y<g.length;y++){var b=g[y],m=b.parentNode;m.removeChild(b);if(i||!c(m,s)&&m!=s)while(V(m)&&W(m)&&T(m)==0){var w=m.parentNode;w.removeChild(m),m=w}(V(m)||X(m))&&!W(m)&&wn(m)}V(a)&&a.nodeType==e.Node.TEXT_NODE&&a.deleteData(0,f),hn(t.startContainer,t.startOffset),hn(t.endContainer,t.endOffset);if(!r||!h||!d||!K(h,d)||h==d){t.setEnd(t.startContainer,t.startOffset),un(v,t);return}h.children.length==1&&rt(h.firstChild)&&h.removeChild(h.firstChild),d.children.length==1&&rt(d.firstChild)&&d.removeChild(d.firstChild);if(c(h,d)){var l=d;while(l.parentNode!=h)l=l.parentNode;t.setStart(h,x(l)),t.setEnd(h,x(l));if(!d.hasChildNodes()){while(V(d)&&d.parentNode.childNodes.length==1&&d.parentNode!=h){var m=d;m.removeChild(d),d=m}V(d)&&!W(d)&&W(d.previousSibling)&&W(d.nextSibling)&&d.parentNode.insertBefore(document.createElement("br"),d.nextSibling),V(d)&&d.parentNode.removeChild(d),un(v,t);return}if(!W(d.firstChild)){un(v,t);return}var E=[];E.push(d.firstChild);while(!q(E[E.length-1],"br")&&W(E[E.length-1].nextSibling))E.push(E[E.length-1].nextSibling);var S=_t(E);while(E[0].parentNode!=h)fn(E,t);V(E[0].previousSibling)&&q(E[0].previousSibling,"br")&&E[0].parentNode.removeChild(E[0].previousSibling)}else if(p(h,d)){t.setStart(h,T(h)),t.setEnd(h,T(h));var l=h;while(l.parentNode!=d)l=l.parentNode;W(l.nextSibling)&&q(h.lastChild,"br")&&h.removeChild(h.lastChild);var C=[];l.nextSibling&&!q(l.nextSibling,"br")&&!z(l.nextSibling)&&C.push(l.nextSibling),C.length&&C[C.length-1].nextSibling&&!q(C[C.length-1].nextSibling,"br")&&!z(C[C.length-1].nextSibling)&&C.push(C[C.length-1].nextSibling);var S=_t(C);e(C).forEach(function(e){ht(e,h,-1,t)}),q(l.nextSibling,"br")&&l.parentNode.removeChild(l.nextSibling)}else{t.setStart(h,T(h)),t.setEnd(h,T(h)),W(d.firstChild)&&q(h.lastChild,"br")&&h.removeChild(h.lastChild);var S=_t([].slice.call(u(d.childNodes)));while(d.hasChildNodes())ht(d.firstChild,h,-1,t);while(!d.hasChildNodes()){var m=d.parentNode;m.removeChild(d),d=m}}Dt(S,t),wn(h),un(v,t)}function fn(t,n){var r=t[0].parentNode;if(!V(r)||!r.parentNode)return;e(t).indexOf(r.firstChild)!=-1&&vt(r);var i=e(t).indexOf(r.firstChild)!=-1&&nn(r),s=e(t).indexOf(r.lastChild)!=-1&&rn(r);if(e(t).indexOf(r.firstChild)==-1&&e(t).indexOf(r.lastChild)!=-1){for(var o=t.length-1;o>=0;o--)ht(t[o],r.parentNode,1+x(r),n);s&&!rn(t[t.length-1])&&t[t.length-1].parentNode.insertBefore(document.createElement("br"),t[t.length-1].nextSibling),mt(r);return}if(e(t).indexOf(r.firstChild)==-1){var u=r.cloneNode(!1);r.removeAttribute("id"),r.parentNode.insertBefore(u,r);while(t[0].previousSibling)ht(r.firstChild,u,u.childNodes.length,n)}for(var o=0;o<t.length;o++)ht(t[o],r.parentNode,x(r),n);i&&!nn(t[0])&&t[0].parentNode.insertBefore(document.createElement("br"),t[0]),W(t[t.length-1])&&!q(t[t.length-1],"br")&&q(r.firstChild,"br")&&!W(r)&&r.removeChild(r.firstChild),r.hasChildNodes()?vt(r):(r.parentNode===n.startContainer&&r.parentNode===n.endContainer&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&r.parentNode.childNodes.length===n.startOffset&&(n.startOffset=r.parentNode.childNodes.length-1,n.endOffset=n.startOffset),r.parentNode.removeChild(r),s&&!rn(t[t.length-1])&&t[t.length-1].parentNode.insertBefore(document.createElement("br"),t[t.length-1].nextSibling)),!t[t.length-1].nextSibling&&t[t.length-1].parentNode&&mt(t[t.length-1].parentNode)}function ln(e,t){e.hasChildNodes()?fn([].slice.call(u(e.childNodes)),t):e.parentNode.removeChild(e)}function cn(e,t,n){if(e==0)return"";if(e==1&&!t&&!n)return" ";if(e==1)return"";var r="",i;t?i=" ":i=" ";while(e>3)r+=i,e-=2;return e==3?r+=!t&&!n?"  ":t&&!n?" ":!t&&n?" ":t&&n?" ":"impossible":r+=!t&&!n?" ":t&&!n?" ":!t&&n?" ":t&&n?"":"impossible",r}function hn(t,n){if(!V(t)&&!X(t))return;var r=t,i=n;for(;;)if(0<=i-1&&K(r,r.childNodes[i-1]))r=r.childNodes[i-1],i=T(r);else if(i==0&&!nn(r)&&K(r,r.parentNode))i=x(r),r=r.parentNode;else{if(r.nodeType!=e.Node.TEXT_NODE||e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(r.parentNode).whiteSpace)!=-1||i==0||!/[ \xa0]/.test(r.data[i-1]))break;i--}var s=r,o=i,u=0,a=!1;for(;;)if(o<s.childNodes.length&&K(s,s.childNodes[o]))s=s.childNodes[o],o=0;else if(o==T(s)&&!rn(s)&&K(s,s.parentNode))o=1+x(s),s=s.parentNode;else{if(s.nodeType!=e.Node.TEXT_NODE||e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(s.parentNode).whiteSpace)!=-1||o==T(s)||!/[ \xa0]/.test(s.data[o]))break;if(a&&" "==s.data[o]){s.deleteData(o,1);continue}a=" "==s.data[o],o++,u++}var f=cn(u,i==0&&nn(r),o==T(s)&&rn(s));while(N(r,i,s,o)=="before")if(i<r.childNodes.length)r=r.childNodes[i],i=0;else if(r.nodeType!=e.Node.TEXT_NODE||i==T(r))i=1+x(r),r=r.parentNode;else{var l=f[0];f=f.slice(1),l!=r.data[i]&&(r.insertData(i,l),r.deleteData(i+1,1)),i++}}function pn(e,n){e&&t(e).find("ul,ol,li").each(function(){t(this).contents().each(function(){if(Y(this)){var e=x(this);n.startContainer===this.parentNode&&n.startOffset>e?n.startOffset--:n.startContainer===this&&(n.startContainer=this.parentNode,n.startOffset=e),n.endContainer===this.parentNode&&n.endOffset>e?n.endOffset--:n.endContainer===this&&(n.endContainer=this.parentNode,n.endOffset=e),t(this).remove()}})})}function dn(e,t){if(!e.length)return;var n=e[0];if(q(n.parentNode,["OL","UL"])){var r=n.parentNode.tagName;yt(e,function(e){return q(e,r)},function(){return n.ownerDocument.createElement(r)},t);return}var i=yt(e,function(e){return zt(e)},function(){return n.ownerDocument.createElement("blockquote")},t);$t(i,t)}function vn(t,n){if(!V(t))return;if(zt(t)){ln(t,n);return}if(Ut(t)){t.removeAttribute("class"),t.removeAttribute("dir"),t.style.margin="",t.style.padding="",t.style.border="",t.getAttribute("style")==""&&t.removeAttribute("style"),dt(t,"div",n);return}var r=t.parentNode,i=[];while(V(r)&&r.nodeType==e.Node.ELEMENT_NODE&&!zt(r)&&!q(r,["ol","ul"]))i.push(r),r=r.parentNode;if(!V(r)||!zt(r)){r=t.parentNode,i=[];while(V(r)&&r.nodeType==e.Node.ELEMENT_NODE&&!Ut(r)&&!q(r,["ol","ul"]))i.push(r),r=r.parentNode}if(q(t,["OL","UL"])&&(!V(r)||!Ut(r))){t.removeAttribute("reversed"),t.removeAttribute("start"),t.removeAttribute("type");var s=[].slice.call(u(t.childNodes));if(t.attributes.length&&!q(t.parentNode,["OL","UL"]))dt(t,"div",n);else{var o=_t([].slice.call(u(t.childNodes)));ln(t,n),Dt(o,n)}for(var a=0;a<s.length;a++)$t(s[a],n);return}if(!V(r)||!Ut(r))return;i.push(r);var f=r;while(i.length){r=i.pop();var l=t.parentNode==r?t:i[i.length-1];W(l)&&!q(l,"BR")&&q(l.nextSibling,"BR")&&l.parentNode.removeChild(l.nextSibling);var c=[].slice.call(u(r.childNodes),0,x(l)),h=[].slice.call(u(r.childNodes),1+x(l));dn(c,n),dn(h,n)}vn(f,n)}function mn(t,n){var r=Qt()==t?"disable":"enable";t=t.toUpperCase();var i=t=="OL"?"UL":"OL",s=[];(function(){for(var e=n.endContainer;e!=n.commonAncestorContainer;e=e.parentNode)q(e,"li")&&s.unshift(e);for(var e=n.startContainer;e;e=e.parentNode)q(e,"li")&&s.unshift(e)})(),e(s).forEach(function(e){Jt(e,n)});var o=tn(n);r=="enable"&&e(A(o,function(e){return V(e)&&q(e,i)})).forEach(function(e){if(V(e.previousSibling)&&q(e.previousSibling,t)||V(e.nextSibling)&&q(e.nextSibling,t)){var r=[].slice.call(u(e.childNodes)),i=_t(r);fn(r,n),yt(r,function(e){return q(e,t)},function(){return null},n),Dt(i,n)}else dt(e,t,n)});var a=L(o,function(e){return V(e)&&!Ut(e)&&(q(e,["OL","UL"])||q(e.parentNode,["OL","UL"])||Et(e,"li"))});r=="enable"&&(a=e(a).filter(function(e){return!q(e,["ol","ul"])||q(e.parentNode,["ol","ul"])}));if(r=="disable")while(a.length){var f=[];f.push(a.shift());if(q(f[0],t)){vn(f[0],n);continue}while(a.length&&a[0]==f[f.length-1].nextSibling&&!q(a[0],t))f.push(a.shift());var l=_t(f);fn(f,n);for(var c=0;c<f.length;c++)$t(f[c],n);Dt(l,n)}else while(a.length){var f=[];while(!f.length||a.length&&a[0]==f[f.length-1].nextSibling)if(q(a[0],["p","div"]))f.push(dt(a[0],"li",n)),a.shift();else if(q(a[0],["li","ol","ul"]))f.push(a.shift());else{var h=[];while(!h.length||a.length&&a[0]==h[h.length-1].nextSibling&&W(a[0])&&W(h[h.length-1])&&!q(h[h.length-1],"br"))h.push(a.shift());f.push(yt(h,undefined,function(){return document.createElement("li")},n))}if(q(f[0].parentNode,t)||e(f).every(function(e){return q(e,["ol","ul"])}))continue;if(q(f[0].parentNode,i)){var l=_t(f);fn(f,n),yt(f,function(e){return q(e,t)},function(){return document.createElement(t)},n),Dt(l,n);continue}$t(yt(f,function(e){return q(e,t)},function(){if(!V(f[0].parentNode)||!zt(f[0].parentNode)||!V(f[0].parentNode.previousSibling)||!q(f[0].parentNode.previousSibling,t))return document.createElement(t);var e=f[0].parentNode.previousSibling;return Jt(e.lastChild,n),(!V(e.lastChild)||!q(e.lastChild,t))&&e.appendChild(document.createElement(t)),e.lastChild},n),n)}}function gn(t,n){var r=tn(n),s=A(r,function(t){return t.nodeType==e.Node.ELEMENT_NODE&&V(t)&&(e(t).hasAttribute("align")||t.style.textAlign!=""||q(t,"center"))});for(var u=0;u<s.length;u++){var a=s[u];a.removeAttribute("align"),a.style.textAlign="",a.getAttribute("style")==""&&a.removeAttribute("style"),q(a,["div","span","center"])&&!a.attributes.length&&ln(a,n),q(a,"center")&&a.attributes.length&&dt(a,"div",n)}r=tn(i);var f=[];f=L(r,function(e){return V(e)&&Et(e,"div")&&Gt(e)!=t});while(f.length){var l=[];l.push(f.shift());while(f.length&&f[0]==l[l.length-1].nextSibling)l.push(f.shift());yt(l,function(n){return q(n,"div")&&e(n.attributes).every(function(e){return e.name=="align"&&e.value.toLowerCase()==t||e.name=="style"&&o(n)==1&&n.style.textAlign==t})},function(){var e=document.createElement("div");return e.setAttribute("style","text-align: "+t),e},n)}}function yn(e){return q(e,"br")?t(e).hasClass("aloha-end-br"):!1}function bn(){var e=document.createElement("br");return e.setAttribute("class","aloha-end-br"),e}function wn(n){if(!n)return;if(q(n.lastChild,"br"))return;if(e(n.childNodes).some(tt))return;t.browser.msie?t.browser.msie&&t.browser.version<=7&&q(n,["p","h1","h2","h3","h4","h5","h6","pre","blockquote"])&&(n.firstChild||n.appendChild(document.createTextNode(""))):n.appendChild(bn())}function En(t,n){var r;if(!t.collapsed)return;r=t.startOffset;if(n){if(t.startContainer&&t.startContainer.nodeType===e.Node.TEXT_NODE)while(r<t.startContainer.data.length&&t.startContainer.data.charAt(r)==="")r++}else if(t.startContainer&&t.startContainer.nodeType===e.Node.TEXT_NODE)while(r>0&&t.startContainer.data.charAt(r-1)==="")r--;r!==t.startOffset&&(t.setStart(t.startContainer,r),t.setEnd(t.startContainer,r))}var n="http://www.w3.org/1999/xhtml",r=!1,i=null,s={},_=0,R=["address","article","aside","blockquote","caption","center","col","colgroup","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","listing","menu","nav","ol","p","plaintext","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul","xmp"],ot,ut,at,ft,lt,ct;(function(){function r(r){if(!n||n.startContainer!=r.startContainer||n.endContainer!=r.endContainer||n.startOffset!=r.startOffset||n.endOffset!=r.endOffset)e={},t={},n=r.cloneRange()}var e={},t={},n=null;ot=function(t,n){return r(n),e[t]},ut=function(t,n,i){r(i),e[t]=n},at=function(t,n){r(n),delete e[t]},ft=function(e,n){return r(n),t[e]},lt=function(e,n,i){r(i),t[e]=n,e=="backcolor"?t.hilitecolor=n:e=="hilitecolor"&&(t.backcolor=n)},ct=function(e,n){r(n),delete t[e],e=="backcolor"?delete t.hilitecolor:e=="hilitecolor"&&delete t.backcolor}})();var bt=["a","abbr","b","bdi","bdo","cite","code","dfn","em","h1","h2","h3","h4","h5","h6","i","kbd","mark","p","pre","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","u","var","acronym","listing","strike","xmp","big","blink","font","marquee","nobr","tt"];s.backcolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;jt("backcolor",e)},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return O(e)===O(t)}},s.bold={action:function(e,t){j("bold",t)?jt("bold","normal",t):jt("bold","bold",t)},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(e,t){return e==t||e=="bold"&&t=="700"||e=="700"&&t=="bold"||e=="normal"&&t=="400"||e=="400"&&t=="normal"}},s.createlink={action:function(t){if(t==="")return;e(Tt(st())).forEach(function(n){e(m(n)).forEach(function(n){V(n)&&q(n,"a")&&e(n).hasAttribute("href")&&n.setAttribute("href",t)})}),jt("createlink",t)},standardInlineValueCommand:!0},s.fontname={action:function(e){jt("fontname",e)},standardInlineValueCommand:!0,relevantCssProperty:"fontFamily"},s.fontsize={action:function(t){if(t==="")return;t=qt(t);if(e(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"]).indexOf(t)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(t))return;jt("fontsize",t)},indeterm:function(){return e(Tt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return At(e,"fontsize")},!0).filter(function(t,n,r){return e(r.slice(0,n)).indexOf(t)==-1}).length>=2},value:function(t){var n=Tt(t,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];n===undefined&&(n=t.startContainer);var r=At(n,"fontsize");return Rt(r)},relevantCssProperty:"fontSize"},s.forecolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;jt("forecolor",e)},standardInlineValueCommand:!0,relevantCssProperty:"color",equivalentValues:function(e,t){return O(e)===O(t)}},s.hilitecolor={action:function(e){/^([0-9a-fA-F]{3}){1,2}$/.test(e)&&(e="#"+e);if(!/^(rgba?|hsla?)\(.*\)$/.test(e)&&!M(e)&&e.toLowerCase()!="transparent")return;jt("hilitecolor",e)},indeterm:function(){return e(Tt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return At(e,"hilitecolor")},!0).filter(function(t,n,r){return e(r.slice(0,n)).indexOf(t)==-1}).length>=2},standardInlineValueCommand:!0,relevantCssProperty:"backgroundColor",equivalentValues:function(e,t){return O(e)===O(t)}},s.italic={action:function(e,t){j("italic",t)?jt("italic","normal",t):jt("italic","italic",t)},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"},s.removeformat={action:function(){function t(e){return V(e)&&q(e,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var n=Tt(st(),t);e(n).forEach(function(e){while(e.hasChildNodes())ht(e.firstChild,e.parentNode,x(e),range);e.parentNode.removeChild(e)});if(V(st().startContainer)&&st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset!=0&&st().startOffset!=T(st().startContainer))if(st().startContainer==st().endContainer){var r=st().endOffset-st().startOffset,i=st().startContainer.splitText(st().startOffset);st().setStart(i,0),st().setEnd(i,r)}else st().setStart(st().startContainer.splitText(st().startOffset),0);if(V(st().endContainer)&&st().endContainer.nodeType==e.Node.TEXT_NODE&&st().endOffset!=0&&st().endOffset!=T(st().endContainer)){var s=[st().startContainer,st().startOffset],r=[st().endContainer,st().endOffset];st().setEnd(document.documentElement,0),r[0].splitText(r[1]),st().setStart(s[0],s[1]),st().setEnd(r[0],r[1])}e(Tt(st(),V)).forEach(function(e){while(t(e.parentNode)&&K(e.parentNode,e))fn([e],range)}),e(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(e){jt(e,null)})}},s.strikethrough={action:function(){j("strikethrough")?jt("strikethrough",null):jt("strikethrough","line-through")},inlineCommandActivatedValues:["line-through"]},s.subscript={action:function(){var e=j("subscript");jt("subscript",null),e||jt("subscript","subscript")},indeterm:function(){var t=Tt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return e(t).some(function(e){return At(e,"subscript")=="subscript"})&&e(t).some(function(e){return At(e,"subscript")!="subscript"})||e(t).some(function(e){return At(e,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"]},s.superscript={action:function(){var e=j("superscript");jt("superscript",null),e||jt("superscript","superscript")},indeterm:function(){var t=Tt(st(),function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return e(t).some(function(e){return At(e,"superscript")=="superscript"})&&e(t).some(function(e){return At(e,"superscript")!="superscript"})||e(t).some(function(e){return At(e,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"]},s.underline={action:function(){j("underline")?jt("underline",null):jt("underline","underline")},inlineCommandActivatedValues:["underline"]},s.unlink={action:function(){var t=st(),n=[];for(var r=t.startContainer;r;r=r.parentNode)q(r,"A")&&e(r).hasAttribute("href")&&n.unshift(r);for(var r=t.startContainer;r!=l(t.endContainer);r=a(r))q(r,"A")&&e(r).hasAttribute("href")&&(k(r,t)||c(r,t.endContainer)||r==t.endContainer)&&n.push(r);for(var i=0;i<n.length;i++)Pt(n[i],"unlink",t)},standardInlineValueCommand:!0};var Vt="p";s["delete"]={action:function(n,r){t.browser.msie&&t.browser.version<=7&&En(r,!1);if(!r.collapsed){an(r);return}hn(r.startContainer,r.startOffset);var i=r.startContainer,s=r.startOffset,o=!1,u=!1;for(;;){s>0&&(o=q(i.childNodes[s-1],"br")||!1,u=q(i.childNodes[s-1],"hr")||!1);if(s==0&&V(i.previousSibling)&&nt(i.previousSibling))i.parentNode.removeChild(i.previousSibling);else if(0<=s-1&&s-1<i.childNodes.length&&V(i.childNodes[s-1])&&(nt(i.childNodes[s-1])||o||u)){i.removeChild(i.childNodes[s-1]),s--;if(o||u){r.setStart(i,s),r.setEnd(i,s);return}}else if(s==0&&W(i)||nt(i))s=x(i),i=i.parentNode;else{if(0<=s-1&&s-1<i.childNodes.length&&V(i.childNodes[s-1])&&q(i.childNodes[s-1],"a")){ln(i.childNodes[s-1],r);return}if(!(0<=s-1&&s-1<i.childNodes.length&&!z(i.childNodes[s-1])&&!q(i.childNodes[s-1],["br","img"])))break;i=i.childNodes[s-1],s=T(i)}}var a;if(a=It(i,s)){a.parentNode.removeChild(a);return}if(i.nodeType==e.Node.TEXT_NODE&&s!=0){r.setStart(i,s-1),r.setEnd(i,s-1),an(i,s-1,i,s);return}if(i.nodeType==e.Node.TEXT_NODE&&s==0&&t.browser.msie){s=1,r.setStart(i,s),r.setEnd(i,s),r.startOffset=0,an(r);return}if(W(i))return;if(0<=s-1&&s-1<i.childNodes.length&&q(i.childNodes[s-1],["br","hr","img"])){r.setStart(i,s),r.setEnd(i,s),an(r);return}if(q(i,["li","dt","dd"])&&i==i.parentNode.firstChild&&s==0){var f=[];for(var l=i.parentNode;l;l=l.parentNode)q(l,"li")&&f.unshift(l);for(var c=0;c<f.length;c++)Jt(f[c],r);var p=_t([i]);fn([i],r),Dt(p,r),q(i,["dd","dt"])&&e(m(i)).every(function(e){return!K(i,e)||!Et(i,e)})&&(i=dt(i,Vt,r)),$t(i,r);for(var c=0;c<f.length;c++)Kt(f[c].parentNode,r);return}var d=i,v=s;for(;;)if(v==0)v=x(d),d=d.parentNode;else{if(!(0<=v-1&&v-1<d.childNodes.length&&V(d.childNodes[v-1])&&nt(d.childNodes[v-1])))break;d.removeChild(d.childNodes[v-1]),v--}if(s==0&&e(m(i).concat(i)).filter(function(e){return V(e)&&K(e,i)&&Ut(e)}).length){var g=Aloha.createRange();g.setStart(i,0),g.setEnd(i,0),g=tn(g);var y=L(g,function(e){return V(e)&&!$(e)});for(var c=0;c<y.length;c++)vn(y[c],r);return}if(q(d.childNodes[v],"table"))return;if(0<=v-1&&v-1<d.childNodes.length&&q(d.childNodes[v-1],"table")){r.setStart(d,v-1),r.setEnd(d,v);return}if(s==0&&(q(d.childNodes[v-1],"hr")||q(d.childNodes[v-1],"br")&&(q(d.childNodes[v-1].previousSibling,"br")||!W(d.childNodes[v-1].previousSibling)))){r.setStart(i,s),r.setEnd(i,s),an(d,v-1,d,v);return}if(q(d.childNodes[v],["li","dt","dd"])&&W(d.childNodes[v].firstChild)&&v!=0){var b=d.childNodes[v-1];W(b.lastChild)&&!q(b.lastChild,"br")&&b.appendChild(document.createElement("br")),W(b.lastChild)&&b.appendChild(document.createElement("br"))}if(q(d.childNodes[v],["li","dt","dd"])&&q(d.childNodes[v-1],["li","dt","dd"]))d=d.childNodes[v-1],v=T(d),i=d.nextSibling,s=0;else while(0<=v-1&&v-1<d.childNodes.length)V(d.childNodes[v-1])&&nt(d.childNodes[v-1])?(d.removeChild(d.childNodes[v-1]),v--):(d=d.childNodes[v-1],v=T(d));var w=Aloha.createRange();w.setStart(d,v),w.setEnd(i,s),an(w),h(document.body,r.startContainer)||(w.startContainer.hasChildNodes()||w.startContainer.nodeType==e.Node.TEXT_NODE?(r.setStart(w.startContainer,w.startOffset),r.setEnd(w.startContainer,w.startOffset)):(r.setStart(w.startContainer.parentNode,x(w.startContainer)),r.setEnd(w.startContainer.parentNode,x(w.startContainer))))}};var Sn=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];return s.formatblock={action:function(t){/^<.*>$/.test(t)&&(t=t.slice(1,-1)),t=t.toLowerCase();if(e(Sn).indexOf(t)==-1)return;var n=tn(st()),r=L(n,function(t){return V(t)&&(Wt(t)||Et(t,"p")||q(t,["dd","dt"]))&&!e(g(t)).some(U)}),i=_t(r);for(var s=0;s<r.length;s++){var o=r[s];while(e(m(o)).some(function(t){return V(t)&&K(t,o)&&q(t,Sn)&&!e(g(t)).some(U)}))fn([o],range)}Dt(i,range);while(r.length){var a;if(Xt(r[0])){a=[].slice.call(u(r[0].childNodes));var i=_t(a);ln(r[0],range),Dt(i,range),r.shift()}else{a=[],a.push(r.shift());while(r.length&&r[0]==a[a.length-1].nextSibling&&!Xt(r[0])&&!q(a[a.length-1],"BR"))a.push(r.shift())}$t(yt(a,e(["div","p"]).indexOf(t)==-1?function(e){return q(e,t)&&!e.attributes.length}:function(){return!1},function(){return document.createElement(t)},range),range)}},indeterm:function(){var t=tn(st()),n=A(t,function(e){return tt(e)&&V(e)&&!e.hasChildNodes()});if(!n.length)return!1;var r=null;for(var i=0;i<n.length;i++){var s=n[i];while(V(s.parentNode)&&K(s,s.parentNode)&&!q(s,Sn))s=s.parentNode;var o="";V(s)&&q(s,Sn)&&!e(g(s)).some(U)&&(o=s.tagName);if(r===null)r=o;else if(r!=o)return!0}return!1},value:function(){var t=tn(st()),n=A(t,function(e){return tt(e)&&V(e)&&!e.hasChildNodes()});if(!n.length)return"";var r=n[0];while(V(r.parentNode)&&K(r,r.parentNode)&&!q(r,Sn))r=r.parentNode;return V(r)&&q(r,Sn)&&!e(g(r)).some(U)?r.tagName.toLowerCase():""}},s.forwarddelete={action:function(n,r){t.browser.msie&&t.browser.version<=7&&En(r,!0);if(!r.collapsed){an(r);return}hn(r.startContainer,r.startOffset);var i=r.startContainer,s=r.startOffset,o=!1,u=!1;for(;;){s<i.childNodes.length;if(s==T(i)&&V(i.nextSibling)&&nt(i.nextSibling))i.parentNode.removeChild(i.nextSibling);else if(s<i.childNodes.length&&V(i.childNodes[s])&&(nt(i.childNodes[s])||o||u)){i.removeChild(i.childNodes[s]);if(o||u){wn(i),r.setStart(i,s),r.setEnd(i,s);return}}else if(s<i.childNodes.length&&rt(i.childNodes[s]))s++;else if(s==T(i)&&W(i)||nt(i))s=1+x(i),i=i.parentNode;else{if(!(s<i.childNodes.length&&!z(i.childNodes[s])&&!q(i.childNodes[s],["br","img"])))break;i=i.childNodes[s],s=0}}hn(r.startContainer,r.startOffset);var a;if(a=Ft(i,s)){a.parentNode.removeChild(a);return}if(i.nodeType==e.Node.TEXT_NODE&&s!=T(i)){r.setStart(i,s),r.setEnd(i,s);var f=s+1;while(f!=i.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(i.data[f]))f++;an(i,s,i,f);return}if(W(i))return;if(s<i.childNodes.length&&q(i.childNodes[s],["br","hr","img"])){r.setStart(i,s),r.setEnd(i,s),an(i,s,i,s+1);return}var l=i,f=s;for(;;)if(f==T(l))f=1+x(l),l=l.parentNode;else{if(!(f<l.childNodes.length&&V(l.childNodes[f])&&nt(l.childNodes[f])))break;l.removeChild(l.childNodes[f])}if(q(l.childNodes[f-1],"table"))return;if(q(l.childNodes[f],"table")){r.setStart(l,f),r.setEnd(l,f+1);return}if(s==T(i)&&q(l.childNodes[f],["br","hr"])){r.setStart(i,s),r.setEnd(i,s),an(l,f,l,f+1);return}while(f<l.childNodes.length)V(l.childNodes[f])&&nt(l.childNodes[f])?l.removeChild(l.childNodes[f]):(l=l.childNodes[f],f=0);an(i,s,l,f)}},s.indent={action:function(){var e=[];for(var t=st().endContainer;t!=st().commonAncestorContainer;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var t=st().startContainer;t!=st().commonAncestorContainer;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var t=st().commonAncestorContainer;t;t=t.parentNode)q(t,"LI")&&e.unshift(t);for(var n=0;n<e.length;n++)Jt(e[n,range]);var r=tn(st()),i=[];i=L(r,function(e){return V(e)&&(Et(e,"div")||Et(e,"ol"))}),i.length&&q(i[0],"LI")&&q(i[0].parentNode,["OL","UL"])&&q(i[0].previousSibling,"LI")&&Jt(i[0].previousSibling,range);while(i.length){var s=[];s.push(i.shift());while(i.length&&i[0]==s[s.length-1].nextSibling)s.push(i.shift());dn(s,range)}}},s.inserthorizontalrule={action:function(t,n){while(n.startOffset==0&&n.startContainer.parentNode)n.setStart(n.startContainer.parentNode,x(n.startContainer));while(n.endOffset==T(n.endContainer)&&n.endContainer.parentNode)n.setEnd(n.endContainer.parentNode,1+x(n.endContainer));an(n,{blockMerging:!1});if(!V(st().startContainer)&&!X(st().startContainer))return;st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset==0&&(st().setStart(st().startContainer.parentNode,x(st().startContainer)),st().collapse(!0)),st().startContainer.nodeType==e.Node.TEXT_NODE&&st().startOffset==T(st().startContainer)&&(st().setStart(st().startContainer.parentNode,1+x(st().startContainer)),st().collapse(!0));var r=document.createElement("hr");n.insertNode(r),$t(r,n),n.setStart(r.parentNode,1+x(r)),n.setEnd(r.parentNode,1+x(r)),Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(n)}},s.inserthtml={action:function(t,n){an(n);if(!V(n.startContainer)&&!X(n.startContainer))return;var r=n.createContextualFragment(t),i=r.lastChild;if(!i)return;var s=g(r);z(n.startContainer)&&e(n.startContainer.childNodes).filter(function(e,t){return V(e)&&rt(e)&&x(e)>=t.startOffset},!0).forEach(function(e){e.parentNode.removeChild(e)}),n.insertNode(r),z(n.startContainer)&&wn(n.startContainer),n.setStart(i.parentNode,1+x(i)),n.setEnd(i.parentNode,1+x(i));for(var o=0;o<s.length;o++)$t(s[o],n);it(n)}},s.insertimage={action:function(e){if(e==="")return;var t=st();an(t,{stripWrappers:!1});if(!V(st().startContainer)&&!X(st().startContainer))return;z(t.startContainer)&&t.startContainer.childNodes.length==1&&q(t.startContainer.firstChild,"br")&&t.startOffset==0&&t.startContainer.removeChild(t.startContainer.firstChild);var n=document.createElement("img");n.setAttribute("src",e),t.insertNode(n),t.setStart(n.parentNode,1+x(n)),t.setEnd(n.parentNode,1+x(n)),
Aloha.getSelection().removeAllRanges(),Aloha.getSelection().addRange(t),n.removeAttribute("width"),n.removeAttribute("height")}},s.insertlinebreak={action:function(n,r){an(r,{stripWrappers:!1});if(!V(r.startContainer)&&!X(r.startContainer))return;if(r.startContainer.nodeType==e.Node.ELEMENT_NODE&&!Et("br",r.startContainer))return;if(r.startContainer.nodeType!=e.Node.ELEMENT_NODE&&!Et("br",r.startContainer.parentNode))return;if(r.startContainer.nodeType==e.Node.TEXT_NODE&&r.startOffset==0){var i=r.startContainer.parentNode,s=x(r.startContainer);Aloha.getSelection().collapse(i,s),r.setStart(i,s),r.setEnd(i,s)}if(r.startContainer.nodeType==e.Node.TEXT_NODE&&r.startOffset==T(r.startContainer)){var i=r.startContainer.parentNode,s=1+x(r.startContainer);Aloha.getSelection().collapse(i,s),r.setStart(i,s),r.setEnd(i,s)}var o=document.createElement("br");r.insertNode(o),Aloha.getSelection().collapse(o.parentNode,1+x(o)),r.setStart(o.parentNode,1+x(o)),r.setEnd(o.parentNode,1+x(o)),Q(o)&&(r.insertNode(bn()),Aloha.getSelection().collapse(o.parentNode,1+x(o)),r.setStart(o.parentNode,1+x(o)),r.setEnd(o.parentNode,1+x(o))),t.browser.msie&&t.browser.version<8&&o.parentNode.removeAttribute("style")}},s.insertorderedlist={action:function(){mn("ol")},indeterm:function(){return/^mixed( ol)?$/.test(Qt())},state:function(){return Qt()=="ol"}},s.insertparagraph={action:function(t,n){an(n),pn(J(n.startContainer),n);if(!V(n.startContainer)&&!X(n.startContainer))return;var r=n.startContainer,i=n.startOffset;r.nodeType==e.Node.TEXT_NODE&&i!=0&&i!=T(r)&&r.splitText(i),r.nodeType==e.Node.TEXT_NODE&&i==T(r)&&(i=1+x(r),r=r.parentNode);if(r.nodeType==e.Node.TEXT_NODE||r.nodeType==e.Node.COMMENT_NODE)i=x(r),r=r.parentNode;Aloha.getSelection().collapse(r,i),n.setStart(r,i),n.setEnd(r,i);var s=r;while(!Xt(s)&&V(s.parentNode)&&K(r,s.parentNode))s=s.parentNode;if(!V(s)||!K(s,r)||!Xt(s)){var o=Vt,u=tn(n),f=L(u,function(e){return Et(e,"p")}).slice(0,1);if(!f.length){if(!Et(o,n.startContainer))return;s=document.createElement(o),n.insertNode(s),s.appendChild(bn()),Aloha.getSelection().collapse(s,0),n.setStart(s,0),n.setEnd(s,0);return}while(f[f.length-1].nextSibling&&Et(f[f.length-1].nextSibling,"p"))f.push(f[f.length-1].nextSibling);s=yt(f,function(){return!1},function(){return document.createElement(o)},n)}if(s.tagName=="ADDRESS"||s.tagName=="LISTING"||s.tagName=="PRE"){var l=document.createElement("br"),c=s.offsetHeight;n.insertNode(l);var h=s.offsetHeight;Aloha.getSelection().collapse(r,i+1),n.setStart(r,i+1),n.setEnd(r,i+1),c==h&&!p(a(l),s)&&(n.insertNode(bn()),Aloha.getSelection().collapse(r,i+1),n.setEnd(r,i+1));return}if(e(["LI","DT","DD"]).indexOf(s.tagName)!=-1&&(!s.hasChildNodes()||s.childNodes.length==1&&q(s.firstChild,"br"))){fn([s],n),q(s,["dd","dt"])&&e(m(s)).every(function(e){return!K(s,e)||!Et(s,e)})&&(s=dt(s,Vt,n)),$t(s,n);if(q(s,"li")&&q(s.nextSibling,"li")&&q(s.nextSibling.firstChild,["ol","ul"])){var d=s.nextSibling,v=s.nextSibling.childNodes.length;for(var y=0;y<v;y++)s.appendChild(d.childNodes[0]);d.parentNode.removeChild(d)}return}var b=Aloha.createRange();b.setStart(n.startContainer,n.startOffset),b.setEnd(s,T(s));while(b.startOffset==0&&b.startContainer!=s)b.setStart(b.startContainer.parentNode,x(b.startContainer));while(b.startOffset==T(b.startContainer)&&b.startContainer!=s)b.setStart(b.startContainer.parentNode,1+x(b.startContainer));var w=L(b),E=!w.length||w.length==1&&q(w[0],"br"),S;/^H[1-6]$/.test(s.tagName)&&E?S=Vt:s.tagName=="DT"&&E?S="dd":s.tagName=="DD"&&E?S="dt":S=s.tagName.toLowerCase();var N=document.createElement(S);pt(s,N),N.removeAttribute("id"),s.parentNode.insertBefore(N,s.nextSibling);var C=A(b),k=b.extractContents(),O=g(k);for(var y=0;y<O.length;y++)O[y].nodeType==e.Node.ELEMENT_NODE&&e(C).indexOf(O[y])==-1&&O[y].removeAttribute("id");var M=[],_=k.firstChild;if(_)do Y(_)||M.push(_);while(_=_.nextSibling);if(q(N,"li")&&M.length&&q(M[0],["ul","ol"])){var c=N.offsetHeight,D=bn();N.appendChild(D);var h=N.offsetHeight;c!==h&&N.removeChild(D)}N.appendChild(k),wn(s),wn(N),Aloha.getSelection().collapse(N,0),n.setStart(N,0),n.setEnd(N,0)}},s.inserttext={action:function(t,n){an(n,{stripWrappers:!1});if(!V(n.startContainer)&&!X(n.startContainer))return;if(t.length>1){for(var r=0;r<t.length;r++)s.inserttext.action(t[r],n);return}if(t=="")return;if(t=="\n"){s.insertparagraph.action("",n);return}var i=n.startContainer,o=n.startOffset;0<=o-1&&o-1<i.childNodes.length&&i.childNodes[o-1].nodeType==e.Node.TEXT_NODE&&(i=i.childNodes[o-1],o=T(i)),0<=o&&o<i.childNodes.length&&i.childNodes[o].nodeType==e.Node.TEXT_NODE&&(i=i.childNodes[o],o=0);var u=i.nodeType==e.Node.ELEMENT_NODE?i:i.parentNode;t==" "&&u.nodeType==e.Node.ELEMENT_NODE&&e(["pre","pre-wrap"]).indexOf(e.getComputedStyle(u).whiteSpace)==-1&&(t="");var a=sn(n);if(i.nodeType==e.Node.TEXT_NODE)i.insertData(o,t),Aloha.getSelection().collapse(i,o),n.setStart(i,o),Aloha.getSelection().extend(i,o+1),n.setEnd(i,o+1);else{i.childNodes.length==1&&Q(i.firstChild)&&i.removeChild(i.firstChild);var f=document.createTextNode(t);n.insertNode(f),Aloha.getSelection().collapse(f,0),n.setStart(f,0),Aloha.getSelection().extend(f,1),n.setEnd(f,1)}un(a),hn(n.startContainer,n.startOffset),hn(n.endContainer,n.endOffset),Aloha.getSelection().collapseToEnd(),n.collapse(!1)}},s.insertunorderedlist={action:function(){mn("ul")},indeterm:function(){return/^mixed( ul)?$/.test(Qt())},state:function(){return Qt()=="ul"}},s.justifycenter={action:function(e,t){gn("center",t)},indeterm:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Gt(e)=="center"})&&e(t).some(function(e){return Gt(e)!="center"})},state:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Gt(e)=="center"})},value:function(){var e=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Gt(e[0]):"left"}},s.justifyfull={action:function(e,t){gn("justify",t)},indeterm:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Gt(e)=="justify"})&&e(t).some(function(e){return Gt(e)!="justify"})},state:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Gt(e)=="justify"})},value:function(){var e=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Gt(e[0]):"left"}},s.justifyleft={action:function(e,t){gn("left",t)},indeterm:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Gt(e)=="left"})&&e(t).some(function(e){return Gt(e)!="left"})},state:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Gt(e)=="left"})},value:function(){var e=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Gt(e[0]):"left"}},s.justifyright={action:function(e,t){gn("right",t)},indeterm:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e(t).some(function(e){return Gt(e)=="right"})&&e(t).some(function(e){return Gt(e)!="right"})},state:function(){var t=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return t.length&&e(t).every(function(e){return Gt(e)=="right"})},value:function(){var e=A(tn(st()),function(e){return V(e)&&tt(e)&&!e.hasChildNodes()});return e.length?Gt(e[0]):"left"}},s.outdent={action:function(){var t=[];(function(){for(var e=st().endContainer;e!=st().commonAncestorContainer;e=e.parentNode)q(e,"li")&&t.unshift(e);for(var e=st().startContainer;e;e=e.parentNode)q(e,"li")&&t.unshift(e)})(),e(t).forEach(function(e){Jt(e,range)});var n=tn(st()),r=L(n,function(t){return V(t)&&(!e(g(t)).some(V)||q(t,["ol","ul"])||q(t,"li")&&q(t.parentNode,["ol","ul"]))});while(r.length){while(r.length&&(q(r[0],["OL","UL"])||!q(r[0].parentNode,["OL","UL"])))vn(r.shift(),range);if(!r.length)break;var i=[];i.push(r.shift());while(r.length&&r[0]==i[i.length-1].nextSibling&&!q(r[0],["OL","UL"]))i.push(r.shift());var s=_t(i);fn(i,range),e(i).forEach($t),Dt(s,range)}}},s.selectall={action:function(){var e=document.body;e||(e=document.documentElement),e?Aloha.getSelection().selectAllChildren(e):Aloha.getSelection().removeAllRanges()}},s.stylewithcss={action:function(e){r=String(e).toLowerCase()!="false"},state:function(){return r}},s.usecss={action:function(e){r=String(e).toLowerCase()=="false"}},function(){var t=[];for(var n in s)t.push(n);e(t).forEach(function(t){"relevantCssProperty"in s[t]||(s[t].relevantCssProperty=null),"inlineCommandActivatedValues"in s[t]&&!("indeterm"in s[t])&&(s[t].indeterm=function(n){var r=e(Tt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})).map(function(e){return At(e,t)}),i=e(r).filter(function(n){return e(s[t].inlineCommandActivatedValues).indexOf(n)!=-1});return i.length>=1&&r.length-i.length>=1}),"inlineCommandActivatedValues"in s[t]&&(s[t].state=function(n){var r=Tt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE});return r.length==0?e(s[t].inlineCommandActivatedValues).indexOf(At(n.startContainer,t))!=-1:e(r).every(function(n){return e(s[t].inlineCommandActivatedValues).indexOf(At(n,t))!=-1})}),"standardInlineValueCommand"in s[t]&&(s[t].indeterm=function(){var n=e(Tt(st())).filter(function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE},!0).map(function(e){return At(e,t)});for(var r=1;r<n.length;r++)if(n[r]!=n[r-1])return!0;return!1},s[t].value=function(n){var r=Tt(n,function(t){return V(t)&&t.nodeType==e.Node.TEXT_NODE})[0];return typeof r=="undefined"&&(r=n.startContainer),At(r,t)})})}(),{commands:s,execCommand:P,queryCommandIndeterm:B,queryCommandState:j,queryCommandValue:I,queryCommandEnabled:H,queryCommandSupported:F,copyAttributes:pt,createEndBreak:bn,isEndBreak:yn,ensureContainerEditable:wn,isEditingHost:X,isEditable:V}}),define("aloha/selection",["aloha/core","jquery","util/class","util/range","util/arrays","util/strings","aloha/console","PubSub","aloha/engine","aloha/ecma5shims","aloha/rangy-core"],function(e,t,n,r,i,s,o,u,a,f){function h(e){var n;if(t.browser.msie&&e.startContainer===e.endContainer&&e.startOffset===e.endOffset&&e.startContainer.nodeType==3&&e.startOffset==e.startContainer.data.length&&e.startContainer.nextSibling){n=e.startContainer.nextSibling;if("OL"===n.nodeName||"UL"===n.nodeName)e.startContainer.data[e.startContainer.data.length-1]==" "?e.startOffset=e.endOffset=e.startOffset-1:e.startContainer.data=e.startContainer.data+" "}}function p(e){return h(e),e}function m(e){var t;return e.startContainer!==e.endContainer?!1:e.startContainer.nodeType!=1?!1:(t=e.startContainer.firstChild,!t||!t.nextSibling&&t.nodeName=="BR")}function g(e){return e.startContainer!==e.endContainer?!1:e.startContainer.nodeType!=1?!1:a.isEndBreak(e.startContainer)}function w(e,t){var n=[],r,i,s;1===e.nodeType&&e.nodeName!=="BODY"&&e.nodeName!=="HTML"?n.push(e.cloneNode(!1).outerHTML):n.push("#"+e.nodeType);for(s=0,i=t.length;s<i;s++){r=t[s];if(r.nodeName==="BODY"||r.nodeName==="HTML")break;n.push(r.cloneNode(!1).outerHTML)}return n.join("")}function E(n,r){var s=e.activeEditable?e.activeEditable.obj.parent()[0]:null,o=t(n).parentsUntil(s).get(),u=w(n,o),a=r&&n===r.node&&i.equal(r.parents,o)&&u===r.html;return a?null:{node:n,parents:o,html:u}}function S(e,t){var n=e.startContainer,r=e.endContainer;if(!n||!r){o.warn("aloha/selection","encountered range object without start or end container");return}var i=E(n,y),s=E(r,b);if(!i&&!s)return;y=i,b=s,u.pub("aloha.selection.context-change",{range:e,event:t})}var l=window.GENTICS,c=n.extend({_constructor:function(){this.rangeObject={},this.preventSelectionChangedFlag=!1,this.tagHierarchy={textNode:{},abbr:{textNode:!0},b:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0,cite:!0,q:!0,code:!0,abbr:!0,strong:!0},pre:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0,cite:!0,q:!0,code:!0,abbr:!0},blockquote:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0,cite:!0,q:!0,code:!0,abbr:!0,p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0},ins:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,u:!0,p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0},ul:{li:!0},ol:{li:!0},li:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,ul:!0,ol:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,del:!0,ins:!0,u:!0,a:!0},tr:{td:!0,th:!0},table:{tr:!0},div:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,ul:!0,ol:!0,table:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,del:!0,ins:!0,u:!0,p:!0,div:!0,pre:!0,blockquote:!0,a:!0},h1:{textNode:!0,b:!0,i:!0,em:!0,sup:!0,sub:!0,br:!0,span:!0,img:!0,a:!0,del:!0,ins:!0,u:!0}},this.tagHierarchy={textNode:this.tagHierarchy.textNode,abbr:this.tagHierarchy.abbr,br:this.tagHierarchy.textNode,img:this.tagHierarchy.textNode,b:this.tagHierarchy.b,strong:this.tagHierarchy.b,code:this.tagHierarchy.b,q:this.tagHierarchy.b,blockquote:this.tagHierarchy.blockquote,cite:this.tagHierarchy.b,i:this.tagHierarchy.b,em:this.tagHierarchy.b,sup:this.tagHierarchy.b,sub:this.tagHierarchy.b,span:this.tagHierarchy.b,del:this.tagHierarchy.del,ins:this.tagHierarchy.ins,u:this.tagHierarchy.b,p:this.tagHierarchy.b,pre:this.tagHierarchy.pre,a:this.tagHierarchy.b,ul:this.tagHierarchy.ul,ol:this.tagHierarchy.ol,li:this.tagHierarchy.li,td:this.tagHierarchy.li,div:this.tagHierarchy.div,h1:this.tagHierarchy.h1,h2:this.tagHierarchy.h1,h3:this.tagHierarchy.h1,h4:this.tagHierarchy.h1,h5:this.tagHierarchy.h1,h6:this.tagHierarchy.h1,table:this.tagHierarchy.table},this.replacingElements={h1:{p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,pre:!0,blockquote:!0}},this.replacingElements={h1:this.replacingElements.h1,h2:this.replacingElements.h1,h3:this.replacingElements.h1,h4:this.replacingElements.h1,h5:this.replacingElements.h1,h6:this.replacingElements.h1,pre:this.replacingElements.h1,p:this.replacingElements.h1,blockquote:this.replacingElements.h1},this.allowedToStealElements={h1:{textNode:!0}},this.allowedToStealElements={h1:this.allowedToStealElements.h1,h2:this.allowedToStealElements.h1,h3:this.allowedToStealElements.h1,h4:this.allowedToStealElements.h1,h5:this.allowedToStealElements.h1,h6:this.allowedToStealElements.h1,p:this.tagHierarchy.b}},SelectionTree:function(){this.domobj={},this.selection=undefined,this.children=[]},onChange:function(t,n,r){this.updateSelectionTimeout&&window.clearTimeout(this.updateSelectionTimeout);var i=this;this.updateSelectionTimeout=window.setTimeout(function(){var s=new e.Selection.SelectionRange(!0);if(!s.startContainer||"HTML"===s.startContainer.nodeName||"BODY"===s.startContainer.nodeName){this.updateSelectionTimeout||i.onChange(t,n,10+(r||5)*2);return}e.Selection._updateSelection(n,s)},r||5)},preventSelectionChanged:function(){this.preventSelectionChangedFlag=!0},isSelectionChangedPrevented:function(){var e=this.preventSelectionChangedFlag;return this.preventSelectionChangedFlag=!1,e},isSelectionEditable:function(){return this.rangeObject.commonAncestorContainer&&t(this.rangeObject.commonAncestorContainer).contentEditable()},isFloatingMenuVisible:function(){var n=t(e.Selection.rangeObject.commonAncestorContainer).attr("data-aloha-floatingmenu-visible");return n!=="undefined"?n==="true"?!0:!1:!1},updateSelection:function(e){return this._updateSelection(e,null)},_updateSelection:function(n,r){if(n&&n.originalEvent&&n.originalEvent.stopSelectionUpdate===!0)return!1;if(typeof r=="undefined")return!1;this.rangeObject=r||new e.Selection.SelectionRange(!0);if(typeof this.rangeObject!="undefined"&&typeof this.rangeObject.startContainer!="undefined"&&this.rangeObject.endContainer!=="undefined")if(this.rangeObject.startContainer.nodeType===3&&!t(this.rangeObject.startContainer.parentNode).contentEditable()||this.rangeObject.endContainer.nodeType===3&&!t(this.rangeObject.endContainer.parentNode).contentEditable())return e.getSelection().removeAllRanges(),!0;return this.rangeObject.update(),this.isSelectionChangedPrevented()?!0:(e.trigger("aloha-selection-changed-before",[this.rangeObject,n]),e.trigger("aloha-selection-changed",[this.rangeObject,n]),S(this.rangeObject,n),e.trigger("aloha-selection-changed-after",[this.rangeObject,n]),!0)},getSelectionTree:function(t){return t?t.commonAncestorContainer?(this.inselection=!1,l.Utils.Dom.doCleanup({merge:!0},t)&&(t.update(),t.select()),this.recursiveGetSelectionTree(t,t.commonAncestorContainer)):(e.Log.error(this,"the rangeObject is missing the commonAncestorContainer"),!1):this.rangeObject.getSelectionTree()},recursiveGetSelectionTree:function(n,r){var i=t(r),s=0,o=this,u=[];return i.contents().each(function(t){var i="none",a=!1,f=!1,l=!1,c,h,p=!1,d=!1,v=!1;n.isCollapsed()&&r===n.startContainer&&n.startOffset==t&&(u[s]=new e.Selection.SelectionTree,u[s].selection="collapsed",u[s].domobj=undefined,o.inselection=!1,l=!0,s++);if(!o.inselection&&!l){var m;try{m=this.nodeType}catch(g){return}switch(m){case 3:this===n.startContainer&&(o.inselection=!0,i=n.startOffset>0?"partial":"full",a=n.startOffset,f=this.length);break;case 1:this===n.startContainer&&n.startOffset===0&&(o.inselection=!0,i="full"),r===n.startContainer&&n.startOffset===t&&(o.inselection=!0,i="full")}}if(o.inselection&&!l){i=="none"&&(i="full");switch(this.nodeType){case 3:this===n.endContainer&&(o.inselection=!1,n.endOffset<this.length&&(i="partial"),a===!1&&(a=0),f=n.endOffset);break;case 1:this===n.endContainer&&n.endOffset===0&&(o.inselection=!1)}r===n.endContainer&&n.endOffset<=t&&(o.inselection=!1,i="none")}u[s]=new e.Selection.SelectionTree,u[s].domobj=this,u[s].selection=i,i=="partial"&&(u[s].startOffset=a,u[s].endOffset=f),u[s].children=o.recursiveGetSelectionTree(n,this),h=u[s].children.length;if(h>0){for(c=0;c<h;++c)switch(u[s].children[c].selection){case"none":p=!0;break;case"full":v=!0;break;case"partial":d=!0}d||v&&p?u[s].selection="partial":v&&!d&&!p&&(u[s].selection="full")}s++}),n.isCollapsed()&&r===n.startContainer&&n.startOffset==r.childNodes.length&&(u[s]=new e.Selection.SelectionTree,u[s].selection="collapsed",u[s].domobj=undefined),u},getRangeObject:function(){return this.rangeObject},isRangeObjectWithinMarkup:function(n,r,i,s,o){var u=r?n.endContainer:n.startContainer,a=this,f=t(u).parents(),l=!1,c=-1;return typeof s!="undefined"&&typeof s!="function"&&e.Log.error(this,"parameter tagComparator is not a function"),typeof s=="undefined"&&(s=function(e,t){return a.standardTextLevelSemanticsComparator(e,t)}),f.length>0&&f.each(function(){if(this===o)return e.Log.debug(a,"reached limit dom obj"),!1;if(s(this,i))return l===!1&&(l=[]),e.Log.debug(a,"reached object equal to markup"),c++,l[c]=this,!0}),l},standardSectionsAndGroupingContentComparator:function(t,n){if(t.nodeType!==1)return e.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1;if(!n[0].nodeName)return!1;var r=e.Selection.replacingElements[t.nodeName.toLowerCase()];return r&&r[n[0].nodeName.toLowerCase()]},standardTagNameComparator:function(t,n){return t.nodeType===1?t.nodeName!=n[0].nodeName?!1:!0:(e.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardTextLevelSemanticsComparator:function(t,n){return t.nodeType===1?t.nodeName!=n[0].nodeName?!1:this.standardAttributesComparator(t,n)?!0:!1:(e.Log.debug(this,"only element nodes (nodeType == 1) can be compared"),!1)},standardAttributesComparator:function(e,t){var n=s.words(e&&e.className||""),r=s.words(t.length&&t[0].className||"");return i.sortUnique(n),i.sortUnique(r),i.equal(n,r)},changeMarkup:function(n,r,i){var s=r[0].tagName.toLowerCase(),o,u,l,c=this.isRangeObjectWithinMarkup(n,!1,r,i,u),h=this.isRangeObjectWithinMarkup(n,!0,r,i,u),p,d,v,y,b;if(this.replacingElements[s])l=n,n=new this.SelectionRange(n),e.activeEditable?o=e.activeEditable.obj.get(0):o=t("body"),n.update(o),r.isReplacingElement=!0;else if(n.isCollapsed())return e.Log.debug(this,"early returning from applying markup because nothing is currently selected"),!1;e.activeEditable?u=e.activeEditable.obj[0]:u=t("body"),!r.isReplacingElement&&n.startOffset===0&&(v=this.getTextNodeSibling(!1,n.commonAncestorContainer.parentNode,n.startContainer))&&(y=this.isRangeObjectWithinMarkup({startContainer:v,startOffset:0},!1,r,i,u)),!r.isReplacingElement&&n.endOffset===n.endContainer.length&&(p=this.getTextNodeSibling(!0,n.commonAncestorContainer.parentNode,n.endContainer))&&(d=this.isRangeObjectWithinMarkup({startContainer:p,startOffset:0},!1,r,i,u));if(!r.isReplacingElement&&c&&!h)e.Log.info(this,"markup 2 non-markup"),this.prepareForRemoval(n.getSelectionTree(),r,i),t(c).addClass("preparedForRemoval"),this.insertCroppedMarkups(c,n,!1,i);else if(!r.isReplacingElement&&c&&h)e.Log.info(this,"markup 2 markup"),this.prepareForRemoval(n.getSelectionTree(),r,i),this.splitRelevantMarkupObject(c,h,n,i);else if(!r.isReplacingElement&&(!c&&h||d||y))e.Log.info(this,"non-markup 2 markup OR with next2markup"),y&&d?(b=new e.Selection.SelectionRange(n),b.startContainer=t(y[y.length-1]).textNodes()[0],b.startOffset=0,b.endContainer=t(d[d.length-1]).textNodes().last()[0],b.endOffset=b.endContainer.length,b.update(),this.applyMarkup(b.getSelectionTree(),n,r,i),e.Log.info(this,"double extending previous markup(previous and after selection), actually wrapping it ...")):y&&!d&&!h?(this.extendExistingMarkupWithSelection(y,n,!1,i),e.Log.info(this,"extending previous markup")):y&&!d&&h?(b=new e.Selection.SelectionRange(n),b.startContainer=t(y[y.length-1]).textNodes()[0],b.startOffset=0,b.endContainer=t(h[h.length-1]).textNodes().last()[0],b.endOffset=b.endContainer.length,b.update(),this.applyMarkup(b.getSelectionTree(),n,r,i),e.Log.info(this,"double extending previous markup(previous and relevant at the end), actually wrapping it ...")):!y&&d?(this.extendExistingMarkupWithSelection(d,n,!0,i),e.Log.info(this,"extending following markup backwards")):this.extendExistingMarkupWithSelection(h,n,!0,i);else if(r.isReplacingElement||!c&&!h&&!y&&!d){e.Log.info(this,"non-markup 2 non-markup");if(m(n)){var w=r.clone();g(n)&&w[0].appendChild(a.createEndBreak()),e.activeEditable&&t.browser.mozilla&&e.activeEditable.obj.focus(),a.isEditable(n.startContainer)?(a.copyAttributes(n.startContainer,w[0]),t(n.startContainer).after(w[0]).remove()):a.isEditingHost(n.startContainer)&&(t(n.startContainer).append(w[0]),a.ensureContainerEditable(w[0])),l.startContainer=w[0],l.endContainer=w[0],l.startOffset=0,l.endOffset=0;return}this.applyMarkup(n.getSelectionTree(),n,r,i,{setRangeObject2NewMarkup:!0}),l.startContainer=n.startContainer,l.endContainer=n.endContainer,l.startOffset=n.startOffset,l.endOffset=n.endOffset}if(r.isReplacingElement){if(l&&l.startContainer.className&&l.startContainer.className.indexOf("preparedForRemoval")>-1){var E=t(l.startContainer).parents(r[0].tagName).get(0);l.startContainer=E,n.startContainer=E}if(l&&l.endContainer.className&&l.endContainer.className.indexOf("preparedForRemoval")>-1){var E=t(l.endContainer).parents(r[0].tagName).get(0);l.endContainer=E,n.endContainer=E}}t(".preparedForRemoval").zap(),r.isReplacingElement?(f.Node.ELEMENT_NODE===l.startContainer.nodeType&&l.startContainer.childNodes&&l.startContainer.childNodes.length<l.startOffset&&(l.startOffset=l.startContainer.childNodes.length,n.startOffset=l.startContainer.childNodes.length),f.Node.ELEMENT_NODE===l.endContainer.nodeType&&l.endContainer.childNodes&&l.endContainer.childNodes.length<l.endOffset&&(l.endOffset=l.endContainer.childNodes.length,n.endOffset=l.endContainer.childNodes.length),n.endContainer=l.endContainer,n.endOffset=l.endOffset,n.startContainer=l.startContainer,n.startOffset=l.startOffset,l.update(),l.select()):(n.update(),n.select())},areMarkupObjectsAsLongAsRangeObject:function(e,n,r){var i,s,o,u,a;if(r.startOffset!==0)return!1;for(i=0,a=e.length;i<a;i++){s=t(e[i]);if(s.textNodes().first()[0]!==r.startContainer)return!1}for(i=0,u=n.length;i<u;i++){s=t(n[i]),o=s.textNodes().last()[0];if(o!==r.endContainer||o.length!=r.endOffset)return!1}return!0},splitRelevantMarkupObject:function(e,n,r,i){t(e).addClass("preparedForRemoval"),t(n).addClass("preparedForRemoval");if(this.areMarkupObjectsAsLongAsRangeObject(e,n,r))return!0;var s=this.intersectRelevantMarkupObjects(e,n);return s?(this.insertCroppedMarkups([s],r,!1,i),this.insertCroppedMarkups([s],r,!0,i)):(this.insertCroppedMarkups(e,r,!1,i),this.insertCroppedMarkups(n,r,!0,i)),!0},intersectRelevantMarkupObjects:function(e,t){var n=!1,r,i,s,o,u,a;if(!e||!t)return n;u=e.length,a=t.length;for(r=0;r<u;r++){i=e[r];for(s=0;s<a;s++)o=t[s],i===o&&(n=i)}return n},extendExistingMarkupWithSelection:function(e,n,r,i){var s,o,u,a,f,l,c,h;r||(s=!0),r&&(o=!0),u=[];for(a=0,f=e.length;a<f;a++)u[a]=new this.SelectionRange,l=e[a],o&&!s&&(u[a].startContainer=n.startContainer,u[a].startOffset=n.startOffset,c=t(l).textNodes(!0),h=c.length-1,u[a].endContainer=c[h],u[a].endOffset=c[h].length,u[a].update(),this.applyMarkup(u[a].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NewMarkup:!0})),!o&&s&&(c=t(l).textNodes(!0),u[a].startContainer=c[0],u[a].startOffset=0,u[a].endContainer=n.endContainer,u[a].endOffset=n.endOffset,u[a].update(),this.applyMarkup(u[a].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NewMarkup:!0}));return!0},getClonedMarkup4Wrapping:function(e){var n=t(e.outerHTML).removeClass("preparedForRemoval").empty();return n.attr("class").length===0&&n.removeAttr("class"),n},insertCroppedMarkups:function(e,n,r,i){var s,o,u,a,f,l,c;r?o=!0:s=!0,a=[];for(f=0;f<e.length;f++){a[f]=new this.SelectionRange,l=e[f];if(s&&!o){c=t(l).textNodes(!0),a[f].startContainer=c[0],a[f].startOffset=0;if(a[f].startContainer===n.startContainer&&a[f].startOffset===n.startOffset)continue;n.startOffset===0?(a[f].endContainer=this.getTextNodeSibling(!1,l,n.startContainer),a[f].endOffset=a[f].endContainer.length):(a[f].endContainer=n.startContainer,a[f].endOffset=n.startOffset),a[f].update(),this.applyMarkup(a[f].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2NextSibling:!0})}!s&&o&&(a[f].startContainer=n.endContainer,a[f].startOffset=n.endOffset,u=t(l).textNodes(!0),a[f].endContainer=u[u.length-1],a[f].endOffset=u[u.length-1].length,a[f].update(),this.applyMarkup(a[f].getSelectionTree(),n,this.getClonedMarkup4Wrapping(l),i,{setRangeObject2PreviousSibling:!0}))}return!0},changeMarkupOnSelection:function(e){var t=this.getRangeObject();this.changeMarkup(t,e,this.getStandardTagComparator(e)),l.Utils.Dom.doCleanup({merge:!0},t),t.update(),t.select(),this.rangeObject=t},applyMarkup:function(t,n,r,i,s){var o,u,a,f;s=s?s:{},this.prepareForRemoval(t,r,i),o=this.optimizeSelectionTree4Markup(t,r,i),f=!0;for(u=0;u<o.length;u++)a=o[u],a.wrappable?this.wrapMarkupAroundSelectionTree(a.elements,n,r,i,s):(e.Log.debug(this,"dive further into non-wrappable object"),this.applyMarkup(a.element.children,n,r,i,s))},getMarkupType:function(n){var r=t(n)[0].nodeName.toLowerCase();n.outerHtml&&e.Log.debug(this,"Node name detected: "+r+" for: "+n.outerHtml());if(r=="#text")return"textNode";if(this.replacingElements[r])return"sectionOrGroupingContent";if(this.tagHierarchy[r])return"textLevelSemantics";e.Log.warn(this,"unknown markup passed to this.getMarkupType(...): "+n.outerHtml())},getStandardTagComparator:function(e){var t=this,n;switch(this.getMarkupType(e)){case"textNode":n=function(e,t){return!1};break;case"sectionOrGroupingContent":n=function(e,n){return t.standardSectionsAndGroupingContentComparator(e,n)};break;case"textLevelSemantics":default:n=function(e,n){return t.standardTextLevelSemanticsComparator(e,n)}}return n},prepareForRemoval:function(n,r,i){var s=this,o,u;typeof i!="undefined"&&typeof i!="function"&&e.Log.error(this,"parameter tagComparator is not a function"),typeof i=="undefined"&&(i=this.getStandardTagComparator(r));for(o=0;o<n.length;o++)u=n[o],u.domobj&&(u.selection=="full"||u.selection=="partial"&&r.isReplacingElement)&&u.domobj.nodeType===1&&i(u.domobj,r)&&(e.Log.debug(this,"Marking for removal: "+u.domobj.nodeName),t(u.domobj).addClass("preparedForRemoval")),u.selection!="none"&&u.children.length>0&&this.prepareForRemoval(u.children,r,i)},wrapMarkupAroundSelectionTree:function(n,r,i,s,o){var u=[],a=-1,f=!0,l="",c="",h,p,d,v,m,g,y;e.Log.debug(this,"The formatting <"+i[0].tagName+"> will be wrapped around the selection");for(m=0;m<n.length;m++){g=n[m];if(g.domobj&&!this.canTag1WrapTag2(g.domobj.parentNode.tagName.toLowerCase(),i[0].tagName.toLowerCase())){e.Log.info(this,"Skipping the wrapping of <"+i[0].tagName.toLowerCase()+"> because this tag is not allowed inside <"+g.domobj.parentNode.tagName.toLowerCase()+">");continue}if(g.domobj&&g.domobj.nodeType===3&&t.trim(g.domobj.nodeValue).length===0)continue;if(g.domobj&&g.selection=="partial"&&!i.isReplacingElement)if(g.startOffset!==undefined&&g.endOffset===undefined)a++,l+=g.domobj.data.substr(0,g.startOffset),g.domobj.data=g.domobj.data.substr(g.startOffset,g.domobj.data.length-g.startOffset),u[a]=g.domobj;else if(g.endOffset!==undefined&&g.startOffset===undefined)a++,c+=g.domobj.data.substr(g.endOffset,g.domobj.data.length-g.endOffset),g.domobj.data=g.domobj.data.substr(0,g.endOffset),u[a]=g.domobj;else if(g.endOffset!==undefined&&g.startOffset!==undefined){if(g.startOffset==g.endOffset){e.Log.debug(this,"skipping empty selection");continue}a++,l+=g.domobj.data.substr(0,g.startOffset),y=g.domobj.data.substr(g.startOffset,g.endOffset-g.startOffset),c+=g.domobj.data.substr(g.endOffset,g.domobj.data.length-g.endOffset),g.domobj.data=y,u[a]=g.domobj}else e.Log.debug(this,"diving into object"),this.applyMarkup(g.children,r,i,s,o);g.domobj&&(g.selection=="full"||g.selection=="partial"&&i.isReplacingElement)&&(a++,u[a]=g.domobj)}u.length>0&&(u=t(u),t.each(u,function(e,n){t.browser.msie&&n.nodeType==3&&!n.nextSibling&&!n.previousSibling&&n.parentNode&&n.parentNode.nodeName.toLowerCase()=="li"&&(n.data=t.trim(n.data))}),v=u.wrapAll(i).parent(),v.before(l).after(c),o.setRangeObject2NewMarkup&&(d=u.textNodes(),d.index(r.startContainer)!=-1&&(r.startOffset=0),d.index(r.endContainer)!=-1&&(r.endOffset=r.endContainer.length),f=!0),o.setRangeObject2NextSibling&&(h=!0,p=v.textNodes(!0).last()[0],u.index(r.startContainer)!=-1&&(r.startContainer=this.getTextNodeSibling(h,v.parent(),p),r.startOffset=0),u.index(r.endContainer)!=-1&&(r.endContainer=this.getTextNodeSibling(h,v.parent(),p),r.endOffset=r.endOffset-p.length)),o.setRangeObject2PreviousSibling&&(h=!1,p=v.textNodes(!0).first()[0],u.index(r.startContainer)!=-1&&(r.startContainer=this.getTextNodeSibling(h,v.parent(),p),r.startOffset=0),u.index(r.endContainer)!=-1&&(r.endContainer=this.getTextNodeSibling(h,v.parent(),p),r.endOffset=r.endContainer.length)))},getTextNodeSibling:function(e,n,r){var i=t(n).textNodes(!0),s,o;return o=i.index(r),o==-1?!1:(s=o+(e?1:-1),i[s]?i[s]:!1)},optimizeSelectionTree4Markup:function(e,n,r){var i=[],s=0,o=0,u=this,a,f,l,c;typeof r=="undefined"&&(r=function(e,t){return u.standardTextLevelSemanticsComparator(t)});for(a=0;a<e.length;a++)if(e[a].domobj&&e[a].selection!="none")if(n.isReplacingElement&&r(n[0],t(e[a].domobj)))i[s]!==undefined&&s++,i[s]={},i[s].wrappable=!0,i[s].elements=[],i[s].elements[o]=e[a],s++;else if(this.canMarkupBeApplied2ElementAsWhole([e[a]],n)){i[s]===undefined&&(i[s]={},i[s].wrappable=!0,i[s].elements=[]);if(n.isReplacingElement){c=a;for(f=a-1;f>=0;f--){if(!this.canMarkupBeApplied2ElementAsWhole([e[f]],n)||!this.isMarkupAllowedToStealSelectionTreeElement(e[f],n))break;c=f}l=a;for(f=a+1;f<e.length;f++){if(!this.canMarkupBeApplied2ElementAsWhole([e[f]],n)||!this.isMarkupAllowedToStealSelectionTreeElement(e[f],n))break;l=f}o=0;for(f=c;f<=l;f++)i[s].elements[o]=e[f],i[s].elements[o].selection="full",o++;o=0}else i[s].elements[o]=e[a],o++}else i[s]!==undefined&&s++,i[s]={},i[s].wrappable=!1,i[s].element=e[a],o=0,s++;return i},isMarkupAllowedToStealSelectionTreeElement:function(e,t){if(!e.domobj)return!1;var n=e.domobj.nodeName.toLowerCase(),r=n=="#text"?"textNode":n,i=t[0].nodeName.toLowerCase(),s=this.allowedToStealElements[i];return s&&s[r]},canMarkupBeApplied2ElementAsWhole:function(e,t){var n,r,i,s;t.jquery&&(n=t[0].tagName),t.tagName&&(n=t.tagName),s=!0;for(r=0;r<e.length;r++){i=e[r];if(i.domobj&&(i.selection!="none"||t.isReplacingElement)){if(!this.canTag1WrapTag2(n,i.domobj.nodeName))return!1;if(i.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(i.children,t))return!1}}return s},canTag1WrapTag2:function(e,t){e=e=="#text"?"textNode":e.toLowerCase(),t=t=="#text"?"textNode":t.toLowerCase();var n=this.tagHierarchy[e];return n?this.tagHierarchy[t]?n[t]:!0:!0},mayInsertTag:function(t){if(typeof this.rangeObject.unmodifiableMarkupAtStart=="object"
){for(var n=0;n<this.rangeObject.unmodifiableMarkupAtStart.length;++n)if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[n].nodeName,t))return!1;return!0}return e.Log.warn(this,"Unable to determine whether tag "+t+" may be inserted"),!0},toString:function(){return"Aloha.Selection"},SelectionRange:l.Utils.RangeObject.extend({_constructor:function(e){this._super(e),e&&(e.commonAncestorContainer&&(this.commonAncestorContainer=e.commonAncestorContainer),e.selectionTree&&(this.selectionTree=e.selectionTree),e.limitObject&&(this.limitObject=e.limitObject),e.markupEffectiveAtStart&&(this.markupEffectiveAtStart=e.markupEffectiveAtStart),e.unmodifiableMarkupAtStart&&(this.unmodifiableMarkupAtStart=e.unmodifiableMarkupAtStart),e.splitObject&&(this.splitObject=e.splitObject))},commonAncestorContainer:undefined,selectionTree:undefined,markupEffectiveAtStart:[],unmodifiableMarkupAtStart:[],limitObject:undefined,splitObject:undefined,select:function(){this._super(),e.Selection.updateSelection()},update:function(e){this.updatelimitObject(),this.updateMarkupEffectiveAtStart(),this.updateCommonAncestorContainer(e),this.selectionTree=undefined},getSelectionTree:function(){return this.selectionTree||(this.selectionTree=e.Selection.getSelectionTree(this)),this.selectionTree},getSelectedSiblings:function(e){var t=this.getSelectionTree();return this.recursionGetSelectedSiblings(e,t)},recursionGetSelectedSiblings:function(e,t){var n=!1,r=!1,i;for(i=0;i<t.length;++i)if(t[i].domobj===e)r=!0,n=[];else if(!r&&t[i].children){n=this.recursionGetSelectedSiblings(e,t[i].children);if(n!==!1)break}else if(r&&t[i].domobj&&t[i].selection!="collapsed"&&t[i].selection!="none")n.push(t[i].domobj);else if(r&&t[i].selection=="none")break;return n},updateMarkupEffectiveAtStart:function(){this.markupEffectiveAtStart=[],this.unmodifiableMarkupAtStart=[];var e=this.getStartContainerParents(),t=!1,n,r,i;for(r=0;r<e.length;r++)i=e[r],!t&&i!==this.limitObject?(this.markupEffectiveAtStart[r]=i,!n&&l.Utils.Dom.isSplitObject(i)&&(n=!0,this.splitObject=i)):(t=!0,this.unmodifiableMarkupAtStart.push(i));n||(this.splitObject=!1);return},updatelimitObject:function(){if(e.editables&&e.editables.length>0){var n=this.getStartContainerParents(),r=e.editables,i,s,o,u;for(i=0;i<n.length;i++){s=n[i];for(o=0;o<r.length;o++){u=r[o].obj[0];if(s===u)return this.limitObject=s,!0}}}return this.limitObject=t("body"),!0},toString:function(e){return e?"Aloha.Selection.SelectionRange {start ["+this.startContainer.nodeValue+"] offset "+this.startOffset+", end ["+this.endContainer.nodeValue+"] offset "+this.endOffset+"}":"Aloha.Selection.SelectionRange"}})}),d=n.extend({_constructor:function(e){this._nativeSelection=e,this.ranges=[],this.preventChange=!1},anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:!1,rangeCount:0,collapse:function(e,t){this._nativeSelection.collapse(e,t)},collapseToStart:function(){throw"NOT_IMPLEMENTED"},extend:function(e,t){},modify:function(e,t,n){},collapseToEnd:function(){throw"NOT_IMPLEMENTED"},selectAllChildren:function(e){throw"NOT_IMPLEMENTED"},deleteFromDocument:function(){throw"NOT_IMPLEMENTED"},getRangeAt:function(e){return p(this._nativeSelection.getRangeAt(e))},addRange:function(t){this._nativeSelection.addRange(t),this._nativeSelection._ranges[0]=p(t),e.Selection.updateSelection()},removeRange:function(e){this._nativeSelection.removeRange()},removeAllRanges:function(){this._nativeSelection.removeAllRanges()},refresh:function(e){},toString:function(){return"Aloha.Selection"},getRangeCount:function(){return this._nativeSelection.rangeCount}});e.getSelection=function(e){var e=e!==document||e!==window?window:e;return new d(window.rangy.getSelection(e))},e.createRange=function(e){return window.rangy.createRange(e)};var v=new c;e.Selection=v;var y=null,b=null;return v}),define("aloha/block-jump",["aloha/core","jquery"],function(e,t){function r(){if(!n)return;var e=n.nodeValue.replace(/\u200b/,"");e===n.nodeValue&&console.warn("Expected to remove the zero width text node fix, but couldn't find it"),i(n,e),n=null}function i(e,n){e.deleteData(0,e.length),""!==n&&(e.nextSibling&&3===e.nextSibling.nodeType?e.nextSibling.insertData(0,n):e.previousSibling&&3===e.previousSibling.nodeType?e.previousSibling.insertData(e.previousSibling.length,n):e.insertData(0,n)),setTimeout(function(){0===e.length&&t(e).remove()},0)}function s(i,s){return r(),n=document.createTextNode(""),s?t(i).after(n):t(i).before(n),e.bind("aloha-selection-changed",function(t){r(),e.unbind(t)}),n}var n=null;return{removeZeroWidthTextNodeFix:r,insertZeroWidthTextNodeFix:s}}),define("aloha/markup",["aloha/core","util/class","jquery","aloha/ecma5shims","aloha/console","aloha/block-jump"],function(e,t,n,r,i,s){function a(e){return"BR"===e.nodeName}function f(e){return"false"===n(e).attr("contenteditable")}function l(e){return e&&3===e.nodeType}function c(e){return e?l(e)?e.length:e.childNodes.length:0}function h(e){return e?e.nextSibling?l(e.nextSibling)&&!d(e.nextSibling)?h(e.nextSibling):a(e.nextSibling)&&e.nextSibling===e.parentNode.lastChild?h(e.nextSibling):""===e.nextSibling.innerHTML&&!f(e.nextSibling)?h(e.nextSibling):e.nextSibling:e.parentNode?h(e.parentNode):null:null}function p(e){return e?e.previousSibling?l(e.previousSibling)&&!d(e.previousSibling)?p(e.previousSibling):""===e.previousSibling.innerHTML&&!f(e.previousSibling)?p(e.previouSibling):e.previousSibling:e.parentNode?p(e.parentNode):null:null}function d(e){return 0<e.data.replace(/\s+/g,"").length}function v(e,t){return 0===t||t<=e.data.length-e.data.replace(/^\s+/,"").length}function m(e){return e.parent().hasClass("aloha-editable")}function g(e,t){var n=c(e);if(n===t)return!0;var r=l(e);return r&&e.data.replace(/\s+$/,"").length===t?!0:1===n&&!r?a(e.childNodes[0]):!1}function y(e){return n(e).stop(!0).css({opacity:0}).fadeIn(0).delay(100).fadeIn(function(){n(e).css({opacity:1})}),e}function b(t,r,i){var u=new o.Utils.RangeObject,a=r?p(t):h(t);if(!a||f(a)){var l=n("<div>&nbsp;</div>");r?n(t).before(l):n(t).after(l),u.startContainer=u.endContainer=l[0],u.startOffset=u.endOffset=0,S(u),window.$_alohaPlaceholder=l}else{var d=i.startContainer.nodeType===3&&i.startContainer===i.endContainer&&i.startContainer.nodeValue!==""&&(r?i.startOffset===1:i.endOffset+1===i.endContainer.length)||i.startContainer.nodeType===1&&(!i.startOffset||i.startContainer.childNodes[i.startOffset]&&i.startContainer.childNodes[i.startOffset].nodeType===1);if(d){var v=s.insertZeroWidthTextNodeFix(t,r);u.startContainer=u.endContainer=v,u.startOffset=u.endOffset=r?1:0}else u.startContainer=u.endContainer=a,u.startOffset=u.endOffset=r?c(a):0,r||s.insertZeroWidthTextNodeFix(t,!0);S(u)}u.select(),e.trigger("aloha-block-selected",t),e.Selection.preventSelectionChanged()}function w(e,t){return u?r.compareDocumentPosition(e,t)&16:0<n(e).find(t).length}function E(e){var t=e.startContainer,n=e.endContainer,r=window.$_alohaPlaceholder;return r.is(t)||r.is(n)||w(r[0],t)||w(r[0],n)}function S(e){window.$_alohaPlaceholder&&!E(e)&&(0===window.$_alohaPlaceholder.html().replace(/^(&nbsp;)*$/,"").length&&window.$_alohaPlaceholder.remove(),window.$_alohaPlaceholder=null)}var o=window.GENTICS,u=!!(n.browser.msie&&9>parseInt(n.browser.version,10));return e.Markup=t.extend({keyHandlers:{},addKeyHandler:function(e,t){this.keyHandlers[e]||(this.keyHandlers[e]=[]),this.keyHandlers[e].push(t)},removeKeyHandler:function(e){this.keyHandlers[e]&&(this.keyHandlers[e]=null)},insertBreak:function(){var t=e.Selection.rangeObject,r,i,s;t.isCollapsed()||this.removeSelectedMarkup(),s=n("<br/>"),o.Utils.Dom.insertIntoDOM(s,t,e.activeEditable.obj),i=o.Utils.Dom.searchAdjacentTextNode(s.parent().get(0),o.Utils.Dom.getIndexInParent(s.get(0))+1,!1),i&&(nonWSIndex=i.data.search(/\S/),nonWSIndex>0&&(i.data=i.data.substring(nonWSIndex))),t.startContainer=t.endContainer=s.get(0).parentNode,t.startOffset=t.endOffset=o.Utils.Dom.getIndexInParent(s.get(0))+1,t.correctRange(),t.clearCaches(),t.select()},preProcessKeyStrokes:function(t){if(t.type!=="keydown")return!1;var n,r,i;if(this.keyHandlers[t.keyCode]){r=this.keyHandlers[t.keyCode];for(i=0;i<r.length;++i)if(!r[i](t))return!1}if(t.keyCode===37||t.keyCode===39){if(e.getSelection().getRangeCount()){n=e.getSelection().getRangeAt(0);if(this.processCursor(n,t.keyCode))return S(e.Selection.rangeObject),!0}return!1}return t.keyCode===8?(t.preventDefault(),e.execCommand("delete",!1),!1):t.keyCode===46?(e.execCommand("forwarddelete",!1),!1):t.keyCode===13?t.shiftKey?(e.execCommand("insertlinebreak",!1),!1):(e.execCommand("insertparagraph",!1),!1):!0},processCursor:function(t,r){if(!t.collapsed)return!0;s.removeZeroWidthTextNodeFix();var i=t.startContainer,o=e.getSelection();if(!i)return!0;var a;if(n.browser.msie&&parseInt(n.browser.version,10)<=7&&l(i))if(r==37){var d=t.startOffset;while(d>0&&i.data.charAt(d-1)==="")d--;d!=t.startOffset&&(t.setStart(t.startContainer,d),t.setEnd(t.startContainer,d),o=e.getSelection(),o.removeAllRanges(),o.addRange(t))}else if(r==39){var d=t.startOffset;while(d<i.data.length&&i.data.charAt(d)==="")d++;d!=t.startOffset&&(t.setStart(t.startContainer,d),t.setEnd(t.startContainer,d),o.removeAllRanges(),o.addRange(t))}if(u&&!n(i).contentEditable()){var y=n(i).parents("[contenteditable=false]"),w=y.length>0;if(w){if(!m(y))return!0;a=y[0]}}if(!a){var E=37===r||38===r,d=t.startOffset;if(l(i)){if(E){var S=1===d;if(!S&&!v(i,d))return!0}else if(!g(i,d))return!0}else i=i.childNodes[d===c(i)?d-1:d];a=E?p(i):h(i)}return f(a)?(b(a,E,t),!1):!0},processShiftEnter:function(e){this.insertHTMLBreak(e.getSelectionTree(),e)},processEnter:function(e){e.splitObject?this.splitRangeObject(e):this.insertHTMLBreak(e.getSelectionTree(),e)},insertHTMLCode:function(t){var r=e.Selection.rangeObject;this.insertHTMLBreak(r.getSelectionTree(),r,n(t))},insertHTMLBreak:function(t,r,i){var s,u,a,f,l,c,h,p,d;i=i?i:n("<br/>");for(s=0,u=t.length;s<u;++s){a=t[s],f=a.domobj?n(a.domobj):undefined;if(a.selection!=="none")if(a.selection=="collapsed")s>0?(l=n(t[s-1].domobj),l.after(i)):(c=n(t[1].domobj),c.before(i)),r.startContainer=r.endContainer=i[0].parentNode,r.startOffset=r.endOffset=o.Utils.Dom.getIndexInParent(i[0])+1,r.correctRange();else if(a.domobj&&a.domobj.nodeType===3){a.domobj.nextSibling&&a.domobj.nextSibling.nodeType==1&&e.Selection.replacingElements[a.domobj.nextSibling.nodeName.toLowerCase()]&&f.after("<br/>");if(this.needEndingBreak()){d=a.domobj;while(d)if(d.nextSibling)d=!1;else{d=d.parentNode;if(o.Utils.Dom.isBlockLevelElement(d)||o.Utils.Dom.isListElement(d))break;d===r.limitObject&&(d=!1)}d&&n(d).append('<br class="aloha-cleanme" />')}f.between(i,a.startOffset),p=0,h=i[0];while(h)h=h.previousSibling,++p;r.startContainer=i[0].parentNode,r.endContainer=i[0].parentNode,r.startOffset=p,r.endOffset=p,r.correctRange()}else a.domobj&&a.domobj.nodeType===1&&(f.parent().find("br.aloha-ephemera").length===0&&(n(r.limitObject).find("br.aloha-ephemera").remove(),n(r.commonAncestorContainer).append(this.getFillUpElement(r.splitObject))),f.after(i),r.startContainer=r.commonAncestorContainer,r.endContainer=r.startContainer,r.startOffset=s+2,r.endOffset=s+2,r.update())}r.select()},needEndingBreak:function(){return!n.browser.msie},getSelectedText:function(){var t=e.Selection.rangeObject;return t.isCollapsed()?!1:this.getFromSelectionTree(t.getSelectionTree(),!0)},getFromSelectionTree:function(e,t){var r="",i,s,o,u;for(i=0,s=e.length;i<s;i++)o=e[i],o.selection=="partial"?o.domobj.nodeType===3?r+=o.domobj.data.substring(o.startOffset,o.endOffset):o.domobj.nodeType===1&&o.children&&(t?r+=this.getFromSelectionTree(o.children,t):(u=n(o.domobj.outerHTML).empty(),u.html(this.getFromSelectionTree(o.children,t)),r+=u.outerHTML())):o.selection=="full"&&(o.domobj.nodeType===3?r+=n(o.domobj).text():o.domobj.nodeType===1&&o.children&&(r+=t?n(o.domobj).text():n(o.domobj).outerHTML()));return r},getSelectedMarkup:function(){var t=e.Selection.rangeObject;return t.isCollapsed()?null:this.getFromSelectionTree(t.getSelectionTree(),!1)},removeSelectedMarkup:function(){var t=e.Selection.rangeObject,n;if(t.isCollapsed())return;n=new e.Selection.SelectionRange,this.removeFromSelectionTree(t.getSelectionTree(),n),n.update(),o.Utils.Dom.doCleanup({merge:!0,removeempty:!0},e.Selection.rangeObject),e.Selection.rangeObject=n,n.correctRange(),n.update(),n.select(),e.Selection.updateSelection()},removeFromSelectionTree:function(e,t){var r,i,s,u,a,f;for(s=0,f=e.length;s<f;s++)u=e[s],u.selection=="partial"?u.domobj.nodeType===3?(i="",u.startOffset>0&&(i+=u.domobj.data.substring(0,u.startOffset)),u.endOffset<u.domobj.data.length&&(i+=u.domobj.data.substring(u.endOffset,u.domobj.data.length)),u.domobj.data=i,t.startContainer||(t.startContainer=t.endContainer=u.domobj,t.startOffset=t.endOffset=u.startOffset)):u.domobj.nodeType===1&&u.children&&(this.removeFromSelectionTree(u.children,t),r?r.nodeName==u.domobj.nodeName&&(n(r).append(n(u.domobj).contents()),n(u.domobj).remove()):r=u.domobj):u.selection=="full"&&(t.startContainer||(a=o.Utils.Dom.searchAdjacentTextNode(u.domobj.parentNode,o.Utils.Dom.getIndexInParent(u.domobj)+1,!1,{blocklevel:!1}),a?(t.startContainer=t.endContainer=a,t.startOffset=t.endOffset=0):(t.startContainer=t.endContainer=u.domobj.parentNode,t.startOffset=t.endOffset=o.Utils.Dom.getIndexInParent(u.domobj)+1)),n(u.domobj).remove())},splitRangeObject:function(t,r){var i=n(t.splitObject),s,u,a;t.update(t.splitObject),s=t.getSelectionTree(),a=this.getSplitFollowUpContainer(t),this.splitRangeObjectHelper(s,t,a),a.hasClass("preparedForRemoval")&&a.removeClass("preparedForRemoval"),u=this.getInsertAfterObject(t,a),n(a).insertAfter(u),t.splitObject.nodeName.toLowerCase()==="li"&&!e.Selection.standardTextLevelSemanticsComparator(t.splitObject,a)&&n(t.splitObject).remove(),t.startContainer=null;var f=a.contents();f.length>0&&f.get(0).nodeType==1&&f.get(0).nodeName.toLowerCase()==="br"&&(t.startContainer=a.get(0)),t.startContainer||(t.startContainer=a.textNodes(!0,!0).first().get(0)),t.startContainer||(t.startContainer=a.textNodes(!1).first().parent().get(0)),t.startContainer?(t.endContainer=t.startContainer,t.startOffset=0,t.endOffset=0):(t.startContainer=t.endContainer=a.parent().get(0),t.startOffset=t.endOffset=o.Utils.Dom.getIndexInParent(a.get(0))),t.update(),t.select()},getInsertAfterObject:function(t,r){var i,s,o;for(s=0;s<t.markupEffectiveAtStart.length;s++){o=t.markupEffectiveAtStart[s],o===t.splitObject&&(i=!0);if(!i)continue;if(e.Selection.canTag1WrapTag2(n(o).parent()[0].nodeName,r[0].nodeName))return o}return!1},getFillUpElement:function(e){return n.browser.msie?!1:n('<br class="aloha-cleanme"/>')},removeElementContentWhitespaceObj:function(e){var t=0,n=[],r,i,s;for(r=0;r<e.length;++r)i=e[r],i.isElementContentWhitespace&&(n[n.length]=r);for(r=0;r<n.length;++r)s=n[r],e.splice(s-t,1),++t},splitRangeObjectHelper:function(t,r,i,s){i||e.Log.warn(this,"no followUpContainer, no inBetweenMarkup, nothing to do...");var u=this.getFillUpElement(r.splitObject),a=n(r.splitObject),f=!1,l,c,h,p,d,v,m;if(t.length>0){d=i.contents(),d.length!==t.length&&this.removeElementContentWhitespaceObj(d);for(c=0,m=t.length;c<m;++c){l=t[c];if(l.selection==="none"&&f===!1||l.domobj&&l.domobj.nodeType===3&&l===t[t.length-1]&&l.startOffset===l.domobj.data.length){i.textNodes().length>1||l.domobj.nodeType===1&&l.children.length===0?d.eq(c).remove():o.Utils.Dom.isSplitObject(i[0])?u?i.html(u):i.empty():(i.empty(),i.addClass("preparedForRemoval"));continue}l.selection!=="none"?(l.domobj&&l.domobj.nodeType===3&&l.startOffset!==undefined&&(h=l.domobj.data,l.startOffset>0?l.domobj.data=h.substr(0,l.startOffset):t.length>1?n(l.domobj).remove():(v=n(l.domobj).parent(),o.Utils.Dom.isSplitObject(v[0])?u?v.html(u):v.empty():v.remove()),h.length-l.startOffset>0?d[c].data=h.substr(l.startOffset,h.length):d.length>1?d.eq(c).remove():o.Utils.Dom.isBlockLevelElement(i[0])?u?i.html(u):i.empty():(i.empty(),i.addClass("preparedForRemoval"))),f=!0,l.children.length>0&&this.splitRangeObjectHelper(l.children,r,d.eq(c),s)):l.selection==="none"&&f===!0&&(p=n(l.domobj).remove())}}else e.Log.error(this,"can not split splitObject due to an empty selection tree");a.find("br.aloha-ephemera:gt(0)").remove(),i.find("br.aloha-ephemera:gt(0)").remove(),a.find(".preparedForRemoval").remove(),i.find(".preparedForRemoval").remove(),a.contents().length===0&&o.Utils.Dom.isSplitObject(a[0])&&u&&a.html(u),i.contents().length===0&&o.Utils.Dom.isSplitObject(i[0])&&u&&i.html(u)},getSplitFollowUpContainer:function(e){var t=e.splitObject.nodeName.toLowerCase(),r,i,s;switch(t){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":s=n(e.splitObject).textNodes(":not(.aloha-cleanme)").last()[0];if(s&&e.startContainer===s&&e.startOffset===s.length)return r=n("<p></p>"),i=n(e.splitObject.outerHTML).contents(),r.append(i),r;break;case"li":if(e.startContainer.nodeName.toLowerCase()==="br"&&n(e.startContainer).hasClass("aloha-ephemera"))return r=n("<p></p>"),i=n(e.splitObject.outerHTML).contents(),r.append(i),r;if(!e.splitObject.nextSibling&&n.trim(n(e.splitObject).text()).length===0)return r=n("<p></p>"),r}return n(e.splitObject.outerHTML)},transformDomObject:function(e,t,r){var i=n(e),s=n("<"+t+">"),o,u=i[0].cloneNode(!1).attributes;if(u)for(o=0;o<u.length;++o)(typeof u[o].specified=="undefined"||u[o].specified)&&s.attr(u[o].nodeName,u[o].nodeValue);return i[0].style&&i[0].style.cssText&&(s[0].style.cssText=i[0].style.cssText),i.contents().appendTo(s),i.replaceWith(s),r&&(r.startContainer==e&&(r.startContainer=s.get(0)),r.endContainer==e&&(r.endContainer=s.get(0))),s},toString:function(){return"Aloha.Markup"}}),e.Markup=new e.Markup,e.Markup}),define("aloha/observable",["jquery"],function(e,t){var n=e;return{_eventHandlers:null,bind:function(e,t,n){this._eventHandlers=this._eventHandlers||{},this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push({handler:t,scope:n?n:window})},unbind:function(e,t){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[e])return;t?this._eventHandlers[e]=n.grep(this._eventHandlers[e],function(e){return e.handler===t?!1:!0}):this._eventHandlers[e]=[]},trigger:function(e){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[e])return;var t=[];n.each(arguments,function(e,n){e>0&&t.push(n)}),n.each(this._eventHandlers[e],function(e,n){n.handler.apply(n.scope,t)})},unbindAll:function(){this._eventHandlers=null}}}),define("aloha/registry",["jquery","aloha/observable","util/class"],function(e,t,n){return n.extend(t,{_entries:null,_constructor:function(){this._entries={}},register:function(e,t){this._entries[e]=t,this.trigger("register",t,e)},unregister:function(e){var t=this._entries[e];delete this._entries[e],this.trigger("unregister",t,e)},get:function(e){return this._entries[e]},has:function(e){return this._entries[e]?!0:!1},getEntries:function(){return e.extend({},this._entries)}})}),define("aloha/contenthandlermanager",["jquery","aloha/registry","util/class"],function(e,t,n){return new(t.extend({createHandler:function(e){if(typeof e.handleContent!="function")throw"ContentHandler has no function handleContent().";var t=n.extend({handleContent:function(e){}},e);return new t},handleContent:function(t,n){var r,i=this.getEntries();if(typeof n.contenthandler=="undefined"){n.contenthandler=[];for(r in i)i.hasOwnProperty(r)&&n.contenthandler.push(r)}for(r in i)if(i.hasOwnProperty(r)){if(e.inArray(r,n.contenthandler)<0)continue;if(null==t)break;typeof i[r].handleContent=="function"?t=i[r].handleContent(t,n):console.error("A valid content handler needs the method handleContent.")}return t}}))}),define("aloha/editable",["aloha/core","util/class","jquery","aloha/pluginmanager","aloha/selection","aloha/markup","aloha/contenthandlermanager","aloha/console","aloha/block-jump"],function(e,t,n,r,i,s,o,u,a){function m(e){n.browser.msie&&n.browser.version<8&&(e=n(e),e.find("[hidefocus]").each(function(){n(this).removeAttr("hidefocus")}),e.find("[hideFocus]").each(function(){n(this).removeAttr("hideFocus")}),e.find("[tabindex]").each(function(){n(this).removeAttr("tabindex")}),e.find("[tabIndex]").each(function(){n(this).removeAttr("tabIndex")}))}var f=window.unescape,l=window.GENTICS,c=!1,h={};e.defaults.contentHandler={},e.defaults.contentHandler.initEditable=["blockelement","sanitize"],e.defaults.contentHandler.getContents=["blockelement","sanitize","basic"],typeof e.settings.contentHandler=="undefined"&&(e.settings.contentHandler={});var p=function(e){return n(e).html()},d=p,v=o.createHandler({handleContent:function(e){return n.browser.msie&&n.browser.version<8&&(e=e.replace(/(<table\s+[^>]*?)contenteditable=['\"\w]+/gi,"$1")),e=this.stringFizzleSizzle(e),e},stringFizzleSizzle:function(e){var t=e;while(e!==(t=e.replace(/(<[^>]*?)(nodeIndex|sizcache|sizset|jquery)[\w\d]*="[^"]*"/gi,"$1")))e=t;return e}});o.register("basic",v),e.Editable=t.extend({_constructor:function(t){t.attr("id")||t.attr("id",l.Utils.guid()),this.obj=t,this.originalObj=t,this.ready=!1,this.sccDelimiters=[":",";",".","!","?",",",f("%u0009"),f("%u0020"),f("%u0008"),f("%u007F"),"Enter"],this.sccIdle=5e3,this.sccDelay=500,this.sccTimerIdle=!1,this.sccTimerDelay=!1,this.keyCodeMap={93:"Apps",18:"Alt",20:"CapsLock",17:"Control",40:"Down",35:"End",13:"Enter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Insert",37:"Left",224:"Meta",34:"PageDown",33:"PageUp",19:"Pause",44:"PrintScreen",39:"Right",145:"Scroll",16:"Shift",38:"Up",91:"Win",92:"Win"},this.placeholderClass="aloha-placeholder",e.registerEditable(this),this.init()},init:function(){var t=this;this.settings=e.settings,e.settings&&e.settings.smartContentChange&&(e.settings.smartContentChange.delimiters&&(this.sccDelimiters=e.settings.smartContentChange.delimiters),e.settings.smartContentChange.idle&&(this.sccIdle=e.settings.smartContentChange.idle),e.settings.smartContentChange.delay&&(this.sccDelay=e.settings.smartContentChange.delay));if(!this.check(this.obj)){this.destroy();return}typeof e.settings.contentHandler.getContents=="undefined"&&(e.settings.contentHandler.getContents=e.defaults.contentHandler.getContents),typeof e.settings.contentHandler.initEditable=="undefined"&&(e.settings.contentHandler.initEditable=e.defaults.contentHandler.initEditable);var r=t.obj.html();r=o.handleContent(r,{contenthandler:e.settings.contentHandler.initEditable,command:"initEditable"}),t.obj.html(r),e.bind("aloha-ready",function(){t.obj.addClass("aloha-editable").contentEditable(!0),t.obj.mousedown(function(n){if(!e.eventHandled)return e.eventHandled=!0,t.activate(n)}),t.obj.mouseup(function(t){e.eventHandled=!1}),t.obj.focus(function(e){return t.activate(e)}),t.obj.add(".aloha-block",t.obj).keydown(function(e){var n=s.preProcessKeyStrokes(e);return t.keyCode=e.which,n||t.smartContentChange(e),n}),t.obj.keypress(function(t){e.activeEditable.smartContentChange(t)}),t.obj.keyup(function(t){if(t.keyCode===27)return e.deactivateEditable(),!1}),t.obj.contentEditableSelectionChange(function(e){return i.onChange(t.obj,e),t.obj}),t.setUnmodified(),t.snapshotContent=t.getContents(),n.browser.mozilla&&t.initEmptyEditable(),t.initPlaceholder(),t.ready=!0,e.trigger("aloha-editable-created",[t])})},isActive:!1,originalContent:null,range:undefined,check:function(){var e=this,t=this.obj,r=t.get(0),i=r.nodeName.toLowerCase(),s=["a","abbr","address","article","aside","b","bdo","blockquote","cite","code","command","del","details","dfn","div","dl","em","footer","h1","h2","h3","h4","h5","h6","header","i","ins","menu","nav","p","pre","q","ruby","section","small","span","strong","sub","sup","var"],o,u;for(o=0;o<s.length;++o)if(i===s[o])return!0;switch(i){case"label":case"button":break;case"textarea":case"input":return u=n('<div id="'+this.getId()+'-aloha" class="aloha-'+i+'" />').insertAfter(t),u.height(t.height()).width(t.width()).html(t.val()),t.hide(),t.parents("form:first").submit(function(){t.val(e.getContents())}),this.obj=u,!0;default:}return!1},initPlaceholder:function(){e.settings.placeholder&&this.isEmpty()&&this.addPlaceholder()},isEmpty:function(){var e=n.trim(this.getContents()),t=e==="<br>"?!0:!1;return e.length===0||t},initEmptyEditable:function(){var e=this.obj;this.empty(this.getContents())&&n(e).prepend('<br class="aloha-cleanme" />')},addPlaceholder:function(){var t=n("<div>"),r=n("<span>"),i,s=this.obj;l.Utils.Dom.allowsNesting(s[0],t[0])?i=t:i=r;if(n("."+this.placeholderClass,s).length!==0)return;n(s).append(i.addClass(this.placeholderClass)),n.each(e.settings.placeholder,function(e,t){s.is(e)&&i.html(t)}),n("br",s).remove()},removePlaceholder:function(e,t){var r=this.placeholderClass,s;if(n("."+this.placeholderClass,e).length===0)return;t===!0?window.setTimeout(function(){s=new i.SelectionRange,s.startContainer=s.endContainer=e.get(0),s.startOffset=s.endOffset=0,n("."+r,e).remove(),s.select()},100):n("."+r,e).remove()},destroy:function(){this===e.getActiveEditable()&&this.blur();switch(this.originalObj.get(0).nodeName.toLowerCase()){case"label":case"button":break;case"textarea":case"input":this.originalObj.val(this.getContents()),this.obj.remove(),this.originalObj.show();break;default:}this.ready=!1,this.removePlaceholder(this.obj),this.obj.removeClass("aloha-editable").contentEditable(!1).unbind("mousedown click dblclick focus keydown keypress keyup"),e.trigger("aloha-editable-destroyed",[this]),e.unregisterEditable(this)},setUnmodified:function(){this.originalContent=this.getContents()},isModified:function(){return this.originalContent!==this.getContents()},toString:function(){return"Aloha.Editable"},isDisabled:function(){return!this.obj.contentEditable()||this.obj.contentEditable()==="false"},disable:function(){return this.isDisabled()||this.obj.contentEditable(!1)},enable:function(){return this.isDisabled()&&this.obj.contentEditable(!0)},activate:function(t){var n=e.getActiveEditable();if(c){c=!1;return}if(t&&t.type==="focus"&&n!==null&&n.obj.parent().get(0)===t.currentTarget)return;if(this.isActive||this.isDisabled())return;this.obj.addClass("aloha-editable-active"),e.activateEditable(this),c=!0,this.removePlaceholder(this.obj,!0),c=!1,this.isActive=!0,e.trigger("aloha-editable-activated",{oldActive:n,editable:this})},blur:function(){this.obj.blur(),this.isActive=!1,this.initPlaceholder(),this.obj.removeClass("aloha-editable-active"),e.trigger("aloha-editable-deactivated",{editable:this}),e.activeEditable.smartContentChange({type:"blur"},null)},empty:function(e){return null===e||n.trim(e)===""||e==="<br/>"},getContents:function(t){var i=this.obj.html(),s=h[this.getId()];if(!s||i!==s.raw){a.removeZeroWidthTextNodeFix();var u=this.obj.clone(!1);u.find(".aloha-cleanme").remove(),this.removePlaceholder(u),r.makeClean(u),m(u),u=n("<div>"+o.handleContent(u.html(),{contenthandler:e.settings.contentHandler.getContents,command:"getContents"})+"</div>"),s=h[this.getId()]={},s.raw=i,s.element=u}return t?s.element.clone().contents():(null==s.serialized&&(s.serialized=d(s.element[0])),s.serialized)},setContents:function(t,n){var r=null;return e.getActiveEditable()===this&&(e.deactivateEditable(),r=this),this.obj.html(t),null!==r&&r.activate(),this.smartContentChange({type:"set-contents"}),n?this.obj.contents():d(this.obj[0])},getId:function(){return this.obj.attr("id")},smartContentChange:function(t){function l(){return null==a&&(a=r.getSnapshotContent()),a}var r=this,i=null,s,o;if(t&&(t.metaKey||t.crtlKey||t.altKey))return!1;t&&t.originalEvent&&(s=new RegExp("U\\+(\\w{4})"),o=s.exec(t.originalEvent.keyIdentifier),t.originalEvent.keyIdentifier&&!1?(o!==null&&(i=f("%u"+o[1])),i===null&&(i=t.originalEvent.keyIdentifier)):i=this.keyCodeMap[this.keyCode]||String.fromCharCode(t.which)||"unknown");var a=null;n.inArray(i,this.sccDelimiters)>=0?(clearTimeout(this.sccTimerIdle),clearTimeout(this.sccTimerDelay),this.sccTimerDelay=window.setTimeout(function(){e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:t.originalEvent.keyIdentifier,keyCode:t.keyCode,"char":i,triggerType:"keypress",getSnapshotContent:l}),u.debug("Aloha.Editable","smartContentChanged: event type keypress triggered")},this.sccDelay)):t&&t.type==="paste"?e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:null,keyCode:null,"char":null,triggerType:"paste",getSnapshotContent:l}):t&&t.type==="blur"?e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:null,keyCode:null,"char":null,triggerType:"blur",getSnapshotContent:l}):t&&t.type==="block-change"?e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:null,keyCode:null,"char":null,triggerType:"block-change",snapshotContent:r.getSnapshotContent()}):i!==null&&(clearTimeout(this.sccTimerDelay),clearTimeout(this.sccTimerIdle),this.sccTimerIdle=window.setTimeout(function(){e.trigger("aloha-smart-content-changed",{editable:r,keyIdentifier:null,keyCode:null,"char":null,triggerType:"idle",getSnapshotContent:l})},this.sccIdle))},getSnapshotContent:function(){var e=this.snapshotContent;return this.snapshotContent=this.getContents(),e}}),e.Editable.setContentSerializer=function(e){d=e},e.Editable.getContentSerializer=function(){return d}}),define("aloha/plugin",["aloha/core","jquery","util/class","aloha/pluginmanager","aloha/console"],function(e,t,n,r,i){var s=n.extend({name:null,defaults:{},settings:{},dependencies:[],_constructor:function(e){typeof e!="string"?i.error("Cannot initialise unnamed plugin, skipping"):this.name=e},checkDependencies:function(){var n=!0,r=this;return t.each(this.dependencies,function(){e.isPluginLoaded(this)||(n=!1,i.error("plugin."+r.name,'Required plugin "'+this+'" not found.'))}),n},init:function(){},getEditableConfig:function(e){var n=null,r=!1,i=this;return this.settings.editables&&t.each(this.settings.editables,function(s,o){if(e.is(s)){r=!0;if(o instanceof Array)n=[],n=t.merge(n,o);else if(typeof o=="object"){n={},n["aloha-editable-selector"]=s;for(var u in o)o.hasOwnProperty(u)&&(o[u]instanceof Array?n[u]=o[u]:typeof o[u]=="object"?(n[u]={},n[u]=t.extend(!0,n[u],i.config[u],o[u])):n[u]=o[u])}else n=o}}),r||(typeof this.settings.config=="undefined"||!this.settings.config?n=this.config:n=this.settings.config),n},makeClean:function(e){},getUID:function(e){return i.deprecated("plugin","getUID() is deprecated. Use plugin.name instead."),this.name},toString:function(){return this.name},log:function(e,t){i.deprecated("plugin","log() is deprecated. Use Aloha.console instead."),i.log(e,this,t)}});return s.create=function(n,i){var o=new(s.extend(i))(n);return o.settings=t.extendObjects(!0,o.defaults,e.settings[n]),r.register(o),o},s}),define("aloha/command",["aloha/core","aloha/registry","aloha/engine","util/dom","aloha/contenthandlermanager"],function(e,t,n,r,i){var s={execCommand:function(t,s,o,u){var a={commandId:t,preventDefault:!1};e.trigger("aloha-command-will-execute",a);if(a.preventDefault===!0)return;if(!u){if(!e.getSelection().getRangeCount())return;u=e.getSelection().getRangeAt(0)}t.toLowerCase()==="inserthtml"&&(o=i.handleContent(o,{contenthandler:e.settings.contentHandler.insertHtml,command:"insertHtml"})),n.execCommand(t,s,o,u);if(e.getSelection().getRangeCount()){u=e.getSelection().getRangeAt(0);var f=u.commonAncestorContainer;f.parentNode&&(f=f.parentNode);var l=new window.GENTICS.Utils.RangeObject;l.startContainer=u.startContainer,l.startOffset=u.startOffset,l.endContainer=u.endContainer,l.endOffset=u.endOffset,r.doCleanup({merge:!0,removeempty:!1},l,f),l.select()}e.trigger("aloha-command-executed",t)},queryCommandEnabled:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandEnabled(t,r)},queryCommandIndeterm:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandIndeterm(t,r)},queryCommandState:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandState(t,r)},queryCommandSupported:function(e){return n.queryCommandSupported(e)},queryCommandValue:function(t,r){if(!r){if(!e.getSelection().getRangeCount())return;r=e.getSelection().getRangeAt(0)}return n.queryCommandValue(t,r)},querySupportedCommands:function(){var e=[],t;for(t in n.commands)e.push(t);return e}};return s=new(t.extend(s)),e.execCommand=s.execCommand,e.queryCommandEnabled=s.queryCommandEnabled,e.queryCommandIndeterm=s.queryCommandIndeterm,e.queryCommandState=s.queryCommandState,e.queryCommandSupported=s.queryCommandSupported,e.queryCommandValue=s.queryCommandValue,e.querySupportedCommands=s.querySupportedCommands,s}),define("aloha/jquery.aloha",["aloha/core","aloha/selection","jquery","aloha/console"],function(e,t,n,r){function s(e,t,n,r){if(t===r.target||!/textarea|input|select/i
.test(r.target.nodeName)&&r.target.type!=="text")return e.apply(t,n);return}function o(e){if(typeof e.data!="string")return;var t=e.handler,r=e.data.toLowerCase().split(" "),i={};for(var o=0;o<r.length;o++)i[r[o]]=!0;e.handler=function(e){if(this!==e.target)return;var r=e.type!=="keypress"&&n.hotkeys.specialKeys[e.which],o="",u;e.altKey&&r!=="alt"&&(o+="alt+"),e.ctrlKey&&r!=="ctrl"&&(o+="ctrl+"),e.metaKey&&!e.ctrlKey&&r!=="meta"&&(o+="meta+"),e.shiftKey&&r!=="shift"&&(o+="shift+");if(r){if(i[o+r])return s(t,this,arguments,e)}else{u=String.fromCharCode(e.which).toLowerCase();if(i[o+u])return s(t,this,arguments,e);if(i[o+n.hotkeys.shiftNums[u]])return s(t,this,arguments,e);if(o==="shift+"&&i[n.hotkeys.shiftNums[u]])return s(t,this,arguments,e)}}}var i=window.XMLSerializer;n.fn.between=function(e,t){var n,r;this[0].nodeType!==3?(n=this.children().size(),t>n&&(t=n),t<=0?this.prepend(e):this.children().eq(t-1).after(e)):t<=0?this.before(e):t>=this[0].length?this.after(e):(r=this[0].data,this[0].data=r.substring(0,t),this.after(r.substring(t,r.length)),this.after(e))},n.fn.contentEditable=function(e){var t=n(this),i="contenteditable";return n.browser.msie&&parseInt(n.browser.version,10)==7&&(i="contentEditable"),typeof e=="undefined"?typeof t[0]=="undefined"?(r.warn("The jquery object did not contain any valid elements."),undefined):typeof t[0].isContentEditable=="undefined"?(r.warn("Could not determine whether the is editable or not. I assume it is."),!0):t[0].isContentEditable:(e===""?t.removeAttr(i):(e&&e!=="false"?e="true":e="false",t.attr(i,e)),t)},n.fn.aloha=function(){var t=n(this);return e.bind("aloha-ready",function(){t.each(function(){e.isEditable(this)||new e.Editable(n(this))})}),t},n.fn.mahalo=function(){return this.each(function(){e.isEditable(this)&&e.getEditableById(n(this).attr("id")).destroy()})},n.fn.contentEditableSelectionChange=function(e){var r=this;return this.keyup(function(n){var r=t.getRangeObject();e(n)}),this.dblclick(function(t){e(t)}),this.mousedown(function(e){r.selectionStarted=!0}),n(document).mouseup(function(n){t.eventOriginalTarget=r,r.selectionStarted&&e(n),t.eventOriginalTarget=!1,r.selectionStarted=!1}),this},n.fn.outerHtml=n.fn.outerHtml||function(){var e=n(this),t=e.get(0);if(typeof t.outerHTML!="undefined")return t.outerHTML;try{return(new i).serializeToString(t)}catch(r){try{return t.xml}catch(r){}}},n.fn.zap=function(){return this.each(function(){n(this.childNodes).insertBefore(this)}).remove()},n.fn.textNodes=function(e,t){var r=[],i=function(s){if(s.nodeType===3&&n.trim(s.data)&&!t||s.nodeType===3&&t||s.nodeName=="BR"&&!e)r.push(s);else for(var o=0,u=s.childNodes.length;o<u;++o)i(s.childNodes[o])};return i(this[0]),n(r)},n.extendObjects=n.fn.extendObjects=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!n.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(t in e){r=u[t],i=e[t];if(u===i)continue;l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,o=r&&n.isArray(r)?r:[]):o=r&&n.isPlainObject(r)?r:{},n.isArray(i)?u[t]=i:u[t]=n.extendObjects(l,o,i)):i!==undefined&&(u[t]=i)}return u},n.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},n.each(["keydown","keyup","keypress"],function(){n.event.special[this]={add:o}})}),define("aloha/sidebar",["aloha/core","jquery","aloha/selection","PubSub"],function(e,t,n,r){var i=+(new Date);t.easing.easeOutExpo||t.extend(t.easing,{easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeOutElastic:function(e,t,n,r,i){var s=Math,o=1.70158,u=0,a=r;if(!t)return n;if((t/=i)==1)return n+r;u||(u=i*.3);if(a<s.abs(r)){a=r;var o=u/4}else var o=u/(2*s.PI)*s.asin(r/a);return a*s.pow(2,-10*t)*s.sin((t*i-o)*2*s.PI/u)+r+n}});var s=function(n){this.id=null,this.folds={},this.button=null,this.title=t('<div class="aloha-sidebar-panel-title"><span class="aloha-sidebar-panel-title-arrow"></span><span class="aloha-sidebar-panel-title-text">Untitled</span></div>'),this.content=t('<div class="aloha-sidebar-panel-content"><div class="aloha-sidebar-panel-content-inner"><div class="aloha-sidebar-panel-content-inner-text"></div></div></div>'),this.element=null,this.effectiveElement=null,this.expanded=!1,this.isActive=!0,this.init(n)},o=function(r){var s=this;this.id="aloha-sidebar-"+ ++i,this.panels={},this.container=t('<div class="aloha-ui aloha-sidebar-bar"><div class="aloha-sidebar-handle"><span class="aloha-sidebar-handle-icon"></span></div><div class="aloha-sidebar-inner"><ul class="aloha-sidebar-panels"></ul></div></div>'),this.width=300,this.opened=!1,this.isOpen=!1,this.settings={rotateIcons:!t.browser.msie,overlayPage:!0},t(function(){(typeof e.settings.sidebar=="undefined"||!e.settings.sidebar.disabled)&&s.init(r)})},u=null,a=null;t.extend(o.prototype,{init:function(e){var n=this,r;typeof e=="object"&&(r=e.panels,delete e.panels),t.extend(this,e),typeof r=="object"&&t.each(r,function(){n.addPanel(this,!0)});var i=this.container;this.position==="right"&&i.addClass("aloha-sidebar-right"),i.hide().appendTo(t("body")).click(function(){n.barClicked.apply(n,arguments)}).find(".aloha-sidebar-panels").width(this.width),i.width(this.width),this.width=i.width(),t(window).resize(function(){n.updateHeight()}),this.updateHeight(),this.initToggler(),this.container.css(this.position==="right"?"marginRight":"marginLeft",-this.width),this.opened&&this.open(0),this.toggleHandleIcon(this.isOpen),this.subscribeToEvents(),t(window).resize(function(){n.correctHeight()}),this.correctHeight()},show:function(){return this.container.css("display","block"),this},hide:function(){return this.container.css("display","none"),this},checkActivePanels:function(e){var n=[];if(typeof e!="undefined"&&typeof e.markupEffectiveAtStart!="undefined"){var r=e.markupEffectiveAtStart.length,i;for(i=0;i<r;++i)n.push(t(e.markupEffectiveAtStart[i]))}var s=this;t.each(this.panels,function(){s.showActivePanel(this,n)}),this.correctHeight()},subscribeToEvents:function(){var t=this;r.sub("aloha.selection.context-change",function(e){t.isOpen&&t.checkActivePanels(e.range),t.lastRange=e.range}),e.bind("aloha-editable-deactivated",function(e,n){t.isOpen&&t.checkActivePanels(),t.lastRange=null}),this.container.mousedown(function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!0}),this.container.mouseup(function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!1})},correctHeight:function(){if(!this.isOpen)return;var e=t(window).height(),n=[],r=[],i;for(i in this.panels)this.panels.hasOwnProperty(i)&&this.panels[i].isActive&&(r.push(this.panels[i]),n.push(i));if(0===r.length)return;n=n.sort().join(",");if(a===n&&u===e)return;u=e,a=n;var s=this.container.find(".aloha-sidebar-inner").height(),o=s-(r[0].title.outerHeight()+10)*r.length,f,l,c,h,p,d=0,v=Math,m;while(r.length>0&&o>0){o+=d,d=0,p=[];for(m=r.length-1;m>=0;--m)f=r[m],c=f.content.find(".aloha-sidebar-panel-content-inner"),l=v.min(c.height("auto").height(),v.floor(o/(m+1))),c.height(l),o-=l,h=c.find(".aloha-sidebar-panel-content-inner-text"),h.height()>l?(p.push(f),d+=l,c.css({"overflow-x":"hidden","overflow-y":"scroll"})):c.css("overflow-y","hidden"),f.expanded&&f.expand();r=p}},showActivePanel:function(e,n){n.push(null);var r=e.content.parent("li"),i=e.activeOn,s=t(),o=0,u=n.length,a;for(a=0;a<u;++a)i(n[a])&&(++o,n[a]&&t.merge(s,n[a]));o?e.activate(s):e.deactivate()},initToggler:function(){var n=this,r=this.container,i=r.find(".aloha-sidebar-handle-icon"),s="aloha-sidebar-toggled",o,u=this.position==="right";this.opened&&this.rotateHandleArrow(u?0:180,0),t(function(){typeof e.settings.sidebar!="undefined"&&e.settings.sidebar.handle&&e.settings.sidebar.handle.top&&(t(r.find(".aloha-sidebar-handle"))[0].style.top=e.settings.sidebar.handle.top)}),r.find(".aloha-sidebar-handle").click(function(){o&&clearInterval(o),i.stop().css("marginLeft",4),n.isOpen?(t(this).removeClass(s),n.close(),n.isOpen=!1):(t(this).addClass(s),n.open(),n.isOpen=!0)}).hover(function(){var e=n.isOpen?-1:1;o&&clearInterval(o),i.stop(),t(this).stop().animate(u?{marginLeft:"-="+e*5}:{marginRight:"-="+e*5},200),o=setInterval(function(){e*=-1,i.animate(u?{left:"-="+e*4}:{right:"-="+e*4},300)},300)},function(){o&&clearInterval(o),i.stop().css(u?"left":"right",5),t(this).stop().animate(u?{marginLeft:0}:{marginRight:0},600,"easeOutElastic")})},roundCorners:function(){var e=this.container,t=e.find(".aloha-sidebar-panels>li:not(.aloha-sidebar-deactivated)"),n="aloha-sidebar-panel-top",r="aloha-sidebar-panel-bottom";e.find(".aloha-sidebar-panel-top, .aloha-sidebar-panel-bottom").removeClass(n).removeClass(r),t.first().find(".aloha-sidebar-panel-title").addClass(n),t.last().find(".aloha-sidebar-panel-content").addClass(r)},updateHeight:function(){var e=t(window).height();this.container.height(e).find(".aloha-sidebar-inner").height(e)},barClicked:function(e){this.handleBarclick(t(e.target))},handleBarclick:function(e){e.hasClass("aloha-sidebar-panel-title")?this.togglePanel(e):!e.hasClass("aloha-sidebar-panel-content")&&!e.hasClass("aloha-sidebar-handle")&&!e.hasClass("aloha-sidebar-bar")&&this.handleBarclick(e.parent())},getPanelById:function(e){return this.panels[e]},getPanelByElement:function(e){var t=e[0].tagName==="LI"?e:e.parent("li");return this.getPanelById(t[0].id)},togglePanel:function(e){this.getPanelByElement(e).toggle()},rotateHandleIcon:function(e,t){var n=this.container.find(".aloha-sidebar-handle-icon");n.animate({angle:e},{duration:typeof t=="number"||typeof t=="string"?t:500,easing:"easeOutExpo",step:function(e,t){n.css({"-o-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)"})}})},toggleHandleIcon:function(e){var t=this.position==="right"^e;if(this.settings.rotateIcons)this.rotateHandleIcon(t?180:0,0);else{var n=this.container.find(".aloha-sidebar-handle-icon");t?n.addClass("aloha-sidebar-handle-icon-left"):n.removeClass("aloha-sidebar-handle-icon-left")}},open:function(e,n){if(this.isOpen)return this;var r=this.position==="right",i=r?{marginRight:0}:{marginLeft:0};return this.toggleHandleIcon(!0),this.container.animate(i,typeof e=="number"||typeof e=="string"?e:500,"easeOutExpo"),this.settings.overlayPage||t("body").animate(r?{marginRight:"+="+this.width}:{marginLeft:"+="+this.width},500,"easeOutExpo"),this.isOpen=!0,this.correctHeight(),this.lastRange&&this.checkActivePanels(this.lastRange),t("body").trigger("aloha-sidebar-opened",this),this},close:function(e,n){if(!this.isOpen)return this;var r=this.position==="right",i=r?{marginRight:-this.width}:{marginLeft:-this.width};return this.toggleHandleIcon(!1),this.container.animate(i,typeof e=="number"||typeof e=="string"?e:500,"easeOutExpo"),this.settings.overlayPage||t("body").animate(r?{marginRight:"-="+this.width}:{marginLeft:"-="+this.width},500,"easeOutExpo"),this.isOpen=!1,this},activatePanel:function(e,t){return typeof e=="string"&&(e=this.getPanelById(e)),e&&e.activate(t),this.roundCorners(),this},expandPanel:function(e,t){return typeof e=="string"&&(e=this.getPanelById(e)),e&&e.expand(t),this},collapsePanel:function(e,t){return typeof e=="string"&&(e=this.getPanelById(e)),e&&e.collapse(t),this},addPanel:function(e,t){return e instanceof s||(e.width||(e.width=this.width),e.sidebar=this,e=new s(e)),this.panels[e.id]=e,this.container.find(".aloha-sidebar-panels").append(e.element),this.checkActivePanels(n.getRangeObject()),e}}),t.extend(s.prototype,{init:function(e){this.setTitle(e.title).setContent(e.content),delete e.title,delete e.content,t.extend(this,e),this.id||(this.id="aloha-sidebar-"+ ++i);var n=this.element=t('<li id="'+this.id+'">').append(this.title,this.content);this.expanded&&this.content.height("auto"),this.toggleTitleIcon(this.expanded),this.coerceActiveOn(),this.title.attr("unselectable","on").css("-moz-user-select","none").each(function(){this.onselectstart=function(){return!1}}),typeof this.onInit=="function"&&this.onInit.apply(this)},toggleTitleIcon:function(e){if(this.sidebar.settings.rotateIcons)this.rotateTitleIcon(e?90:0);else{var t=this.title.find(".aloha-sidebar-panel-title-arrow");e?t.addClass("aloha-sidebar-panel-title-arrow-down"):t.removeClass("aloha-sidebar-panel-title-arrow-down")}},coerceActiveOn:function(){if(typeof this.activeOn!="function"){var e=this.activeOn;this.activeOn=function(){var t=typeof e,n;return t==="boolean"?n=function(){return e}:t==="undefined"?n=function(){return!0}:t==="string"?n=function(t){return t?t.is(e):!1}:n=function(){return!1},n}()}},activate:function(e){this.isActive=!0,this.content.parent("li").show().removeClass("aloha-sidebar-deactivated"),this.effectiveElement=e,typeof this.onActivate=="function"&&this.onActivate.call(this,e)},deactivate:function(){if(!this.isActive)return;this.isActive=!1,this.content.parent("li").hide().addClass("aloha-sidebar-deactivated"),this.effectiveElement=null},toggle:function(){this.expanded?this.collapse():this.expand()},expand:function(e){var t=this,n=this.content,r=n.height(),i=n.height("auto").height();return n.height(r).stop().animate({height:i},500,"easeOutExpo",function(){typeof e=="function"&&e.call(t)}),this.element.removeClass("collapsed"),this.toggleTitleIcon(!0),this.expanded=!0,this},collapse:function(e,t){var n=this;return this.element.addClass("collapsed"),this.content.stop().animate({height:5},250,"easeOutExpo",function(){typeof t=="function"&&t.call(n)}),this.toggleTitleIcon(!1),this.expanded=!1,this},setTitle:function(e){return this.title.find(".aloha-sidebar-panel-title-text").html(e),this},setContent:function(e){if(!e||e==="")e="&nbsp;";return this.content.find(".aloha-sidebar-panel-content-inner-text").html(e),this},rotateTitleIcon:function(e,t){var n=this.title.find(".aloha-sidebar-panel-title-arrow");n.animate({angle:e},{duration:typeof t=="number"?t:500,easing:"easeOutExpo",step:function(e,t){n.css({"-o-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)","-moz-transform":"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)"})}})},renderEffectiveParents:function(e,n){var r=e.first(),i=[],s=[],o=this.activeOn,u,a;while(r.length>0&&!r.is(".aloha-editable")){if(o(r)){s.push("<span>"+r[0].tagName.toLowerCase()+"</span>"),u=s.length,a=[];while(u--)a.push(s[u]);i.push('<div class="aloha-sidebar-panel-parent"><div class="aloha-sidebar-panel-parent-path">'+a.join("")+"</div>"+'<div class="aloha-sidebar-panel-parent-content'+'aloha-sidebar-opened">'+(typeof n=="function"?n(r):"----")+"</div>"+"</div>")}r=r.parent()}this.setContent(i.join("")),t(".aloha-sidebar-panel-parent-path").click(function(){var e=t(this).parent().find(".aloha-sidebar-panel-parent-content");e.hasClass("aloha-sidebar-opened")?e.hide().removeClass("aloha-sidebar-opened"):e.show().addClass("aloha-sidebar-opened")}),this.content.height("auto").find(".aloha-sidebar-panel-content-inner").height("auto")}});var f=new o({position:"left",width:250}),l=new o({position:"right",width:250});return e.Sidebar={left:f,right:l},e.Sidebar}),GENTICS=window.GENTICS||{},GENTICS.Utils=GENTICS.Utils||{},define("util/position",["jquery"],function(e){var t=e,n=window.GENTICS,r=window.Class,i=window.console;n.Utils.Position={},n.Utils.Position.w=e(window),n.Utils.Position.Scroll={top:0,left:0,isScrolling:!1},n.Utils.Position.ScrollCorrection={top:100,left:50},n.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:!1,triggeredMouseStop:!0},n.Utils.Position.mouseStopCallbacks=[],n.Utils.Position.mouseMoveCallbacks=[],n.Utils.Position.update=function(){var e=this.w.scrollTop(),t=this.w.scrollLeft(),n;if(this.Scroll.isScrolling)this.Scroll.top==e&&this.Scroll.left==t&&(this.Scroll.isScrolling=!1);else if(this.Scroll.top!=e||this.Scroll.left!=t)this.Scroll.isScrolling=!0;this.Scroll.top=e,this.Scroll.left=t;if(this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){this.Mouse.isMoving=!1;if(!this.Mouse.triggeredMouseStop){this.Mouse.triggeredMouseStop=!0;for(n=0;n<this.mouseStopCallbacks.length;n++)this.mouseStopCallbacks[n].call()}}else{this.Mouse.isMoving=!0,this.Mouse.triggeredMouseStop=!1;for(n=0;n<this.mouseMoveCallbacks.length;n++)this.mouseMoveCallbacks[n].call()}this.Mouse.oldX=this.Mouse.x,this.Mouse.oldY=this.Mouse.y},n.Utils.Position.addMouseStopCallback=function(e){return this.mouseStopCallbacks.push(e),this.mouseStopCallbacks.length-1},n.Utils.Position.addMouseMoveCallback=function(e){return this.mouseMoveCallbacks.push(e),this.mouseMoveCallbacks.length-1},e(function(){window.setInterval(function(){n.Utils.Position.update()},500)}),e("html").mousemove(function(e){n.Utils.Position.Mouse.x=e.pageX,n.Utils.Position.Mouse.y=e.pageY})}),define("aloha/repositorymanager",["aloha/core","util/class","jquery","aloha/console"],function(e,t,n,r){return e.RepositoryManager=t.extend({repositories:[],settings:{},init:function(){var t=this.repositories,r=0,i=t.length,s;e.settings&&e.settings.repositories&&(this.settings=e.settings.repositories),this.settings.timeout=this.settings.timeout||5e3;for(;r<i;++r)s=t[r],s.settings||(s.settings={}),this.settings[s.repositoryId]&&n.extend(s.settings,this.settings[s.repositoryId]),s.init()},register:function(e){this.getRepository(e.repositoryId)?r.warn(this,"A repository with name { "+e.repositoryId+" } already registerd. Ignoring this."):this.repositories.push(e)},getRepository:function(e){var t=this.repositories,n=0,r=t.length;for(;n<r;++n)if(t[n].repositoryId===e)return t[n];return null},query:function(e,t){var i=this,s,o=[],u={numItems:0,hasMoreItems:!1},a=[],f=0,l,c,h,p=function(e,s){if(f===0)return;var a=e?e.length:0;if(a){if(!e[0].repositoryId){var c=this.repositoryId,h;for(h=0;h<a;++h)e[h].repositoryId=c}n.merge(o,e)}s&&u?(n.isNumeric(s.numItems)&&n.isNumeric(u.numItems)?u.numItems+=s.numItems:u.numItems=undefined,typeof s.hasMoreItems=="boolean"&&typeof u.hasMoreItems=="boolean"?u.hasMoreItems=u.hasMoreItems||s.hasMoreItems:u.hasMoreItems=undefined):u=undefined,r.debug(this,"The repository "+this.repositoryId+" returned with "+a+" results."),--f===0&&i.queryCallback(t,o,u,l)},d=parseInt(e.timeout,10)||this.settings.timeout;l=window.setTimeout(function(){f>0&&r.warn(this,f+" repositories did not return before the configured timeout of "+d+"ms."),f=0,i.queryCallback(t,o,u,l)},d),e.repositoryId?a.push(this.getRepository(e.repositoryId)):a=this.repositories,h=a.length;var v=[];for(c=0;c<h;++c)s=a[c],typeof s.query=="function"&&(++f,v.push(s));h=v.length;for(c=0;c<h;++c)s=v[c],s.query(e,function(){p.apply(s,arguments)});f===0&&this.queryCallback(t,o,u,l)},queryCallback:function(e,t,n,r){r&&(clearTimeout(r),r=undefined);var i={items:t,results:t.length};n&&(i.numItems=n.numItems,i.hasMoreItems=n.hasMoreItems),e.call(this,i)},getChildren:function(t,r){var i=this,s,o=[],u=[],a=0,f,l,c,h=function(e){if(a===0)return;o&&e&&n.merge(o,e),--a===0&&i.getChildrenCallback(r,o,f)};if(t.inFolderId==="aloha"){var p=t.repositoryFilter,d=p&&p.length;c=this.repositories.length;for(l=0;l<c;++l)s=this.repositories[l],(!d||n.inArray(s.repositoryId,p)>-1)&&u.push(new e.RepositoryFolder({id:s.repositoryId,name:s.repositoryName,repositoryId:s.repositoryId,type:"repository",hasMoreItems:!0}));i.getChildrenCallback(r,u,null);return}u=this.repositories;var v=parseInt(t.timeout,10)||this.settings.timeout;f=window.setTimeout(function(){a=0,i.getChildrenCallback(r,o,f)},v),c=u.length;for(l=0;l<c;++l)s=u[l],typeof s.getChildren=="function"&&(++a,s.getChildren(t,function(){h.apply(s,arguments)}));a===0&&this.getChildrenCallback(r,o,f)},getChildrenCallback:function(e,t,n){n&&(clearTimeout(n),n=undefined),e.call(this,t)},makeClean:function(e){var t=this,n={},i=0,s=t.repositories.length;e.find("[data-gentics-aloha-repository="+this.prefix+"]").each(function(){for(;i<s;++i)n.makeClean(e);r.debug(t,"Passing contents of HTML Element with id { "+this.attr("id")+" } for cleaning to repository { "+n.repositoryId+" }"),n.makeClean(this)})},markObject:function(e,t){if(!e)return;if(t){var i=this.getRepository(t.repositoryId);i?(n(e).attr({"data-gentics-aloha-repository":t.repositoryId,"data-gentics-aloha-object-id":t.id}),i.markObject(e,t)):r.error(this,"Trying to apply a repository { "+t.name+" } to an object, but item has no repositoryId.")}else n(e).removeAttr("data-gentics-aloha-repository").removeAttr("data-gentics-aloha-object-id")},getObject:function(e,t){var r=this,i=n(e),s=this.getRepository(i.attr("data-gentics-aloha-repository")),o=i.attr("data-gentics-aloha-object-id");s&&o&&(this.itemCache=this.itemCache||[],this.itemCache[s.repositoryId]=this.itemCache[s.repositoryId]||[],this.itemCache[s.repositoryId][o]?t.call(this,[this.itemCache[s.repositoryId][o]]):s.getObjectById(o,function(e){r.itemCache[s.repositoryId][o]=e[0],t.call(this,e)}))},toString:function(){return"repositorymanager"}}),e.RepositoryManager=new e.RepositoryManager,e.RepositoryManager}),define("aloha/repository",["aloha/core","util/class","aloha/repositorymanager"],function(e,t,n){var r=t.extend({_constructor:function(e,t){this.repositoryId=e,this.settings={},this.repositoryName=t?t:e,n.register(this)},init:function(){},query:null,getChildren:null,makeClean:function(e){},markObject:function(e,t){},setTemplate:function(e){e?this.template=e:this.template=null},hasTemplate:function(){return this.template?!0:!1},getTemplate:function(){return this.template},getObjectById:function(e,t){return!0}});return e.AbstractRepository=r,r}),define("aloha/repositoryobjects",["aloha/core","util/class"],function(e,t){var n=window.GENTICS;e.RepositoryObject=function(){},e.RepositoryDocument=t.extend({_constructor:function(e){var t=e;this.type="document";if(!t.id||!t.name||!t.repositoryId)return;n.Utils.applyProperties(this,e),this.baseType="document"}}),e.RepositoryFolder=t.extend({_constructor:function(e){var t=e;this.type="folder";if(!t.id||!t.name||!t.repositoryId)return;n.Utils.applyProperties(this,e),this.baseType="folder"}})}),function(e){function t(){var e,t,n=Aloha.settings.plugins&&Aloha.settings.plugins.load,r=Aloha.settings.baseUrl,i,s=/\/aloha\.js$/,o=/\/[^\/]*\.js$/,u;if(!n||!r){e=document.getElementsByTagName("script");for(u=0;u<e.length;u++){t=e[u],i=t.getAttribute("data-aloha-plugins");if(null!=i){n||(n=i),r=t.src.replace(o,"");break}!r&&s.test(t.src)&&(r=t.src.replace(s,""))}}return typeof n=="string"&&n!==""&&(n=n.replace(/\s+/g,"").split(",")),{baseUrl:r,plugins:n||[]}}function n(){var e=document.getElementsByTagName("script");for(var t=0;t<e.length;t++){var n=e[t].getAttribute("data-aloha-defer-init");if("true"===n)return!0}return!1}function r(e,t,n){var r=["nls","css","vendor","res"],i,s;e[n]=t+"/"+n+"/lib";for(s=0;s<r.length;s++){var i=r[s];e[n+"/"+i]=t+"/"+n+"/"+i}}function i(e){var t={},n=[],i=[],s={},o={},u,a,f,l=Aloha.settings.basePath||"",c,h=Aloha.settings.bundles||{},p;for(p=0;p<e.length;p++)u=e[p].split("/"),a=u[0],f=u[1],h[a]?c=l+h[a]:c=l+"../plugins/"+a,r(t,c,f),s[f]=c+"/"+f,n.push(f+"/"+f+"-plugin"),o[f]={jquery:"aloha/jquery"};return{paths:t,entryPoints:n,baseUrlByName:s,names:i,map:o}}function s(){var e={},t=Array.prototype.slice.call(arguments),n,r,i;for(r=0;r<t.length;r++){i=t[r];for(n in i)i.hasOwnProperty(n)&&(e[n]=t[r][n])}return e}function o(e,t){define(e,function(){return t})}function u(){Aloha.defaults={},Aloha.settings=Aloha.settings||{};var e=t(),n=i(e.plugins);Aloha.settings.baseUrl=e.baseUrl,Aloha.settings.loadedPlugins=n.names,Aloha.settings._pluginBaseUrlByName=n.baseUrlByName;var r={aloha:{jquery:"aloha/jquery"},"aloha/jquery":{jquery:"jquery"},jqueryui:{jquery:"aloha/jquery"},vendor:{jquery:"aloha/jquery"},util:{jquery:"aloha/jquery"},RepositoryBrowser:{jquery:"aloha/jquery"},jstree:{jquery:"aloha/jquery"},jqgrid:{jquery:"aloha/jquery"},"jqgrid-locale-en":{jquery:"aloha/jquery"},"jqgrid-locale-de":{jquery:"aloha/jquery"},"jquery-layout":{jquery:"aloha/jquery"}},u=s(r,n.map),a={context:"aloha",locale:Aloha.settings.locale||"en",baseUrl:Aloha.settings.baseUrl,map:u},f={jquery:"vendor/jquery-1.7.2",jqueryui:"vendor/jquery-ui-1.9m6"},l={PubSub:"vendor/pubsub/js/pubsub-unminified",Class:"vendor/class",RepositoryBrowser:"vendor/repository-browser/js/repository-browser-unminified",jstree:"vendor/jquery.jstree",jqgrid:"vendor/jquery.jqgrid","jquery-layout":"vendor/jquery.layout","jqgrid-locale-en":"vendor/grid.locale.en","jqgrid-locale-de":"vendor/grid.locale.de","repository-browser-i18n-de":"vendor/repository-browser/js/repository-browser-unminified","repository-browser-i18n-en":"vendor/repository-browser/js/repository-browser-unminified"},c=s(a,Aloha.settings.requireConfig);c.paths=s(f,l,n.paths,c.paths);var h=Aloha.settings.predefinedModules||{};Aloha.settings.jQuery&&(h.jquery=Aloha.settings.jQuery);var p;for(p in h)h.hasOwnProperty(p)&&(o(p,h[p]),delete c.paths[p]);var d=require.config(c);Aloha.require=function(e){return 1===arguments.length&&typeof e=="function"?d(["aloha"],e):d.apply(this,arguments)};var v;Aloha.bind=function(e,t){return Aloha.require(["aloha/jquery"],function(n){Aloha.bind=function(e,t){return v=v||n.Deferred(),"aloha-ready"===e?"alohaReady"!==Aloha.stage?v.done(t):t():n(Aloha,"body").bind(e,t),this},Aloha.bind(e,t)}),this},Aloha.trigger=function(e,t){return Aloha.require(["aloha/jquery"],function(n){Aloha.trigger=function(e,t){return v=v||n.Deferred(),"aloha-ready"===e&&n(v.resolve),n(Aloha,"body").trigger(e,t),this},Aloha.trigger(e,t)}),this},Aloha.unbind=function(e){jQuery(Aloha,"body").unbind(e)},Aloha.ready=function(e){return this.bind("aloha-ready",e),this};var m=Aloha.settings.jQuery;define("aloha/jquery",["jquery"],function(e){return m||e}),define("aloha",["aloha/jquery","util/json2","aloha/rangy-core","util/class","util/lang","util/range","util/dom","aloha/core","aloha/editable","aloha/console","aloha/markup","aloha/plugin","aloha/selection","aloha/command","aloha/jquery.aloha","aloha/sidebar","util/position","aloha/repositorymanager","aloha/repository","aloha/repositoryobjects","aloha/contenthandlermanager"],function(e){return Aloha.jQuery=e,Aloha.settings=e.extendObjects(!0,{},Aloha.defaults,Aloha.settings),Aloha}),Aloha.stage="loadingAloha",require(c,["aloha","aloha/jquery"],function(e,t){e.stage="loadPlugins",require(c,n.entryPoints,function(){t(function(){window.rangy.init(),e.init()})})})}e.Aloha=e.Aloha||{},e.Aloha.deferInit||n()?e.Aloha.deferInit=u:Aloha._load=u}(window),define("ui/context",["aloha","jquery","util/class"],function(e,t,n){var r="aloha-ui-context",i="#"+r,s;s=t(i),s.length||(s=t("<div>",{"class":"aloha",id:r}),t(function(){s.appendTo("body")}));var o=n.extend({surfaces:[],containers:[]});return t.extend(o,{selector:i,element:s}),o}),define("ui/scopes",["jquery","PubSub"],function(e,t){function o(e,t){if(!n.hasOwnProperty(t))return;var r=n[t];for(var i=0;i<r.length;i++){var s=r[i];e.push(s),o(e,s)}}var n={"Aloha.empty":[],"Aloha.global":["Aloha.empty"],"Aloha.continuoustext":["Aloha.global"]},r=[],i={},s=!1;Aloha.bind("aloha-selection-changed-before",function(){s=!1}),Aloha.bind("aloha-selection-changed-after",function(e,t,n){typeof n!="undefined"&&!s&&u.setScope("Aloha.continuoustext")});var u={enterScope:function(e){var n=i[e]||0;i[e]=n+1,n||t.pub("aloha.ui.scope.change")},leaveScope:function(e){var n=i[e]-1;n?i[e]=n:(delete i[e],t.pub("aloha.ui.scope.change"))},isActiveScope:function(t){if(i[t])return!0;var n=-1!==e.inArray(t,r);return n?!0:!1},getPrimaryScope:function(){return r[0]},setScope:function(e){s=!0,r[0]!=e&&(r=[e],o(r,e),t.pub("aloha.ui.scope.change"))},createScope:function(e,t){t?typeof t=="string"&&(t=[t]):t=["Aloha.empty"],n[e]=t}};return u}),define("ui/container",["jquery","util/class","ui/scopes"],function(e,t,n){function i(e){return e.showOnId||(e.showOnId=++r),e.showOnId}function s(e,t){var n=t?"show":"hide",r;for(r=0;r<e.length;r++)e[r][n]()}function a(t,r){switch(e.type(r)){case"function":return r;case"object":if(r.scope)return o[r.scope]?o[r.scope]:o[r.scope]=function(){return n.isActiveScope(r.scope)};throw"Invalid showOn configuration";default:return u}}var r=0,o={},u=function(){return!0},f=t.extend({element:null,_constructor:function(e,t){var n=a(this,t.showOn),r=i(n),s=e.containers[r];this.context=e,s||(s=e.containers[r]={shouldShow:n,containers:[]}),s.containers.push(this)},show:function(){},hide:function(){},focus:function(){},foreground:function(){},childVisible:function(e,t){},childFocus:function(e){},childForeground:function(e){}});return e.extend(f,{showContainersForContext:function(e,t){var n,r,i;if(!e.containers)return;i=e.containers;for(r in i)i.hasOwnProperty(r)&&(n=i[r],s(n.containers,n.shouldShow(t)))}}),f}),define("ui/surface",["aloha/core","jquery","util/class","ui/container"],function(e,t,n,r){var i=n.extend({_constructor:function(e){e.surfaces.push(this)},isActive:function(){return!0}});return t.extend(i,{range:null,show:function(e){t.each(e.surfaces,function(e,t){t.show()})},hide:function(e){t.each(e.surfaces,function(e,t){t.hide()})},trackRange:function(t){t.bind("mousedown",function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!0,i.suppressHide=!0;if(e.activeEditable){var n=e.getSelection();i.range=0<n.getRangeCount()?n.getRangeAt(0):null}}),t.bind("mouseup",function(t){t.originalEvent.stopSelectionUpdate=!0,e.eventHandled=!1,i.suppressHide=!1})}}),i}),define("ui/component",["aloha/core","jquery","util/class"],function(e,t,n){var r=0,i=n.extend({id:0,isInstance:!0,container:null,type:null,visible:!0,_constructor:function(){this.id=r++,this.init()},adoptParent:function(e){this.container=e},init:function(){},isVisible:function(){return this.visible},show:function(e){if(!1===e){this.hide();return}this.visible||(this.visible=!0,this.element.show(),this.container&&this.container.childVisible(this,!0))},hide:function(){this.visible&&(this.visible=!1,this.element.hide(),this.container&&this.container.childVisible(this,!1))},focus:function(){this.element.focus(),this.container&&this.container.childFocus(this)},foreground:function(){this.container&&this.container.childForeground(this)},enable:function(e){},disable:function(){}});return i}),define("jqueryui",["jquery"],function(jQuery){var $=jQuery;return function(e,t){function n(t,n){var i=t.nodeName.toLowerCase();if("area"===i){var s=t.parentNode,o=s.name,u;return!t.href||!o||s.nodeName.toLowerCase()!=="map"?!1:(u=e("img[usemap=#"+o+"]")[0],!!u&&r(u))}return(/input|select|textarea|button|object/.test(i)?!t.disabled:"a"==i?t.href||n:n)&&r(t)}function r(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.9m6",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection"
,function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,r&&(n-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),s&&(n-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i=e.ui[t].prototype;for(var s in r)i.plugins[s]=i.plugins[s]||[],i.plugins[s].push([n,r[s]])},call:function(e,t,n){var r=e.plugins[t];if(!r||!e.element[0].parentNode)return;for(var i=0;i<r.length;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})}(jQuery),function(e,t){var n=Array.prototype.slice,r=e.cleanData;e.cleanData=function(t){for(var n=0,i;(i=t[n])!=null;n++)try{e(i).triggerHandler("remove")}catch(s){}r(t)},e.widget=function(t,r,i){var s=t.split(".")[0],o;t=t.split(".")[1],o=s+"-"+t,i||(i=r,r=e.Widget),e.expr[":"][o]=function(n){return!!e.data(n,t)},e[s]=e[s]||{},e[s][t]=e.extend(function(n,r){if(!this._createWidget)return new e[s][t](n,r);arguments.length&&this._createWidget(n,r)},e[s][t],{version:i.version});var u=new r;u.options=e.widget.extend({},u.options),e.each(i,function(t,s){e.isFunction(s)&&(i[t]=function(){var e=function(e){return r.prototype[e].apply(this,n.call(arguments,1))},t=function(e,t){return r.prototype[e].apply(this,t)};return function(){var n=this._super,r=this._superApply,i;return this._super=e,this._superApply=t,i=s.apply(this,arguments),this._super=n,this._superApply=r,i}}())}),e[s][t].prototype=e.widget.extend(u,{namespace:s,widgetName:t,widgetEventPrefix:t,widgetBaseClass:o},i),e.widget.bridge(t,e[s][t])},e.widget.extend=function(r){var i=n.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(r[u]=e.isPlainObject(a)?e.widget.extend({},r[u],a):a);return r},e.widget.bridge=function(r,i){e.fn[r]=function(s){var o=typeof s=="string",u=n.call(arguments,1),a=this;return s=!o&&u.length?e.widget.extend.apply(null,[s].concat(u)):s,o?this.each(function(){var n=e.data(this,r);if(!n)return e.error("cannot call methods on "+r+" prior to initialization; "+"attempted to call method '"+s+"'");if(!e.isFunction(n[s])||s.charAt(0)==="_")return e.error("no such method '"+s+"' for "+r+" widget instance");var i=n[s].apply(n,u);if(i!==n&&i!==t)return a=i&&i.jquery?a.pushStack(i.get()):i,!1}):this.each(function(){var t=e.data(this,r);t?t.option(s||{})._init():i(s,this)}),a}},e.Widget=function(t,n){if(!this._createWidget)return new e[namespace][name](t,n);arguments.length&&this._createWidget(t,n)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetName,this),this._bind({remove:"destroy"})),this._create(),this._trigger("create"),this._init()},_getCreateOptions:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled"),this.bindings.unbind("."+this.widgetName),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_bind:function(t,n){n?(t=e(t),this.bindings=this.bindings.add(t)):(n=t,t=this.element);var r=this;e.each(n,function(n,i){function s(){if(r.options.disabled===!0||e(this).hasClass("ui-state-disabled"))return;return(typeof i=="string"?r[i]:i).apply(r,arguments)}var o=n.match(/^(\w+)\s*(.*)$/),u=o[1]+"."+r.widgetName,a=o[2];a?r.widget().delegate(a,u,s):t.bind(u,s)})},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._bind(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._bind(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i=this.options[t],s;n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),r=r||{};if(n.originalEvent)for(var o=e.event.props.length,u;o;)u=e.event.props[--o],n[u]=n.originalEvent[u];return this.element.trigger(n,r),s=e.isArray(r)?[n].concat(r):[n,r],!(e.isFunction(i)&&i.apply(this.element[0],s)===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{version:"1.9m6",options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which==1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.browser.msie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.9m6",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);if(!this.element[0]||!this.element[0].parentNode)return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var r=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return this.options.iframeFix===!0&&e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];if(!r)return;var i=n.offset(),s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r),left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,a=t.top,f=t.left;return e.ui.isOver(i+n,s+r,a,f,o,u)};e.each(r.sortables,function(s){this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function(t,n){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;r.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if(i.snapMode!="outer"){var v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=v||m||g||y||b}}}),e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e,t){e.widget("ui.droppable",{version:"1.9m6",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];for(var n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return!1;var i=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,n,r){if(!n.offset)return!1;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,d=e.ui.isOver(p,h,l,a,n.proportions.height,n.proportions.width);return d;case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var o=0;o<r.length;o++){if(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))continue;for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible=r[o].element.css("display")!="none";if(!r[o].visible)continue;i=="mousedown"&&r[o]._activate.call(r[o],n),r[o].offset=
r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight}}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=r||this._drop.call(this,n)),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r=e.ui.intersect(t,this,this.options.tolerance),i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null;if(!i)return;var s;if(this.options.greedy){var o=this.element.parents(":data(droppable):eq(0)");o.length&&(s=e.data(o[0],"droppable"),s.greedyChild=i=="isover"?1:0)}s&&i=="isover"&&(s.isover=0,s.isout=1,s._out.call(s,n)),this[i]=1,this[i=="isout"?"isover":"isout"]=0,this[i=="isover"?"_over":"_out"].call(this,n),s&&i=="isout"&&(s.isout=0,s.isover=1,s._over.call(s,n))})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e,t){e.widget("ui.resizable",e.ui.mouse,{version:"1.9m6",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,n=this.options;this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&e.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=n.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var r=this.handles.split(",");this.handles={};for(var i=0;i<r.length;i++){var s=e.trim(r[i]),o="ui-resizable-"+s,u=e('<div class="ui-resizable-handle '+o+'"></div>');/sw|se|ne|nw/.test(s)&&u.css({zIndex:++n.zIndex}),"se"==s&&u.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(u)}}this._renderAxis=function(t){t=t||this.element;for(var n in this.handles){this.handles[n].constructor==String&&(this.handles[n]=e(this.handles[n],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var r=e(this.handles[n],this.element),i=0;i=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth();var s=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join("");t.css(s,i),this._proportionallyResize()}if(!e(this.handles[n]).length)continue}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),n.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").hover(function(){if(n.disabled)return;e(this).removeClass("ui-resizable-autohide"),t._handles.show()},function(){if(n.disabled)return;t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var n=this.element;n.after(this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")})).remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var n=!1;for(var r in this.handles)e(this.handles[r])[0]==t.target&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var r=this.options,i=this.element.position(),s=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(s.is(".ui-draggable")||/absolute/.test(s.css("position")))&&s.css({position:"absolute",top:i.top,left:i.left}),e.browser.opera&&/relative/.test(s.css("position"))&&s.css({position:"relative",top:"auto",left:"auto"}),this._renderProxy();var o=n(this.helper.css("left")),u=n(this.helper.css("top"));r.containment&&(o+=e(r.containment).scrollLeft()||0,u+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:o,top:u},this.size=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalPosition={left:o,top:u},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1;var a=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor",a=="auto"?this.axis+"-resize":a),s.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n=this.helper,r=this.options,i={},s=this,o=this.originalMousePosition,u=this.axis,a=t.pageX-o.left||0,f=t.pageY-o.top||0,l=this._change[u];if(!l)return!1;var c=l.apply(this,[t,a,f]),h=e.browser.msie&&e.browser.version<7,p=this.sizeDiff;this._updateVirtualBoundaries(t.shiftKey);if(this._aspectRatio||t.shiftKey)c=this._updateRatio(c,t);return c=this._respectSize(c,t),this._propagate("resize",t),n.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(c),this._trigger("resize",t,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var n=this.options,r=this;if(this._helper){var i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:r.sizeDiff.height,u=s?0:r.sizeDiff.width,a={width:r.helper.width()-u,height:r.helper.height()-o},f=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,l=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;n.animate||this.element.css(e.extend(a,{top:l,left:f})),r.helper.height(r.size.height),r.helper.width(r.size.width),this._helper&&!n.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t=this.options,n,i,s,o,u;u={minWidth:r(t.minWidth)?t.minWidth:0,maxWidth:r(t.maxWidth)?t.maxWidth:Infinity,minHeight:r(t.minHeight)?t.minHeight:0,maxHeight:r(t.maxHeight)?t.maxHeight:Infinity};if(this._aspectRatio||e)n=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,i=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,n>u.minWidth&&(u.minWidth=n),s>u.minHeight&&(u.minHeight=s),i<u.maxWidth&&(u.maxWidth=i),o<u.maxHeight&&(u.maxHeight=o);this._vBoundaries=u},_updateCache:function(e){var t=this.options;this.offset=this.helper.offset(),r(e.left)&&(this.position.left=e.left),r(e.top)&&(this.position.top=e.top),r(e.height)&&(this.size.height=e.height),r(e.width)&&(this.size.width=e.width)},_updateRatio:function(e,t){var n=this.options,i=this.position,s=this.size,o=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),o=="sw"&&(e.left=i.left+(s.width-e.width),e.top=null),o=="nw"&&(e.top=i.top+(s.height-e.height),e.left=i.left+(s.width-e.width)),e},_respectSize:function(e,t){var n=this.helper,i=this._vBoundaries,s=this._aspectRatio||t.shiftKey,o=this.axis,u=r(e.width)&&i.maxWidth&&i.maxWidth<e.width,a=r(e.height)&&i.maxHeight&&i.maxHeight<e.height,f=r(e.width)&&i.minWidth&&i.minWidth>e.width,l=r(e.height)&&i.minHeight&&i.minHeight>e.height;f&&(e.width=i.minWidth),l&&(e.height=i.minHeight),u&&(e.width=i.maxWidth),a&&(e.height=i.maxHeight);var c=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,p=/sw|nw|w/.test(o),d=/nw|ne|n/.test(o);f&&p&&(e.left=c-i.minWidth),u&&p&&(e.left=c-i.maxWidth),l&&d&&(e.top=h-i.minHeight),a&&d&&(e.top=h-i.maxHeight);var v=!e.width&&!e.height;return v&&!e.left&&e.top?e.top=null:v&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){var t=this.options;if(!this._proportionallyResizeElements.length)return;var n=this.helper||this.element;for(var r=0;r<this._proportionallyResizeElements.length;r++){var i=this._proportionallyResizeElements[r];if(!this.borderDif){var s=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],o=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];this.borderDif=e.map(s,function(e,t){var n=parseInt(e,10)||0,r=parseInt(o[t],10)||0;return n+r})}if(!(!e.browser.msie||!e(n).is(":hidden")&&!e(n).parents(":hidden").length))continue;i.css({height:n.height()-this.borderDif[0]-this.borderDif[2]||0,width:n.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var r=e.browser.msie&&e.browser.version<7,i=r?1:0,s=r?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+s,height:this.element.outerHeight()+s,position:"absolute",left:this.elementOffset.left-i+"px",top:this.elementOffset.top-i+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t,n){return{width:this.originalSize.width+t}},w:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{top:s.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),t!="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","alsoResize",{start:function(t,n){var r=e(this).data("resizable"),i=r.options,s=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10),position:t.css("position")})})};typeof i.alsoResize=="object"&&!i.alsoResize.parentNode?i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)}):s(i.alsoResize)},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,i){e(t).each(function(){var t=e(this),s=e(this).data("resizable-alsoresize"),o={},a=i&&i.length?i:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var n=(s[t]||0)+(u[t]||0);n&&n>=0&&(o[t]=n||null)}),e.browser.opera&&/relative/.test(t.css("position"))&&(r._revertToRelativePosition=!0,t.css({position:"absolute",top:"auto",left:"auto"})),t.css(o)})};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e,t){a(e,t)}):a(i.alsoResize)},stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=function(t){e(t).each(function(){var t=e(this);t.css({position:t.data("resizable-alsoresize").position})})};r._revertToRelativePosition&&(r._revertToRelativePosition=!1,typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e){s(e)}):s(i.alsoResize)),e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r._proportionallyResizeElements,o=s.length&&/textarea/i.test(s[0].nodeName),u=o&&e.ui.hasScroll(s[0],"left")?0:r.sizeDiff.height,a=o?0:r.sizeDiff.width,f={width:r.size.width-a,height:r.size.height-u},l=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,c=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;r.element.animate(e.extend(f,c&&l?{top:c,left:l}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var n={width:parseInt(r.element.css("width"),10),height:parseInt(r.element.css("height"),10),top:parseInt(r.element.css("top"),10),left:parseInt(r.element.css("left"),10)};s&&s.length&&e(s[0]).css({width:n.width,height:n.height}),r._updateCache(n),r._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(t,r){var i=e(this).data("resizable"),s=i.options,o=i.element,u=s.containment,a=u instanceof e?u.get(0):/parent/.test(u)?o.parent().get(0):u;if(!a)return;i.containerElement=e(a);if(/document/.test(u)||u==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var f=e(a),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,t){l[e]=n(f.css("padding"+t))}),i.containerOffset=f.offset(),i.containerPosition=f.position(),i.containerSize={height:f.innerHeight()-l[3],width:f.innerWidth()-l[1]};var c=i.containerOffset,h=i.containerSize.height,p=i.containerSize.width,d=e.ui.hasScroll(a,"left")?a.scrollWidth:p,v=e.ui.hasScroll(a)?a.scrollHeight:h;i.parentData={element:a,left:c.left,top:c.top,width:d,height:v}}},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.containerSize,o=r.containerOffset,u=r.size,a=r.position,f=r._aspectRatio||t.shiftKey,l={top:0,left:0},c=r.containerElement;c[0]!=document&&/static/.test(c.css("position"))&&(l=o),a.left<(r._helper?o.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-o.left:r.position.left-l.left),f&&(r.size.height=r.size.width/i.aspectRatio),r.position.left=i.helper?o.left:0),a.top<(r._helper?o.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-o.top:r.position.top),f&&(r.size.width=r.size.height*i.aspectRatio),r.position.top=r._helper?o.top:0),r.offset.left=r.parentData.left+r.position.left,r.offset.top=r.parentData.top+r.position.top;var h=Math.abs((r._helper?r.offset.left-l.left:r.offset.left-l.left)+r.sizeDiff.width),p=Math.abs((r._helper?r.offset.top-l.top:r.offset.top-o.top)+r.sizeDiff.height),d=r.containerElement.get(0)==r.element.parent().get(0),v=/relative|absolute/.test(r.containerElement.css("position"));d&&v&&(h-=r.parentData.left),h+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-h,f&&(r.size.height=r.size.width/r.aspectRatio)),p+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-p,f&&(r.size.width=r.size.height*r.aspectRatio))},stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.position,o=r.containerOffset,u=r.containerPosition,a=r.containerElement,f=e(r.helper),l=f.offset(),c=f.outerWidth()-r.sizeDiff.width,h=f.outerHeight()-r.sizeDiff.height;r._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h}),r._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h})}}),e.ui.plugin.add("resizable","ghost",{start:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size;r.ghost=r.originalElement.clone(),r.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof i.ghost=="string"?i.ghost:""),r.ghost.appendTo(r.helper)},resize:function(t,n){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.ghost.css({position:"relative",height:r.size.height,width:r.size.width})},stop:function(t,n){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.helper&&r.helper.get(0).removeChild(r.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size,o=r.originalSize,u=r.originalPosition,a=r.axis,f=i._aspectRatio||t.shiftKey;i.grid=typeof i.grid=="number"?[i.grid,i.grid]:i.grid;var l=Math.round((s.width-o.width)/(i.grid[0]||1))*(i.grid[0]||1),c=Math.round((s.height-o.height)/(i.grid[1]||1))*(i.grid[1]||1);/^(se|s|e)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c):/^(ne)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c):/^(sw)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.left=u.left-l):(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c,r.position.left=u.left-l)}});var n=function(e){return parseInt(e,10)||0},r=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.9m6",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var n;this.refresh=function(){n=e(t.options.filter,t.element[0]),n.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(t){var n=this;this.opos=[t.pageX,t.pageY];if(this.options.disabled)return;var r=this.options;this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,t.metaKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item");if(r){var i=!t.metaKey||!r.$element.hasClass("ui-selected");return r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),r.unselecting=!i,r.selecting=i,r.selected=i,i?n._trigger("selecting",t,{selecting:r.element}):n._trigger("unselecting",t,{unselecting:r.element}),!1}})},_mouseDrag:function(t){var n=this;this.dragged=!0;if(this.options.disabled)return;var r=this.options,i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;if(i>o){var a=o;o=i,i=a}if(s>u){var a=u;u=s,s=a}return this.helper.css({left:i,top:s,width:o-i,height:u-s}),this.selectees.each(function(){var a=e.data(this,"selectable-item");if(!a||a.element==n.element[0])return;var f=!1;r.tolerance=="touch"?f=!(a.left>o||a.right<i||a.top>u||a.bottom<s):r.tolerance=="fit"&&(f=a.left>i&&a.right<o&&a.top>s&&a.bottom<u),f?(a.selected&&(a.$element.removeClass("ui-selected"),a.selected=!1),a.unselecting&&(a.$element.removeClass("ui-unselecting"),a.unselecting=!1),a.selecting||(a.$element.addClass("ui-selecting"),a.selecting=!0,n._trigger("selecting",t,{selecting:a.element}))):(a.selecting&&(t.metaKey&&a.startselected?(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.$element.addClass("ui-selected"),a.selected=!0):(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.startselected&&(a.$element.addClass("ui-unselecting"),a.unselecting=!0),n._trigger("unselecting",t,{unselecting:a.element}))),a.selected&&!t.metaKey&&!a.startselected&&(a.$element.removeClass("ui-selected"),a.selected=!1,a.$element.addClass("ui-unselecting"),a.unselecting=!0,n._trigger("unselecting",t,{unselecting:a.element})))}),!1},_mouseStop:function(t){var n=this;this.dragged=!1;var r=this.options;return e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,n._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,n._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e,t){e.widget("ui.sortable",e.ui.mouse,{version:"1.9m6",widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData("sortable-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(t);var r=null,i=this,s=e(t.target).parents().each(function(){if(e.data(this,"sortable-item")==i)return r=e(this),!1});e.data(t.target,"sortable-item")==i&&(r=e(t.target));if(!r)return!1;if(this.options.handle&&!n){var o=!1;e(this.options.handle,r).find("*").andSelf().each(function(){this==t.target&&(o=!0)});if(!o)return!1}return this.currentItem=r,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){var i=this.options,s=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(var o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",t,s._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var n=this.options,r=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var i=this.items.length-1;i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(!u)continue;if(o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):!0)){this.direction=u==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(!t)return;e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this,i=r.placeholder.offset();r.reverting=!0,e(this.helper).animate({left:i.left-this.offset.parent.left-r.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-r.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1},cancel:function(){var t=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("deactivate",null,t._uiHash(this)),this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",null,t._uiHash(this)),this.containers[n].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1):!1},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s=="right"&&r||s=="left"&&!r:i&&(i=="down"&&n||i=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.
lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=this,r=[],i=[],s=this._connectWith();if(s&&t)for(var o=s.length-1;o>=0;o--){var u=e(s[o]);for(var a=u.length-1;a>=0;a--){var f=e.data(u[a],"sortable");f&&f!=this&&!f.options.disabled&&i.push([e.isFunction(f.options.items)?f.options.items.call(f.element):e(f.options.items,f.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),f])}}i.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var o=i.length-1;o>=0;o--)i[o][0].each(function(){r.push(this)});return e(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data(sortable-item)");for(var t=0;t<this.items.length;t++)for(var n=0;n<e.length;n++)e[n]==this.items[t].item[0]&&this.items.splice(t,1)},_refreshItems:function(t){this.items=[],this.containers=[this];var n=this.items,r=this,i=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],s=this._connectWith();if(s)for(var o=s.length-1;o>=0;o--){var u=e(s[o]);for(var a=u.length-1;a>=0;a--){var f=e.data(u[a],"sortable");f&&f!=this&&!f.options.disabled&&(i.push([e.isFunction(f.options.items)?f.options.items.call(f.element[0],t,{item:this.currentItem}):e(f.options.items,f.element),f]),this.containers.push(f))}}for(var o=i.length-1;o>=0;o--){var l=i[o][1],c=i[o][0];for(var a=0,h=c.length;a<h;a++){var p=e(c[a]);p.data("sortable-item",l),n.push({item:p,instance:l,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])continue;var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;t||(r.width=i.outerWidth(),r.height=i.outerHeight());var s=i.offset();r.left=s.left,r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var n=this.containers.length-1;n>=0;n--){var s=this.containers[n].element.offset();this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}return this},_createPlaceholder:function(t){var n=t||this,r=n.options;if(!r.placeholder||r.placeholder.constructor==String){var i=r.placeholder;r.placeholder={element:function(){var t=e(document.createElement(n.currentItem[0].nodeName)).addClass(i||n.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return i||(t.style.visibility="hidden"),t},update:function(e,t){if(i&&!r.forcePlaceholderSize)return;t.height()||t.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10))}}}n.placeholder=e(r.placeholder.element.call(n.element,n.currentItem)),n.currentItem.after(n.placeholder),r.placeholder.update(n,n.placeholder)},_contactContainers:function(t){var n=null,r=null;for(var i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0]))continue;if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0]))continue;n=this.containers[i],r=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(!n)return;if(this.containers.length===1)this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;else if(this.currentContainer!=this.containers[r]){var s=1e4,o=null,u=this.positionAbs[this.containers[r].floating?"left":"top"];for(var a=this.items.length-1;a>=0;a--){if(!e.contains(this.containers[r].element[0],this.items[a].item[0]))continue;var f=this.items[a][this.containers[r].floating?"left":"top"];Math.abs(f-u)<s&&(s=Math.abs(f-u),o=this.items[a])}if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[r],o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[r].element,!0),this._trigger("change",t,this._uiHash()),this.containers[r]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(r[0].style.width==""||n.forceHelperSize)&&r.width(this.currentItem.width()),(r[0].style.height==""||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0],r=e(t.containment).offset(),i=e(n).css("overflow")!="hidden";this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(e.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r),left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(e.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var s=t.pageX,o=t.pageY;if(this.originalPosition){this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top));if(n.grid){var u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3]?u-this.offset.click.top<this.containment[1]?u+n.grid[1]:u-n.grid[1]:u:u;var a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this,s=this.counter;window.setTimeout(function(){s==i.counter&&i.refreshPositions(!r)},0)},_clear:function(t,n){this.reverting=!1;var r=[],i=this;!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var s in this._storedCSS)if(this._storedCSS[s]=="auto"||this._storedCSS[s]=="static")this._storedCSS[s]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash())});if(!e.contains(this.element[0],this.currentItem[0])){n||r.push(function(e){this._trigger("remove",e,this._uiHash())});for(var s=this.containers.length-1;s>=0;s--)e.contains(this.containers[s].element[0],this.currentItem[0])&&!n&&(r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.containers[s])),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.containers[s])))}for(var s=this.containers.length-1;s>=0;s--)n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over=0);this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(var s=0;s<r.length;s++)r[s].call(this,t);this._trigger("stop",t,this._uiHash())}return!1}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!n){for(var s=0;s<r.length;s++)r[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),jQuery.effects||function(e,t){function r(t){var n;return t&&t.constructor===Array&&t.length===3?t:(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))?[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]:(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[parseFloat(n[1])*2.55,parseFloat(n[2])*2.55,parseFloat(n[3])*2.55]:(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:(n=/rgba\(0, 0, 0, 0\)/.exec(t))?s.transparent:s[e.trim(t).toLowerCase()]}function i(t,n){var i;do{i=e.curCSS(t,n);if(i!=""&&i!=="transparent"||e.nodeName(t,"body"))break;n="backgroundColor"}while(t=t.parentNode);return r(i)}function f(){var t=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,n={},r,i,s;if(t&&t.length&&t[0]&&t[t[0]]){s=t.length;while(s--)r=t[s],typeof t[r]=="string"&&(n[e.camelCase(r)]=t[r])}else for(r in t)typeof t[r]=="string"&&(n[r]=t[r]);return n}function l(t,n){var r={},i,s;for(i in n)s=n[i],t[i]!=s&&!u[i]&&(e.fx.step[i]||!isNaN(parseFloat(s)))&&(r[i]=s);return r}function c(n,r,i,s){if(e.isPlainObject(n))return n;n={effect:n},r===t&&(r={}),e.isFunction(r)&&(s=r,i=null,r={});if(e.type(r)==="number"||e.fx.speeds[r])s=i,i=r,r={};return e.isFunction(i)&&(s=i,i=null),r&&e.extend(n,r),i=i||r.duration,n.duration=e.fx.off?0:typeof i=="number"?i:i in e.fx.speeds?e.fx.speeds[i]:e.fx.speeds._default,n.complete=s||r.complete,n}function h(t){return!t||typeof t=="number"||e.fx.speeds[t]?!0:typeof t=="string"&&!e.effects.effect[t]?n&&e.effects[t]?!1:!0:!1}var n=e.uiBackCompat!==!1;e.effects={effect:{}},e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(t,n){e.fx.step[n]=function(e){e.colorInit||(e.start=i(e.elem,n),e.end=r(e.end),e.colorInit=!0),e.elem.style[n]="rgb("+Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2],10),255),0)+")"}});var s={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},o=["add","remove","toggle"],u={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1},a="ec.storage.";e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){if(e.end!=="none"&&!e.setAttr||e.pos===1&&!e.setAttr)jQuery.style(e.elem,n,e.end),e.setAttr=!0}}),e.effects.animateClass=function(t,n,r,i){var s=e.speed(n,r,i);return this.queue(function(){var n=e(this),r=n.attr("class"),i,u=s.children?n.find("*").andSelf():n;u=u.map(function(){var t=e(this);return{el:t,originalStyleAttr:t.attr("style")||" ",start:f.call(this)}}),e.each(o,function(e,r){t[r]&&n[r+"Class"](t[r])}),i=n.attr("class"),u=u.map(function(){return this.end=f.call(this.el[0]),this.diff=l(this.start,this.end),this}),n.attr("class",r),u=u.map(function(){var t=this,n=e.Deferred();return this.el.animate(this.diff,{duration:s.duration,easing:s.easing,queue:!1,complete:function(){n.resolve(t)}}),n.promise()}),e.when.apply(e,u.get()).done(function(){n.attr("class",i),e.each(arguments,function(){typeof this.el.attr("style")=="object"?(this.el.attr("style").cssText="",this.el.attr("style").cssText=this.originalStyleAttr):this.el.attr("style",this.originalStyleAttr)}),s.complete.call(n[0])})})},e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{add:t},n,r,i]):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{remove:t},n,r,i]):this._removeClass(t)},_toggleClass:e.fn.toggleClass,toggleClass:function(n,r,i,s,o){return typeof r=="boolean"||r===t?i?e.effects.animateClass.apply(this,[r?{add:n}:{remove:n},i,s,o]):this._toggleClass(n,r):e.effects.animateClass.apply(this,[{toggle:n},r,i,s])},switchClass:function(t,n,r,i,s){return e.effects.animateClass.apply(this,[{add:n,remove:t},r,i,s])}}),e.extend(e.effects,{version:"1.9m6",save:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.data(a+t[n],e[0].style[t[n]])},restore:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.css(t[n],e.data(a+t[n]))},setMode:function(e,t){return t==="toggle"&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:t.width(),height:t.height()},s=document.activeElement;return t.wrap(r),(t[0]===s||e.contains(t[0],s))&&e(s).focus(),r=t.parent(),t.css("position")==="static"?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(i),r.css(n).show()},removeWrapper:function(t){var n=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){var s=t.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1])}),i}}),e.fn.extend({effect:function(t,r,i,s){function h(t){function s(){e.isFunction(r)&&r.call(n[0]),e.isFunction(t)&&t()}var n=e(this),r=o.complete,i=o.mode;(n.is(":hidden")?i==="hide":i==="show")?s():f.call(n[0],o,s)}var o=c.apply(this,arguments),u=o.mode,a=o.queue,f=e.effects.effect[o.effect],l=!f&&n&&e.effects[o.effect];return e.fx.off||!f&&!l?u?this[u](o.duration,o.complete):this.each(function(){o.complete&&o.complete.call(this)}):f?a===!1?this.each(h):this.queue(a||"fx",h):l.call(this,{options:o,duration:o.duration,callback:o.complete,mode:o.mode})},_show:e.fn.show,show:function(e){if(h(e))return this._show.apply(this,arguments);var t=c.apply(this,arguments);return t.mode="show",this.effect.call(this,t)},_hide:e.fn.hide,hide:function(e){if(h(e))return this._hide.apply(this,arguments);var t=c.apply(this,arguments);return t.mode="hide",this.effect.call(this,t)},__toggle:e.fn.toggle,toggle:function(t){if(h(t)||typeof t=="boolean"||e.isFunction(t))return this.__toggle.apply(this,arguments);var n=c.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)},cssUnit:function(t){var n=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}}),e.easing.jswing=e.easing.swing,e.extend(e.easing,{def:"easeOutQuad",swing:function(t,n,r,i,s){return e.easing[e.easing.def](t,n,r,i,s)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=i*.3,u=r;return t==0?n:(t/=i)==1?n+r:(u<Math.abs(r)?(u=r,s=o/4):s=o/(2*Math.PI)*Math.asin(r/u),-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n)},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=i*.3,u=r;return t==0?n:(t/=i)==1?n+r:(u<Math.abs(r)?(u=r,s=o/4):s=o/(2*Math.PI)*Math.asin(r/u),u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n)},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=i*.3*1.5,u=r;return t==0?n:(t/=i/2)==2?n+r:(u<Math.abs(r)?(u=r,s=o/4):s=o/(2*Math.PI)*Math.asin(r/u),t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n)},easeInBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),i*(n/=s)*n*((o+1)*n-o)+r},easeOutBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),i*((n=n/s-1)*n*((o+1)*n+o)+1)+r},easeInOutBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),(n/=s/2)<1?i/2*n*n*(((o*=1.525)+1)*n-o)+r:i/2*((n-=2)*n*(((o*=1.525)+1)*n+o)+2)+r},easeInBounce:function(t,n,r,i,s){return i-e.easing.easeOutBounce(t,s-n,0,i,s)+r},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(t,n,r,i,s){return n<s/2?e.easing.easeInBounce(t,n*2,0,i,s)*.5+r:e.easing.easeOutBounce(t,n*2-s,0,i,s)*.5+i*.5+r}})}(jQuery),function(e,t){var n=/up|down|vertical/,r=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,i){var s=e(this),o=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(s,t.mode||"hide"),a=t.direction||"up",f=n.test(a),l=f?"height":"width",c=f?"top":"left",h=r.test(a),p={},d=u==="show",v,m;s.parent().is(".ui-effects-wrapper")?e.effects.save(s.parent(),o):e.effects.save(s,o),s.show(),v=e.effects.createWrapper(s).css({overflow:"hidden"}),m=v[l](),p[l]=d?m:0,h||(s.css(f?"bottom":"right",0).css(f?"top":"left","").css({position:"absolute"}),p[c]=d?0:m),d&&(v.css(l,0),h||v.css(c,m)),v.animate(p,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){u==="hide"&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e,t){e.effects.effect.bounce=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=s==="hide",u=s==="show",a=t.direction||"up",f=t.distance,l=t.times||5,c=l*2+(u||o?1:0),h=t.duration/c,p=t.easing,d=a==="up"||a==="down"?"top":"left",v=a==="up"||a==="left",m,g,y,b=r.queue(),w=b.length;(u||o)&&i.push("opacity"),e.effects.save(r,i),r.show(),e.effects.createWrapper(r),f||(f=r[d==="top"?"outerHeight":"outerWidth"]()/3),u&&(y={opacity:1},y[d]=0,r.css("opacity",0).css(d,v?-f*2:f*2).animate(y,h,p)),o&&(f/=Math.pow(2,l-1)),y={},y[d]=0;for(m=0;m<l;m++)g={},g[d]=(v?"-=":"+=")+f,r.animate(g,h,p).animate(y,h,p),f=o?f*2:f/2;o&&(g={opacity:0},g[d]=(v?"-=":"+=")+f,r.animate(g,h,p)),r.queue(function(){o&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}),w>1&&b.splice.apply(b,[1,0].concat(b.splice(w,c+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.clip=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"vertical",a=u==="vertical",f=a?"height":"width",l=a?"top":"left",c={},h,p,d;e.effects.save(r,i),r.show(),h=e.effects.createWrapper(r).css({overflow:"hidden"}),p=r[0].tagName==="IMG"?h:r,d=p[f](),o&&(p.css(f,0),p.css(l,d/2)),c[f]=o?d:0,c[l]=o?0:d/2,p.animate(c,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){o||r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}})}}(jQuery),function(e,t){e.effects.effect.drop=function(t,n){var r=e(this),i=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"left",a=u==="up"||u==="down"?"top":"left",f=u==="up"||u==="left"?"pos":"neg",l={opacity:o?1:0},c;e.effects.save(r,i),r.show(),e.effects.createWrapper(r),c=t.distance||r[a=="top"?"outerHeight":"outerWidth"]({margin:!0})/2,o&&r.css("opacity",0).css(a,f=="pos"?-c:c),l[a]=(o?f==="pos"?"+=":"-=":f==="pos"?"-=":"+=")+c,r.animate(l,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s=="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}})}}(jQuery),function(e,t){e.effects.effect.explode=function(t,n){function y(){c.push(this),c.length==r*i&&b()}function b(){s.css({visibility:"visible"}),e(c).remove(),u||s.hide(),n()}var r=t.pieces?Math.round(Math.sqrt(t.pieces)):3,i=r,s=e(this),o=e.effects.setMode(s,t.mode||"hide"),u=o==="show",a=s.show().css("visibility","hidden").offset(),f=Math.ceil(s.outerWidth()/i),l=Math.ceil(s.outerHeight()/r),c=[],h,p,d,v,m,g;for(h=0;h<r;h++){v=a.top+h*l,g=h-(r-1)/2;for(p=0;p<i;p++)d=a.left+p*f,m=p-(i-1)/2,s.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-p*f,top:-h*l}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:f,height:l,left:d+(u?m*f:0),top:v+(u?g*l:0),opacity:u?0:1}).animate({left:d+(u?0:m*f),top:v+(u?0:g*l),opacity:u?1:0},t.duration||500,t.easing,y)}}}(jQuery),function(e,t){e.effects.effect.fade=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"toggle"),s=i==="hide";r.show(),r.animate({opacity:s?0:1},{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s&&r.hide(),n()}})}}(jQuery),function(e,t){e.effects.effect.fold=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=s==="hide",a=t.size||15,f=/([0-9]+)%/.exec(a),l=!!t.horizFirst,c=o!=l,h=c?["width","height"]:["height","width"],p=t.duration/2,d,v,m={},g={};e.effects.save(r,i),r.show(),d=e.effects.createWrapper(r).css({overflow:"hidden"}),v=c?[d.width(),d.height()]:[d.height(),d.width()],f&&(a=parseInt(f[1],10)/100*v[u?0:1]),o&&d.css(l?{height:0,width:a}:{height:a,width:0}),m[h[0]]=o?v[0]:a,g[h[1]]=o?v[1]:0,d.animate(m,p,t.easing).animate(g,p,t.easing,function(){u&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()})}}(jQuery),function(e,t){e.effects.effect.highlight=function(t,n){var r=e(this),i=["backgroundImage","backgroundColor","opacity"],s=e.effects.setMode(r,t.mode||"show"),o={backgroundColor:r.css("backgroundColor")};s==="hide"&&(o.opacity=0),e.effects.save(r,i),r.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),n()}})}}(jQuery),function(e,t){e.effects.effect.pulsate=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"show"),s=i==="show",o=i==="hide",u=s||i==="hide",a=(t.times||5)*2+(u?1:0),f=t.duration/a,l=0,c=r.queue(),h=c.length,p;if(s||!r.is(":visible"))r.css("opacity",0).show(),l=1;for(p=1;p<a;p++)r.animate({opacity:l},f,t.easing),l=1-l;r.animate({opacity:l},f,t.easing),r.queue(function(){o&&r.hide(),n()}),h>1&&c.splice.apply(c,[1,0].concat(c.splice(h,a+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.puff=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"hide"),s=i==="hide",o=parseInt(t.percent,10)||150,u=o/100,a={height:r.height(),width:r.width()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:i,complete:n,percent:s?o:100,from:s?a:{height:a.height*u,width:a.width*u}}),r.effect(t)},e.effects.effect.scale=function(t,n){var r=e(this),i=e.extend(!0,{},t),s=e.effects.setMode(r,t.mode||"effect"),o=parseInt(t.percent,10)||(parseInt(t.percent,10)==0?0:s=="hide"?0:100),u=t.direction||"both",a=t.origin,f={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},l={y:u!="horizontal"?o/100:1,x:u!="vertical"?o/100:1};i.effect="size",i.queue=!1,i.complete=n,s!="effect"&&(i.origin=a||["middle","center"],i.restore=!0),i.from=t.from||(s=="show"?{height:0,width:0}:f),i.to={height:f.height*l.y,width:f.width*l.x,outerHeight:f.outerHeight*l.y,outerWidth:f.outerWidth*l.x},i.fade&&(s=="show"&&(i.from.opacity=0,i.to.opacity=1),s=="hide"&&(i.from.opacity=1,i.to.opacity=0)),r.effect(i)},e.effects.effect.size=function(t,n){var r=e(this),i=["position","top","bottom","left","right","width","height","overflow","opacity"],s=["position","top","bottom","left","right","overflow","opacity"],o=["width","height","overflow"],u=["fontSize"],a=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],f=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],l=e.effects.setMode(r,t.mode||"effect"),c=t.restore||l!=="effect",h=t.scale||"both",p=t.origin||["middle","center"],d,v,m,g=r.css("position"),y=r.css("bottom")!=="auto"?"bottom":"top";originalHorizontalPositioning=r.css("right")!=="auto"?"right":"left",l==="show"&&r.show(),d={height:r.height(),width:r.width(),outerHeight:r.outerHeight()
,outerWidth:r.outerWidth()},r.from=t.from||d,r.to=t.to||d,m={from:{y:r.from.height/d.height,x:r.from.width/d.width},to:{y:r.to.height/d.height,x:r.to.width/d.width}};if(h=="box"||h=="both")m.from.y!==m.to.y&&(i=i.concat(a),r.from=e.effects.setTransition(r,a,m.from.y,r.from),r.to=e.effects.setTransition(r,a,m.to.y,r.to)),m.from.x!==m.to.x&&(i=i.concat(f),r.from=e.effects.setTransition(r,f,m.from.x,r.from),r.to=e.effects.setTransition(r,f,m.to.x,r.to));(h=="content"||h=="both")&&m.from.y!==m.to.y&&(i=i.concat(u),r.from=e.effects.setTransition(r,u,m.from.y,r.from),r.to=e.effects.setTransition(r,u,m.to.y,r.to)),e.effects.save(r,c?i:s),r.show(),e.effects.createWrapper(r),r.css("overflow","hidden").css(r.from),p&&(v=e.effects.getBaseline(p,d),r.from.top=(d.outerHeight-r.outerHeight())*v.y,r.from.left=(d.outerWidth-r.outerWidth())*v.x,r.to.top=(d.outerHeight-r.to.outerHeight)*v.y,r.to.left=(d.outerWidth-r.to.outerWidth)*v.x),r.css(r.from);if(h=="content"||h=="both")a=a.concat(["marginTop","marginBottom"]).concat(u),f=f.concat(["marginLeft","marginRight"]),o=i.concat(a).concat(f),r.find("*[width]").each(function(){var n=e(this),r={height:n.height(),width:n.width()};c&&e.effects.save(n,o),n.from={height:r.height*m.from.y,width:r.width*m.from.x},n.to={height:r.height*m.to.y,width:r.width*m.to.x},m.from.y!=m.to.y&&(n.from=e.effects.setTransition(n,a,m.from.y,n.from),n.to=e.effects.setTransition(n,a,m.to.y,n.to)),m.from.x!=m.to.x&&(n.from=e.effects.setTransition(n,f,m.from.x,n.from),n.to=e.effects.setTransition(n,f,m.to.x,n.to)),n.css(n.from),n.animate(n.to,t.duration,t.easing,function(){c&&e.effects.restore(n,o)})});r.animate(r.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){r.to.opacity===0&&r.css("opacity",r.from.opacity),l=="hide"&&r.hide(),e.effects.restore(r,c?i:s),c||(g==="static"?r.css({position:"relative",top:r.to.top,left:r.to.left}):e.each([y,originalHorizontalPositioning],function(e,t){r.css(t,function(n,i){var s=parseInt(i,10),o=e?r.to.left:r.to.top,u=e?r.to.outerWidth-r.from.outerWidth:r.to.outerHeight-r.from.outerHeight,a=p[e]===t,f=p[e]==="middle"||p[e]==="center",l=t=="left"||t=="top";return i==="auto"?o+"px":(l||(g==="relative"?o*=-1:f||(o-=u*(a?-1:1))),s+o+"px")})})),e.effects.removeWrapper(r),n()}})}}(jQuery),function(e,t){e.effects.effect.shake=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=t.direction||"left",u=t.distance||20,a=t.times||3,f=a*2+1,l=t.duration,c=o=="up"||o=="down"?"top":"left",h=o=="up"||o=="left",p={},d={},v={},m,g=r.queue(),y=g.length;e.effects.save(r,i),r.show(),e.effects.createWrapper(r),p[c]=(h?"-=":"+=")+u,d[c]=(h?"+=":"-=")+u*2,v[c]=(h?"-=":"+=")+u*2,r.animate(p,l,t.easing);for(m=1;m<a;m++)r.animate(d,l,t.easing).animate(v,l,t.easing);r.animate(d,l,t.easing).animate(p,l/2,t.easing).queue(function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}),y>1&&g.splice.apply(g,[1,0].concat(g.splice(y,f+1))),r.dequeue()}}(jQuery),function(e,t){e.effects.effect.slide=function(t,n){var r=e(this),i=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(r,t.mode||"show"),o=s==="show",u=t.direction||"left",a=u=="up"||u=="down"?"top":"left",f=u=="up"||u=="left",l,c={},h;e.effects.save(r,i),r.show(),l=t.distance||r[a==="top"?"outerHeight":"outerWidth"]({margin:!0}),e.effects.createWrapper(r).css({overflow:"hidden"}),o&&r.css(a,f?isNaN(l)?"-"+l:-l:l),c[a]=(o?f?"+=":"-=":f?"-=":"+=")+l,r.animate(c,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n()}})}}(jQuery),function(e,t){e.effects.effect.transfer=function(t,n){var r=e(this),i=e(t.to),s=i.css("position")==="fixed",o=e("body"),u=s?o.scrollTop():0,a=s?o.scrollLeft():0,f=i.offset(),l={top:f.top-u,left:f.left-a,height:i.innerHeight(),width:i.innerWidth()},c=r.offset(),h=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(t.className).css({top:c.top-u,left:c.left-a,height:r.innerHeight(),width:r.innerWidth(),position:s?"fixed":"absolute"}).animate(l,t.duration,t.easing,function(){h.remove(),n()})}}(jQuery),function(e,t){var n={};e.widget("ui.accordion",{version:"1.9m6",options:{active:0,animated:"slide",collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this,n=t.options;t.element.addClass("ui-accordion ui-widget ui-helper-reset"),t.headers=t.element.find(n.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),t._hoverable(t.headers),t._focusable(t.headers),t.headers.find(":first-child").addClass("ui-accordion-heading"),t.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom"),!n.collapsible&&n.active===!1&&(n.active=0),n.active<0&&(n.active+=this.headers.length),t.active=t._findActive(n.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top"),t.active.next().addClass("ui-accordion-content-active"),t._createIcons(),t.refresh(),t.element.attr("role","tablist"),t.headers.attr("role","tab").bind("keydown.accordion",e.proxy(t,"_keydown")).next().attr("role","tabpanel"),t.headers.not(t.active).attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide(),t.active.length?t.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):t.headers.eq(0).attr("tabIndex",0),e.browser.safari||t.headers.find("a").attr("tabIndex",-1),this._setupEvents(n.event)},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.element.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.children(".ui-accordion-header-icon").remove(),this.element.removeClass("ui-accordion-icons")},_destroy:function(){this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex").find("a").removeAttr("tabIndex").end().find(".ui-accordion-heading").removeClass("ui-accordion-heading"),this._destroyIcons();var e=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");this.options.heightStyle!=="content"&&e.css("height","")},_setOption:function(e,t){if(e==="active"){this._activate(t);return}e==="event"&&(this.options.event&&this.headers.unbind(this.options.event+".accordion",this._eventHandler),this._setupEvents(t)),this._super("_setOption",e,t),e==="collapsible"&&!t&&this.options.active===!1&&this._activate(0),e==="icons"&&(this._destroyIcons(),t&&this._createIcons()),e==="disabled"&&this.headers.add(this.headers.next()).toggleClass("ui-accordion-disabled ui-state-disabled",!!t)},_keydown:function(t){if(this.options.disabled||t.altKey||t.ctrlKey)return;var n=e.ui.keyCode,r=this.headers.length,i=this.headers.index(t.target),s=!1;switch(t.keyCode){case n.RIGHT:case n.DOWN:s=this.headers[(i+1)%r];break;case n.LEFT:case n.UP:s=this.headers[(i-1+r)%r];break;case n.SPACE:case n.ENTER:this._eventHandler(t)}s&&(e(t.target).attr("tabIndex",-1),e(s).attr("tabIndex",0),s.focus(),t.preventDefault())},refresh:function(){var t=this.options,n=this.element.parent(),r,i;return t.heightStyle==="fill"?(e.support.minHeight||(i=n.css("overflow"),n.css("overflow","hidden")),r=n.height(),this.element.siblings(":visible").each(function(){var t=e(this),n=t.css("position");if(n==="absolute"||n==="fixed")return;r-=t.outerHeight(!0)}),i&&n.css("overflow",i),this.headers.each(function(){r-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,r-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):t.heightStyle==="auto"&&(r=0,this.headers.next().each(function(){r=Math.max(r,e(this).height("").height())}).height(r)),this},_activate:function(t){var n=this._findActive(t)[0];if(n===this.active[0])return;n=n||this.active[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop})},_findActive:function(t){return typeof t=="number"?this.headers.eq(t):e()},_setupEvents:function(t){t&&this.headers.bind(t.split(" ").join(".accordion ")+".accordion",e.proxy(this,"_eventHandler"))},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i[0]===r[0],o=s&&n.collapsible,u=o?e():i.next(),a=r.next(),f={oldHeader:r,oldContent:a,newHeader:o?e():i,newContent:u};t.preventDefault();if(n.disabled||s&&!n.collapsible||this._trigger("beforeActivate",t,f)===!1)return;n.active=o?!1:this.headers.index(i),this.active=s?e():i,this._toggle(f),r.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-accordion-header-icon").removeClass(n.icons.activeHeader).addClass(n.icons.header),s||(i.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-accordion-header-icon").removeClass(n.icons.header).addClass(n.icons.activeHeader),i.next().addClass("ui-accordion-content-active"))},_toggle:function(t){function u(){r._completed(t)}var r=this,i=r.options,s=t.newContent,o=t.oldContent;if(i.animated){var a=e.ui.accordion.animations,f=i.animated,l;a[f]||(l={easing:e.easing[f]?f:"slide",duration:700},f="slide"),a[f]({toShow:s,toHide:o,prevShow:n.toShow,prevHide:n.toHide,complete:u,down:s.length&&(!o.length||s.index()<o.index())},l)}else o.hide(),s.show(),u();o.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur(),s.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(e){var t=e.newContent,n=e.oldContent;this.options.heightStyle==="content"&&t.add(n).css({height:"",overflow:""}),n.removeClass("ui-accordion-content-active"),n.length&&(n.parent()[0].className=n.parent()[0].className),this._trigger("activate",null,e)}}),e.extend(e.ui.accordion,{animations:{slide:function(t,r){if(t.prevShow||t.prevHide)t.prevHide.stop(!0,!0),t.toHide=t.prevShow;var i=t.toShow.css("overflow"),s=t.toHide.css("overflow"),o=0,u={},a={},f=["height","paddingTop","paddingBottom"],l;t=e.extend({easing:"swing",duration:300},t,r),n=t;if(!t.toHide.size()){l=t.toShow[0].style.width,t.toShow.show().width(t.toShow.width()).hide().animate({height:"show",paddingTop:"show",paddingBottom:"show"},{duration:t.duration,easing:t.easing,complete:function(){t.toShow.width(l),t.complete()}});return}if(!t.toShow.size()){t.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},t);return}var c=t.toShow;l=c[0].style.width,c.width(parseInt(c.parent().width(),10)-parseInt(c.css("paddingLeft"),10)-parseInt(c.css("paddingRight"),10)-(parseInt(c.css("borderLeftWidth"),10)||0)-(parseInt(c.css("borderRightWidth"),10)||0)),e.each(f,function(n,r){a[r]="hide";var i=(""+e.css(t.toShow[0],r)).match(/^([\d+-.]+)(.*)$/),s=r==="height"&&i[1]==="0"?1:i[1];u[r]={value:s,unit:i[2]||"px"}}),t.toShow.css({height:0,overflow:"hidden"}).show(),t.toHide.filter(":hidden").each(t.complete).end().filter(":visible").animate(a,{step:function(e,n){if(n.prop=="height"||n.prop=="paddingTop"||n.prop=="paddingBottom")o=n.end-n.start===0?0:(n.now-n.start)/(n.end-n.start);t.toShow[0].style[n.prop]=o*u[n.prop].value+u[n.prop].unit},duration:t.duration,easing:t.easing,complete:function(){t.toShow.css({width:l,overflow:i}),t.toHide.css("overflow",s),t.complete()}})},bounceslide:function(e){this.slide(e,{easing:e.down?"easeOutBounce":"swing",duration:e.down?1e3:200})}}}),e.uiBackCompat!==!1&&(function(e,t){e.extend(t.options,{navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}});var n=t._create;t._create=function(){if(this.options.navigation){var t=this,r=this.element.find(this.options.header),i=r.next(),s=r.add(i).find("a").filter(this.options.navigationFilter)[0];s&&r.add(i).each(function(n){if(e.contains(this,s))return t.options.active=Math.floor(n/2),!1})}n.call(this)}}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options,{heightStyle:null,autoHeight:!0,clearStyle:!1,fillSpace:!1});var n=t._create,r=t._setOption;e.extend(t,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle(),n.call(this)},_setOption:function(e,t){if(e==="autoHeight"||e==="clearStyle"||e==="fillSpace")this.options.heightStyle=this._mergeHeightStyle();r.apply(this,arguments)},_mergeHeightStyle:function(){var e=this.options;if(e.fillSpace)return"fill";if(e.clearStyle)return"content";if(e.autoHeight)return"auto"}})}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});var n=t._createIcons;t._createIcons=function(){this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected,n.call(this)}}(jQuery,jQuery.ui.accordion.prototype),function(e,t){t.activate=t._activate;var n=t._findActive;t._findActive=function(e){return e===-1&&(e=!1),e&&typeof e!="number"&&(e=this.headers.index(this.headers.filter(e)),e===-1&&(e=!1)),n.call(this,e)}}(jQuery,jQuery.ui.accordion.prototype),jQuery.ui.accordion.prototype.resize=jQuery.ui.accordion.prototype.refresh,function(e,t){e.extend(t.options,{change:null,changestart:null});var n=t._trigger;t._trigger=function(e,t,r){var i=n.apply(this,arguments);return i?(e==="beforeActivate"?i=n.call(this,"changestart",t,r):e==="activate"&&(i=n.call(this,"change",t,r)),i):!1}}(jQuery,jQuery.ui.accordion.prototype))}(jQuery),function(e,t){var n=0;e.widget("ui.autocomplete",{version:"1.9m6",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t=this,n=this.element[0].ownerDocument,r,i;this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(t.options.disabled||t.element.prop("readOnly")){r=!0,i=!0;return}r=!1,i=!1;var s=e.ui.keyCode;switch(n.keyCode){case s.PAGE_UP:r=!0,t._move("previousPage",n);break;case s.PAGE_DOWN:r=!0,t._move("nextPage",n);break;case s.UP:r=!0,t._move("previous",n),n.preventDefault();break;case s.DOWN:r=!0,t._move("next",n),n.preventDefault();break;case s.ENTER:case s.NUMPAD_ENTER:t.menu.active&&(r=!0,n.preventDefault());case s.TAB:if(!t.menu.active)return;t.menu.select(n);break;case s.ESCAPE:t._value(t.term),t.close(n);break;default:t._searchTimeout(n)}}).bind("keypress.autocomplete",function(n){if(r){r=!1,n.preventDefault();return}var i=e.ui.keyCode;switch(n.keyCode){case i.PAGE_UP:t._move("previousPage",n);break;case i.PAGE_DOWN:t._move("nextPage",n);break;case i.UP:t._move("previous",n),n.preventDefault();break;case i.DOWN:t._move("next",n),n.preventDefault()}}).bind("input.autocomplete",function(e){if(i){i=!1,e.preventDefault();return}t._searchTimeout(e)}).bind("focus.autocomplete",function(){if(t.options.disabled)return;t.selectedItem=null,t.previous=t._value()}).bind("blur.autocomplete",function(e){if(t.options.disabled)return;clearTimeout(t.searching),t.closing=setTimeout(function(){t.close(e),t._change(e)},150)}),this._initSource(),this.response=function(){return t._response.apply(t,arguments)},this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(n){var r=t.menu.element[0];e(n.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(n){n.target!==t.element[0]&&n.target!==r&&!e.contains(r,n.target)&&t.close()})},1),setTimeout(function(){clearTimeout(t.closing)},13)}).menu({input:e(),focus:function(e,n){var r=n.item.data("item.autocomplete");!1!==t._trigger("focus",e,{item:r})&&/^key/.test(e.originalEvent.type)&&t._value(r.value)},select:function(e,r){var i=r.item.data("item.autocomplete"),s=t.previous;t.element[0]!==n.activeElement&&(t.element.focus(),t.previous=s,setTimeout(function(){t.previous=s,t.selectedItem=i},1)),!1!==t._trigger("select",e,{item:i})&&t._value(i.value),t.term=t._value(),t.close(e),t.selectedItem=i},blur:function(e,n){t.menu.element.is(":visible")&&t._value()!==t.term&&t._value(t.term)}}).zIndex(this.element.zIndex()+1).hide().data("menu"),e.fn.bgiframe&&this.menu.element.bgiframe()},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove()},_setOption:function(t,n){this._super("_setOption",t,n),t==="source"&&this._initSource(),t==="appendTo"&&this.menu.element.appendTo(e(n||"body",this.element[0].ownerDocument)[0]),t==="disabled"&&n&&this.xhr&&this.xhr.abort()},_initSource:function(){var t=this,r,i;e.isArray(this.options.source)?(r=this.options.source,this.source=function(t,n){n(e.ui.autocomplete.filter(r,t.term))}):typeof this.options.source=="string"?(i=this.options.source,this.source=function(r,s){t.xhr&&t.xhr.abort(),t.xhr=e.ajax({url:i,data:r,dataType:"json",autocompleteRequest:++n,success:function(e,t){this.autocompleteRequest===n&&s(e)},error:function(){this.autocompleteRequest===n&&s([])}})}):this.source=this.options.source},_searchTimeout:function(e){var t=this;t.searching=setTimeout(function(){t.term!=t.element.val()&&(t.selectedItem=null,t.search(null,e))},t.options.delay)},search:function(e,t){e=e!=null?e:this._value(),this.term=this._value();if(e.length<this.options.minLength)return this.close(t);clearTimeout(this.closing);if(this._trigger("search",t)===!1)return;return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:e},this.response)},_response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length?(this._suggest(e),this._trigger("open")):this.close(),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(e){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.blur(),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new e.Event("mouseover"))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItem(t,n)})},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>").text(n.label)).appendTo(t)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)){this._value(this.term),this.menu.blur();return}this.menu[e](t)},widget:function(){return this.menu.element},_value:function(e){return this.valueMethod.apply(this.element,arguments)}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}})}(jQuery),function(e,t){var n,r,i,s,o="ui-button ui-widget ui-state-default ui-corner-all",u="ui-state-hover ui-state-active ",a="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",f=function(){var t=e(this).find(":ui-button");setTimeout(function(){t.button("refresh")},1)},l=function(t){var n=t.name,r=t.form,i=e([]);return n&&(r?i=e(r).find("[name='"+n+"']"):i=e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})),i};e.widget("ui.button",{version:"1.9m6",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",f),typeof this.options.disabled!="boolean"&&(this.options.disabled=this.element.prop("disabled")),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,u=this.options,a=this.type==="checkbox"||this.type==="radio",c="ui-state-hover"+(a?"":" ui-state-active"),h="ui-state-focus";u.label===null&&(u.label=this.buttonElement.html()),this.element.is(":disabled")&&(u.disabled=!0),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter.button",function(){if(u.disabled)return;e(this).addClass("ui-state-hover"),this===n&&e(this).addClass("ui-state-active")}).bind("mouseleave.button",function(){if(u.disabled)return;e(this).removeClass(c)}).bind("click.button",function(e){u.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus.button",function(){t.buttonElement.addClass(h)}).bind("blur.button",function(){t.buttonElement.removeClass(h)}),a&&(this.element.bind("change.button",function(){if(s)return;t.refresh()}),this.buttonElement.bind("mousedown.button",function(e){if(u.disabled)return;s=!1,r=e.pageX,i=e.pageY}).bind("mouseup.button",function(e){if(u.disabled)return;if(r!==e.pageX||i!==e.pageY)s=!0})),this.type==="checkbox"?this.buttonElement.bind("click.button",function(){if(u.disabled||s)return!1;e(this).toggleClass("ui-state-active"),t.buttonElement.attr("aria-pressed",t.element[0].checked)}):this.type==="radio"?this.buttonElement.bind("click.button",function(){if(u.disabled||s)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var n=t.element[0];l(n).not(n).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown.button",function(){if(u.disabled)return!1;e(this).addClass("ui-state-active"),n=this,e(document).one("mouseup",function(){n=null})}).bind("mouseup.button",function(){if(u.disabled)return!1;e(this).removeClass("ui-state-active")}).bind("keydown.button",function(t){if(u.disabled)return!1;(t.keyCode==e.ui.keyCode.SPACE||t.keyCode==e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active")}).bind("keyup.button",function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",u.disabled),this._resetButton()},_determineButtonType:function(){this.element.is(":checkbox")?this.type="checkbox":this.element.is(":radio")?this.type="radio":this.element.is("input")?this.type="input":this.type="button";if(this.type==="checkbox"||this.type==="radio"){var e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']";this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible");var n=this.element.is(":checked");n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",n)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" "+u+" "+a).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){this._super("_setOption",e,t);if(e==="disabled"){t?this.element.prop("disabled",!0):this.element.prop("disabled",!1);return}this._resetButton()},refresh:function(){var t=this.element.is(":disabled");t!==this.options.disabled&&this._setOption("disabled",t),this.type==="radio"?l(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);return}var t=this.buttonElement.removeClass(a),n=e("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,i=r.primary&&r.secondary,s=[];r.primary||r.secondary?(this.options.text&&s.push("ui-button-text-icon"+(i?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(s.push(i?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",n))):s.push("ui-button-text-only"),t.addClass(s.join(" "))}}),e.ui.button.version="1.9m6",e.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){e==="disabled"&&this.buttons.button("option",e,t),this._super("_setOption",e,t)},refresh:function(){var t=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(t,"mouseout",function(){$(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).removeClass("ui-datepicker-next-hover")}).delegate(t,"mouseover",function(){$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])||($(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).addClass("ui-datepicker-next-hover"))})}function extendRemove(e,t){$.extend(e,t);for(var n in t)if(t[n]==null||t[n]==undefined)e[n]=t[n];return e}function isArray(e){return e&&($.browser.safari&&typeof e=="object"&&e.length||e.constructor&&e.constructor.toString().match(/\Array\(\)/))}$.extend($.ui,{datepicker:{version:"1.9m6"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline=nodeName=="div"||nodeName=="span";target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),nodeName=="input"?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(e,t){var n=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(e,t){var n=$(e);t.append=$([]),t.trigger=$([]);if(n.hasClass(this.markerClassName))return;this._attachments(n,t),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),this._autoSize(t),$.data(e,PROP_NAME,t),t.settings.disabled&&this._disableDatepicker(e)},_attachments:function(e,t){var n=this._get(t,"appendText"),r=this._get(t,"isRTL");t.append&&t.append.remove(),n&&(t.append=$('<span class="'+this._appendClass+'">'+n+"</span>"),e[r?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove();var i=this._get(t,"showOn");(i=="focus"||i=="both")&&e.focus(this._showDatepicker);if(i=="button"||i=="both"){var s=this._get(t,"buttonText"),o=this._get(t,"buttonImage");t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:o,alt:s,title:s}):$('<button type="button"></button>').addClass(this._triggerClass).html(o==""?s:$("<img/>").attr({src:o,alt:s,title:s}))),e[r?"before":"after"](t.trigger),t.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker
._lastInput==e[0]?$.datepicker._hideDatepicker():$.datepicker._showDatepicker(e[0]),!1})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),n=this._get(e,"dateFormat");if(n.match(/[DM]/)){var r=function(e){var t=0,n=0;for(var r=0;r<e.length;r++)e[r].length>t&&(t=e[r].length,n=r);return n};t.setMonth(r(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(r(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var n=$(e);if(n.hasClass(this.markerClassName))return;n.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),$.data(e,PROP_NAME,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block")},_dialogDatepicker:function(e,t,n,r,i){var s=this._dialogInst;if(!s){this.uuid+=1;var o="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+o+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),s=this._dialogInst=this._newInst(this._dialogInput,!1),s.settings={},$.data(this._dialogInput[0],PROP_NAME,s)}extendRemove(s.settings,r||{}),t=t&&t.constructor==Date?this._formatDate(s,t):t,this._dialogInput.val(t),this._pos=i?i.length?i:[i.pageX,i.pageY]:null;if(!this._pos){var u=document.documentElement.clientWidth,a=document.documentElement.clientHeight,f=document.documentElement.scrollLeft||document.body.scrollLeft,l=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[u/2-100+f,a/2-150+l]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),s.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,s),this},_destroyDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName))return;var r=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),r=="input"?(n.append.remove(),n.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(r=="div"||r=="span")&&t.removeClass(this.markerClassName).empty()},_enableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName))return;var r=e.nodeName.toLowerCase();if(r=="input")e.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t})},_disableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName))return;var r=e.nodeName.toLowerCase();if(r=="input")e.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t}),this._disabledInputs[this._disabledInputs.length]=e},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==e)return!0;return!1},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,n){var r=this._getInst(e);if(arguments.length==2&&typeof t=="string")return t=="defaults"?$.extend({},$.datepicker._defaults):r?t=="all"?$.extend({},r.settings):this._get(r,t):null;var i=t||{};typeof t=="string"&&(i={},i[t]=n);if(r){this._curInst==r&&this._hideDatepicker();var s=this._getDateDatepicker(e,!0),o=this._getMinMaxDate(r,"min"),u=this._getMinMaxDate(r,"max");extendRemove(r.settings,i),o!==null&&i.dateFormat!==undefined&&i.minDate===undefined&&(r.settings.minDate=this._formatDate(r,o)),u!==null&&i.dateFormat!==undefined&&i.maxDate===undefined&&(r.settings.maxDate=this._formatDate(r,u)),this._attachments($(e),r),this._autoSize(r),this._setDate(r,s),this._updateAlternate(r),this._updateDatepicker(r)}},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target),n=!0,r=t.dpDiv.is(".ui-datepicker-rtl");t._keyEvent=!0;if($.datepicker._datepickerShowing)switch(e.keyCode){case 9:$.datepicker._hideDatepicker(),n=!1;break;case 13:var i=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);i[0]&&$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,i[0]);var s=$.datepicker._get(t,"onSelect");if(s){var o=$.datepicker._formatDate(t);s.apply(t.input?t.input[0]:null,[o,t])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&$.datepicker._clearDate(e.target),n=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&$.datepicker._gotoToday(e.target),n=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,r?1:-1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,-7,"D"),n=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,r?-1:1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,7,"D"),n=e.ctrlKey||e.metaKey;break;default:n=!1}else e.keyCode==36&&e.ctrlKey?$.datepicker._showDatepicker(this):n=!1;n&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var n=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),r=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||r<" "||!n||n.indexOf(r)>-1}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);if(t.input.val()!=t.lastVal)try{var n=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));n&&($.datepicker._setDateFromField(t),$.datepicker._updateAlternate(t),$.datepicker._updateDatepicker(t))}catch(e){$.datepicker.log(e)}return!0},_showDatepicker:function(e){e=e.target||e,e.nodeName.toLowerCase()!="input"&&(e=$("input",e.parentNode)[0]);if($.datepicker._isDisabledDatepicker(e)||$.datepicker._lastInput==e)return;var t=$.datepicker._getInst(e);$.datepicker._curInst&&$.datepicker._curInst!=t&&($.datepicker._datepickerShowing&&$.datepicker._triggerOnClose($.datepicker._curInst),$.datepicker._curInst.dpDiv.stop(!0,!0));var n=$.datepicker._get(t,"beforeShow"),r=n?n.apply(e,[e,t]):{};if(r===!1)return;extendRemove(t.settings,r),t.lastVal=null,$.datepicker._lastInput=e,$.datepicker._setDateFromField(t),$.datepicker._inDialog&&(e.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(e),$.datepicker._pos[1]+=e.offsetHeight);var i=!1;$(e).parents().each(function(){return i|=$(this).css("position")=="fixed",!i}),i&&$.browser.opera&&($.datepicker._pos[0]-=document.documentElement.scrollLeft,$.datepicker._pos[1]-=document.documentElement.scrollTop);var s={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(t),s=$.datepicker._checkOffset(t,s,i),t.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":i?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"});if(!t.inline){var o=$.datepicker._get(t,"showAnim"),u=$.datepicker._get(t,"duration"),a=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(!!e.length){var n=$.datepicker._getBorders(t.dpDiv);e.css({left:-n[0],top:-n[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex($(e).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&($.effects.effect[o]||$.effects[o])?t.dpDiv.show(o,$.datepicker._get(t,"showOptions"),u,a):t.dpDiv[o||"show"](o?u:null,a),(!o||!u)&&a(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),$.datepicker._curInst=t}},_updateDatepicker:function(e){var t=this;t.maxRows=4;var n=$.datepicker._getBorders(e.dpDiv);instActive=e,e.dpDiv.empty().append(this._generateHTML(e));var r=e.dpDiv.find("iframe.ui-datepicker-cover");!r.length||r.css({left:-n[0],top:-n[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i=this._getNumberOfMonths(e),s=i[1],o=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),s>1&&e.dpDiv.addClass("ui-datepicker-multi-"+s).css("width",o*s+"em"),e.dpDiv[(i[0]!=1||i[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus();if(e.yearshtml){var u=e.yearshtml;setTimeout(function(){u===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),u=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,n){var r=e.dpDiv.outerWidth(),i=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,u=document.documentElement.clientWidth+$(document).scrollLeft(),a=document.documentElement.clientHeight+$(document).scrollTop();return t.left-=this._get(e,"isRTL")?r-s:0,t.left-=n&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=n&&t.top==e.input.offset().top+o?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+r>u&&u>r?Math.abs(t.left+r-u):0),t.top-=Math.min(t.top,t.top+i>a&&a>i?Math.abs(i+o):0),t},_findPos:function(e){var t=this._getInst(e),n=this._get(t,"isRTL");while(e&&(e.type=="hidden"||e.nodeType!=1||$.expr.filters.hidden(e)))e=e[n?"previousSibling":"nextSibling"];var r=$(e).offset();return[r.left,r.top]},_triggerOnClose:function(e){var t=this._get(e,"onClose");t&&t.apply(e.input?e.input[0]:null,[e.input?e.input.val():"",e])},_hideDatepicker:function(e){var t=this._curInst;if(!t||e&&t!=$.data(e,PROP_NAME))return;if(this._datepickerShowing){var n=this._get(t,"showAnim"),r=this._get(t,"duration"),i=function(){$.datepicker._tidyDialog(t),this._curInst=null};$.effects&&($.effects.effect[n]||$.effects[n])?t.dpDiv.hide(n,$.datepicker._get(t,"showOptions"),r,i):t.dpDiv[n=="slideDown"?"slideUp":n=="fadeIn"?"fadeOut":"hide"](n?r:null,i),n||i(),$.datepicker._triggerOnClose(t),this._datepickerShowing=!1,this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(!$.datepicker._curInst)return;var t=$(e.target);t[0].id!=$.datepicker._mainDivId&&t.parents("#"+$.datepicker._mainDivId).length==0&&!t.hasClass($.datepicker.markerClassName)&&!t.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)&&$.datepicker._hideDatepicker()},_adjustDate:function(e,t,n){var r=$(e),i=this._getInst(r[0]);if(this._isDisabledDatepicker(r[0]))return;this._adjustInstDate(i,t+(n=="M"?this._get(i,"showCurrentAtPos"):0),n),this._updateDatepicker(i)},_gotoToday:function(e){var t=$(e),n=this._getInst(t[0]);if(this._get(n,"gotoCurrent")&&n.currentDay)n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear;else{var r=new Date;n.selectedDay=r.getDate(),n.drawMonth=n.selectedMonth=r.getMonth(),n.drawYear=n.selectedYear=r.getFullYear()}this._notifyChange(n),this._adjustDate(t)},_selectMonthYear:function(e,t,n){var r=$(e),i=this._getInst(r[0]);i["selected"+(n=="M"?"Month":"Year")]=i["draw"+(n=="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(i),this._adjustDate(r)},_selectDay:function(e,t,n,r){var i=$(e);if($(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(i[0]))return;var s=this._getInst(i[0]);s.selectedDay=s.currentDay=$("a",r).html(),s.selectedMonth=s.currentMonth=t,s.selectedYear=s.currentYear=n,this._selectDate(e,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear))},_clearDate:function(e){var t=$(e),n=this._getInst(t[0]);this._selectDate(t,"")},_selectDate:function(e,t){var n=$(e),r=this._getInst(n[0]);t=t!=null?t:this._formatDate(r),r.input&&r.input.val(t),this._updateAlternate(r);var i=this._get(r,"onSelect");i?i.apply(r.input?r.input[0]:null,[t,r]):r.input&&r.input.trigger("change"),r.inline?this._updateDatepicker(r):(this._hideDatepicker(),this._lastInput=r.input[0],typeof r.input[0]!="object"&&r.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var n=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),i=this.formatDate(n,r,this._getFormatConfig(e));$(t).each(function(){$(this).val(i)})}},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/864e5)/7)+1},parseDate:function(e,t,n){if(e==null||t==null)throw"Invalid arguments";t=typeof t=="object"?t.toString():t+"";if(t=="")return null;var r=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;r=typeof r!="string"?r:(new Date).getFullYear()%100+parseInt(r,10);var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=-1,f=-1,l=-1,c=-1,h=!1,p=function(t){var n=y+1<e.length&&e.charAt(y+1)==t;return n&&y++,n},d=function(e){var n=p(e),r=e=="@"?14:e=="!"?20:e=="y"&&n?4:e=="o"?3:2,i=new RegExp("^\\d{1,"+r+"}"),s=t.substring(g).match(i);if(!s)throw"Missing number at position "+g;return g+=s[0].length,parseInt(s[0],10)},v=function(e,n,r){var i=$.map(p(e)?r:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)}),s=-1;$.each(i,function(e,n){var r=n[1];if(t.substr(g,r.length).toLowerCase()==r.toLowerCase())return s=n[0],g+=r.length,!1});if(s!=-1)return s+1;throw"Unknown name at position "+g},m=function(){if(t.charAt(g)!=e.charAt(y))throw"Unexpected literal at position "+g;g++},g=0;for(var y=0;y<e.length;y++)if(h)e.charAt(y)=="'"&&!p("'")?h=!1:m();else switch(e.charAt(y)){case"d":l=d("d");break;case"D":v("D",i,s);break;case"o":c=d("o");break;case"m":f=d("m");break;case"M":f=v("M",o,u);break;case"y":a=d("y");break;case"@":var b=new Date(d("@"));a=b.getFullYear(),f=b.getMonth()+1,l=b.getDate();break;case"!":var b=new Date((d("!")-this._ticksTo1970)/1e4);a=b.getFullYear(),f=b.getMonth()+1,l=b.getDate();break;case"'":p("'")?m():h=!0;break;default:m()}if(g<t.length){var w=t.substr(g);if(!/^\s+/.test(w))throw"Extra/unparsed characters found in date: "+w}a==-1?a=(new Date).getFullYear():a<100&&(a+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a<=r?0:-100));if(c>-1){f=1,l=c;do{var E=this._getDaysInMonth(a,f-1);if(l<=E)break;f++,l-=E}while(!0)}var b=this._daylightSavingAdjust(new Date(a,f-1,l));if(b.getFullYear()!=a||b.getMonth()+1!=f||b.getDate()!=l)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,i=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,o=(n?n.monthNames:null)||this._defaults.monthNames,u=function(t){var n=h+1<e.length&&e.charAt(h+1)==t;return n&&h++,n},a=function(e,t,n){var r=""+t;if(u(e))while(r.length<n)r="0"+r;return r},f=function(e,t,n,r){return u(e)?r[t]:n[t]},l="",c=!1;if(t)for(var h=0;h<e.length;h++)if(c)e.charAt(h)=="'"&&!u("'")?c=!1:l+=e.charAt(h);else switch(e.charAt(h)){case"d":l+=a("d",t.getDate(),2);break;case"D":l+=f("D",t.getDay(),r,i);break;case"o":l+=a("o",Math.round(((new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()-(new Date(t.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":l+=a("m",t.getMonth()+1,2);break;case"M":l+=f("M",t.getMonth(),s,o);break;case"y":l+=u("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":l+=t.getTime();break;case"!":l+=t.getTime()*1e4+this._ticksTo1970;break;case"'":u("'")?l+="'":c=!0;break;default:l+=e.charAt(h)}return l},_possibleChars:function(e){var t="",n=!1,r=function(t){var n=i+1<e.length&&e.charAt(i+1)==t;return n&&i++,n};for(var i=0;i<e.length;i++)if(n)e.charAt(i)=="'"&&!r("'")?n=!1:t+=e.charAt(i);else switch(e.charAt(i)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":r("'")?t+="'":n=!0;break;default:t+=e.charAt(i)}return t},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()==e.lastVal)return;var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i,s;i=s=this._getDefaultDate(e);var o=this._getFormatConfig(e);try{i=this.parseDate(n,r,o)||s}catch(u){this.log(u),r=t?"":r}e.selectedDay=i.getDate(),e.drawMonth=e.selectedMonth=i.getMonth(),e.drawYear=e.selectedYear=i.getFullYear(),e.currentDay=r?i.getDate():0,e.currentMonth=r?i.getMonth():0,e.currentYear=r?i.getFullYear():0,this._adjustInstDate(e)},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,n){var r=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},i=function(t){try{return $.datepicker.parseDate($.datepicker._get(e,"dateFormat"),t,$.datepicker._getFormatConfig(e))}catch(n){}var r=(t.toLowerCase().match(/^c/)?$.datepicker._getDate(e):null)||new Date,i=r.getFullYear(),s=r.getMonth(),o=r.getDate(),u=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,a=u.exec(t);while(a){switch(a[2]||"d"){case"d":case"D":o+=parseInt(a[1],10);break;case"w":case"W":o+=parseInt(a[1],10)*7;break;case"m":case"M":s+=parseInt(a[1],10),o=Math.min(o,$.datepicker._getDaysInMonth(i,s));break;case"y":case"Y":i+=parseInt(a[1],10),o=Math.min(o,$.datepicker._getDaysInMonth(i,s))}a=u.exec(t)}return new Date(i,s,o)},s=t==null||t===""?n:typeof t=="string"?i(t):typeof t=="number"?isNaN(t)?n:r(t):new Date(t.getTime());return s=s&&s.toString()=="Invalid Date"?n:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),(i!=e.selectedMonth||s!=e.selectedYear)&&!n&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()==""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var n=this._get(e,"isRTL"),r=this._get(e,"showButtonPanel"),i=this._get(e,"hideIfNoPrevNext"),s=this._get(e,"navigationAsDateFormat"),o=this._getNumberOfMonths(e),u=this._get(e,"showCurrentAtPos"),a=this._get(e,"stepMonths"),f=o[0]!=1||o[1]!=1,l=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),c=this._getMinMaxDate(e,"min"),h=this._getMinMaxDate(e,"max"),p=e.drawMonth-u,d=e.drawYear;p<0&&(p+=12,d--);if(h){var v=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-o[0]*o[1]+1,h.getDate()));v=c&&v<c?c:v;while(this._daylightSavingAdjust(new Date(d,p,1))>v)p--,p<0&&(p=11,d--)}e.drawMonth=p,e.drawYear=d;var m=this._get(e,"prevText");m=s?this.formatDate(m,this._daylightSavingAdjust(new Date(d,p-a,1)),this._getFormatConfig(e)):m;var g=this._canAdjustMonth(e,-1,d,p)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+e.id+"', -"+a+", 'M');\""+' title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>":i?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>",y=this._get(e,"nextText");y=s?this.formatDate(y,this._daylightSavingAdjust(new Date(d,p+a,1)),this._getFormatConfig(e)):y;var b=this._canAdjustMonth(e,1,d,p)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+e.id+"', +"+a+", 'M');\""+' title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>":i?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>",w=this._get(e,"currentText"),E=this._get(e,"gotoCurrent")&&e.currentDay?l:t;w=s?this.formatDate(w,E,this._getFormatConfig(e)):w;var S=e.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(e,"closeText")+"</button>",x=r?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(n?S:"")+(this._isInRange(e,E)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._gotoToday('#"+e.id+"');\""+">"+w+"</button>":"")+(n?"":S)+"</div>":"",T=parseInt(this._get(e,"firstDay"),10);T=isNaN(T)?0:T;var N=this._get(e,"showWeek"),C=this._get(e,"dayNames"),k=this._get(e,"dayNamesShort"),L=this._get(e,"dayNamesMin"),A=this._get(e,"monthNames"),O=this._get(e,"monthNamesShort"),M=this._get(e,"beforeShowDay"),_=this._get(e,"showOtherMonths"),D=this._get(e,"selectOtherMonths"),P=this._get(e,"calculateWeek")||this.iso8601Week,H=this._getDefaultDate(e),B="";for(var j=0;j<o[0];j++){var F="";this.maxRows=4;for(var I=0;I<o[1];I++){var q=this._daylightSavingAdjust(new Date(d,p,e.selectedDay)),R=" ui-corner-all",U="";if(f){U+='<div class="ui-datepicker-group';if(o[1]>1)switch(I){case 0:U+=" ui-datepicker-group-first",R=" ui-corner-"+(n?"right":"left");break;case o[1]-1:U+=" ui-datepicker-group-last",R=" ui-corner-"+(n?"left":"right");break;default:U+=" ui-datepicker-group-middle",R=""}U+='">'}U+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+R+'">'+(/all|left/.test(R)&&j==0?n?b:g:"")+(/all|right/.test(R)&&j==0?n?g:b:"")+this._generateMonthYearHeader(e,p,d,c,h,j>0||I>0,A,O)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";var z=N?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"";for(var W=0;W<7;W++){var X=(W+T)%7;z+="<th"+((W+T+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+C[X]+'">'+L[X]+"</span></th>"}U+=z+"</tr></thead><tbody>";var V=this._getDaysInMonth(d,p);d==e.selectedYear&&p==e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,V));var J=(this._getFirstDayOfMonth(d,p)-T+7)%7,K=Math.ceil((J+V)/7),Q=f?this.maxRows>K?this.maxRows:K:K;this.maxRows=Q;var G=this._daylightSavingAdjust(new Date(d,p,1-J));for(var Y=0;Y<Q;Y++){U+="<tr>";var Z=N?'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(G)+"</td>":"";for(var W=0;W<7;W++){var et=M?M.apply(e.input?e.input[0]:null,[G]):[!0,""],tt=G.getMonth()!=p,nt=tt&&!D||!et[0]||c&&G<c||h&&G>h;Z+='<td class="'+((W+T+6)%7>=5?" ui-datepicker-week-end":"")+(tt?" ui-datepicker-other-month":"")+(G.getTime()==q.getTime()&&p==e.selectedMonth&&e._keyEvent||H.getTime()==G.getTime()&&H.getTime()==q.getTime()?" "+this._dayOverClass:"")+(nt?" "+this._unselectableClass+" ui-state-disabled":"")+(tt&&!_?"":" "+et[1]+(G.getTime()==l.getTime()?" "+this._currentClass:"")+(G.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+((!tt||_)&&et[2]?' title="'+et[2]+'"':"")+(nt?"":' onclick="DP_jQuery_'+dpuuid+".datepicker._selectDay('#"+e.id+"',"+G.getMonth()+","+G.getFullYear()+', this);return false;"')+">"+(tt&&!_?"&#xa0;":nt?'<span class="ui-state-default">'+G.getDate()+"</span>":'<a class="ui-state-default'+(G.getTime()==t.getTime()?" ui-state-highlight":"")+(G.getTime()==l.getTime()?" ui-state-active":"")+(tt?" ui-priority-secondary":"")+'" href="#">'+G.getDate()+"</a>")+"</td>",G.setDate(G.getDate()+1),G=this._daylightSavingAdjust(G)}U+=Z+"</tr>"}p++,p>11&&(p=0,d++),U+="</tbody></table>"+(f?"</div>"+(o[0]>0&&I==o[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),F+=U}B+=F}return B+=x+($.browser.msie&&parseInt($.browser.version,10)<7&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),e._keyEvent=!1,B},_generateMonthYearHeader:function(e,t,n,r,i,s,o,u){var a=this._get(e,"changeMonth"),f=this._get(e,"changeYear"),l=this._get(e,"showMonthAfterYear"),c='<div class="ui-datepicker-title">',h="";if(s||!a)h+='<span class="ui-datepicker-month">'+o[t]+"</span>";else{var p=r&&r.getFullYear()==n,d=i&&i.getFullYear()==n;h+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+e.id+"', this, 'M');\" "+">";for(var v=0;v<12;v++)(!p||v>=r.getMonth())&&(!d||v<=i.getMonth())&&(h+='<option value="'+v+'"'+(v==t?' selected="selected"':"")+">"+u[v]+"</option>");h+="</select>"}l||(c+=h+(s||!a||!f?"&#xa0;":""));if(!e.yearshtml){e.yearshtml="";if(s||!f)c+='<span class="ui-datepicker-year">'+n+"</span>";else{var m=this._get(e,"yearRange").split(":"),g=(new Date).getFullYear(),y=function(e){var t=e.match(/c[+-].*/)?n+parseInt(e.substring(1),10):e.match(/[+-].*/)?g+parseInt(e,10):parseInt(e,10);return isNaN(t)?g:t},b=y(m[0]),w=Math.max(b,y(m[1]||""));b=r?Math.max(b,r.getFullYear()):b,w=i?Math.min(w,i.getFullYear()):w,e.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+e.id+"', this, 'Y');\" "+">";for(;b<=w;b++)e.yearshtml+='<option value="'+b+'"'+(b==n?' selected="selected"':"")+">"+b+"</option>";e.yearshtml+="</select>",c+=e.yearshtml,e.yearshtml=null}}return c+=this._get(e,"yearSuffix"),l&&(c+=(s||!a||!f?"&#xa0;":"")+h),c+="</div>",c},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n=="Y"?t:0),i=e.drawMonth+(n=="M"?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n=="D"?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,s)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),(n=="M"||n=="Y")&&this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),i=n&&t<n?n:t;return i=r&&i>r?r:i,i},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay()},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1));return t<0&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s)},_isInRange:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max");return(!n||t.getTime()>=n.getTime())&&(!r||t.getTime()<=r.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var i=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e))}}),$.fn.datepicker=function(e){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv),$.datepicker.initialized=!0);var t=Array.prototype.slice.call(arguments,1);return typeof e!="string"||e!="isDisabled"&&e!="getDate"&&e!="widget"?e=="option"&&arguments.length==2&&typeof arguments[1]=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t)):this.each(function(){typeof e=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e)}):$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.9m6",window["DP_jQuery_"+dpuuid]=$}(jQuery),function(e,t){var n="ui-dialog ui-widget ui-widget-content ui-corner-all ",r={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.9m6",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;n<0&&e(this).css("top",t.top-n)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var t=this,r=t.options,i=r.title||"&#160;",s=e.ui.dialog.getTitleId(t.element),o=(t.uiDialog=e("<div>")).addClass(n+r.dialogClass).css({display:"none",outline:0,zIndex:r.zIndex}).attr("tabIndex",-1).keydown(function(n){r.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE&&(t.close(n),n.preventDefault())}).attr({role:"dialog","aria-labelledby":s}).mousedown(function(e){t.moveToTop(!1,e)}).appendTo("body"),u=t.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(o),a=(t.uiDialogTitlebar=e("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix"
).prependTo(o),f=e("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(e){e.preventDefault(),t.close(e)}).appendTo(a),l=(t.uiDialogTitlebarCloseText=e("<span>")).addClass("ui-icon ui-icon-closethick").text(r.closeText).appendTo(f),c=e("<span>").addClass("ui-dialog-title").attr("id",s).html(i).prependTo(a);a.find("*").add(a).disableSelection(),this._hoverable(f),this._focusable(f),r.draggable&&e.fn.draggable&&t._makeDraggable(),r.resizable&&e.fn.resizable&&t._makeResizable(),t._createButtons(r.buttons),t._isOpen=!1,e.fn.bgiframe&&o.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},_destroy:function(){var e=this;e.overlay&&e.overlay.destroy(),e.uiDialog.hide(),e.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),e.uiDialog.remove(),e.originalTitle&&e.element.attr("title",e.originalTitle)},widget:function(){return this.uiDialog},close:function(t){if(!this._isOpen)return n;var n=this,r,i;if(!1===n._trigger("beforeClose",t))return;return n._isOpen=!1,n.overlay&&n.overlay.destroy(),n.uiDialog.unbind("keypress.ui-dialog"),n.options.hide?n.uiDialog.hide(n.options.hide,function(){n._trigger("close",t)}):(n.uiDialog.hide(),n._trigger("close",t)),e.ui.dialog.overlay.resize(),n.options.modal&&(r=0,e(".ui-dialog").each(function(){this!==n.uiDialog[0]&&(i=e(this).css("z-index"),isNaN(i)||(r=Math.max(r,i)))}),e.ui.dialog.maxZ=r),n},isOpen:function(){return this._isOpen},moveToTop:function(t,n){var r=this,i=r.options,s;return i.modal&&!t||!i.stack&&!i.modal?r._trigger("focus",n):(i.zIndex>e.ui.dialog.maxZ&&(e.ui.dialog.maxZ=i.zIndex),r.overlay&&(e.ui.dialog.maxZ+=1,e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ,r.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ)),s={scrollTop:r.element.scrollTop(),scrollLeft:r.element.scrollLeft()},e.ui.dialog.maxZ+=1,r.uiDialog.css("z-index",e.ui.dialog.maxZ),r.element.attr(s),r._trigger("focus",n),r)},open:function(){if(this._isOpen)return;var t=this,n=t.options,r=t.uiDialog;t._size(),t._position(n.position),r.show(n.show),t.overlay=n.modal?new e.ui.dialog.overlay(t):null,t.moveToTop(!0),n.modal&&r.bind("keydown.ui-dialog",function(t){if(t.keyCode!==e.ui.keyCode.TAB)return;var n=e(":tabbable",this),r=n.filter(":first"),i=n.filter(":last");if(t.target===i[0]&&!t.shiftKey)return r.focus(1),!1;if(t.target===r[0]&&t.shiftKey)return i.focus(1),!1});var i=t.element.find(":tabbable");return i.length||(i=r.find(".ui-dialog-buttonpane :tabbable"),i.length||(i=r)),i.eq(0).focus(),t._isOpen=!0,t._trigger("open"),t},_createButtons:function(t){var n=this,r=!1;n.uiDialog.find(".ui-dialog-buttonpane").remove(),typeof t=="object"&&t!==null&&e.each(t,function(){return!(r=!0)});if(r){var i=e("<div>").addClass("ui-dialog-buttonpane  ui-widget-content ui-helper-clearfix"),s=e("<div>").addClass("ui-dialog-buttonset").appendTo(i);e.each(t,function(t,r){r=e.isFunction(r)?{click:r,text:t}:r;var i=e("<button type='button'>").attr(r,!0).unbind("click").click(function(){r.click.apply(n.element[0],arguments)}).appendTo(s);e.fn.button&&i.button()}),n.uiDialog.addClass("ui-dialog-buttons"),i.appendTo(n.uiDialog)}else n.uiDialog.removeClass("ui-dialog-buttons")},_makeDraggable:function(){function i(e){return{position:e.position,offset:e.offset}}var t=this,n=t.options,r=e(document);t.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){e(this).addClass("ui-dialog-dragging"),t._trigger("dragStart",n,i(r))},drag:function(e,n){t._trigger("drag",e,i(n))},stop:function(s,o){n.position=[o.position.left-r.scrollLeft(),o.position.top-r.scrollTop()],e(this).removeClass("ui-dialog-dragging"),t._trigger("dragStop",s,i(o)),e.ui.dialog.overlay.resize()}})},_makeResizable:function(n){function u(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}n=n===t?this.options.resizable:n;var r=this,i=r.options,s=r.uiDialog.css("position"),o=typeof n=="string"?n:"n,e,s,w,se,sw,ne,nw";r.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:r.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:r._minHeight(),handles:o,start:function(t,n){e(this).addClass("ui-dialog-resizing"),r._trigger("resizeStart",t,u(n))},resize:function(e,t){r._trigger("resize",e,u(t))},stop:function(t,n){e(this).removeClass("ui-dialog-resizing"),i.height=e(this).height(),i.width=e(this).width(),r._trigger("resizeStop",t,u(n)),e.ui.dialog.overlay.resize()}}).css("position",s).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t){var n=[],r=[0,0],i;if(t){if(typeof t=="string"||typeof t=="object"&&"0"in t)n=t.split?t.split(" "):[t[0],t[1]],n.length===1&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t={my:n.join(" "),at:n.join(" "),offset:r.join(" ")};t=e.extend({},e.ui.dialog.prototype.options.position,t)}else t=e.ui.dialog.prototype.options.position;i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.position(t),i||this.uiDialog.hide()},_setOptions:function(t){var n=this,s={},o=!1;e.each(t,function(e,t){n._setOption(e,t),e in r&&(o=!0),e in i&&(s[e]=t)}),o&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(t,r){var i=this,s=i.uiDialog;switch(t){case"buttons":i._createButtons(r);break;case"closeText":i.uiDialogTitlebarCloseText.text(""+r);break;case"dialogClass":s.removeClass(i.options.dialogClass).addClass(n+r);break;case"disabled":r?s.addClass("ui-dialog-disabled"):s.removeClass("ui-dialog-disabled");break;case"draggable":var o=s.is(":data(draggable)");o&&!r&&s.draggable("destroy"),!o&&r&&i._makeDraggable();break;case"position":i._position(r);break;case"resizable":var u=s.is(":data(resizable)");u&&!r&&s.resizable("destroy"),u&&typeof r=="string"&&s.resizable("option","handles",r),!u&&r!==!1&&i._makeResizable(r);break;case"title":e(".ui-dialog-title",i.uiDialogTitlebar).html(""+(r||"&#160;"))}this._super("_setOption",t,r)},_size:function(){var t=this.options,n,r,i=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),t.minWidth>t.width&&(t.width=t.minWidth),n=this.uiDialog.css({height:"auto",width:t.width}).height(),r=Math.max(0,t.minHeight-n);if(t.height==="auto")if(e.support.minHeight)this.element.css({minHeight:r,height:"auto"});else{this.uiDialog.show();var s=this.element.css("height","auto").height();i||this.uiDialog.hide(),this.element.height(Math.max(s,r))}else this.element.height(Math.max(t.height-n,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),e.extend(e.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}}),e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(t){this.instances.length===0&&(setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(t){if(e(t.target).zIndex()<e.ui.dialog.overlay.maxZ)return!1})},1),e(document).bind("keydown.dialog-overlay",function(n){t.options.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE&&(t.close(n),n.preventDefault())}),e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize));var n=(this.oldInstances.pop()||e("<div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return e.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n},destroy:function(t){var n=e.inArray(t,this.instances);n!==-1&&this.oldInstances.push(this.instances.splice(n,1)[0]),this.instances.length===0&&e([document,window]).unbind(".dialog-overlay"),t.height(0).width(0).remove();var r=0;e.each(this.instances,function(){r=Math.max(r,this.css("z-index"))}),this.maxZ=r},height:function(){var t,n;return e.browser.msie?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),t<n?e(window).height()+"px":t+"px"):e(document).height()+"px"},width:function(){var t,n;return e.browser.msie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),t<n?e(window).width()+"px":t+"px"):e(document).width()+"px"},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}}),e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),function(e){function i(t){if(!e(t.target).closest(".ui-menu").length)for(var n in r)r.hasOwnProperty(n)&&r[n].collapseAll(t)}function s(t){if(r[t.menuId])return;r[t.menuId]=t,n++||e("body").click(i)}function o(t){if(!r[t.menuId])return;delete r[t.menuId],n&&!--n&&e("body").unbind("click",i)}var t=0,n=0,r={};e.widget("ui.menu",{version:"1.9m6",defaultElement:"<ul>",delay:150,options:{position:{my:"left top",at:"right top"}},_create:function(){this.activeMenu=this.element,this.menuId=this.element.attr("id")||"ui-menu-"+t++,this.element.find(".ui-icon").length&&this.element.addClass("ui-menu-icons"),this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:"menu"}).bind("click.menu",e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this._bind({"click .ui-menu-item:has(a)":function(t){t.stopImmediatePropagation();var n=e(t.currentTarget);(!this.active||this.active[0]!==n[0])&&this.focus(t,n),this.select(t)},"mouseover .ui-menu-item":function(t){t.stopImmediatePropagation();var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"_mouseleave","mouseleave .ui-menu":"_mouseleave","mouseout .ui-menu-item":"blur",focus:function(t){this.focus(t,e(t.target).children(".ui-menu-item:first"))},blur:"collapseAll"}),this.refresh(),this.element.attr("tabIndex",0),this._bind({keydown:function(t){switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.HOME:this._move("first","first",t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.END:this._move("last","last",t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.UP:this.previous(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.DOWN:this.next(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.LEFT:this.collapse(t)&&t.stopImmediatePropagation(),t.preventDefault();break;case e.ui.keyCode.RIGHT:this.expand(t)&&t.stopImmediatePropagation(),t.preventDefault();break;case e.ui.keyCode.ENTER:this.active.children("a[aria-haspopup='true']").length?this.expand(t)&&t.stopImmediatePropagation():(this.select(t),t.stopImmediatePropagation()),t.preventDefault();break;case e.ui.keyCode.ESCAPE:this.collapse(t)&&t.stopImmediatePropagation(),t.preventDefault();break;default:t.stopPropagation(),clearTimeout(this.filterTimer);var n,r=this.previousFilter||"",i=String.fromCharCode(t.keyCode),s=!1;i==r?s=!0:i=r+i;function o(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}n=this.activeMenu.children(".ui-menu-item").filter(function(){return(new RegExp("^"+o(i),"i")).test(e(this).children("a").text())}),n=s&&n.index(this.active.next())!=-1?this.active.nextAll(".ui-menu-item"):n,n.length||(i=String.fromCharCode(t.keyCode),n=this.activeMenu.children(".ui-menu-item").filter(function(){return(new RegExp("^"+o(i),"i")).test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=i,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find("ul").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").show(),this.element.find(".ui-menu-item").unbind(".menu").removeClass("ui-menu-item").removeAttr("role").children("a").removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").removeAttr("id").children(".ui-icon").remove()},refresh:function(){var t=this.element.find("ul:not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","menu").hide().attr("aria-hidden","true").attr("aria-expanded","false"),n=this.menuId;t.add(this.element).children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").addClass("ui-corner-all").attr("tabIndex",-1).attr("role","menuitem").attr("id",function(e){return n+"-"+e}),t.each(function(){var t=e(this),n=t.prev("a");n.attr("aria-haspopup","true").prepend('<span class="ui-menu-icon ui-icon ui-icon-carat-1-e"></span>'),t.attr("aria-labelledby",n.attr("id"))})},focus:function(t,n){this.blur(t);if(this._hasScroll()){var r=parseFloat(e.curCSS(this.activeMenu[0],"borderTopWidth",!0))||0,i=parseFloat(e.curCSS(this.activeMenu[0],"paddingTop",!0))||0,s=n.offset().top-this.activeMenu.offset().top-r-i,o=this.activeMenu.scrollTop(),u=this.activeMenu.height(),a=n.height();s<0?this.activeMenu.scrollTop(o+s):s+a>u&&this.activeMenu.scrollTop(o+s-u+a)}this.active=n.first().children("a").addClass("ui-state-focus").end(),this.element.attr("aria-activedescendant",this.active.children("a").attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),this.timer=this._delay(function(){this._close()},this.delay);var f=e(">ul",n);f.length&&/^mouse/.test(t.type)&&this._startOpening(f),this.activeMenu=n.parent(),this._trigger("focus",t,{item:n})},blur:function(e){if(!this.active)return;clearTimeout(this.timer),this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true")return;this.timer=this._delay(function(){this._close(),this._open(e)},this.delay)},_open:function(t){clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents()).hide().attr("aria-hidden","true");var n=e.extend({},{of:this.active},e.type(this.options.position)=="function"?this.options.position(this.active):this.options.position);t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n),s(this)},collapseAll:function(t){var n=!1;if(t){var r=e(t.target);r.is("ui.menu")?n=r:r.closest(".ui-menu").length&&(n=r.closest(".ui-menu"))}this._close(n),n||(this.blur(t),this.activeMenu=this.element)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find("ul").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active"),e[0]===this.element[0]&&o(this)},collapse:function(e){var t=this.active&&this.active.parents("li:not(.ui-menubar-item)").first();if(t&&t.length)return this._close(),this.focus(e,t),!0},expand:function(e){var t=this.active&&this.active.children("ul").children("li").first();if(t&&t.length)return this._open(t.parent()),this._delay(function(){this.focus(e,t)},20),!0},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){if(!this.active){this.focus(n,this.activeMenu.children(".ui-menu-item")[t]());return}var r;e==="first"||e==="last"?r=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):r=this.active[e+"All"](".ui-menu-item").eq(0),r.length?this.focus(n,r):this.focus(n,this.activeMenu.children(".ui-menu-item")[t]())},nextPage:function(t){if(this._hasScroll()){if(!this.active){this.focus(t,this.activeMenu.children(".ui-menu-item").first());return}if(this.last())return;var n=this.active.offset().top,r=this.element.height(),i;this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),e(this).offset().top-n-r<0}),this.focus(t,i)}else this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())},previousPage:function(t){if(this._hasScroll()){if(!this.active){this.focus(t,this.activeMenu.children(".ui-menu-item").first());return}if(this.first())return;var n=this.active.offset().top,r=this.element.height(),i;this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),e(this).offset().top-n+r>0}),this.focus(t,i)}else this.focus(t,this.activeMenu.children(".ui-menu-item").first())},_hasScroll:function(){return this.element.height()<this.element.prop("scrollHeight")},_mouseleave:function(e){this.collapseAll(e),this.blur()},select:function(e){var t={item:this.active};this.collapseAll(e),this._trigger("select",e,t)}})}(jQuery),function(e){e.widget("ui.menubar",{version:"1.9m6",options:{autoExpand:!1,buttons:!1,menuIcon:!1,position:{my:"left top",at:"left bottom"}},_create:function(){var t=this,n=this.items=this.element.children("li").addClass("ui-menubar-item").attr("role","presentation").children("button, a");n.slice(1).attr("tabIndex",-1),this.element.addClass("ui-menubar ui-widget-header ui-helper-clearfix").attr("role","menubar"),this._focusable(n),this._hoverable(n),n.next("ul").menu({position:{within:this.options.position.within},select:function(n,r){r.item.parents("ul.ui-menu:last").hide(),t._close(),e(n.target).prev().focus(),t._trigger("select",n,r)}}).hide().attr({"aria-hidden":"true","aria-expanded":"false"}).bind("keydown.menubar",function(n){var r=e(this);if(r.is(":hidden"))return;switch(n.keyCode){case e.ui.keyCode.LEFT:t._left(n),n.preventDefault();break;case e.ui.keyCode.RIGHT:t._right(n),n.preventDefault()}}),n.each(function(){var n=e(this),r=n.next("ul");n.bind("click.menubar focus.menubar mouseenter.menubar",function(e){if(e.type=="focus"&&!e.originalEvent)return;e.preventDefault();if(e.type=="click"&&r.is(":visible")&&t.active&&t.active[0]==r[0]){t._close();return}if(t.open&&e.type=="mouseenter"||e.type=="click"||t.options.autoExpand)t.options.autoExpand&&clearTimeout(t.timer),t._open(e,r)}).bind("keydown",function(n){switch(n.keyCode){case e.ui.keyCode.SPACE:case e.ui.keyCode.UP:case e.ui.keyCode.DOWN:t._open(n,e(this).next()),n.preventDefault();break;case e.ui.keyCode.LEFT:t._prev(n,e(this)),n.preventDefault();break;case e.ui.keyCode.RIGHT:t._next(n,e(this)),n.preventDefault()}}).addClass("ui-button ui-widget ui-button-text-only ui-menubar-link").attr("role","menuitem").attr("aria-haspopup","true").wrapInner("<span class='ui-button-text'></span>"),t.options.autoExpand&&(n.bind("mouseleave.menubar",function(e){t.timer=setTimeout(function(){t._close()},150)}),r.bind("mouseleave.menubar",function(e){t.timer=setTimeout(function(){t._close()},150)}).bind("mouseenter.menubar",function(e){clearTimeout(t.timer)})),t.options.menuIcon&&(n.addClass("ui-state-default").append("<span class='ui-button-icon-secondary ui-icon ui-icon-triangle-1-s'></span>"),n.removeClass("ui-button-text-only").addClass("ui-button-text-icon-secondary")),t.options.buttons||n.addClass("ui-menubar-link").removeClass("ui-state-default")}),t._bind({keydown:function(n){if(n.keyCode==e.ui.keyCode.ESCAPE&&t.active&&t.active.menu("collapse",n)!==!0){var r=t.active;t.active.blur(),t._close(n),r.prev().focus()}},focusin:function(e){clearTimeout(t.closeTimer)},focusout:function(e){t.closeTimer=setTimeout(function(){t._close(e)},100)}})},_destroy:function(){var t=this.element.children("li").removeClass("ui-menubar-item").removeAttr("role").children("button, a");this.element.removeClass("ui-menubar ui-widget-header ui-helper-clearfix").removeAttr("role").unbind(".menubar"),t.unbind(".menubar").removeClass("ui-button ui-widget ui-button-text-only ui-menubar-link ui-state-default").removeAttr("role").removeAttr("aria-haspopup").children("span.ui-button-text").each(function(t,n){var r=e(this);r.parent().html(r.html())}).end().children(".ui-icon").remove(),this.element.find(":ui-menu").menu("destroy").show().removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("tabindex").unbind(".menubar")},_close:function(){if(!this.active||!this.active.length)return;this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"}),this.active.prev().removeClass("ui-state-active").removeAttr("tabIndex"),this.active=null,this.open=!1},_open:function(t,n){if(this.active&&this.active[0]==n[0])return;this.active&&(this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"}),this.active.prev().removeClass("ui-state-active"));var r=n.prev().addClass("ui-state-active").attr("tabIndex",-1);this.active=n.show().position(e.extend({of:r},this.options.position)).removeAttr("aria-hidden").attr("aria-expanded","true").menu("focus",t,n.children("li").first()).focus().focusin(),this.open=!0},_prev:function(e,t){t.attr("tabIndex",-1);var n=t.parent().prevAll("li").children(".ui-button").eq(0);if(n.length)n.removeAttr("tabIndex")[0].focus();else{var r=this.element.children("li:last").children(".ui-button:last");r.removeAttr("tabIndex")[0].focus()}},_next:function(e,t){t.attr("tabIndex",-1);var n=t.parent().nextAll("li").children(".ui-button").eq(0);if(n.length)n.removeAttr("tabIndex")[0].focus();else{var r=this.element.children("li:first").children(".ui-button:first");r.removeAttr("tabIndex")[0].focus()}},_left:function(e){var t=this.active.parent().prevAll("li:eq(0)").children(".ui-menu").eq(0);if(t.length)this._open(e,t);else{var n=this.element.children("li:last").children(".ui-menu:first");this._open(e,n)}},_right:function(e){var t=this.active.parent().nextAll("li:eq(0)").children(".ui-menu").eq(0);if(t.length)this._open(e,t);else{var n=this.element.children("li:first").children(".ui-menu:first");this._open(e,n)}}})}(jQuery),function(e){var t=0;e.widget("ui.popup",{version:"1.9m6",options:{position:{my:"left top",at:"left bottom"}},_create:function(){this.options.trigger||(this.options.trigger=this.element.prev()),this.element.attr("id")||(this.element.attr("id","ui-popup-"+t++),this.generatedId=!0),this.element.attr("role")||(this.element.attr("role","dialog"),this.generatedRole=!0),this.options.trigger.attr("aria-haspopup","true").attr("aria-owns",this.element.attr("id")),this.element.addClass("ui-popup"),this.close(),this._bind(this.options.trigger,{keydown:function(t){e.ui.button&&this.options.trigger.is("a:ui-button")&&t.keyCode==e.ui.keyCode.SPACE&&t.preventDefault(),t.keyCode==e.ui.keyCode.SPACE&&this.options.trigger.is("a:not(:ui-button)")&&this.options.trigger.trigger("click",t),t.keyCode==e.ui.keyCode.DOWN&&(t.preventDefault(),this.options.trigger.trigger("click",t))},click:function(e){e.preventDefault();if(this.isOpen)return;clearTimeout(this.closeTimer),this._delay(function(){this.open(e)},1)}}),this.element.is(":ui-menu")||this._bind({keydown:function(t){if(t.keyCode!==e.ui.keyCode.TAB)return;var n=e(":tabbable",this.element),r=n.first(),i=n.last();t.target===i[0]&&!t.shiftKey?(r.focus(1),t.preventDefault()):t.target===r[0]&&t.shiftKey&&(i.focus(1),t.preventDefault())}}),this._bind({focusout:function(e){this.closeTimer=this._delay(function(){this.close(e)},100)},focusin:function(e){clearTimeout(this.closeTimer)}}),this._bind({keyup:function(t){t.keyCode==e.ui.keyCode.ESCAPE&&this.element.is(":visible")&&(this.close(t),this.options.trigger.focus())}}),this._bind(document,{click:function(t){this.isOpen&&!e(t.target).closest(".ui-popup").length&&this.close(t)}})},_destroy:function(){this.element.show().removeClass("ui-popup").removeAttr("aria-hidden").removeAttr("aria-expanded").unbind("keypress.ui-popup"),this.options.trigger.removeAttr("aria-haspopup").removeAttr("aria-owns"),this.generatedId&&this.element.removeAttr("id"),this.generatedRole&&this.element.removeAttr("role")},open:function(t){var n=e.extend({},{of:this.options.trigger},this.options.position);this.element.show().attr("aria-hidden","false").attr("aria-expanded","true").position(n);if(this.element.is(":ui-menu"))this.element.menu("focus",t,this.element.children("li").first()),this.element.focus();else{var r=this.element.find(":tabbable");this.removeTabIndex=!1,r.length||(this.element.is(":tabbable")||(this.element.attr("tabindex","0"),this.removeTabIndex=!0),r=r.add(this.element[0])),r.first().focus(1)}this.options.trigger.attr("tabindex",-1),this.isOpen=!0,this._trigger("open",t)},close:function(e){this.element.hide().attr("aria-hidden","true").attr("aria-expanded","false"),this.options.trigger.attr("tabindex",0),this.removeTabIndex&&this.element.removeAttr("tabindex"),this.isOpen=!1,this._trigger("close",e)}})}(jQuery),function(e,t){e.ui=e.ui||{};var n=/left|center|right/,r=/top|center|bottom/,i=/[+-]\d+%?/,s=/^\w+/,o=/%$/,u="center",a=e.fn.position;e.position={scrollbarWidth:function(){var t,n,r=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),i=r.children()[0];return e("body").append(r),t=i.offsetWidth,r.css("overflow","scroll"),n=i.offsetWidth,t===n&&(n=r[0].clientWidth),r.remove(),t-n},getScrollInfo:function(t){var n=t[0]!==window,r=n?t.css("overflow-x"):"",i=n?t.css("overflow-y"):"",s=r==="auto"||r==="scroll"?e.position.scrollbarWidth():0,o=i==="auto"||i==="scroll"?e.position.scrollbarWidth():0;return{height:t.height()<t[0].scrollHeight?o:0,width:t.width()<t[0].scrollWidth?s:0}}},e.fn.position=function(t){if(!t||!t.of)return a.apply(this,arguments);t=e.extend({},t);var f=e(t.of),l=e(t.within||window),c=f[0],h=(t.collision||"flip").split(" "),p={},d,v,m,g;return c.nodeType===9?(v=f.width(),m=f.height(),g={top:0,left:0}):e.isWindow(c)?(v=f.width(),m=f.height(),g={top:f.scrollTop(),left:f.scrollLeft()}):c.preventDefault?(t.at="left top",v=m=0,g={top:t.of.pageY,left:t.of.pageX}):(v=f.outerWidth(),m=f.outerHeight(),g=f.offset()),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),o,a;e.length===1&&(e=n.test(e[0])?e.concat([u]):r.test(e[0])?[u].concat(e):[u,u]),e[0]=n.test(e[0])?e[0]:u,e[1]=r.test(e[1])?e[1]:u,o=i.exec(e[0]),a=i.exec(e[1]),p[this]=[o?o[0]:0,a?a[0]:0],t[this]=[s.exec(e[0])[0],s.exec(e[1])[0]]}),h.length===1&&(h[1]=h[0]),t.at[0]==="right"?g.left+=v:t.at[0]===u&&(g.left+=v/2),t.at[1]==="bottom"?g.top+=m:t.at[1]===u&&(g.top+=m/2),d=[parseInt(p.at[0],10)*(o.test(p.at[0])?v/100:1),parseInt(p.at[1],10)*(o.test(p.at[1])?m/100:1)],g.left+=d[0],g.top+=d[1],this.each(function(){var n=e(this),r=n.outerWidth(),i=n.outerHeight(),s=parseInt(e.curCSS(this,"marginLeft",!0))||0,a=parseInt(e.curCSS(this,"marginTop",!0))||0,f=e.position.getScrollInfo(l),c=r+s+(parseInt(e.curCSS(this,"marginRight",!0))||0)+f.width,y=i+a+(parseInt(e.curCSS(this,"marginBottom",!0))||0)+f.height,b=e.extend({},g),w=[parseInt(p.my[0],10)*(o.test(p.my[0])?n.outerWidth()/100:1),parseInt(p.my[1],10)*(o.test(p.my[1])?n.outerHeight()/100:1)],E;t.my[0]==="right"?b.left-=r:t.my[0]===u&&(b.left-=r/2),t.my[1]==="bottom"?b.top-=i:t.my[1]===u&&(b.top-=i/2),b.left+=w[0],b.top+=w[1],E={marginLeft:s,marginTop:a},e.each(["left","top"],function(s,o){e.ui.position[h[s]]&&e.ui.position[h[s]][o](b,{targetWidth:v,targetHeight:m,elemWidth:r,elemHeight:i,collisionPosition:E,collisionWidth:c,collisionHeight:y,offset:[d[0]+w[0],d[1]+w[1]],my:t.my,at:t.at,within:l,elem:n})}),e.fn.bgiframe&&n.bgiframe(),n.offset(e.extend(b,{using:t.using}))})},e.ui.position={fit:{left:function(t,n){var r=n.within,i=e(window),s=e.isWindow(n.within[0]),o=s?i.scrollLeft():r.offset().left,u=s?i.width():r.outerWidth(),a=t.left-n.collisionPosition.marginLeft,f=o-a,l=a+n.collisionWidth-u-o,c,h;n.collisionWidth>u?f>0&&l<=0?(c=t.left+f+n.collisionWidth-u-o,t.left+=f-c):l>0&&f<=0?t.left=o:f>l?t.left=o+u-n.collisionWidth:t.left=o:f>0?t.left+=f:l>0?t.left-=l:t.left=Math.max(t.left-a,t.left)},top:function(t,n){var r=n.within,i=e(window),s=e.isWindow(n.within[0]),o=s?i.scrollTop():r.offset().top,u=s?i.height():r.outerHeight(),a=t.top-n.collisionPosition.marginTop,f=o-a,l=a+n.collisionHeight-u-o,c,h;n.collisionHeight>u?f>0&&l<=0?(h=t.top+f+n.collisionHeight-u-o,t.top+=f-h):l>0&&f<=0?t.top=o:f>l?t.top=o+u-n.collisionHeight:t.top=o:f>0?t.top+=f:l>0?t.top-=l:t.top=Math.max(t.top-a,t.top)}},flip:{left:function(t,n){if(n.at[0]===u)return;n.elem.removeClass("ui-flipped-left ui-flipped-right");var r=n.within,i=e(window),s=e.isWindow(n.within[0]),o=(s?0:r.offset().left)+r.scrollLeft(),a=s?r.width():r.outerWidth(),f=t.left-n.collisionPosition.marginLeft,l=f-o,c=f+n.collisionWidth-a-o,h=n.my[0]==="left",p=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,d=n.at[0]==="left"?n.targetWidth:-n.targetWidth,v=-2*n.offset[0],m,g;if(l<0){m=t.left+p+d+v+n.collisionWidth-a-o;if(m<0||m<Math.abs(l))n.elem.addClass("ui-flipped-right"),t.left+=p+d+v}else if(c>0){g=t.left-n.collisionPosition.marginLeft+p+d+v-o;if(g>0||Math.abs(g)<c)n.elem.addClass("ui-flipped-left"),t.left+=p+d+v}},top:function(t,n){if(n.at[1]===u)return;n.elem.removeClass("ui-flipped-top ui-flipped-bottom");var r=n.within,i=e(window),s=e.isWindow(n.within[0]),o=(s?0:r.offset().top)+r.scrollTop(),a=s?r.height():r.outerHeight(),f=t.top-n.collisionPosition.marginTop,l=f-o,c=f+n.collisionHeight-a-o,h=n.my[1]==="top",p=h?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,d=n.at[1]==="top"?n.targetHeight:-n.targetHeight,v=-2*n.offset[1],m,g;if(l<0){g=t.top+p+d+v+n.collisionHeight-a-o;if(g<0||g<Math.abs(l))n.elem.addClass("ui-flipped-bottom"),t.top+=p+d+v}else if(c>0){m=t.top-n.collisionPosition.marginTop+p+d+v-o;if(m>0||Math.abs(m)<c)n.elem.addClass("ui-flipped-top"),t.top+=p+d+v}}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset)return n.call(this,r);var i=r.offset.split(" "),s=r.at.split(" ");return i.length===1&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),s.length===1&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}}(jQuery)}(jQuery),function(e,t){e.widget("ui.progressbar",{version:"1.9m6",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return e===t?this._value():(this._setOption("value",e),this)},_setOption:function(e,t){e==="value"&&(this.options.value=t,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),this._super("_setOption",e,t)},_value:function(){var e=this.options.value;return typeof e!="number"&&(e=0),Math.min(this.options.max,Math.max(this.min,e))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var e=this.value(),t=this._percentage();this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),this.valueDiv.toggle(e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%"),this.element.attr("aria-valuenow",e)}})}(jQuery),function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9m6",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t=this,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>"
,o=r.values&&r.values.length||1,u=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(r.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),r.range&&(r.range===!0&&(r.values||(r.values=[this._valueMin(),this._valueMin()]),r.values.length&&r.values.length!==2&&(r.values=[r.values[0],r.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(r.range==="min"||r.range==="max"?" ui-slider-range-"+r.range:"")));for(var a=i.length;a<o;a+=1)u.push(s);this.handles=i.add(e(u.join("")).appendTo(t.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).hover(function(){r.disabled||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).focus(function(){r.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("index.ui-slider-handle",t)}),this.handles.keydown(function(r){var i=!0,s=e(this).data("index.ui-slider-handle"),o,u,a,f;if(t.options.disabled)return;switch(r.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:i=!1;if(!t._keySliding){t._keySliding=!0,e(this).addClass("ui-state-active"),o=t._start(r,s);if(o===!1)return}}f=t.options.step,t.options.values&&t.options.values.length?u=a=t.values(s):u=a=t.value();switch(r.keyCode){case e.ui.keyCode.HOME:a=t._valueMin();break;case e.ui.keyCode.END:a=t._valueMax();break;case e.ui.keyCode.PAGE_UP:a=t._trimAlignValue(u+(t._valueMax()-t._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:a=t._trimAlignValue(u-(t._valueMax()-t._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(u===t._valueMax())return;a=t._trimAlignValue(u+f);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(u===t._valueMin())return;a=t._trimAlignValue(u-f)}return t._slide(r,s,a),i}).keyup(function(n){var r=e(this).data("index.ui-slider-handle");t._keySliding&&(t._keySliding=!1,t._stop(n,r),t._change(n,r),e(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(t){var n=this.options,r,i,s,o,u,a,f,l,c;return n.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),r={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(r),s=this._valueMax()-this._valueMin()+1,u=this,this.handles.each(function(t){var n=Math.abs(i-u.values(t));s>n&&(s=n,o=e(this),a=t)}),n.range===!0&&this.values(1)===n.min&&(a+=1,o=e(this.handles[a])),f=this._start(t,a),f===!1?!1:(this._mouseSliding=!0,u._handleIndex=a,o.addClass("ui-state-active").focus(),l=o.offset(),c=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-l.left-o.width()/2,top:t.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,a,i),this._animateOff=!0,!0))},_mouseStart:function(e){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t=this.options.range,n=this.options,r=this,i=this._animateOff?!1:n.animate,s,o={},u,a,f,l;this.options.values&&this.options.values.length?this.handles.each(function(t,a){s=(r.values(t)-r._valueMin())/(r._valueMax()-r._valueMin())*100,o[r.orientation==="horizontal"?"left":"bottom"]=s+"%",e(this).stop(1,1)[i?"animate":"css"](o,n.animate),r.options.range===!0&&(r.orientation==="horizontal"?(t===0&&r.range.stop(1,1)[i?"animate":"css"]({left:s+"%"},n.animate),t===1&&r.range[i?"animate":"css"]({width:s-u+"%"},{queue:!1,duration:n.animate})):(t===0&&r.range.stop(1,1)[i?"animate":"css"]({bottom:s+"%"},n.animate),t===1&&r.range[i?"animate":"css"]({height:s-u+"%"},{queue:!1,duration:n.animate}))),u=s}):(a=this.value(),f=this._valueMin(),l=this._valueMax(),s=l!==f?(a-f)/(l-f)*100:0,o[r.orientation==="horizontal"?"left":"bottom"]=s+"%",this.handle.stop(1,1)[i?"animate":"css"](o,n.animate),t==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[i?"animate":"css"]({width:s+"%"},n.animate),t==="max"&&this.orientation==="horizontal"&&this.range[i?"animate":"css"]({width:100-s+"%"},{queue:!1,duration:n.animate}),t==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[i?"animate":"css"]({height:s+"%"},n.animate),t==="max"&&this.orientation==="vertical"&&this.range[i?"animate":"css"]({height:100-s+"%"},{queue:!1,duration:n.animate}))}})}(jQuery),function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.widget("ui.spinner",{version:"1.9m6",defaultElement:"<input>",widgetEventPrefix:"spin",options:{incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._value(this.element.val(),!0),this._draw(),this._bind(this._events),this._refresh()},_getCreateOptions:function(){var t={},n=this.element;return e.each(["min","max","step"],function(e,r){var i=n.attr(r);i!==undefined&&i.length&&(t[r]=i)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.uiSpinner.addClass("ui-state-active"),this.previous=this.element.val()},blur:function(e){this._refresh(),this.uiSpinner.removeClass("ui-state-active"),this.previous!==this.element.val()&&this._trigger("change",e)},mousewheel:function(e,t){if(!t)return;if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=setTimeout(function(){this.spinning&&this._stop(e)},100),e.preventDefault()},"mousedown .ui-spinner-button":function(t){t.preventDefault(),document.activeElement!==this.element[0]&&this.element.focus();if(this._start(t)===!1)return;this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(!e(t.currentTarget).hasClass("ui-state-active"))return;if(this._start(t)===!1)return!1;this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this._hoverable(e),this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()===e.height()&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var n=this.options,r=e.ui.keyCode;switch(t.keyCode){case r.UP:return this._repeat(null,1,t),!0;case r.DOWN:return this._repeat(null,-1,t),!0;case r.PAGE_UP:return this._repeat(null,n.page,t),!0;case r.PAGE_DOWN:return this._repeat(null,-n.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-state-default ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon ui-icon-triangle-1-n'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon ui-icon-triangle-1-s'>&#9660;</span></a>"},_start:function(e){return!this.spinning&&this._trigger("start",e)===!1?!1:(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,n){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,n)},e),this._spin(t*this.options.step,n)},_spin:function(e,t){var n=this.value()||0;this.counter||(this.counter=1),n=this._adjustValue(n+e*this._increment(this.counter));if(!this.spinning||this._trigger("spin",t,{value:n})!==!1)this._value(n),this.counter++},_increment:function(t){var n=this.options.incremental;return n?e.isFunction(n)?n(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return this.options.min!==null&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),n=t.indexOf(".");return n===-1?0:t.length-n-1},_adjustValue:function(e){var t,n,r=this.options;return t=r.min!==null?r.min:0,n=e-t,n=Math.round(n/r.step)*r.step,e=t+n,e=parseFloat(e.toFixed(this._precision())),r.max!==null&&e>r.max?r.max:r.min!==null&&e<r.min?r.min:e},_stop:function(e){if(!this.spinning)return;clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e)},_setOption:function(e,t){this._super("_setOption",e,t),e==="disabled"&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(e){this._super("_setOptions",e),this._value(this.element.val())}),_parse:function(e){return typeof e=="string"&&e!==""&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e):+e),e===""||isNaN(e)?null:e},_format:function(e){return e===""?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var n;e!==""&&(n=this._parse(e),n!==null&&(t||(n=this._adjustValue(n)),e=this._format(n))),this.element.val(e),this._refresh()},destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this._super("destroy"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._spin((e||1)*this.options.step)},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._spin((e||1)*-this.options.step)},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}})}(jQuery),function(e,t){function r(){return++n}var n=0,i=function(){var e=/#.*$/,t=location.href.replace(e,"");return function(n){return n=n.cloneNode(!1),n.hash.length>1&&n.href.replace(e,"")===t}}();e.widget("ui.tabs",{version:"1.9m6",options:{active:null,collapsible:!1,event:"click",fx:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=t.options,r=n.active;t.running=!1,t.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),t._processTabs();if(r===null){location.hash&&t.anchors.each(function(e,t){if(t.hash===location.hash)return r=e,!1}),r===null&&(r=t.lis.filter(".ui-tabs-active").index());if(r===null||r===-1)r=t.lis.length?0:!1}r!==!1&&(r=this.lis.eq(r).index(),r===-1&&(r=n.collapsible?!1:0)),n.active=r,!n.collapsible&&n.active===!1&&this.anchors.length&&(n.active=0),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.lis.filter(".ui-state-disabled"),function(e,n){return t.lis.index(e)}))).sort()),this._setupFx(n.fx),this._refresh(),this.panels.hide(),this.lis.removeClass("ui-tabs-active ui-state-active");if(n.active!==!1&&this.anchors.length){this.active=this._findActive(n.active);var i=t._getPanelForTab(this.active);i.show(),this.lis.eq(n.active).addClass("ui-tabs-active ui-state-active"),this.load(n.active)}else this.active=e()},_setOption:function(e,t){if(e=="active"){this._activate(t);return}if(e==="disabled"){this._setupDisabled(t);return}this._super("_setOption",e,t),e==="collapsible"&&!t&&this.options.active===!1&&this._activate(0),e==="event"&&this._setupEvents(t),e==="fx"&&this._setupFx(t)},_tabId:function(t){return e(t).attr("aria-controls")||"ui-tabs-"+r()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@[\]^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this,n=this.options,r=this.list.children(":has(a[href])");n.disabled=e.map(r.filter(".ui-state-disabled"),function(e){return r.index(e)}),this._processTabs(),this._refresh(),this.panels.not(this._getPanelForTab(this.active)).hide();if(n.active===!1||!this.anchors.length)n.active=!1,this.active=e();else if(this.active.length&&!e.contains(this.list[0],this.active[0])){var i=n.active-1;this._activate(i>=0?i:0)}else n.active=this.anchors.index(this.active)},_refresh:function(){var e=this.options;this.element.toggleClass("ui-tabs-collapsible",e.collapsible),this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),this._setupDisabled(e.disabled),this._setupEvents(e.event),this.lis.unbind(".tabs"),this._focusable(this.lis),this._hoverable(this.lis)},_processTabs:function(){var t=this;this.list=this.element.find("ol,ul").eq(0),this.lis=e(" > li:has(a[href])",this.list),this.anchors=this.lis.map(function(){return e("a",this)[0]}),this.panels=e([]),this.anchors.each(function(n,r){var s,o;if(i(r))s=r.hash,o=t.element.find(t._sanitizeSelector(s));else{var u=t._tabId(r);s="#"+u,o=t.element.find(s),o.length||(o=t._createPanel(u),o.insertAfter(t.panels[n-1]||t.list))}o.length&&(t.panels=t.panels.add(o)),e(r).attr("aria-controls",s.substring(1))})},_createPanel:function(t){return e("<div></div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("destroy.tabs",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n=0,r;r=this.lis[n];n++)e(r).toggleClass("ui-state-disabled",t===!0||e.inArray(n,t)!==-1);this.options.disabled=t},_setupFx:function(t){t&&(e.isArray(t)?(this.hideFx=t[0],this.showFx=t[1]):this.hideFx=this.showFx=t)},_resetStyle:function(t,n){!e.support.opacity&&n.opacity&&t[0].style.removeAttribute("filter")},_setupEvents:function(t){this.anchors.unbind(".tabs"),t&&this.anchors.bind(t.split(" ").join(".tabs ")+".tabs",e.proxy(this,"_eventHandler")),this.anchors.bind("click.tabs",function(e){e.preventDefault()})},_eventHandler:function(t){var n=this,r=n.options,i=n.active,s=e(t.currentTarget),o=s[0]===i[0],u=o&&r.collapsible,a=u?e():n._getPanelForTab(s),f=i.length?n._getPanelForTab(i):e(),l=s.closest("li"),c={oldTab:i,oldPanel:f,newTab:u?e():s,newPanel:a};t.preventDefault();if(l.hasClass("ui-state-disabled")||l.hasClass("ui-tabs-loading")||n.running||o&&!r.collapsible||n._trigger("beforeActivate",t,c)===!1){s[0].blur();return}r.active=u?!1:n.anchors.index(s),n.active=o?e():s,n.xhr&&n.xhr.abort();if(!f.length&&!a.length)throw"jQuery UI Tabs: Mismatching fragment identifier.";a.length&&(n.load(n.anchors.index(s),t),s[0].blur()),n._toggle(t,c)},_toggle:function(t,n){function u(){r.running=!1,r._trigger("activate",t,n)}function a(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&r.showFx?s.animate(r.showFx,r.showFx.duration||"normal",function(){r._resetStyle(e(this),r.showFx),u()}):(s.show(),u())}var r=this,i=r.options,s=n.newPanel,o=n.oldPanel;r.running=!0,o.length&&r.hideFx?o.animate(r.hideFx,r.hideFx.duration||"normal",function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r._resetStyle(e(this),r.hideFx),a()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o.hide(),a())},_activate:function(t){var n=this._findActive(t)[0];if(n===this.active[0])return;n=n||this.active[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop})},_findActive:function(t){return typeof t=="number"?this.anchors.eq(t):typeof t=="string"?this.anchors.filter("[href$='"+t+"']"):e()},_getIndex:function(e){return typeof e=="string"&&(e=this.anchors.index(this.anchors.filter("[href$="+e+"]"))),e},_destroy:function(){var t=this.options;return this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.anchors.unbind(".tabs").removeData("href.tabs").removeData("load.tabs"),this.lis.unbind(".tabs").add(this.panels).each(function(){e.data(this,"destroy.tabs")?e(this).remove():e(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-active","ui-state-active","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom"].join(" "))}),this},enable:function(n){var r=this.options.disabled;if(r===!1)return;n===t?r=!1:(n=this._getIndex(n),e.isArray(r)?r=e.map(r,function(e){return e!==n?e:null}):r=e.map(this.lis,function(e,t){return t!==n?t:null})),this._setupDisabled(r)},disable:function(n){var r=this.options.disabled;if(r===!0)return;if(n===t)r=!0;else{n=this._getIndex(n);if(e.inArray(n,r)!==-1)return;e.isArray(r)?r=e.merge([n],r).sort():r=[n]}this._setupDisabled(r)},load:function(t,n){t=this._getIndex(t);var r=this,s=this.options,o=this.anchors.eq(t),u=r._getPanelForTab(o),a={tab:o,panel:u};if(i(o[0]))return;return this.xhr=e.ajax({url:o.attr("href"),beforeSend:function(t,i){return r._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:i},a))}}),this.xhr&&(this.lis.eq(t).addClass("ui-tabs-loading"),this.xhr.success(function(e){u.html(e),r._trigger("load",n,a)}).complete(function(e,n){n==="abort"&&r.panels.stop(!1,!0),r.lis.eq(t).removeClass("ui-tabs-loading"),e===r.xhr&&delete r.xhr})),this},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}});if(e.uiBackCompat!==!1){e.ui.tabs.prototype._ui=function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)}},function(e,t){t.url=function(e,t){this.anchors.eq(e).attr("href",t)}}(jQuery,jQuery.ui.tabs.prototype),function(e,t){e.extend(t.options,{ajaxOptions:null,cache:!1});var n=t._create,r=t._setOption,i=t._destroy,s=t.url||e.noop;e.extend(t,{_create:function(){n.call(this);var t=this;this.element.bind("tabsbeforeload.tabs",function(n,r){if(e.data(r.tab[0],"cache.tabs")){n.preventDefault();return}e.extend(r.ajaxSettings,t.options.ajaxOptions,{error:function(e,n,i){try{t.options.ajaxOptions.error(e,n,r.tab.closest("li").index(),r.tab[0])}catch(i){}}}),r.jqXHR.success(function(){t.options.cache&&e.data(r.tab[0],"cache.tabs",!0)})})},_setOption:function(e,t){e==="cache"&&t===!1&&this.anchors.removeData("cache.tabs"),r.apply(this,arguments)},_destroy:function(){this.anchors.removeData("cache.tabs"),i.call(this)},url:function(e,t){this.anchors.eq(e).removeData("cache.tabs"),s.apply(this,arguments)}})}(jQuery,jQuery.ui.tabs.prototype),function(e,t){t.abort=function(){this.xhr&&this.xhr.abort()}}(jQuery,jQuery.ui.tabs.prototype),e.widget("ui.tabs",e.ui.tabs,{options:{spinner:"<em>Loading&#8230;</em>"},_create:function(){this._super("_create"),this._bind({tabsbeforeload:function(e,t){if(!this.options.spinner)return;var n=t.tab.find("span"),r=n.html();n.html(this.options.spinner),t.jqXHR.complete(function(){n.html(r)})}})}}),function(e,t){e.extend(t.options,{enable:null,disable:null});var n=t.enable,r=t.disable;t.enable=function(t){var r=this.options,i;if(t&&r.disabled===!0||e.isArray(r.disabled)&&e.inArray(t,r.disabled)!==-1)i=!0;n.apply(this,arguments),i&&this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t]))},t.disable=function(t){var n=this.options,i;if(t&&n.disabled===!1||e.isArray(n.disabled)&&e.inArray(t,n.disabled)===-1)i=!0;r.apply(this,arguments),i&&this._trigger("disable",null,this._ui(this.anchors[t],this.panels[t]))}}(jQuery,jQuery.ui.tabs.prototype),function(e,n){e.extend(n.options,{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"}),n.add=function(n,r,i){i===t&&(i=this.anchors.length);var s=this.options,o=e(s.tabTemplate.replace(/#\{href\}/g,n).replace(/#\{label\}/g,r)),u=n.indexOf("#")?this._tabId(o.find("a")[0]):n.replace("#","");o.addClass("ui-state-default ui-corner-top").data("destroy.tabs",!0),o.find("a").attr("aria-controls",u);var a=i>=this.lis.length,f=this.element.find("#"+u);return f.length||(f=this._createPanel(u),a?i>0?f.insertAfter(this.panels.eq(-1)):f.appendTo(this.element):f.insertBefore(this.panels[i])),f.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide(),a?o.appendTo(this.list):o.insertBefore(this.lis[i]),s.disabled=e.map(s.disabled,function(e){return e>=i?++e:e}),this.refresh(),this.lis.length===1&&s.active===!1&&this.option("active",0),this._trigger("add",null,this._ui(this.anchors[i],this.panels[i])),this},n.remove=function(t){t=this._getIndex(t);var n=this.options,r=this.lis.eq(t).remove(),i=this._getPanelForTab(r.find("a[aria-controls]")).remove();return r.hasClass("ui-tabs-active")&&this.anchors.length>2&&this._activate(t+(t+1<this.anchors.length?1:-1)),n.disabled=e.map(e.grep(n.disabled,function(e){return e!==t}),function(e){return e>=t?--e:e}),this.refresh(),this._trigger("remove",null,this._ui(r.find("a")[0],i[0])),this}}(jQuery,jQuery.ui.tabs.prototype),function(e,t){t.length=function(){return this.anchors.length}}(jQuery,jQuery.ui.tabs.prototype),function(e,t){e.extend(t.options,{idPrefix:"ui-tabs-"});var n=t._tabId;t._tabId=function(t){return e(t).attr("aria-controls")||t.title&&t.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+r()}}(jQuery,jQuery.ui.tabs.prototype),function(e,t){e.extend(t.options,{panelTemplate:"<div></div>"});var n=t._createPanel;t._createPanel=function(t){return e(this.options.panelTemplate).attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("destroy.tabs",!0)}}(jQuery,jQuery.ui.tabs.prototype),function(e,n){var r=n._create,i=n._setOption,s=n._eventHandler;n._create=function(){var e=this.options;e.active===null&&e.selected!==t&&(e.active=e.selected===-1?!1:e.selected),r.call(this),e.selected=e.active,e.selected===!1&&(e.selected=-1)},n._setOption=function(e,t){if(e!=="selected")return i.apply(this,arguments);var n=this.options;i.call(this,"active",t===-1?!1:t),n.selected=n.active,n.selected===!1&&(n.selected=-1)},n._eventHandler=function(e){s.apply(this,arguments),this.options.selected=this.options.active,this.options.selected===!1&&(this.options.selected=-1)}}(jQuery,jQuery.ui.tabs.prototype),function(e,t){e.extend(t.options,{show:null,select:null});var n=t._create,r=t._trigger;t._create=function(){n.call(this),this.options.active!==!1&&this._trigger("show",null,this._ui(this.active[0],this._getPanelForTab(this.active)[0]))},t._trigger=function(e,t,n){var i=r.apply(this,arguments);if(!i)return!1;e==="beforeActivate"&&n.newTab.length?i=r.call(this,"select",t,{tab:n.newTab[0],panel:n.newPanel[0],index:n.newTab.closest("li").index()}):e==="activate"&&n.newTab.length&&(i=r.call(this,"show",t,{tab:n.newTab[0],panel:n.newPanel[0],index:n.newTab.closest("li").index()}))}}(jQuery,jQuery.ui.tabs.prototype),function(e,t){t.select=function(e){e=this._getIndex(e);if(e===-1){if(!this.options.collapsible||this.options.selected===-1)return;e=this.options.selected}this.anchors.eq(e).trigger(this.options.event+".tabs")}}(jQuery,jQuery.ui.tabs.prototype);var s=0;function o(){return++s}e.widget("ui.tabs",e.ui.tabs,{options:{cookie:null},_create:function(){var e=this.options,t;e.active==null&&e.cookie&&(t=parseInt(this._cookie(),10),t===-1&&(t=!1),e.active=t),this._super("_create")},_cookie:function(t){var n=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+o())];return arguments.length&&(n.push(t===!1?-1:t),n.push(this.options.cookie)),e.cookie.apply(null,n)},_refresh:function(){this._super("_refresh"),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_eventHandler:function(e){this._superApply("_eventHandler",arguments),this.options.cookie&&this._cookie(this.options.active,this.options.cookie)},_destroy:function(){this._super("_destroy"),this.options.cookie&&this._cookie(null,this.options.cookie)}}),e.widget("ui.tabs",e.ui.tabs,{_trigger:function(t,n,r){var i=e.extend({},r);return t==="load"&&(i.panel=i.panel[0],i.tab=i.tab[0]),this._super("_trigger",t,n,i)}})}}(jQuery),function(e){var t=0;e.widget("ui.tooltip",{version:"1.9m6",options:{content:function(){return e(this).attr("title")},hide:!0,items:"[title]",position:{my:"left+15 center",at:"right center",collision:"flipfit flipfit"},show:!0,tooltipClass:null,close:null,open:null},_create:function(){this._bind({mouseover:"open",focusin:"open"}),this.tooltips={}},_setOption:function(e,t){if(e==="disabled"){this[t?"_disable":"_enable"](),this.options[e]=t;return}this._super("_setOption",e,t)},_disable:function(){var t=this;e.each(this.tooltips,function(n,r){var i=e.Event("blur");i.target=i.currentTarget=r[0],t.close(i,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is("[title]")&&t.data("tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data("tooltip-title")&&t.attr("title",t.data("tooltip-title"))})},open:function(t){var n,r=this,i=e(t?t.target:this.element).closest(this.options.items);if(!i.length||i.attr("aria-describedby"))return;i.data("tooltip-title")||i.data("tooltip-title",i.attr("title")),n=this.options.content.call(i[0],function(e){setTimeout(function(){r._open(t,i,e)},1)}),n&&r._open(t,i,n)},_open:function(t,n,r){if(!r)return;n.is("[title]")&&n.attr("title","");var i=this._find(n);i.length||(i=this._tooltip(n),n.attr("aria-describedby",i.attr("id"))),i.find(".ui-tooltip-content").html(r),i.stop(!0).position(e.extend({of:n},this.options.position)).hide(),this._show(i,this.options.show),this._trigger("open",t,{tooltip:i}),this._bind(n,{mouseleave:"close",blur:"close",keyup:function(t){if(t.keyCode==e.ui.keyCode.ESCAPE){var r=e.Event(t);r.currentTarget=n[0],this.close(r,!0)}}})},close:function(t,n){var r=this,i=e(t?t.currentTarget:this.element),s=this._find(i);if(!n&&document.activeElement===i[0])return;i.data("tooltip-title")&&i.attr("title",i.data("tooltip-title")),i.removeAttr("aria-describedby"),s.stop(!0),this._hide(s,this.options.hide,function(){e(this).remove(),delete r.tooltips[this.id]}),i.unbind("mouseleave.tooltip blur.tooltip keyup.tooltip"),this._trigger("close",t,{tooltip:s})},_tooltip:function(n){var r="ui-tooltip-"+t++,i=e("<div>").attr({id:r,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(document.body),e.fn.bgiframe&&i.bgiframe(),this.tooltips[r]=n,i},_find:function(t){var n=t.attr("aria-describedby");return n?e("#"+n):e()},_destroy:function(){e.each(this.tooltips,function(t){e("#"+t).remove()})}})}(jQuery),jQuery.ui}),define("ui/subguarded",["aloha/core","jquery","PubSub"],function(e,t,n){function o(e){return e.alohaUid||(e.alohaUid=++r),e.alohaUid}function u(e){return s[e]||[]}function a(e){return i[e.alohaUid]||[]}function f(e,t){return i[e.alohaUid]||(i[e.alohaUid]=[]),i[e.alohaUid].push(t),i[e.alohaUid]}function l(e,t){return s[e]||(s[e]=[]),s[e].push(t),s[e]}function c(e){var t=u(e),n;for(n=0;n<t.length;n++)t[n].apply(null,[a(t[n])].concat(arguments))}function h(){var t=Array.prototype.slice.call(arguments),r=t.shift();typeof r=="string"&&(r=[r]);var i=t.shift();o(i),f(i,t);var s,u,a=function(e,t,n){c(u,e,t,n)},h=function(){c(u)};for(s=0;s<r.length;s++)u=r[s],l(u,i),e.bind(u,a),n.sub(u,h)}var r=0,i={},s={};return h}),define("vendor/amplify.store",["util/json2"],function(){var e={};return function(e,t){function i(e,i){n.addType(e,function(s,o,u){var a,f,l,c,h=o,p=(new Date).getTime();if(!s){h={},c=[],l=0;try{s=i.length;while(s=i.key(l++))r.test(s)&&(f=JSON.parse(i.getItem(s)),f.expires&&f.expires<=p?c.push(s):h[s.replace(r,"")]=f.data);while(s=c.pop())i.removeItem(s)}catch(d){}return h}s="__amplify__"+s;if(o===t){a=i.getItem(s),f=a?JSON.parse(a):{expires:-1};if(!(f.expires&&f.expires<=p))return f.data;i.removeItem(s)}else if(o===null)i.removeItem(s);else{f=JSON.
stringify({data:o,expires:u.expires?p+u.expires:null});try{i.setItem(s,f)}catch(d){n[e]();try{i.setItem(s,f)}catch(d){throw n.error()}}}return h})}var n=e.store=function(e,t,r,i){var i=n.type;return r&&r.type&&r.type in n.types&&(i=r.type),n.types[i](e,t,r||{})};n.types={},n.type=null,n.addType=function(e,t){n.type||(n.type=e),n.types[e]=t,n[e]=function(t,r,i){return i=i||{},i.type=e,n(t,r,i)}},n.error=function(){return"amplify.store quota exceeded"};var r=/^__amplify__/;for(var s in{localStorage:1,sessionStorage:1})try{window[s].getItem&&i(s,window[s])}catch(o){}if(window.globalStorage)try{i("globalStorage",window.globalStorage[window.location.hostname]),n.type==="sessionStorage"&&(n.type="globalStorage")}catch(o){}(function(){if(n.types.localStorage)return;var e=document.createElement("div"),r="amplify";e.style.display="none",document.getElementsByTagName("head")[0].appendChild(e);try{e.addBehavior("#default#userdata"),e.load(r)}catch(i){e.parentNode.removeChild(e);return}n.addType("userData",function(i,s,o){e.load(r);var u,a,f,l,c,h=s,p=(new Date).getTime();if(!i){h={},c=[],l=0;while(u=e.XMLDocument.documentElement.attributes[l++])a=JSON.parse(u.value),a.expires&&a.expires<=p?c.push(u.name):h[u.name]=a.data;while(i=c.pop())e.removeAttribute(i);return e.save(r),h}i=i.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(s===t){u=e.getAttribute(i),a=u?JSON.parse(u):{expires:-1};if(!(a.expires&&a.expires<=p))return a.data;e.removeAttribute(i)}else s===null?e.removeAttribute(i):(f=e.getAttribute(i),a=JSON.stringify({data:s,expires:o.expires?p+o.expires:null}),e.setAttribute(i,a));try{e.save(r)}catch(d){f===null?e.removeAttribute(i):e.setAttribute(i,f),n.userData();try{e.setAttribute(i,a),e.save(r)}catch(d){throw f===null?e.removeAttribute(i):e.setAttribute(i,f),n.error()}}return h})})(),function(){function i(e){return e===t?t:JSON.parse(JSON.stringify(e))}var e={},r={};n.addType("memory",function(n,s,o){return n?s===t?i(e[n]):(r[n]&&(clearTimeout(r[n]),delete r[n]),s===null?(delete e[n],null):(e[n]=s,o.expires&&(r[n]=setTimeout(function(){delete e[n],delete r[n]},o.expires)),s)):i(e)})}()}(e),e}),define("ui/floating",["jquery","aloha/core","ui/surface","ui/subguarded","vendor/amplify.store"],function(e,t,n,r,i){function a(e,t,n,r){e.stop().animate(t,n,function(){r(t)})}function f(e,t,n,r){t.top-=e.height()+s,a(e,t,n,r)}function l(e,t,n,r){t.top+=s,a(e,t,n,r)}function c(e){i.store("Aloha.FloatingMenu.pinned","true"),i.store("Aloha.FloatingMenu.top",e.top),i.store("Aloha.FloatingMenu.left",e.left)}function h(){i.store("Aloha.FloatingMenu.pinned",null),i.store("Aloha.FloatingMenu.top",null),i.store("Aloha.FloatingMenu.left",null)}function p(){var e={};return i.store("Aloha.FloatingMenu.pinned")==="true"?{top:parseInt(i.store("Aloha.FloatingMenu.top"),10),left:parseInt(i.store("Aloha.FloatingMenu.left"),10),isPinned:!0}:{top:null,left:null,isPinned:!1}}function d(e){var t=e.left,n=e.top;return n<0?n=0:n>u.height()&&(n=u.height()/2),t<0?t=0:t>u.width()&&(t=u.width()/2),{top:n,left:t}}function v(t,n,r,i){typeof r!="number"&&(r=o);var a=(parseInt(e("body").css("marginTop"),10)||0)+(parseInt(e("body").css("paddingTop"),10)||0),c=t.$element,h=c.offset(),p=n.obj.offset(),d=u.scrollTop(),v=p.top-d-a,m=p.left,g=m+c.width()-u.width()-s;g>0&&(m-=g),v>=c.height()?(p.top-=d,f(c,p,r,i)):v+c.height()>p.top+n.obj.height()?l(c,{top:p.top+n.obj.height(),left:m},r,i):l(c,{top:a,left:m},r,i)}function m(e,t,n){var r=e.$element;n?(h(),r.find(".aloha-ui-pin").removeClass("aloha-ui-pin-down")):(c(t),r.find(".aloha-ui-pin").addClass("aloha-ui-pin-down")),r.css({position:"fixed",top:t.top})}function g(e,t,n,r,i){var s;for(s=0;s<e.length;s++)e[s][0].isActive()&&e[s][1](n,r,i)}function y(t,n){r(["aloha-selection-changed","aloha.ui.container.selected"],g,t,function(){t._move()});var i=function(){var e=d({top:n.pinTop,left:n.pinLeft});n.setFloatingPosition(e),t.$element.css({top:e.top,left:e.left})};u.scroll(function(){t._move(0)}),u.resize(function(){n.isFloatingMode||i()}),t.addPin();if(e.browser.msie){var s=t.$element.parent();t.$element.appendTo("body"),t.$element.css("position","fixed"),s.length?t.$element.appendTo(s):t.$element.detach()}else t.$element.css("position","fixed");n.isFloatingMode||i(),t.$element.css("z-index",10100).draggable({distance:20,stop:function(e,t){n.setFloatingPosition(t.position),n.isFloatingMode||c(t.position)}})}var s=10,o=500,u=e(window);return{getPinState:p,makeFloating:y,floatSurface:v,togglePinSurface:m}}),function(){function t(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function n(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s))&&n.push(s)}function r(e,t,n){var i;for(i in t)t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)?e[i]=t[i]:typeof t[i]=="object"&&r(e[i],t[i],n)}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config();return{version:"2.0.1",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";l[5]?(c=l[1],f=c+p):(f=i,p=l[4],h=s.locale,h||(h=s.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),d=h.split("-"));if(a.isBuild){v.push(f),n(o,"root",v,c,p);for(g=0;g<d.length;g++)y=d[g],b+=(b?"-":"")+y,n(o,b,v,c,p);o(v,function(){u()})}else o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++)i=d[g],b+=(b?"-":"")+i,t(b,e,n,v,c,p);o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t],i=e[s];if(i===!0||i===1)i=o(c+s+"/"+p);r(m,i)}m.t=function(e,t){return this[e]?this[e]:t?t:e},u(m)})})}}})}(),define("ui/nls/i18n",{root:{"button.bold.label":"Bold","button.italic.label":"Italic","button.strikethrough.label":"Strikethrough","button.subscript.label":"Subscript","button.superscript.label":"Superscript","button.underline.label":"Underline","button.p.label":"Paragraph","button.h1.label":"Heading 1","button.h2.label":"Heading 2","button.h3.label":"Heading 3","button.h4.label":"Heading 4","button.h5.label":"Heading 5","button.h6.label":"Heading 6","button.pre.label":"Preformatted text","button.removeFormatting.label":"Remove formatting","button.ol.label":"Insert ordered list","button.ul.label":"Insert unordered list","button.indent.label":"Indent list","button.outdent.label":"Outdent list","button.createLink.label":"Insert link","button.removeLink.label":"Remove link","button.createAbbr.label":"Insert abbreviation","button.characterPicker.label":"Pick special characters","button.justifyLeft.label":"Align to the left","button.justifyRight.label":"Align to the right","button.justifyCenter.label":"Center","button.justifyFull.label":"Justify","button.horizontalRule.label":"Insert horizontal rule","button.createLanguageAnnotation.label":"Insert language annotation","button.metaview.label":"Switch between meta and normal view","button.quote.label":"Format selection as quote","button.blockquote.label":"Format selection as blockquote"},de:!0}),define("util/maps",[],function(){function e(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function t(e,t,n){var r=t.length;while(r--)e[t[r]]=n;return e}function n(e,t){var n=t.length,r;while(n--)r=t[n],e[r[0]]=r[1];return e}return{isEmpty:e,fillTuples:n,fillKeys:t}}),define("util/functions",[],function(){return{identity:function(e){return e}}}),define("util/trees",["jquery","util/functions"],function(e,t){function n(t,n,r){var i=e.type(t),s;if("array"===i){s=[];for(var o=0,u=t.length;o<u;o++)n(t[o],s.length,s)}else if("object"===i){s={};for(var a in t)t.hasOwnProperty(a)&&n(t[a],a,s)}else s=r(t);return s}function r(e,t,n){var r;if(1===e.nodeType){var i=e.cloneNode(!1),s=e.firstChild,o=[];while(s)t(s,0,o),0!==o.length&&i.appendChild(o[0]),s=s.nextSibling;r=i}else r=n(e.cloneNode(!0));return r}function i(e,t,n,r,i,s,o){s[i]=o(t(e),r,n)}function s(e,t,n,r,i,s,o){s[i]=t(o(e,r,n))}function o(e,t,n,r,i,s,o){t(e)||(s[i]=o(e,r,n))}function u(e,t,n,r,i,s,o){var u=o(e,r,n);t(u)||(s[i]=u)}function a(e,t,n,r,i){var s=[null];return function o(e,s,u){r(e,t,n,o,s,u,i)}(e,0,s),s[0]}return{prewalk:function(e,r,s){return a(e,r,s||t.identity,i,n)},postwalk:function(e,r,i){return a(e,r,i||t.identity,s,n)},preprune:function(e,r,i){return a(e,r,i||t.identity,o,n)},postprune:function(e,r,i){return a(e,r,i||t.identity,u,n)},leaves:function(e,r){return a(e,t.identity,r,s,n)},prepruneNodes:function(e,n,i){return a(e,n,i||t.identity,o,r)},postpruneNodes:function(e,n,i){return a(e,n,i||t.identity,u,r)},flatten:function(e){var r=[];return a(e,t.identity,function(e){r.push(e)},s,n),r}}}),define("ui/settings",["jquery","util/arrays","util/maps","util/trees"],function(e,t,n,r){function s(r,i,s){function c(t){return"array"===e.type(t)?!t.length:l[t]}var f=n.fillTuples({},t.map(i,function(e){return[e.label,e]})),l=a(r,s);return r=u(r,f,c),i=o(i,l,c),r.concat(i)}function o(t,n,i){var s,o,u=[],a,f;for(s=0;s<t.length;s++)a=t[s],n[a.label]||(f=r.postprune(a.components,i),f&&(o=e.extend({},a),o.components=f,u.push(o)));return u}function u(t,n,i){var s,o,u=[],a,f,l,c;for(s=0;s<t.length;s++)a=t[s],f=a.components||[],l=n[a.label],!a.exclusive&&l&&(c=r.postprune(l.components,i),c&&(f=f.concat(c))),o=e.extend({},l||{},a),o.components=f,u.push(o);return u}function a(e,t){var i,s=n.fillKeys({},t,!0);for(i=0;i<e.length;i++)s[e[i].label]=!0,n.fillKeys(s,r.flatten(e[i].components),!0);return s}var i={tabs:[{label:"Format",showOn:{scope:"Aloha.continuoustext"},components:[["bold","strong","italic","emphasis","\n","subscript","superscript","strikethrough","quote"],["formatLink","formatAbbr","formatNumeratedHeaders","\n","toggleMetaView","wailang","toggleFormatlessPaste","\n","toggleDragDrop"],["alignLeft","alignCenter","alignRight","alignJustify","\n","orderedList","unorderedList","indentList","outdentList"],["formatBlock"]]},{label:"Insert",showOn:{scope:"Aloha.continuoustext"},components:[["createTable","characterPicker","insertLink","insertImage","insertAbbr","insertToc","insertHorizontalRule","insertTag"]]},{label:"Link",showOn:{scope:"link"},components:["editLink","removeLink","linkBrowser"]},{label:"Image",showOn:{scope:"image"},components:[["imageSource","imageTitle","imageAlignLeft","imageAlignRight","imageAlignNone","imageIncPadding","imageDecPadding","imageBrowser","imageCropButton","imageCnrReset","imageCnrRatio","imageResizeWidth","imageResizeHeight"]]},{label:"Abbreviation",showOn:{scope:"abbr"},components:[["abbrText"]]},{label:"Wailang",showOn:{scope:"wai-lang"},components:[["wailangfield","removewailang"]]},{label:"Table",showOn:{scope:"table.cell"},components:[["mergecells","splitcells","tableCaption","tableSummary","formatTable"]]},{label:"Column",showOn:{scope:"table.column"},components:[["addcolumnleft","addcolumnright","deletecolumns","columnheader","mergecellsColumn","splitcellsColumn","formatColumn"]]},{label:"Row",showOn:{scope:"table.row"},components:[["addrowbefore","addrowafter","deleterows","rowheader","mergecellsRow","splitcellsRow","formatRow"]]}]};return{defaultToolbarSettings:i,combineToolbarSettings:s}}),define("ui/ui-plugin",["jquery","aloha","ui/context","ui/container","ui/surface","ui/toolbar","ui/scopes","ui/settings","PubSub","jqueryui"],function(e,t,n,r,i,s,o,u,a){function c(){var e=t.settings.toolbar,n=u.defaultToolbarSettings;return e?u.combineToolbarSettings(e.tabs||[],n.tabs,e.exclude||[]):n.tabs}function h(){var t=l._tabs,n=o.getPrimaryScope(),r,i;for(i=0;i<t.length;i++){r=t[i].settings;if("object"===e.type(r.showOn)&&r.showOn.scope===n){t[i].tab.foreground();break}}}function p(e,t){return l.adoptInto(e,t)}function d(e){i.show(f),r.showContainersForContext(f,e)}var f=new n,l=new s(f,c());return t.bind("aloha-editable-activated",function(e,t){i.show(f),r.showContainersForContext(f,e)}),t.bind("aloha-editable-deactivated",function(e,t){i.suppressHide||i.hide(f)}),a.sub("aloha.ui.scope.change",function(){r.showContainersForContext(f),h(o.getPrimaryScope())}),{adoptInto:p,showToolbar:d}}),define("ui/ui",["jquery","ui/ui-plugin"],function(e,t){function r(r,i,s){var o,u;return"string"!==e.type(r)&&(s=i,i=r,r=s.name),i.isInstance?u=i:(o=s?i.extend(s):i,u=new o),n[r]=u,t.adoptInto(r,u),u}function i(e){return n[e]||null}var n={};return{adopt:r,getAdoptedComponent:i}}),define("ui/vendor/jquery-ui-autocomplete-html",["jquery","jqueryui"],function(e){(function(e){function r(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(t){return r.test(e("<div>").html(t.label||t.value||t).text())})}var t=e.ui.autocomplete.prototype,n=t._initSource;e.extend(t,{_initSource:function(){this.options.html&&e.isArray(this.options.source)?this.source=function(e,t){t(r(this.options.source,e.term))}:n.call(this)},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>")[this.options.html?"html":"text"](n.label)).appendTo(t)}})})(e)}),define("ui/port-helper-attribute-field",["jquery","ui/ui","ui/component","ui/scopes","ui/context","aloha/repositorymanager","aloha/selection","aloha/console","ui/vendor/jquery-ui-autocomplete-html"],function(e,t,n,r,i,s,o,u){var a=function(r){function w(e,t){t.item&&H(t.item.obj),N()}function E(){N()}function S(t,n){if(!e(t.target).is(":visible"))return;C(),D()===l&&P("")}function x(e){(e.keyCode==13||e.keyCode==27)&&e.preventDefault()}function T(e){v&&m!==D()&&(v=null,m=null),v||j(y,D());if(e.keyCode==13||e.keyCode==27)o.getRangeObject().select(),N()}function N(){k();if(!g||b===e(g).attr(y))return;v||s.markObject(g),D()===""&&A()}function C(){if(c)return;var t=e(g);t&&t.context&&t.context.style&&t.context.style["background-color"]&&t.attr("data-original-background-color",t.context.style["background-color"]),t.css("background-color","#80B5F2")}function k(){if(c)return;var t=e(g),n=t.attr("data-original-background-color");n?t.css("background-color",n):t.css("background-color",""),t.removeAttr("data-original-background-color")}function L(e,t){return e.replace(/\{([^}]+)\}/g,function(e,n){return n in t?t[n]:""})}function A(){if(null==l)return;h.css("color","#AAA"),h.val(l)}function O(e){d=e}function M(e){f=e}function _(t,n){h.bind(t,e.proxy(n,J))}function D(){return h.val()}function P(e){h.val(e),h.css("color","black")}function H(e){v=e;if(e){var t=e[a];P(t),m=t,j(y,e[u]),s.markObject(g,e)}else m=null}function B(){return v}function j(t,n,r,i){if(g){var s=!0;if(typeof i!="undefined"){var o=new RegExp(r);i.match(o)||(s=!1)}s?e(g).attr(t,n):e(g).removeAttr(t)}}function F(t,n){g=t,y=n,H(null);if(!t||!n){P("");return}b=e(t).attr(n),P(e(g).attr(y)),s.getObject(t,function(e){e&&e.length>0&&H(e[0])})}function I(){return g}function q(){p.focus(),h.focus()}function R(){p.foreground()}function U(){h.show()}function z(){h.hide()}function W(){return h.attr("id")}function X(){return!0}function V(){return h[0]}var u=r.valueField||"id",a=r.displayField||"name",f=r.objectTypeFilter||["all"],l=r.placeholder,c=!!r.noTargetHighlight,h=e('<input id="aloha-attribute-field-'+r.name+'">'),p,d,v,m,g,y,b;r.cls&&h.addClass(r.cls),r.width&&h.width(r.width),p=t.adopt(r.name,n,{init:function(){this.element=e("<span>").append(h),h.autocomplete({html:!0,appendTo:i.selector,source:function(t,n){s.query({queryString:t.term,objectTypeFilter:f},function(t){n(e.map(t.items,function(e){return{label:L(d,e),value:e.name,obj:e}}))})},select:w})},scope:r.scope}),h.bind("focus",S).bind("blur",E).bind("keydown",x).bind("keyup",T),A();var J={getInputElem:V,hasInputElem:X,getInputId:W,hide:z,show:U,foreground:R,focus:q,getTargetObject:I,setTargetObject:F,setAttribute:j,getItem:B,setItem:H,setValue:P,getValue:D,addListener:_,setObjectTypeFilter:M,setTemplate:O,setPlaceholder:A};return J};return a}),define("ui/button",["jquery","ui/component","ui/utils","jqueryui"],function(e,t,n){var r=t.extend({init:function(){this._super(),this.createButtonElement(),n.makeButton(this.buttonElement,this).button("widget").tooltip({tooltipClass:"aloha aloha-ui-tooltip",position:{my:"left top",at:"right bottom"}}).click(e.proxy(function(){this.buttonElement.tooltip("close",null,!0),this._onClick()},this))},_onClick:function(){this.click()},click:function(){},createButtonElement:function(){return this.element=this.buttonElement=n.makeButtonElement(),this.buttonElement},disable:function(){this.element.button("option","disabled",!1)},enable:function(e){this.element.button("option","disabled",e===!1)}});return r}),define("ui/toggleButton",["jquery","ui/button","jqueryui"],function(e,t){var n=0,r=t.extend({_checked:!1,setState:function(e){if(this._checked===e)return;this._checked=e,e?this.element.addClass("aloha-button-active"):this.element.removeClass("aloha-button-active")},getState:function(){return this._checked},_onClick:function(){this.setState(!this._checked),this.click()}});return r}),define("link/nls/i18n",{root:{"button.addlink.tooltip":"Insert Link","button.removelink.tooltip":"Remove Link","newlink.defaulttext":"New Link","floatingmenu.tab.link":"Link","link.target.self":"Self","link.target.blank":"Blank","link.target.parent":"Parent","link.target.top":"Top","link.target.framename":"Framename","link.target.legend":"Target","link.title.legend":"Title",insertLink:"ctrl+k"},de:!0,fr:!0,pl:!0,ru:!0}),define("aloha/nls/i18n",{root:{"plugin.abbr.floatingmenu.tab.abbr":"Abbreviation","floatingmenu.tab.format":"Format","floatingmenu.tab.insert":"Insert",yes:"Yes",no:"No",cancel:"Cancel","repository.no_item_found":"No item found.","repository.loading":"Loading","repository.no_items_found_yet":"No items found yet..."},de:!0}),define("link/../extra/linklist",["aloha","jquery"],function(e,t){var n=[{name:"Aloha Editor - The HTML5 Editor",url:"http://aloha-editor.org",type:"website"},{name:"Aloha Editor - Wiki",url:"http://github.com/alohaeditor/Aloha-Editor/wiki",type:"website"},{name:"Aloha Editor - GitHub",url:"http://github.com/alohaeditor/Aloha-Editor",type:"website"},{name:"Aloha Logo",url:"http://www.aloha-editor.com/images/aloha-editor-logo.png",type:"image"}];new(e.AbstractRepository.extend({_constructor:function(){this._super("linklist")},folder:[],init:function(){e.settings.repositories&&e.settings.repositories.linklist&&e.settings.repositories.linklist.data&&(n=n.concat(e.settings.repositories.linklist.data)),"filter"in Array.prototype||(n.filter=function(e,t){var n=[],r,i=0,s=this.length;for(;i<s;i++)i in this&&e.call(t,r=this[i],i,this)&&n.push(r);return n});var t=n.length;for(var r=0;r<t;++r){var i=n[r];i.repositoryId=this.repositoryId,i.id=i.id?i.id:i.url;var s=i.uri=this.parseUri(i.url),o=this.addFolder("",s.host),u=s.path.split("/");for(var a=0;a<u.length;a++)u[a]&&u[a].lastIndexOf(".")<0&&(o=this.addFolder(o,u[a]));i.parentId=o,n[r]=new e.RepositoryDocument(i)}this.repositoryName="Linklist"},addFolder:function(t,n){var r=t?"folder":"hostname",i=t?t+"/"+n:n;return n&&!this.folder[i]&&(this.folder[i]=new e.RepositoryFolder({id:i,name:n||i,parentId:t,type:"host",repositoryId:this.repositoryId})),i},query:function(e,r){var i=new RegExp(e.queryString,"i"),s=n.filter(function(n,r,s){return(!e.queryString||n.name.match(i)||n.url.match(i))&&(!e.objectTypeFilter||!e.objectTypeFilter.length||t.inArray(n.type,e.objectTypeFilter)>-1)&&!0});r.call(this,s)},getChildren:function(e,t){var n=[],r;for(r in this.folder){var i=this.folder[r].parentId;typeof this.folder[r]!="function"&&(this.folder[r].parentId==e.inFolderId||!this.folder[r].parentId&&e.inFolderId==this.repositoryId)&&n.push(this.folder[r])}t.call(this,n)},parseUri:function(e){var t={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;while(i--)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r},getObjectById:function(e,t){var r=0,i=n.length,s=[];for(;r<i;r++)n[r].id==e&&s.push(n[r]);t.call(this,s)}}))}),define("link/link-plugin",["aloha","aloha/plugin","jquery","ui/port-helper-attribute-field","ui/ui","ui/scopes","ui/surface","ui/button","ui/toggleButton","i18n!link/nls/i18n","i18n!aloha/nls/i18n","aloha/console","link/../extra/linklist"],function(e,t,n,r,i,s,o,u,a,f,l,c){function m(t,r){var i,s=!1;return!t.ignoreNextSelectionChangedEvent&&e.Selection.isSelectionEditable()&&e.activeEditable!=null?(i=t.findLinkMarkup(r),i?(t.toggleLinkScope(!0),t.hrefField.setTargetObject(i,"href"),n("#"+t.hrefField.getInputId()).length==0&&(t.hrefUpdateInt!==null&&clearInterval(t.hrefUpdateInt),t.hrefUpdateInt=setInterval(function(){n("#"+t.hrefField.getInputId()).length>0&&(t.hrefField.setTargetObject(i,"href"),clearInterval(t.hrefUpdateInt))},200)),e.trigger("aloha-link-selected"),s=!0):(t.toggleLinkScope(!1),t.hrefField.setTargetObject(null),e.trigger("aloha-link-unselected"))):t.toggleLinkScope(!1),t.ignoreNextSelectionChangedEvent=!1,s}var h=window.GENTICS,p="aloha-link",d="",v;return t.create("link",{languages:["en","de","fr","ru","pl"],config:["a"],targetregex:"",target:"",cssclassregex:"",cssclass:"",objectTypeFilter:[],onHrefChange:null,ignoreNextSelectionChangedEvent:!1,hrefUpdateInt:null,hotKey:{insertLink:f.t("insertLink","ctrl+k")},hrefValue:"http://",init:function(){var t=this;typeof this.settings.targetregex!="undefined"&&(this.targetregex=this.settings.targetregex),typeof this.settings.target!="undefined"&&(this.target=this.settings.target),typeof this.settings.cssclassregex!="undefined"&&(this.cssclassregex=this.settings.cssclassregex),typeof this.settings.cssclass!="undefined"&&(this.cssclass=this.settings.cssclass),typeof this.settings.objectTypeFilter!="undefined"&&(this.objectTypeFilter=this.settings.objectTypeFilter),typeof this.settings.onHrefChange!="undefined"&&(this.onHrefChange=this.settings.onHrefChange),typeof this.settings.hotKey!="undefined"&&n.extend(!0,this.hotKey,this.settings.hotKey),typeof this.settings.hrefValue!="undefined"&&(this.hrefValue=this.settings.hrefValue),this.createButtons(),this.subscribeEvents(),this.bindInteractions(),e.ready(function(){t.initSidebar(e.Sidebar.right)})},nsSel:function(){var e=[],t=p;return n.each(arguments,function(){e.push("."+(this==""?t:t+"-"+this))}),n.trim(e.join(" "))},nsClass:function(){var e=[],t=p;return n.each(arguments,function(){e.push(this==""?t:t+"-"+this)}),n.trim(e.join(" "))},initSidebar:function(e){var t=this;t.sidebar=e,e.addPanel({id:t.nsClass("sidebar-panel-target"),title:f.t("floatingmenu.tab.link"),content:"",expanded:!0,activeOn:"a, link",onInit:function(){var e=this,r=this.setContent('<div class="'+t.nsClass("target-container")+'"><fieldset><legend>'+f.t("link.target.legend")+'</legend><ul><li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_self" /><span>'+f.t("link.target.self")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_blank" /><span>'+f.t("link.target.blank")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_parent" /><span>'+f.t("link.target.parent")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="_top" /><span>'+f.t("link.target.top")+"</span></li>"+'<li><input type="radio" name="targetGroup" class="'+t.nsClass("radioTarget")+'" value="framename" /><span>'+f.t("link.target.framename")+"</span></li>"+'<li><input type="text" class="'+t.nsClass("framename")+'" /></li></ul></fieldset></div>'+'<div class="'+t.nsClass("title-container")+'" ><fieldset><legend>'+f.t("link.title.legend")+'</legend><input type="text" class="'+t.nsClass("linkTitle")+'" /></fieldset></div>').content;n(t.nsSel("framename")).live("keyup",function(){n(e.effective).attr("target",n(this).val().replace('"',"&quot;").replace("'","&#39;"))}),n(t.nsSel("radioTarget")).live("change",function(){n(this).val()=="framename"?n(t.nsSel("framename")).slideDown():(n(t.nsSel("framename")).slideUp().val(""),n(e.effective).attr("target",n(this).val()))}),n(t.nsSel("linkTitle")).live("keyup",function(){n(e.effective).attr("title",n(this).val().replace('"',"&quot;").replace("'","&#39;"))})},onActivate:function(e){var r=this;r.effective=e;if(n(r.effective).attr("target")!=null){var i=!0;n(t.nsSel("framename")).hide().val(""),n(t.nsSel("radioTarget")).each(function(){n(this).removeAttr("checked"),n(this).val()===n(r.effective).attr("target")&&(i=!1,n(this).attr("checked","checked"))}),i&&(n(t.nsSel('radioTarget[value="framename"]')).attr("checked","checked"),n(t.nsSel("framename")).val(n(r.effective).attr("target")).show())}else n(t.nsSel("radioTarget")).first().attr("checked","checked"),n(r.effective).attr("target",n(t.nsSel("radioTarget")).first().val());var r=this;r.effective=e,n(t.nsSel("linkTitle")).val(n(r.effective).attr("title"))}}),e.show()},subscribeEvents:function(){var t=this,r={};e.bind("aloha-editable-created",function(e,i){var s=t.getEditableConfig(i.obj),o=n.inArray("a",s)!==-1;r[i.getId()]=o;if(!o)return;i.obj.bind("keydown",t.hotKey.insertLink,function(){return t.findLinkMarkup()?(t.hrefField.foreground(),t.hrefField.focus()):t.insertLink(!0),!1}),i.obj.find("a").each(function(){t.addLinkEventHandlers(this)})}),e.bind("aloha-editable-activated",function(){r[e.activeEditable.getId()]?(t._formatLinkButton.show(!0),t._insertLinkButton.show(!0)):(t._formatLinkButton.show(!1),t._insertLinkButton.show(!1))});var i=!1;e.bind("aloha-selection-changed",function(n,s){var o=!1;e.activeEditable&&r[e.activeEditable.getId()]&&(o=m(t,s),o&&i!==o&&t.hrefField.foreground()),i=o})},toggleLinkScope:function(e){if(this._isScopeActive===e)return;this._isScopeActive=e,e?(this.hrefField.show(),this._insertLinkButton.show(!1),this._removeLinkButton.show(!0),this._formatLinkButton.setState(!0),s.enterScope(this.name)):(this.hrefField.hide(),this._insertLinkButton.show(!0),this._removeLinkButton.show(!1),this._formatLinkButton.setState(!1),s.leaveScope(this.name))},addLinkEventHandlers:function(t){var r=this;n(t).mouseenter(function(n){e.Log.debug(r,"mouse over link."),r.mouseOverLink=t,r.updateMousePointer()}),n(t).mouseleave(function(t){e.Log.debug(r,"mouse left link."),r.mouseOverLink=null,r.updateMousePointer()}),n(t).click(function(t){if(t.metaKey)return e.activeEditable.blur(),window.setTimeout(function(){location.href=t.target},0),t.stopPropagation(),!1})},createButtons:function(){var e=this;this._formatLinkButton=i.adopt("formatLink",a,{tooltip:f.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:"Aloha.continuoustext",click:function(){e.formatLink()}}),this._insertLinkButton=i.adopt("insertLink",u,{tooltip:f.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:"Aloha.continuoustext",click:function(){e.insertLink(!1)}}),this.hrefField=r({name:"editLink",width:320,valueField:"url",cls:"aloha-link-href-field",scope:"Aloha.continuoustext"}),this.hrefField.setTemplate("<span><b>{name}</b><br/>{url}</span>"),this.hrefField.setObjectTypeFilter(this.objectTypeFilter),this._removeLinkButton=i.adopt("removeLink",u,{tooltip:f.t("button.removelink.tooltip"),icon:"aloha-icon aloha-icon-unlink",scope:"Aloha.continuoustext",click:function(){e.removeLink()}})},bindInteractions:function(){var t=this;this.hrefField.addListener("keyup",function(r){if(r.keyCode==27){var i=t.hrefField.getValue();if(!(i[0]=="/"||i[0]=="#"||i.match(/^.*\.([a-z]){2,4}$/i)||i.match(/^([a-z]){3,10}:\/\/.+/i)||i.match(/^(mailto|tel):.+/i))){var o=t.hrefField.getValue();t.hrefField.setValue(o),(o==t.hrefValue||o=="")&&t.removeLink(!1)}}t.hrefChange();if(r.keyCode==13){var u=e.Selection.getRangeObject();t.ignoreNextSelectionChangedEvent=!0,u.startContainer=u.endContainer,u.startOffset=u.endOffset,u.select(),t.ignoreNextSelectionChangedEvent=!0;var o=n(t.hrefField.getInputElem()).attr("value");(o==t.hrefValue||o=="")&&t.removeLink(!1),window.setTimeout(function(){s.setScope("Aloha.continuoustext")},100)}else v=n(t.hrefField.getInputElem()).attr("value"),d!=v&&(d=v)}),n(document).keydown(function(n){e.Log.debug(t,"Meta key down."),t.metaKey=n.metaKey,t.updateMousePointer()}).keyup(function(n){e.Log.debug(t,"Meta key up."),t.metaKey=n.metaKey,t.updateMousePointer()})},updateMousePointer:function(){this.metaKey&&this.mouseOverLink?(e.Log.debug(this,"set pointer"),n(this.mouseOverLink).removeClass("aloha-link-text"),n(this.mouseOverLink).addClass("aloha-link-pointer")):(n(this.mouseOverLink).removeClass("aloha-link-pointer"),n(this.mouseOverLink).addClass("aloha-link-text"))},findLinkMarkup:function(t){return typeof t=="undefined"&&(t=e.Selection.getRangeObject()),e.activeEditable?t.findMarkup(function(){return this.nodeName.toLowerCase()=="a"},e.activeEditable.obj):null},formatLink:function(){e.activeEditable&&(this.findLinkMarkup(e.Selection.getRangeObject())?this.removeLink():this.insertLink())},insertLink:function(t){var r=this,i=e.Selection.getRangeObject(),s,o;if(!i.startContainer||!i.endContainer)return;if(this.findLinkMarkup(i))return;this.hrefField.foreground(),i.isCollapsed()&&t!==!1&&h.Utils.Dom.extendToWord(i),i.isCollapsed()?(s=f.t("newlink.defaulttext"),o=n('<a href="'+r.hrefValue+'" class="aloha-new-link">'+s+"</a>"),h.Utils.Dom.insertIntoDOM(o,i,n(e.activeEditable.obj)),i.startContainer=i.endContainer=o.contents().get(0),i.startOffset=0,i.endOffset=s.length):(o=n('<a href="'+r.hrefValue+'" class="aloha-new-link"></a>'),h.Utils.Dom.addMarkup(i,o,!1)),e.activeEditable.obj.find("a.aloha-new-link").each(function(e){r.addLinkEventHandlers(this),n(this).removeClass("aloha-new-link")}),i.select(),this.hrefField.focus(),this.hrefField.hasInputElem()&&n(this.hrefField.getInputElem()).attr("value",r.hrefValue).select(),this.hrefChange()},removeLink:function(t){var n=e.Selection.getRangeObject(),r=this.findLinkMarkup();this.hrefField.setItem(null),r&&(h.Utils.Dom.removeFromDOM(r,n,!0),n.startContainer=n.endContainer,n.startOffset=n.endOffset,n.select(),(typeof t=="undefined"||t===!0)&&s.setScope("Aloha.continuoustext"))},hrefChange:function(){var t=this;this.target!=""&&this.hrefField.setAttribute("target",this.target,this.targetregex,this.hrefField.getValue()),this.hrefField.setAttribute("class",this.cssclass,this.cssclassregex,this.hrefField.getValue()),e.trigger("aloha-link-href-change",{obj:t.hrefField.getTargetObject(),href:t.hrefField.getValue(),item:t.hrefField.getItem()}),typeof this.onHrefChange=="function"&&this.onHrefChange.call(this,this.hrefField.getTargetObject(),this.hrefField.getValue(),this.hrefField.getItem())},makeClean:function(e){e.find("a").each(function(){n(this).removeClass("aloha-link-pointer").removeClass("aloha-link-text")})}})}),define("ui/port-helper-multi-split",["aloha/core","jquery","ui/ui","ui/multiSplit"],function(e,t,n,r){function i(e){var i;return i=n.adopt(e.name,r,{scope:e.scope,getButtons:function(){var n=[];return t.each(e.items,function(e,t){n.push({tooltip:t.tooltip,text:t.text,name:t.name,icon:t.iconClass,click:t.click,init:function(){t.cls&&this.element.addClass(t.cls),t.init&&t.init.call(this)},wide:t.wide})}),n}}),{pushItem:function(e){i.addButton(e)},showItem:function(e){i.show(e)},hideItem:function(e){i.hide(e)},setActiveItem:function(e){i.setActiveButton(e)}}}return i}),define("format/nls/i18n",{root:{"button.strong.tooltip":"Strong","button.em.tooltip":"Emphasize","button.b.tooltip":"Bold","button.i.tooltip":"Italic","button.u.tooltip":"Underline","button.cite.tooltip":"Cite","button.q.tooltip":"","button.code.tooltip":"Code","button.abbr.tooltip":"Abbreviation","button.del.tooltip":"Strikethrough","button.s.tooltip":"Strikethrough","button.sub.tooltip":"Subscript","button.sup.tooltip":"Superscript","button.p.tooltip":"Paragraph","button.h1.tooltip":"Heading 1","button.h2.tooltip":"Heading 2","button.h3.tooltip":"Heading 3","button.h4.tooltip":"Heading 4","button.h5.tooltip":"Heading 5","button.h6.tooltip":"Heading 6","button.pre.tooltip":"Pre formated text","button.title.tooltip":"Title","button.removeFormat.tooltip":"Remove formatting","button.removeFormat.text":"Remove formatting",GENTICS_button_p:"GENTICS_button_p",GENTICS_button_h1:"GENTICS_button_h1",GENTICS_button_h2:"GENTICS_button_h2",GENTICS_button_h3:"GENTICS_button_h3",GENTICS_button_h4:"GENTICS_button_h4",GENTICS_button_h5:"GENTICS_button_h5",GENTICS_button_h6:"GENTICS_button_h6",GENTICS_button_pre
:"GENTICS_button_pre",GENTICS_button_title:"GENTICS_button_title",formatBold:"Ctrl+b",formatItalic:"Ctrl+i",formatUnderline:"Ctrl+u",formatParagraph:"Alt+Ctrl+0",formatH1:"Alt+Ctrl+1",formatH2:"Alt+Ctrl+2",formatH3:"Alt+Ctrl+3",formatH4:"Alt+Ctrl+4",formatH5:"Alt+Ctrl+5",formatH6:"Alt+Ctrl+6",formatPre:"Alt+Ctrl+P",formatDel:"Ctrl+\\",formatSub:"Ctrl+,",formatSup:"Ctrl+.","floatingmenu.tab.format":"Format","format.class.legend":"CSS class","format.class.none":"none"},de:!0,eo:!0,fi:!0,fr:!0,it:!0,pl:!0,ru:!0}),define("format/format-plugin",["aloha","aloha/plugin","jquery","ui/ui","ui/toggleButton","ui/port-helper-multi-split","PubSub","i18n!format/nls/i18n","i18n!aloha/nls/i18n","aloha/selection"],function(e,t,n,r,i,s,o,u,a){function v(t,r){var i=!1,s,o,u,a,f;n.each(t.buttons,function(t,n){i=!1;for(u=0;u<r.markupEffectiveAtStart.length;u++)s=r.markupEffectiveAtStart[u],e.Selection.standardTextLevelSemanticsComparator(s,n.markup)&&(n.handle.setState(!0),i=!0);i||n.handle.setState(!1)});if(t.multiSplitItems.length>0){o=!1;for(u=0;u<r.markupEffectiveAtStart.length&&!o;u++){s=r.markupEffectiveAtStart[u];for(a=0;a<t.multiSplitItems.length&&!o;a++){f=t.multiSplitItems[a];if(!f.markup)continue;e.Selection.standardTextLevelSemanticsComparator(s,f.markup)&&(t.multiSplitButton.setActiveItem(f.name),o=!0)}}o||t.multiSplitButton.setActiveItem(null)}}var f=window.GENTICS,l="aloha-format",c={b:"bold",strong:"bold",i:"italic",em:"italic",del:"strikethrough",sub:"subscript",sup:"superscript",u:"underline",s:"strikethrough"},h={strong:"strong",em:"emphasis",s:"strikethrough2"},p={u:!0,em:!0,strong:!0,b:!0,i:!0,cite:!0,q:!0,code:!0,abbr:!0,del:!0,s:!0,sub:!0,sup:!0},d={p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,pre:!0};return t.create("format",{languages:["en","de","fr","eo","fi","ru","it","pl"],config:["b","i","sub","sup","p","h1","h2","h3","h4","h5","h6","pre","removeFormat"],availableButtons:["u","strong","em","b","i","s","sub","sup","p","h1","h2","h3","h4","h5","h6","pre","removeFormat"],hotKey:{formatBold:"ctrl+b",formatItalic:"ctrl+i",formatParagraph:"alt+ctrl+0",formatH1:"alt+ctrl+1",formatH2:"alt+ctrl+2",formatH3:"alt+ctrl+3",formatH4:"alt+ctrl+4",formatH5:"alt+ctrl+5",formatH6:"alt+ctrl+6",formatPre:"ctrl+p",formatDel:"ctrl+d",formatSub:"alt+shift+s",formatSup:"ctrl+shift+s"},init:function(){var t=this;typeof this.settings.hotKey!="undefined"&&n.extend(!0,this.hotKey,this.settings.hotKey),this.initButtons(),e.ready(function(){t.initSidebar(e.Sidebar.right)}),e.bind("aloha-editable-activated",function(e,n){t.applyButtonConfig(n.editable.obj),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatBold,function(){return t.addMarkup("b"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatItalic,function(){return t.addMarkup("i"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatParagraph,function(){return t.changeMarkup("p"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH1,function(){return t.changeMarkup("h1"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH2,function(){return t.changeMarkup("h2"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH3,function(){return t.changeMarkup("h3"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH4,function(){return t.changeMarkup("h4"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH5,function(){return t.changeMarkup("h5"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatH6,function(){return t.changeMarkup("h6"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatPre,function(){return t.changeMarkup("pre"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatDel,function(){return t.addMarkup("del"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatSub,function(){return t.addMarkup("sub"),!1}),n.editable.obj.bind("keydown.aloha.format",t.hotKey.formatSup,function(){return t.addMarkup("sup"),!1})}),e.bind("aloha-editable-deactivated",function(e,t){t.editable.obj.unbind("keydown.aloha.format")})},applyButtonConfig:function(e){var t=this.getEditableConfig(e),r,i,s;if(typeof t=="object"){var o=[];n.each(t,function(e,t){(typeof e!="number"||typeof t!="string")&&o.push(e)}),o.length>0&&(t=o)}this.formatOptions=t;for(r in this.buttons)this.buttons.hasOwnProperty(r)&&(n.inArray(r,t)!==-1?this.buttons[r].handle.show():this.buttons[r].handle.hide());s=this.multiSplitItems.length;for(i=0;i<s;i++)n.inArray(this.multiSplitItems[i].name,t)!==-1?this.multiSplitButton.showItem(this.multiSplitItems[i].name):this.multiSplitButton.hideItem(this.multiSplitItems[i].name)},initButtons:function(){var t="Aloha.continuoustext",a=this;this.buttons={},this.multiSplitItems=[],n.each(this.availableButtons,function(s,o){var f=!1;typeof s!="number"&&typeof o!="string"&&(f=o,o=s);if(p[o]){var l=c[o],v=l;h.hasOwnProperty(o)&&(v=h[o]);var m=r.adopt(v,i,{tooltip:u.t("button."+o+".tooltip"),icon:"aloha-icon aloha-icon-"+v,scope:t,click:function(){var e=n(".aloha-cell-selected");if(e.length>0){var t=0;return e.each(function(){var e=n(this).find("div"),r=e.find(o);r.length>0&&(r.contents().unwrap(),t++),e.contents().wrap("<"+o+"></"+o+">")}),t===e.length&&e.find(o).contents().unwrap(),!1}return a.addMarkup(o),!1}});a.buttons[o]={handle:m,markup:n("<"+o+">",{"class":f||""})}}else d[o]?a.multiSplitItems.push({name:o,tooltip:u.t("button."+o+".tooltip"),iconClass:"aloha-icon "+u.t("aloha-large-icon-"+o),markup:n("<"+o+">"),click:function(){var t=n(".aloha-cell-selected");if(t.length>0){var r=0;return t.each(function(){var e=n(this).find("div"),t=e.find(o);t.length>0&&(t.contents().unwrap(),r++),e.contents().wrap("<"+o+"></"+o+">")}),r===t.length&&t.find(o).contents().unwrap(),!1}a.changeMarkup(o),e.activeEditable&&n.browser.mozilla&&e.activeEditable.obj.focus(),e.activeEditable&&e.trigger("aloha-format-block")}}):"removeFormat"===o?a.multiSplitItems.push({name:o,text:u.t("button."+o+".text"),tooltip:u.t("button."+o+".tooltip"),wide:!0,cls:"aloha-ui-multisplit-fullwidth",click:function(){a.removeFormat()}}):e.log("warn",this,'Button "'+o+'" is not defined')}),this.multiSplitButton=s({name:"formatBlock",items:this.multiSplitItems,hideIfEmpty:!0,scope:t}),o.sub("aloha.selection.context-change",function(e){v(a,e.range)})},initSidebar:function(e){var t=this;t.sidebar=e,e.addPanel({id:t.nsClass("sidebar-panel-class"),title:u.t("floatingmenu.tab.format"),content:"",expanded:!0,activeOn:this.formatOptions||!1,onInit:function(){},onActivate:function(e){var r=this;r.effective=e;if(!e[0])return;r.format=e[0].nodeName.toLowerCase();var i=n("<div>").attr("class",t.nsClass("target-container")),s=n("<fieldset>");s.append(n("<legend>"+r.format+" "+u.t("format.class.legend")).append(n("<select>"))),i.append(s);var o='<div class="'+t.nsClass("target-container")+'"><fieldset><legend>'+u.t("format.class.legend")+'</legend><select name="targetGroup" class="'+t.nsClass("radioTarget")+'">'+'<option value="">'+u.t("format.class.none")+"</option>";t.config[r.format]&&t.config[r.format]["class"]&&n.each(t.config[r.format]["class"],function(e,t){o+='<option value="'+e+'" >'+t+"</option>"}),o+="</select></fieldset></div>";var r=this,a=this.setContent(o).content;n(t.nsSel("framename")).live("keyup",function(){n(r.effective).attr("target",n(this).val().replace('"',"&quot;").replace("'","&#39;"))});var r=this;r.effective=e,n(t.nsSel("linkTitle")).val(n(r.effective).attr("title"))}}),e.show()},nsClass:function(){var e=[],t=l;return n.each(arguments,function(){e.push(this==""?t:t+"-"+this)}),n.trim(e.join(" "))},nsSel:function(){var e=[],t=l;return n.each(arguments,function(){e.push("."+(this==""?t:t+"-"+this))}),n.trim(e.join(" "))},addMarkup:function(t){var r=n("<"+t+">"),i=e.Selection.rangeObject,s;return typeof t=="undefined"||t==""?!1:(s=i.findMarkup(function(){return this.nodeName===r[0].nodeName},e.activeEditable.obj),s?i.isCollapsed()?f.Utils.Dom.removeFromDOM(s,i,!0):f.Utils.Dom.removeMarkup(i,r,e.activeEditable.obj):(i.isCollapsed()&&f.Utils.Dom.extendToWord(i),f.Utils.Dom.addMarkup(i,r)),i.select(),v(this,e.Selection.getRangeObject()),!1)},changeMarkup:function(t){e.Selection.changeMarkupOnSelection(n("<"+t+">"))},removeFormat:function(){var t=["u","strong","em","b","i","q","del","s","code","sub","sup","p","h1","h2","h3","h4","h5","h6","pre","quote","blockquote"],r=e.Selection.rangeObject,i;this.settings.removeFormats&&(t=this.settings.removeFormats);if(r.isCollapsed())return;for(i=0;i<t.length;i++)f.Utils.Dom.removeMarkup(r,n("<"+t[i]+">"),e.activeEditable.obj);r.select()},toString:function(){return"format"}})}),define("list/nls/i18n",{root:{"button.createulist.tooltip":"Insert Unordered List","button.createolist.tooltip":"Insert Ordered List","button.indentlist.tooltip":"Indent List","button.outdentlist.tooltip":"Outdent List","floatingmenu.tab.list":"Lists"},de:!0,eo:!0,fi:!0,fr:!0,it:!0,ru:!0}),define("list/list-plugin",["aloha","jquery","aloha/plugin","ui/ui","ui/scopes","ui/button","ui/toggleButton","i18n!list/nls/i18n","i18n!aloha/nls/i18n","aloha/engine","PubSub"],function(e,t,n,r,s,o,u,a,f,l,c){function d(n){if(8!=n.keyCode&&46!=n.keyCode)return!1;var r=e.getSelection().getRangeAt(0),i=r.startContainer,s=t(i).closest("ul, ol");if(!s.length)return!1;var o=s.parent().closest("ul, ol");if(!o.length)return!1;var u=e.getSelection().getAllRanges(),a=!1;o.each(function(){a=a||v(t(this))});if(a){e.getSelection().setRanges(u);for(var f=0;f<u.length;f++)u[f].detach()}return a}function v(n){var r=!1;return n.children("ul, ol").each(function(){e.Log.debug("performing list-nesting cleanup"),t(this).prev("li").append(this).length||t(this).parent().prepend(document.createElement("li")).append(this),r=!0}),r}var h=window.GENTICS,p=n.create("list",{languages:["en","de","fr","eo","fi","ru","it"],config:["ul","ol"],transformableElements:{p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,ul:!0,ol:!0},init:function(){var n=this;this._orderedListButton=r.adopt("orderedList",u,{tooltip:a.t("button.createolist.tooltip"),icon:"aloha-icon aloha-icon-orderedlist",scope:"Aloha.continuoustext",click:function(){n.transformList(!0)}}),this._unorderedListButton=r.adopt("unorderedList",u,{tooltip:a.t("button.createulist.tooltip"),icon:"aloha-icon aloha-icon-unorderedlist",scope:"Aloha.continuoustext",click:function(){n.transformList(!1)}}),this._indentListButton=r.adopt("indentList",o,{tooltip:a.t("button.indentlist.tooltip"),icon:"aloha-icon aloha-icon-indent",scope:"Aloha.continuoustext",click:function(){n.indentList()}}),this._outdentListButton=r.adopt("outdentList",o,{tooltip:a.t("button.outdentlist.tooltip"),icon:"aloha-icon aloha-icon-outdent",scope:"Aloha.continuoustext",click:function(){n.outdentList()}}),s.createScope("Aloha.List","Aloha.continuoustext"),c.sub("aloha.selection.context-change",function(r){var i,s,o=r.range;n._outdentListButton.show(!1),n._indentListButton.show(!1),n._unorderedListButton.setState(!1),n._orderedListButton.setState(!1);for(i=0;i<o.markupEffectiveAtStart.length;i++){s=o.markupEffectiveAtStart[i];if(e.Selection.standardTagNameComparator(s,t("<ul></ul>"))){n._unorderedListButton.setState(!0),n._outdentListButton.show(!0),n._indentListButton.show(!0);break}if(e.Selection.standardTagNameComparator(s,t("<ol></ol>"))){n._orderedListButton.setState(!0),n._outdentListButton.show(!0),n._indentListButton.show(!0);break}}e.activeEditable&&n.applyButtonConfig(e.activeEditable.obj)}),e.Markup.addKeyHandler(9,function(e){return n.processTab(e)})},applyButtonConfig:function(n){var r=this.getEditableConfig(n);e.Selection.rangeObject.unmodifiableMarkupAtStart[0]&&(t.inArray("ul",r)!=-1&&e.Selection.canTag1WrapTag2(e.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ul")!=-1?this._unorderedListButton.show(!0):this._unorderedListButton.show(!1),t.inArray("ol",r)!=-1&&e.Selection.canTag1WrapTag2(e.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ol")!=-1?this._orderedListButton.show(!0):this._orderedListButton.show(!1))},makeClean:function(e){e.find("li").each(function(){t(this).removeAttr("hidefocus"),t(this).removeAttr("hideFocus"),t(this).removeAttr("tabindex"),t(this).removeAttr("tabIndex")})},processTab:function(e){return e.keyCode===9?e.shiftKey?this.outdentList():this.indentList():!0},getStartingDomObjectToTransform:function(){var t=e.Selection.rangeObject,n,r;for(n=0;n<t.markupEffectiveAtStart.length;n++){r=t.markupEffectiveAtStart[n];if(this.transformableElements[r.nodeName.toLowerCase()])return r}return!1},getNearestSelectedListItem:function(){var t=e.Selection.rangeObject,n,r;for(n=0;n<t.markupEffectiveAtStart.length;n++){r=t.markupEffectiveAtStart[n];if(h.Utils.Dom.isListElement(r))return r}return!1},transformList:function(n){var r=this.getStartingDomObjectToTransform(),i,s,o,u,a,f,c,p,d;this._outdentListButton.show(!0),this._indentListButton.show(!0);if(!r){e.Selection.changeMarkupOnSelection(t("<p></p>")),r=this.getStartingDomObjectToTransform();if(!r){if(e.Selection.rangeObject.startContainer.contentEditable){u=n?t("<ol></ol>"):t("<ul></ul>"),o=t("<li></li>"),u.append(o);var v=o.get(0),m=e.getActiveEditable().obj;v.appendChild(document.createTextNode("")),m.append(u),m.focus();var g=e.createRange(),y=e.getSelection();g.setStart(v.firstChild,0),g.setEnd(v.firstChild,0),y.removeAllRanges(),y.addRange(g),e.Selection.updateSelection();return}e.Log.error(this,"Could not transform selection into a list");return}}d=r.nodeName.toLowerCase();if(d=="ul"&&!n)u=t(r),f=u.parent(),f.length>0&&h.Utils.Dom.isListElement(f.get(0))?f.get(0).nodeName.toLowerCase()==="li"?(f.after(u.children()),u.remove()):u.children().unwrap():(p=t(r),t.each(p.children("li"),function(t,n){c=e.Markup.transformDomObject(n,"p",e.Selection.rangeObject),c.after(c.children("ol,ul")),l.ensureContainerEditable(c.get(0))}),p.children().unwrap());else if(d=="ul"&&n)e.Markup.transformDomObject(r,"ol",e.Selection.rangeObject),this.mergeAdjacentLists(t(r));else if(d=="ol"&&!n)e.Markup.transformDomObject(r,"ul",e.Selection.rangeObject),this.mergeAdjacentLists(t(r));else if(d=="ol"&&n)u=t(r),f=u.parent(),f.length>0&&h.Utils.Dom.isListElement(f.get(0))?f.get(0).nodeName.toLowerCase()==="li"?(f.after(u.children()),u.remove()):u.children().unwrap():(p=t(r),t.each(p.children("li"),function(t,n){c=e.Markup.transformDomObject(n,"p",e.Selection.rangeObject),c.after(c.children("ol,ul")),l.ensureContainerEditable(c.get(0))}),p.children().unwrap());else{a=e.Selection.rangeObject.getSelectedSiblings(r),u=n?t("<ol></ol>"):t("<ul></ul>"),o=t("<li></li>"),u.append(o),t(r).contents().appendTo(o),t(r).replaceWith(u),e.Selection.rangeObject.startContainer==r&&(e.Selection.rangeObject.startContainer=o.get(0)),e.Selection.rangeObject.endContainer==r&&(e.Selection.rangeObject.endContainer=o.get(0));var b=o;if(a){i=!1;for(s=0;s<a.length;++s)if(h.Utils.Dom.isBlockLevelElement(a[s]))i&&(i=!1),o=e.Markup.transformDomObject(a[s],"li",e.Selection.rangeObject),u.append(o),b=o;else{if(a[s].nodeType==3&&t.trim(a[s].data).length===0)continue;i||(i=t("<li></li>"),u.append(i),b=i),i.append(a[s])}}this.mergeAdjacentLists(u);var v=b.get(0);if(h.Utils.Dom.isEmpty(v)){var g=e.createRange(),y=e.getSelection();v.appendChild(document.createTextNode("")),g.selectNodeContents(v.lastChild),y.removeAllRanges(),y.addRange(g),e.Selection.updateSelection()}}this.refreshSelection()},indentList:function(){var n=this.getNearestSelectedListItem(),r,i,s,o,u;if(n){u=t(n).prev("li");if(u.length===0)return!1;o=t(n).parent(),s=e.Selection.rangeObject.getSelectedSiblings(n),i=t(n).parent().clone(!1).empty(),i.append(n),u.append(i);if(s)for(r=0;r<s.length;++r)i.append(t(s[r]));return this.mergeAdjacentLists(i,!0),this.refreshSelection(),!1}return!0},outdentList:function(){var n=this.getNearestSelectedListItem(),r,i,s,o,u,a,f,l;if(n){s=t(n),o=s.parent(),u=o.parents("ul,ol"),a=o.parent("li");if(u.length>0&&h.Utils.Dom.isListElement(u.get(0))){f=e.Selection.rangeObject.getSelectedSiblings(n),f&&f.length>0?l=t(f[f.length-1]):l=s,l.nextAll("li").length>0&&(i=o.clone(!1).empty(),i.append(l.nextAll()),l.append(i)),a.length>0?a.after(s):o.before(s);if(f&&f.length>0)for(r=f.length-1;r>=0;--r)s.after(t(f[r]));o.contents("li").length===0&&o.remove(),a.length>0&&a.contents().length===0&&a.remove(),this.refreshSelection()}return!1}return!0},refreshSelection:function(){e.Selection.rangeObject.update(),e.Selection.rangeObject.select(),e.Selection.updateSelection()},mergeAdjacentLists:function(e,n){var r=e.get(0),i;while(r.previousSibling&&r.previousSibling.nodeType===1&&this.isMergable(r.previousSibling,r,n))r=r.previousSibling;e=t(r);while(r.nextSibling&&(r.nextSibling.nodeType===1&&this.isMergable(r.nextSibling,r,n)||r.nextSibling.nodeType===3&&t.trim(r.nextSibling.data).length===0))i=t(r.nextSibling),r.nextSibling.nodeType==1&&i.contents().appendTo(e),i.remove()},isMergable:function(e,t,n){return n?e.nodeName.toLowerCase()=="ul"||e.nodeName.toLowerCase()=="ol":e.nodeName==t.nodeName}});return l.commands.insertorderedlist={action:function(t,n){p.transformList(!0),n&&e.Selection.rangeObject&&(n.startContainer=e.Selection.rangeObject.startContainer,n.startOffset=e.Selection.rangeObject.startOffset,n.endContainer=e.Selection.rangeObject.endContainer,n.endOffset=e.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ul></ul>")))return!1;if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ol></ol>")))return!0}return!1}},l.commands.insertunorderedlist={action:function(t,n){p.transformList(!1),n&&e.Selection.rangeObject&&(n.startContainer=e.Selection.rangeObject.startContainer,n.startOffset=e.Selection.rangeObject.startOffset,n.endContainer=e.Selection.rangeObject.endContainer,n.endOffset=e.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ul></ul>")))return!0;if(e.Selection.standardTagNameComparator(effectiveMarkup,t("<ol></ol>")))return!1}return!1}},l.commands.indent={action:function(t,n){p.indentList(),n&&e.Selection.rangeObject&&(n.startContainer=e.Selection.rangeObject.startContainer,n.startOffset=e.Selection.rangeObject.startOffset,n.endContainer=e.Selection.rangeObject.endContainer,n.endOffset=e.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){return!1}},l.commands.outdent={action:function(t,n){p.outdentList(),n&&e.Selection.rangeObject&&(n.startContainer=e.Selection.rangeObject.startContainer,n.startOffset=e.Selection.rangeObject.startOffset,n.endContainer=e.Selection.rangeObject.endContainer,n.endOffset=e.Selection.rangeObject.endOffset)},indeterm:function(){},state:function(){return!1}},p}),define("image/nls/i18n",{root:{"size.natural":"Original size","button.addimg.tooltip":"add image ref","floatingmenu.tab.img":"Image","floatingmenu.tab.formatting":"Formatting","floatingmenu.tab.resize":"Resize","floatingmenu.tab.crop":"Crop","button.uploadimg.tooltip":"Upload img","button.uploadimg.label":"Upload","button.img.align.left.tooltip":"Left align","button.img.align.right.tooltip":"Right Align","button.img.align.none.tooltip":"No alignment","field.img.title.label":"","field.img.title.tooltip":"","field.img.src.label":"","field.img.src.tooltip":"",border:"Add Border to Image","padding.increase":"Increase Padding","padding.decrease":"Decrease Padding","size.increase":"Increase Size","size.decrease":"Decrease Size",Resize:"Resize",Crop:"Crop",Reset:"Reset",Accept:"Accept",Cancel:"Cancel",height:"Height",width:"Width","button.toggle.tooltip":"Toggle keep aspect ratio"},cz:!0,de:!0,fr:!0,ru:!0}),define("image/image-floatingMenu",["jquery","util/class","i18n!image/nls/i18n","i18n!aloha/nls/i18n","ui/ui","ui/scopes","ui/button","ui/toggleButton","ui/port-helper-attribute-field"],function(e,t,n,r,i,s,o,u,a){var f=e,l=window.GENTICS,c=window.Aloha;return t.extend({_constructor:function(){},init:function(e){e.floatingMenuControl=this,this.plugin=e,s.createScope(e.name,"Aloha.empty"),this._addUIInsertButton(),this._addUIMetaButtons(),this._addUIResetButton(),this._addUIAlignButtons(),this._addUIMarginButtons(),this._addUICropButtons(),this._addUIResizeButtons(),this._addUIAspectRatioToggleButton()},_addUIAspectRatioToggleButton:function(){var e=this.plugin;this._imageCnrRatioButton=i.adopt("imageCnrRatio",u,{tooltip:n.t("button.toggle.tooltip"),icon:"aloha-icon-cnr-ratio",scope:e.name,click:function(){e.toggleKeepAspectRatio()}}),e.settings.fixedAspectRatio!==!1&&(this._imageCnrRatioButton.setState(!0),e.keepAspectRatio=!0)},_addUIResetButton:function(){var e=this.plugin;this._imageCnrResetButton=i.adopt("imageCnrReset",o,{tooltip:n.t("Reset"),icon:"aloha-icon-cnr-reset",scope:e.name,click:function(){e.reset()}})},_addUIInsertButton:function(){var e=this.plugin;this._insertImageButton=i.adopt("insertImage",o,{tooltip:n.t("button.addimg.tooltip"),icon:"aloha-button aloha-image-insert",scope:"Aloha.continuoustext",click:function(){e.insertImg()}})},_addUIMetaButtons:function(){var e=this.plugin;this.imgSrcField=a({label:n.t("field.img.src.label"),tooltip:n.t("field.img.src.tooltip"),name:"imageSource",scope:e.name}),this.imgSrcField.setObjectTypeFilter(e.objectTypeFilter),this.imgTitleField=a({label:n.t("field.img.title.label"),tooltip:n.t("field.img.title.tooltip"),name:"imageTitle",scope:e.name}),this.imgTitleField.setObjectTypeFilter()},_addUIAlignButtons:function(){var t=this.plugin;this._imageAlignLeftButton=i.adopt("imageAlignLeft",o,{tooltip:n.t("button.img.align.left.tooltip"),icon:"aloha-img aloha-image-align-left",scope:t.name,click:function(){var n=e(t.getPluginFocus());n.add(n.parent()).css("float","left")}}),this._imageAlignRightButton=i.adopt("imageAlignRight",o,{tooltip:n.t("button.img.align.right.tooltip"),icon:"aloha-img aloha-image-align-right",scope:t.name,click:function(){var n=e(t.getPluginFocus());n.add(n.parent()).css("float","right")}}),this._imageAlignNoneButton=i.adopt("imageAlignNone",o,{tooltip:n.t("button.img.align.none.tooltip"),icon:"aloha-img aloha-image-align-none",scope:t.name,click:function(){var n=e(t.getPluginFocus());n.add(n.parent()).css({"float":"none",display:"inline-block"})}})},_addUIMarginButtons:function(){var t=this.plugin;this._imageIncPaddingButton=i.adopt("imageIncPadding",o,{tooltip:n.t("padding.increase"),icon:"aloha-img aloha-image-padding-increase",scope:t.name,click:function(){e(t.getPluginFocus()).increase("padding")}}),this._imageDecPaddingButton=i.adopt("imageDecPadding",o,{tooltip:n.t("padding.decrease"),icon:"aloha-img aloha-image-padding-decrease",scope:t.name,click:function(){e(t.getPluginFocus()).decrease("padding")}})},_addUICropButtons:function(){var e=this.plugin;s.createScope("Aloha.img",["Aloha.global"]),this._imageCropButton=i.adopt("imageCropButton",u,{tooltip:n.t("Crop"),icon:"aloha-icon-cnr-crop",scope:e.name,click:function(){this.getState()?e.crop():e.endCrop()}})},_addUIResizeButtons:function(){var e=this.plugin;this.imgResizeHeightField=a({label:n.t("height"),name:"imageResizeHeight",width:50,scope:e.name}),this.imgResizeHeightField.maxValue=e.settings.maxHeight,this.imgResizeHeightField.minValue=e.settings.minHeight,this.imgResizeWidthField=a({label:n.t("width"),name:"imageResizeWidth",width:50,scope:e.name}),this.imgResizeWidthField.maxValue=e.settings.maxWidth,this.imgResizeWidthField.minValue=e.settings.minWidth},setScope:function(){s.setScope(this.plugin.name)},doLayout:function(){}})}),define("image/vendor/jcrop/jquery.jcrop.min",["jquery"],function(e){(function(e){e.Jcrop=function(t,n){function B(e){return""+parseInt(e)+"px"}function j(e){return""+parseInt(e)+"%"}function F(e){return s.baseClass+"-"+e}function I(t){var n=e(t).offset();return[n.left,n.top]}function q(e){return[e.pageX-C[0],e.pageY-C[1]]}function R(e){e!=L&&(P.setCursor(e),L=e)}function U(e,t){C=I(u),P.setCursor(e=="move"?e:e+"-resize");if(e=="move")return P.activateHandlers(W(t),Q);var n=_.getFixed(),r=X(e),i=_.getCorner(X(r));_.setPressed(_.getCorner(r)),_.setCurrent(i),P.activateHandlers(z(e,n),Q)}function z(e,t){return function(n){if(!s.aspectRatio)switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}else switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}_.setCurrent(n),D.update()}}function W(e){var t=e;return H.watchKeys(),function(e){_.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,D.update()}}function X(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function V(e){return function(t){return s.disabled?!1:e=="move"&&!s.allowMove?!1:(k=!0,U(e,q(t)),t.stopPropagation(),t.preventDefault(),!1)}}function J(e,t,n){var r=e.width(),i=e.height();r>t&&t>0&&(r=t,i=t/e.width()*e.height()),i>n&&n>0&&(i=n,r=n/e.height()*e.width()),x=e.width()/r,T=e.height()/i,e.width(r).height(i)}function K(e){return{x:parseInt(e.x*x),y:parseInt(e.y*T),x2:parseInt(e.x2*x),y2:parseInt(e.y2*T),w:parseInt(e.w*x),h:parseInt(e.h*T)}}function Q(e){var t=_.getFixed();t.w>s.minSelect[0]&&t.h>s.minSelect[1]?(D.enableHandles(),D.done()):D.release(),P.setCursor(s.allowSelect?"crosshair":"default")}function G(e){if(s.disabled)return!1;if(!s.allowSelect)return!1;k=!0,C=I(u),D.disableHandles(),R("crosshair");var t=q(e);return _.setPressed(t),P.activateHandlers(Y,Q),H.watchKeys(),D.update(),e.stopPropagation(),e.preventDefault(),!1}function Y(e){_.setCurrent(e),D.update()}function Z(){var t=e("<div></div>").addClass(F("tracker"));return e.browser.msie&&t.css({opacity:0,backgroundColor:"white"}),t}function et(e){function b(){window.setTimeout(y,f)}var t=e[0]/x,n=e[1]/T,r=e[2]/x,i=e[3]/T;if(O)return;var o=_.flipCoords(t,n,r,i),u=_.getFixed(),a=initcr=[u.x,u.y,u.x2,u.y2],f=s.animationDelay,l=a[0],c=a[1],r=a[2],i=a[3],h=o[0]-initcr[0],p=o[1]-initcr[1],d=o[2]-initcr[2],v=o[3]-initcr[3],m=0,g=s.swingSpeed;D.animMode(!0);var y=function(){return function(){m+=(100-m)/g,a[0]=l+m/100*h,a[1]=c+m/100*p,a[2]=r+m/100*d,a[3]=i+m/100*v,m<100?b():D.done(),m>=99.8&&(m=100),nt(a)}}();b()}function tt(e){nt([e[0]/x,e[1]/T,e[2]/x,e[3]/T])}function nt(e){_.setPressed([e[0],e[1]]),_.setCurrent([e[2],e[3]]),D.update()}function rt(t){typeof t!="object"&&(t={}),s=e.extend(s,t),typeof s.onChange!="function"&&(s.onChange=function(){}),typeof s.onSelect!="function"&&(s.onSelect=function(){})}function it(){return K(_.getFixed())}function st(){return _.getFixed()}function ot(e){rt(e),ct()}function ut(){s.disabled=!0,D.disableHandles(),D.setCursor("default"),P.setCursor("default")}function at(){s.disabled=!1,ct()}function ft(){D.done(),P.activateHandlers(null,null)}function lt(){l.remove(),o.show()}function ct(e){s.allowResize?e?D.enableOnly():D.enableHandles():D.disableHandles(),P.setCursor(s.allowSelect?"crosshair":"default"),D.setCursor(s.allowMove?"move":"default"),l.css("backgroundColor",s.bgColor),"setSelect"in s&&(tt(n.setSelect),D.done(),delete s.setSelect),"trueSize"in s&&(x=s.trueSize[0]/a,T=s.trueSize[1]/f),y=s.maxSize[0]||0,b=s.maxSize[1]||0,E=s.minSize[0]||0,S=s.minSize[1]||0,"outerImage"in s&&(u.attr("src",s.outerImage),delete s.outerImage),D.refresh()}var t=t,n=n;typeof t!="object"&&(t=e(t)[0]),typeof n!="object"&&(n={}),"trackDocument"in n||(n.trackDocument=e.browser.msie?!1:!0,e.browser.msie&&e.browser.version.split(".")[0]=="8"&&(n.trackDocument=!0)),"keySupport"in n||(n.keySupport=e.browser.msie?!1:!0);var r={trackDocument:!1,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:!0,allowMove:!0,allowResize:!0,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}},s=r;rt(n);var o=e(t),u=o.clone().removeAttr("id").css({position:"absolute"});u.width(o.width()),u.height(o.height()),o.after(u).hide(),J(u,s.boxWidth,s.boxHeight);var a=u.width(),f=u.height(),l=e("<div />").width(a).height(f).addClass(F("holder")).css({position:"relative",backgroundColor:s.bgColor}).insertAfter(o).append(u);s.addClass&&l.addClass(s.addClass);var c=e("<img />").attr("src",u.attr("src")).css("position","absolute").width(a).height(f),p=e("<div />").width(j(100)).height(j(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(c),d=e("<div />").width(j(100)).height(j(100)).css("zIndex",320),v=e("<div />").css({position:"absolute",zIndex:300}).insertBefore(u).append(p,d),m=s.boundary,g=Z().width(a+m*2).height(f+m*2).css({position:"absolute",top:B(-m),left:B(-m),zIndex:290}).mousedown(G),y,b,E,S,x,T,N=!0,C=I(u),k,L,A,O,M,_=function(){function u(i){var i=m(i);n=e=i[0],r=t=i[1]}function l(e){var e=m(e);i=e[0]-n,o=e[1]-r,n=e[0],r=e[1]}function c(){return[i,o]}function p(i){var s=i[0],o=i[1];0>e+s&&(s-=s+e),0>t+o&&(o-=o+t),f<r+o&&(o+=f-(r+o)),a<n+s&&(s+=a-(n+s)),e+=s,n+=s,t+=o,r+=o}function d(e){var t=v();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function v(){if(!s.aspectRatio)return N();var i=s.aspectRatio,o=s.minSize[0]/x,u=s.minSize[1]/T,l=s.maxSize[0]/x,c=s.maxSize[1]/T,p=n-e,d=r-t,v=Math.abs(p),m=Math.abs(d),y=v/m,b,E;return l==0&&(l=a*10),c==0&&(c=f*10),y<i?(E=r,w=m*i,b=p<0?e-w:w+e,b<0?(b=0,h=Math.abs((b-e)/i),E=d<0?t-h:h+t):b>a&&(b=a,h=Math.abs((b-e)/i),E=d<0?t-h:h+t)):(b=n,h=v/i,E=d<0?t-h:t+h,E<0?(E=0,w=Math.abs((E-t)*i),b=p<0?e-w:w+e):E>f&&(E=f,w=Math.abs(E-t)*i,b=p<0?e-w:w+e)),b>e?(b-e<o?b=e+o:b-e>l&&(b=e+l),E>t?E=t+(b-e)/i:E=t-(b-e)/i):b<e&&(e-b<o?b=e-o:e-b>l&&(b=e-l),E>t?E=t+(e-b)/i:E=t-(e-b)/i),b<0?(e-=b,b=0):b>a&&(e-=b-a,b=a),E<0?(t-=E,E=0):E>f&&(t-=E-f,E=f),last=C(g(e,t,b,E))}function m(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>a&&(e[0]=a),e[1]>f&&(e[1]=f),[e[0],e[1]]}function g(e,t,n,r){var i=e,s=n,o=t,u=r;return n<e&&(i=n,s=e),r<t&&(o=r,u=t),[Math.round(i),Math.round(o),Math.round(s),Math.round(u)]}function N(){var i=n-e,s=r-t;y&&Math.abs(i)>y&&(n=i>0?e+y:e-y),b&&Math.abs(s)>b&&(r=s>0?t+b:t-b),S&&Math.abs(s)<S&&(r=s>0?t+S:t-S),E&&Math.abs(i)<E&&(n=i>0?e+E:e-E),e<0&&(n-=e,e-=e),t<0&&(r-=t,t-=t),n<0&&(e-=n,n-=n),r<0&&(t-=r,r-=r);if(n>a){var o=n-a;e-=o,n-=o}if(r>f){var o=r-f;t-=o,r-=o}if(e>a){var o=e-f;r-=o,t-=o}if(t>f){var o=t-f;r-=o,t-=o}return C(g(e,t,n,r))}function C(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var e=0,t=0,n=0,r=0,i,o;return{flipCoords:g,setPressed:u,setCurrent:l,getOffset:c,moveOffset:p,getCorner:d,getFixed:v}}(),D=function(){function g(t){var n=e("<div />").css({position:"absolute",opacity:s.borderOpacity}).addClass(F(t));return p.append(n),n}function y(t,n){var r=e("<div />").mousedown(V(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n});return d.append(r),r}function b(e){return y(e,a++).css({top:B(-m+1),left:B(-m+1),opacity:s.handleOpacity}).addClass(F("handle"))}function w(e){var t=s.handleSize,n=m,r=t,i=t,o=n,u=n;switch(e){case"n":case"s":i=j(100);break;case"e":case"w":r=j(100)}return y(e,a++).width(i).height(r).css({top:B(-o+1),left:B(-u+1)})}function E(e){for(i in e)l[e[i]]=b(e[i])}function S(e){var t=Math.round(e.h/2-m),n=Math.round(e.w/2-m),r=west=-m+1,i=e.w-m,s=e.h-m,o,u;"e"in l&&l.e.css({top:B(t),left:B(i)})&&l.w.css({top:B(t)})&&l.s.css({top:B(s),left:B(n)})&&l.n.css({left:B(n)}),"ne"in l&&l.ne.css({left:B(i)})&&l.se.css({top:B(s),left:B(i)})&&l.sw.css({top:B(s)}),"b"in l&&l.b.css({top:B(s)})&&l.r.css({left:B(i)})}function x(e,t){c.css({top:B(-t),left:B(-e)}),v.css({top:B(t),left:B(e)})}function T(e,t){v.width(e).height(t)}function N(){var e=_.getFixed();_.setPressed([e.x,e.y]),_.setCurrent([e.x2,e.y2]),C()}function C(){if(o)return k()}function k(){var e=_.getFixed();T(e.w,e.h),x(e.x,e.y),s.drawBorders&&f.right.css({left:B(e.w-1)})&&f.bottom.css({top:B(e.h-1)}),h&&S(e),o||L(),s.onChange(K(e))}function L(){v.show(),u.css("opacity",s.bgOpacity),o=!0}function A(){P(),v.hide(),u.css("opacity",1),o=!1}function M(){h&&(S(_.getFixed()),d.show())}function D(){h=!0;if(s.allowResize)return S(_.getFixed()),d.show(),!0}function P(){h=!1,d.hide()}function H(e){(O=e)?P():D()}function I(){H(!1),N()}var t,n,r,o,a=370,f={},l={},h=!1,m=s.handleOffset;s.drawBorders&&(f={top:g("hline").css("top",e.browser.msie?B(-1):B(0)),bottom:g("hline"),left:g("vline"),right:g("vline")}),s.dragEdges&&(l.t=w("n"),l.b=w("s"),l.r=w("e"),l.l=w("w")),s.sideHandles&&E(["n","s","e","w"]),s.cornerHandles&&E(["sw","nw","ne","se"]);var q=Z(
).mousedown(V("move")).css({cursor:"move",position:"absolute",zIndex:360});return p.append(q),P(),{updateVisible:C,update:k,release:A,refresh:N,setCursor:function(e){q.css("cursor",e)},enableHandles:D,enableOnly:function(){h=!0},showHandles:M,disableHandles:P,animMode:H,done:I}}(),P=function(){function i(){g.css({zIndex:450}),r&&e(document).mousemove(a).mouseup(f)}function o(){g.css({zIndex:290}),r&&e(document).unbind("mousemove",a).unbind("mouseup",f)}function a(e){t(q(e))}function f(e){return e.preventDefault(),e.stopPropagation(),k&&(k=!1,n(q(e)),s.onSelect(K(_.getFixed())),o(),t=function(){},n=function(){}),!1}function l(e,r){return k=!0,t=e,n=r,i(),!1}function c(e){g.css("cursor",e)}var t=function(){},n=function(){},r=s.trackDocument;return r||g.mousemove(a).mouseup(f).mouseout(f),u.before(g),{activateHandlers:l,setCursor:c}}(),H=function(){function r(){s.keySupport&&(t.show(),t.focus())}function i(e){t.hide()}function o(e,t,n){s.allowMove&&(_.moveOffset([t,n]),D.updateVisible()),e.preventDefault(),e.stopPropagation()}function a(e){if(e.ctrlKey)return!0;M=e.shiftKey?!0:!1;var t=M?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:D.release();break;case 9:return!0}return nothing(e)}var t=e('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(a).blur(i),n=e("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return s.keySupport&&n.insertBefore(u),{watchKeys:r}}();d.hide(),ct(!0);var ht={animateTo:et,setSelect:tt,setOptions:ot,tellSelect:it,tellScaled:st,disable:ut,enable:at,cancel:ft,focus:H.watchKeys,getBounds:function(){return[a*x,f*T]},getWidgetSize:function(){return[a,f]},release:D.release,destroy:lt};return o.data("Jcrop",ht),ht},e.fn.Jcrop=function(t){function n(n){var r=t.useImg||n.src,i=new Image;i.onload=function(){e.Jcrop(n,t)},i.src=r}return typeof t!="object"&&(t={}),this.each(function(){if(e(this).data("Jcrop")){if(t=="api")return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else n(this)}),this}})(e)}),define("image/vendor/mousewheel/mousewheel",["jquery"],function(e){(function(e){function r(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(i=n.wheelDelta/120),n.detail&&(i=-n.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(t,i,o,u),(e.event.dispatch||e.event.handle).apply(this,r)}var t=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var n=t.length;n;)e.event.fixHooks[t[--n]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],r,!1);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],r,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(e)}),define("image/image-plugin",["jquery","aloha/plugin","image/image-floatingMenu","i18n!aloha/nls/i18n","i18n!image/nls/i18n","jqueryui","image/vendor/jcrop/jquery.jcrop.min","image/vendor/mousewheel/mousewheel"],function(t,n,r,i,s){var o=t,u=t,a=window.GENTICS,f=window.Aloha;return String.prototype.toInteger=String.prototype.toInteger||function(){return parseInt(String(this).replace(/px$/,"")||0,10)},String.prototype.toFloat=String.prototype.toInteger||function(){return parseFloat(String(this).replace(/px$/,"")||0,10)},Number.prototype.toInteger=Number.prototype.toInteger||String.prototype.toInteger,Number.prototype.toFloat=Number.prototype.toFloat||String.prototype.toFloat,o.extend(!0,o.fn,{increase:o.fn.increase||function(e){var t=o(this),n,r;return t.length?(n=t.css(e).toFloat(),r=Math.round((n||1)*1.2),n===r&&r++,t.css(e,r),t):t},decrease:o.fn.decrease||function(e){var t=o(this),n,r;return t.length?(n=t.css(e).toFloat(),r=Math.round((n||0)*.8),n===r&&r>0&&r--,t.css(e,r),t):t}}),n.create("image",{languages:["en","fr","de","ru","cz"],defaultSettings:{maxWidth:1600,minWidth:3,maxHeight:1200,minHeight:3,autoCorrectManualInput:!0,fixedAspectRatio:!1,autoResize:!1,ui:{oneTab:!1,insert:!0,reset:!0,aspectRatioToggle:!0,align:!0,resize:!0,meta:!0,margin:!0,crop:!0,resizable:!0,handles:"ne, se, sw, nw"},onCropped:function(e,t){f.Log.info("Default onCropped invoked",e,t)},onReset:function(e){return f.Log.info("Default onReset invoked",e),!1},onResize:function(e){f.Log.info("Default onResize invoked",e)},onResized:function(e){f.Log.info("Default onResized invoked",e)}},_onCropped:function(e,t){u("#"+this.ui.imgResizeHeightField.getInputId()).val(e.height()),u("#"+this.ui.imgResizeWidthField.getInputId()).val(e.width()),u("body").trigger("aloha-image-cropped",[e,t]),this.onCropped(e,t)},_onReset:function(e){return u("#"+this.ui.imgResizeHeightField.getInputId()).val(e.height()),u("#"+this.ui.imgResizeWidthField.getInputId()).val(e.width()),u("body").trigger("aloha-image-reset",e),this.onReset(e)},_onResize:function(e){u("#"+this.ui.imgResizeHeightField.getInputId()).val(e.height()),u("#"+this.ui.imgResizeWidthField.getInputId()).val(e.width()),u("body").trigger("aloha-image-resize",e),this.onResize(e)},_onResized:function(e){u("#"+this.ui.imgResizeHeightField.getInputId()).val(e.height()),u("#"+this.ui.imgResizeWidthField.getInputId()).val(e.width()),u("body").trigger("aloha-image-resized",e),this.onResized(e)},imageObj:null,jcAPI:null,keepAspectRatio:!1,startAspectRatio:!1,restoreProps:[],objectTypeFilter:[],init:function(){var e=this,t=f.getPluginUrl("image");e.startAspectRatio=e.settings.fixedAspectRatio,e.config=e.defaultSettings,e.settings=o.extend(!0,e.defaultSettings,e.settings),e.initializeUI(),e.bindInteractions(),e.subscribeEvents()},initializeUI:function(){var e=this;this.ui=new r,this.ui.init(this)},bindInteractions:function(){var e=this;if(e.settings.ui.resizable)try{document.execCommand("enableObjectResizing",!1,!1)}catch(t){f.Log.info(t,"Could not disable enableObjectResizing")}e.settings.ui.meta&&(e.ui.imgSrcField.addListener("keyup",function(t){e.srcChange()}),e.ui.imgSrcField.addListener("blur",function(t){var n=o(e.ui.imgSrcField.getTargetObject());n.attr("src")===""&&n.remove()})),e.settings.onCropped&&typeof e.settings.onCropped=="function"&&(e.onCropped=e.settings.onCropped),e.settings.onReset&&typeof e.settings.onReset=="function"&&(e.onReset=e.settings.onReset),e.settings.onResized&&typeof e.settings.onResized=="function"&&(e.onResized=e.settings.onResized),e.settings.onResize&&typeof e.settings.onResize=="function"&&(e.onResize=this.settings.onResize)},subscribeEvents:function(){var e=this,t=this.settings;o("img").filter(t.globalselector).unbind(),o("img").filter(t.globalselector).click(function(t){e.clickImage(t)}),f.bind("aloha-drop-files-in-editable",function(t,n){var r,i=n.filesObjs.length,s,u;while(--i>=0)s=n.filesObjs[i],s.file.type.match(/image\//)&&(u=e.getEditableConfig(n.editable),r=o("<img/>"),r.css({"max-width":that.maxWidth,"max-height":that.maxHeight}),r.attr("id",s.id),typeof s.src=="undefined"?r.attr("src",s.data):r.attr("src",s.src),a.Utils.Dom.insertIntoDOM(r,n.range,o(f.activeEditable.obj)))}),f.bind("aloha-selection-changed",function(t,n,r){var i,s;r&&r.target&&e.settings.ui.resizable&&!o(r.target).hasClass("ui-resizable-handle")&&(e.endResize(),e.imageObj=null,f.trigger("aloha-image-unselected"));if(f.activeEditable!==null){s=e.findImgMarkup(n),i=e.getEditableConfig(f.activeEditable.obj);if(typeof i=="undefined"){e.ui._insertImageButton.hide();return}e.ui._insertImageButton.show(),s?(e.ui._insertImageButton.show(),e.ui.setScope(),e.settings.ui.meta&&(e.ui.imgSrcField.setTargetObject(s,"src"),e.ui.imgTitleField.setTargetObject(s,"title")),e.ui.imgSrcField.foreground(),e.ui.imgSrcField.focus()):e.settings.ui.meta&&e.ui.imgSrcField.setTargetObject(null),e.ui.doLayout()}}),f.bind("aloha-editable-created",function(t,n){try{document.execCommand("enableObjectResizing",!1,!1)}catch(r){f.Log.info(r,"Could not disable enableObjectResizing")}n.obj.delegate("img","mouseup",function(t){e.clickImage(t),t.stopPropagation()})}),e._subscribeToResizeFieldEvents()},autoResize:function(){var e=this,t=e.imageObj.width(),n=e.imageObj.height(),r=!1;if(t<e.settings.minWidth||t>e.settings.maxWidth||n<e.settings.minHeight||n>e.settings.maxHeight)r=!0;return r&&t>=n?(e._setNormalizedFieldValues("width"),e.setSizeByFieldValue(),!0):r&&t<n?(e._setNormalizedFieldValues("height"),e.setSizeByFieldValue(),!0):!1},toggleKeepAspectRatio:function(){this.keepAspectRatio=!this.keepAspectRatio,this.endResize();if(!this.keepAspectRatio)this.startAspectRatio=!1;else if(typeof this.settings.fixedAspectRatio!="number"){var e=this.imageObj.width()/this.imageObj.height();this.startAspectRatio=e}else this.startAspectRatio=this.settings.fixedAspectRatio;this.startResize()},_subscribeToResizeFieldEvents:function(){function t(t,n,r,i){typeof i=="undefined"&&(i=0),typeof r=="undefined"&&(r=8e3);var s=parseInt(t.val(),10);if(isNaN(s))return t.css("background-color","red"),!1;var o=s+n;return n>=0&&o>r?e.settings.autoCorrectManualInput?(t.val(r),!0):(t.css("background-color","red"),!1):n<=0&&o<i?e.settings.autoCorrectManualInput?(t.val(i),!0):(t.css("background-color","red"),!1):(t.css("background-color",""),t.val(s+n),!0)}function n(n){var r=n.data.minValue,i=n.data.maxValue,s=n.data.fieldName;if(n.keyCode===8||n.keyCode===46)u(this).val()>=r&&(typeof e.jcAPI!="undefined"&&e.jcAPI!==null?e.setCropAreaByFieldValue():(e._setNormalizedFieldValues(s),e.setSizeByFieldValue()));else if(n.keyCode<=57&&n.keyCode>=48||n.keyCode<=105&&n.keyCode>=96)u(this).val()>=r&&(typeof e.jcAPI!="undefined"&&e.jcAPI!==null?e.setCropAreaByFieldValue():(e._setNormalizedFieldValues(s),e.setSizeByFieldValue()));else{var o=0;if(n.keyCode===38||n.keyCode===107)o=1;else if(n.keyCode===40||n.keyCode===109)o=-1;if(n.shiftKey||n.metaKey||n.ctrlKey)o*=10;t(u(this),o,i,r)&&(typeof e.jcAPI!="undefined"&&e.jcAPI!==null?e.setCropAreaByFieldValue():(e._setNormalizedFieldValues(s),e.setSizeByFieldValue()))}return n.preventDefault(),!1}function r(n,r){var i=n.data.minValue,s=n.data.maxValue,o=n.data.fieldName;if(n.shiftKey||n.metaKey||n.ctrlKey)r*=10;return t(u(this),r,s,i)&&(typeof e.jcAPI!="undefined"&&e.jcAPI!==null?e.setCropAreaByFieldValue():(e._setNormalizedFieldValues(o),e.setSizeByFieldValue())),!1}var e=this,i=u("#"+e.ui.imgResizeHeightField.getInputId()),s={fieldName:"height",maxValue:e.ui.imgResizeHeightField.maxValue,minValue:e.ui.imgResizeHeightField.minValue};i.live("keyup",s,n),i.live("mousewheel",s,r);var o=u("#"+e.ui.imgResizeWidthField.getInputId()),a={fieldName:"width",maxValue:e.ui.imgResizeWidthField.maxValue,minValue:e.ui.imgResizeWidthField.minValue};o.live("keyup",a,n),o.live("mousewheel",a,r)},_setNormalizedFieldValues:function(e){var t=this,n=o("#"+t.ui.imgResizeWidthField.getInputId()),r=o("#"+t.ui.imgResizeHeightField.getInputId()),i=n.val(),s=r.val(),u=t._normalizeSize(i,s,e);n.val(u.width),r.val(u.height)},setSize:function(e,t){var n=this;n.imageObj.width(e),n.imageObj.height(t);var r=n.imageObj.closest(".Aloha_Image_Resize");r.height(t),r.width(e),n._onResize(n.imageObj),n._onResized(n.imageObj)},clickImage:function(e){var t=this;t.endResize(),t.imageObj=o(e.target);var n=t.imageObj;t.ui.setScope();var r=n.closest(".aloha-editable");this.restoreProps.push({obj:e.srcElement,src:t.imageObj.attr("src"),width:t.imageObj.width(),height:t.imageObj.height()}),u("#"+t.ui.imgResizeHeightField.getInputId()).val(t.imageObj.height()),u("#"+t.ui.imgResizeWidthField.getInputId()).val(t.imageObj.width()),t.settings.ui.meta&&(t.ui.imgSrcField.setTargetObject(t.imageObj,"src"),t.ui.imgTitleField.setTargetObject(t.imageObj,"title")),f.Selection.preventSelectionChanged();try{t.ui.imgSrcField.focus()}catch(e){}t.settings.ui.resizable&&t.startResize(),t.settings.autoResize&&t.autoResize(),f.Selection.preventSelectionChangedFlag=!1,f.trigger("aloha-image-selected")},findImgMarkup:function(e){var t=this,n=this.config,r,i;typeof e=="undefined"&&(e=f.Selection.getRangeObject()),i=o(e.startContainer);try{if(f.activeEditable)return typeof e.startContainer!="undefined"&&typeof e.startContainer.childNodes!="undefined"&&typeof e.startOffset!="undefined"&&typeof e.startContainer.childNodes[e.startOffset]!="undefined"&&e.startContainer.childNodes[e.startOffset].nodeName.toLowerCase()==="img"&&e.startOffset+1===e.endOffset||i.hasClass("Aloha_Image_Resize")?(r=i.find("img")[0],r.css||(r.css=""),r.title||(r.title=""),r.src||(r.src=""),r):null}catch(s){f.Log.debug(s,"Error finding img markup.")}return null},getPluginFocus:function(){return this.imageObj},_normalizeSize:function(e,t,n){function i(n){if(t>r.settings.maxHeight){var i={org:t,"new":r.settings.maxHeight};u("body").trigger("aloha-image-resize-outofbounds",["height","max",i]),t=r.settings.maxHeight}else if(t<r.settings.minHeight){var i={org:t,"new":r.settings.minHeight};u("body").trigger("aloha-image-resize-outofbounds",["height","min",i]),t=r.settings.minHeight}r.keepAspectRatio&&(e=t*o,n&&s(!1))}function s(n){if(e>r.settings.maxWidth){var s={org:e,"new":r.settings.maxWidth};u("body").trigger("aloha-image-resize-outofbounds",["width","max",s]),e=r.settings.maxWidth}else if(e<r.settings.minWidth){var s={org:e,"new":r.settings.minWidth};u("body").trigger("aloha-image-resize-outofbounds",["width","min",s]),e=r.settings.minWidth}r.keepAspectRatio&&(t=e/o,n&&i(!1))}var r=this;e=parseInt(e),t=parseInt(t);var o=1.33333;return r.keepAspectRatio&&(o=e/t),typeof r.startAspectRatio=="number"&&(o=r.startAspectRatio),n=="width"&&s(!0),n=="height"&&i(!0),{width:Math.floor(e),height:Math.floor(t)}},setSizeByFieldValue:function(){var e=this,t=u("#"+e.ui.imgResizeWidthField.getInputId()).val(),n=u("#"+e.ui.imgResizeHeightField.getInputId()).val();e.setSize(t,n)},setCropAreaByFieldValue:function(){var e=this,t=e.jcAPI.tellSelect(),n=u("#"+e.ui.imgResizeWidthField.getInputId()).val();n=parseInt(n,10);var r=u("#"+e.ui.imgResizeHeightField.getInputId()).val();r=parseInt(r,10);var i=[t.x,t.y,t.x+n,t.y+r];e.jcAPI.setSelect(i)},insertImg:function(){var e=f.Selection.getRangeObject(),t=this.getEditableConfig(f.activeEditable.obj),n=f.getPluginUrl("image"),r,i,s;e.isCollapsed()?(r="max-width: "+t.maxWidth+"; max-height: "+t.maxHeight,i='<img style="'+r+'" src="'+n+'/img/blank.jpg" title="" />',s=o(i),a.Utils.Dom.insertIntoDOM(s,e,o(f.activeEditable.obj))):f.Log.error("img cannot markup a selection")},srcChange:function(){this.imageObj.attr("src",this.ui.imgSrcField.getValue())},positionCropButtons:function(){var e=o(".jcrop-tracker:first"),t=e.offset(),n=t.top,r=t.left,i=e.height(),s=e.width(),u=0,a=0,f=o("#aloha-CropNResize-btns");n===0&&r===0&&f.hide(),n=parseInt(n+i+3,10),r=parseInt(r+s/2-f.width()/2+10,10),(u!=r||a!=n)&&f.offset({top:n,left:r}),u=r,a=n},initCropButtons:function(){var e=this,t;o("body").append('<div id="aloha-CropNResize-btns" display="none"><button class="cnr-crop-apply" title="'+s.t("Accept")+'"></button>'+'<button class="cnr-crop-cancel" title="'+s.t("Cancel")+'"></button>'+"</div>"),t=o("#aloha-CropNResize-btns"),t.find(".cnr-crop-apply").click(function(){e.acceptCrop()}),t.find(".cnr-crop-cancel").click(function(){e.endCrop()}),this.interval=setInterval(function(){e.positionCropButtons()},10)},destroyCropButtons:function(){o("#aloha-CropNResize-btns").remove(),clearInterval(this.interval)},_disableSelection:function(e){e.find("*").attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"})},crop:function(){var e=this,t=this.config;e.initCropButtons(),e.settings.ui.resizable&&e.endResize(),e.jcAPI=o.Jcrop(e.imageObj,{onSelect:function(){e._onCropSelect(),window.setTimeout(function(){e.ui.setScope()},10)}}),e._disableSelection(u(".jcrop-holder")),e._disableSelection(u("#imageContainer")),e._disableSelection(u("#aloha-CropNResize-btns")),u("body").trigger("aloha-image-crop-start",[e.imageObj])},_onCropSelect:function(){var e=this;o("#aloha-CropNResize-btns").fadeIn("slow"),o(".jcrop-handle").mousedown(function(){o("#aloha-CropNResize-btns").hide()}),o(".jcrop-tracker").mousedown(function(){o("#aloha-CropNResize-btns").hide()});if(typeof e.jcAPI!="undefined"&&e.jcAPI!==null){e.positionCropButtons();var t=e.jcAPI.tellSelect(),n=o("#"+e.ui.imgResizeWidthField.getInputId()).val(t.w),r=o("#"+e.ui.imgResizeHeightField.getInputId()).val(t.h)}},endCrop:function(){this.jcAPI&&(this.jcAPI.destroy(),this.jcAPI=null),this.destroyCropButtons(),this.ui._imageCropButton.setState(!1),this.settings.ui.resizable&&this.startResize();if(this.keepAspectRatio){var e=this.imageObj.width()/this.imageObj.height();this.startAspectRatio=e}u("body").trigger("aloha-image-crop-stop",[this.imageObj])},acceptCrop:function(){this._onCropped(this.imageObj,this.jcAPI.tellSelect()),this.endCrop()},startResize:function(){var e=this,t=this.imageObj;t=this.imageObj.css({height:this.imageObj.height(),width:this.imageObj.width(),position:"relative","max-height":"","max-width":""}),t.resizable({maxHeight:e.settings.maxHeight,minHeight:e.settings.minHeight,maxWidth:e.settings.maxWidth,minWidth:e.settings.minWidth,aspectRatio:e.startAspectRatio,handles:e.settings.handles,grid:e.settings.grid,resize:function(t,n){e._onResize(e.imageObj)},stop:function(t,n){e._onResized(e.imageObj),this.enableCrop&&window.setTimeout(function(){e.ui.setScope(),that.done(t)},10)}}),t.css("display","inline-block"),o(".ui-wrapper").attr("contentEditable",!1).addClass("aloha-image-box-active Aloha_Image_Resize aloha").css({position:"relative",display:"inline-block","float":e.imageObj.css("float")}).bind("resizestart",function(e){e.preventDefault()}).bind("mouseup",function(e){e.originalEvent.stopSelectionUpdate=!0})},endResize:function(){if(this.imageObj)var e=this.imageObj.closest(".aloha-editable");this.imageObj&&this.imageObj.is(":ui-resizable")&&this.imageObj.resizable("destroy").css({top:0,left:0})},resetSize:function(){var e=this,t=new Image;t.onload=function(){var n=e.getPluginFocus();e.settings.ui.resizable&&e.endResize(),o(n).add(n.parent()).css({width:t.width+"px",height:t.height+"px","max-width":"","max-height":""}),e.settings.ui.resizable&&e.resize()},t.src=e.getPluginFocus().attr("src")},reset:function(){this.settings.ui.crop&&this.endCrop(),this.settings.ui.resizable&&this.endResize();if(this._onReset(this.imageObj))return;for(var e=0;e<this.restoreProps.length;e++)if(this.imageObj.get(0)===this.restoreProps[e].obj){this.imageObj.attr("src",this.restoreProps[e].src),this.imageObj.width(this.restoreProps[e].width),this.imageObj.height(this.restoreProps[e].height);return}}})}),define("highlighteditables/highlighteditables-plugin",["aloha","jquery","aloha/plugin"],function(e,t,n){var r=window.GENTICS;return n.create("highlighteditables",{config:["highlight"],init:function(){var t=this,n;r.Utils.Position.addMouseMoveCallback(function(){var r,i;for(r=0;r<e.editables.length;r++)i=e.editables[r],n=t.getEditableConfig(i.obj),!e.activeEditable&&!i.isDisabled()&&n=="highlight"&&i.obj.addClass("aloha-editable-highlight")}),r.Utils.Position.addMouseStopCallback(function(){t.fade()}),e.bind("aloha-editable-activated",function(e,n){t.fade()})},fade:function(){var n,r,i=function(){t(this).css("outline","")};for(n=0;n<e.editables.length;n++)r=e.editables[n].obj,r.hasClass("aloha-editable-highlight")&&r.css("outline",r.css("outlineColor")+" "+r.css("outlineStyle")+" 5px").removeClass("aloha-editable-highlight").animate({outlineWidth:"0px"},300,"swing",i)}})}),define("dom-to-xhtml/dom-to-xhtml",["aloha","jquery","aloha/console"],function(e,t,n){function r(e){var n=e.attributes,r=[];for(var i=0;i<n.length;i++){var s=n[i];if(typeof s.specified=="undefined"||s.specified){var o=s.nodeName,u="style"===o?t.attr(e,o):s.nodeValue;r.push([o,u])}}return r}function o(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function u(e){return o(e).replace(/"/g,"&quot;")}function a(e){var n=r(e),i="";for(var o=0;o<n.length;o++){var a=n[o][0].toLowerCase(),f=n[o][1],l=-1!==t.inArray(a.toLowerCase(),s);if(!l&&(""===f||null==f))continue;i+=" "+a+'="'+u(""+(l?a:f))+'"'}return i}function f(e){var t="/"+e.nodeName,n=e.nextSibling;while(null!=n){if(t==n.nodeName)return!0;n=n.nextSibling}return!1}function l(e,t,n,r){while(null!=t){if(1===t.nodeType&&n&&"/"+e.nodeName==t.nodeName){t=t.nextSibling;break}1===t.nodeType&&f(t)?t=c(t,t.nextSibling,!0,r):(h(t,r),t=t.nextSibling)}return t}function c(e,n,r,s){var o=e.nodeName.toLowerCase();return e.scopeName&&"HTML"!=e.scopeName&&-1===o.indexOf(":")&&(o=e.scopeName.toLowerCase()+":"+o),!r&&null==n&&-1!==t.inArray(o,i)?s.push("<"+o+a(e)+"/>"):(s.push("<"+o+a(e)+">"),n=l(e,n,r,s),s.push("</"+o+">")),n}function h(e,t){var r=e.nodeType;1===r?c(e,e.firstChild,f(e),t):3===e.nodeType?t.push(o(e.nodeValue)):8===e.nodeType?t.push("<!--"+e.nodeValue+"-->"):n.log("Unknown node type encountered during serialization, ignoring it: type="+e.nodeType+" name="+e.nodeName+" value="+e.nodeValue)}var i=["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param","embed"],s=["checked","compact","declare","defer","disabled","ismap","multiple","nohref","noresize","noshade","nowrap","readonly","selected"];return{contentsToXhtml:function(e){var t=[];return l(e,e.firstChild,!1,t),t.join("")},nodeToXhtml:function(e){var t=[];return h(e,t),t.join("")}}}),define("dom-to-xhtml/dom-to-xhtml-plugin",["aloha","jquery","aloha/plugin","dom-to-xhtml/dom-to-xhtml"],function(e,t,n,r){return n.create("dom-to-xhtml",{init:function(){var n=this;e.Editable.setContentSerializer(function(e){return!n.settings.editables&&!n.settings.config?r.contentsToXhtml(e):n.settings.editables&&n.settings.editables["#"+t(e).attr("id")]=="dom-to-xhtml"?r.contentsToXhtml(e):n.settings.config&&n.settings.config=="dom-to-xhtml"&&!n.settings.editables["#"+t(e).attr("id")]?r.contentsToXhtml(e):t(e).html()})}})}),define("contenthandler/wordcontenthandler",["aloha","jquery","aloha/contenthandlermanager"],function(e,t,n){var r=n.createHandler({handleContent:function(e){return typeof e=="string"?e=t("<div>"+e+"</div>"):e instanceof t&&(e=t("<div>").append(e)),this.detectWordContent(e)&&this.transformWordContent(e),e.html()},detectWordContent:function(e){var n=!1;return e.find("*").each(function(){var e=t(this).attr("style"),r;if(e&&e.toLowerCase().indexOf("mso")>=0)return n=!0,!1;r=t(this).attr("class");if(r&&r.toLowerCase().indexOf("mso")>=0)return n=!0,!1}),n},isOrderedList:function(e){return e.css("fontFamily")=="Wingdings"||e.css("fontFamily")=="Symbol"?!1:e.text().match(/^([0-9]{1,3}\.)|([0-9]{1,3}\)|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\)))$/)?!0:!1},transformListsFromWord:function(e){var n=this,r,i,s,o,u,a;a="aloha-list-element",u="aloha-list-bullet",i="p.MsoListParagraphCxSpFirst,p.MsoListParagraphCxSpMiddle,p.MsoListParagraphCxSpLast,p.MsoListParagraph,p span",o=e.find(i),o.each(function(){var e=t(this),n=e.css("font-family")||"",r=e.css("mso-list")||"",i=e.attr("style")||"";e.hasClass("MsoListParagraphCxSpFirst")||e.hasClass("MsoListParagraph")?e.addClass(a):n.indexOf("Symbol")>=0?e.closest("p").addClass(a):n.indexOf("Wingdings")>=0?e.closest("p").addClass(a):r!==""?e.closest("p").addClass(a):i.indexOf("mso-list")>=0&&e.closest("p").addClass(a)}),i="p span span span",s=e.find(i),s.each(function(){var e=t(this),n=t.trim(e.text()).replace(/&nbsp;/g,""),r;n.length===0&&(r=t.trim(e.parent().parent().text()).replace(/&nbsp;/g,""),r.match(/^([0-9]{1,3}\.)|([0-9]{1,3}\))|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\))|(.)$/)&&(e.closest("p").addClass(a),e.parent().parent().addClass(u)))}),i="p."+a,r=":not("+i+", font)",o=e.find(i),o.length>0&&o.each(function(){var e=t(this),i,s,o,f,l,c,h,p;e.removeClass(a),e.find("font").each(function(){t(this).contents().unwrap()}),p=[],h=parseFloat(e.css("marginLeft")),isNaN(h)&&(h=0),c=[],l=e.nextUntil(r),f=t(e.find("span."+u)),f.length===0&&(f=e.find("span").eq(0)),o=n.isOrderedList(f),f.remove(),s=t(o?"<ol></ol>":"<ul></ul>"),c.push(s),i=t("<li></li>"),s.append(i),e.contents().appendTo(i),e.replaceWith(s),l.each(function(){var e=t(this),r,a;if(e.is("font"))return;e.find("font").each(function(){t(this).contents().unwrap()}),r=parseFloat(e.css("marginLeft")),isNaN(r)&&(r=0),f=t(e.find("span."+u)),f.length===0&&(f=e.find("span").eq(0)),o=n.isOrderedList(f),f.remove();if(r>h)a=t(o?"<ol></ol>":"<ul></ul>"),s.children(":last").append(a),s=a,c.push(s),p.push(r),h=r;else if(r<h&&p.length>0){while(p.length>0&&p[p.length-1]>r)p.pop(),c.pop();s=c[c.length-1],h=r}i=t("<li></li>"),s.append(i),e.contents().appendTo(i),e.remove()})})},transformTitles:function(n){n.find("p.MsoTitle").each(function(){e.Markup.transformDomObject(t(this),"h1")}),n.find("p.MsoSubtitle").each(function(){e.Markup.transformDomObject(t(this),"h2")})},cleanHtml:function(e){e.find("*").filter(function(){return t.trim(t(this).text())==""&&!t(this).is("td")}).contents().unwrap(),e.find("span").contents().unwrap(),e.find("a").each(function(){t(this).attr("href")&&t.trim(t(this).attr("href")).match(/^#(.*)$/)&&t(this).contents().unwrap()}),e.find("div").contents().unwrap(),e.find("*").filter(function(){return t.trim(t(this).text())==""&&!t(this).is("td")}).remove()},removeParagraphNumbering:function(e){var n="h1,h2,h3,h4,h5,h6",r=e.find(n);r.length>0&&r.each(function(){var e=t(this),n=e.find("span"),r=e.find("a");n.each(function(){t.trim(t(this).text()).match(/^([\.\(]?[\d\D][\.\(]?){1,4}$/)&&t(this).remove()}),r.each(function(){typeof t(this).attr("href")=="undefined"&&t(this).contents().unwrap()})})},transformToc:function(e){var n="[class*=MsoToc]",r=e.find(n);r.each(function(){var e=t(this),n=e.find("span"),r=e.find("a");n.each(function(){t(this).attr("style")&&t(this).attr("style").search("mso-hide")>-1&&t(this).remove(),t(this).contents().unwrap()}),r.each(function(){t(this).contents().unwrap()})})},transformWordContent:function(e){this.transformToc(e),this.removeParagraphNumbering(e),this.transformListsFromWord(e),this.transformTitles(e),this.cleanHtml(e)}});return r}),define("contenthandler/genericcontenthandler",["aloha","jquery","aloha/contenthandlermanager"],function(e,t,n){var r=window.GENTICS,i=n.createHandler({handleContent:function(n){if(null==n)return;typeof n=="string"?n=t("<div>"+n+"</div>"):n instanceof t&&(n=t("<div>").append(n));if(n.find(".aloha-block").length>0)return;this.cleanLists(n),this.transformTables(n),this.removeComments(n),this.unwrapTags(n),this.removeStyles(n),this.removeNamespacedElements(n);var r=!0;return e.settings&&e.settings.contentHandler&&e.settings.contentHandler.handler&&e.settings.contentHandler.handler.generic&&typeof e.settings.contentHandler.handler.generic.transformFormattings!="undefinded"&&!e.settings.contentHandler.handler.generic.transformFormattings&&(r=!1),r===!0&&this.transformFormattings(n),n.html()},cleanLists:function(e){e.find("ul,ol").each(function(){var e=t(this);e.contents(":not(li,ul,ol)").each(function(){t(this).remove()})})},transformTables:function(e){e.find("table").each(function(){t(this).removeAttr("border").removeAttr("cellspacing").removeAttr("cellpadding")}),e.find("td").each(function(){t(this).removeAttr("width").removeAttr("height").removeAttr("valign"),this.innerHTML.replace(/[\s\xA0]+/g,"")==="<p><br></p>"&&(this.innerHTML="&nbsp;"),t(this).find("p").length===1&&t(this).find("p").contents().unwrap()}),e.find("tr").each(function(){t(this).removeAttr("width").removeAttr("height").removeAttr("valign")}),e.find("colgroup").remove()},transformFormattings:function(n){n.find("strong,em,s,u,strike").each(function(){this.nodeName==="STRONG"?e.Markup.transformDomObject(t(this),"b"):this.nodeName==="EM"?e.Markup.transformDomObject(t(this),"i"):this.nodeName==="S"||this.nodeName=="STRIKE"?e.Markup.transformDomObject(t(this),"del"):this.nodeName==="U"&&t(this).contents().unwrap()})},transformLinks:function(e){e.find("a").each(function(){typeof t(this).attr("href")=="undefined"&&t(this).contents().unwrap()})},removeComments:function(e){var n=this;e.contents().each(function(){this.nodeType===8?t(this).remove():n.removeComments(t(this))})},unwrapTags:function(n){var r=this;n.find("span,font,div").not(".aloha-wai-lang").each(function(){this.nodeName=="DIV"?this.innerHTML==="<br>"?t(this).contents().unwrap():t(e.Markup.transformDomObject(t(this),"p").append("<br>")).contents().unwrap():t(this).contents().unwrap()})},removeStyles:function(e){var n=this;e.children("style").filter(function(){return this.contentEditable!=="false"}).remove(),e.children().filter(function(){return this.contentEditable!=="false"}).each(function(){t(this).removeAttr("style").removeClass(),n.removeStyles(t(this))})},removeNamespacedElements:function(e){e.find("*").each(function(){var e=this.prefix?this.prefix:this.scopeName?this.scopeName:undefined;if(e&&e!=="HTML"||this.nodeName.indexOf(":")>=0){var n=t(this),r=n.contents();r.length?r.unwrap():n.remove()}})}});return i}),define("contenthandler/oembedcontenthandler",["aloha","jquery","aloha/contenthandlermanager"],function(e,t,n){function c(e,t){var n=e.apiendpoint,r="",s=e.callbackparameter||"callback",o;n.indexOf("?")<=0?n+="?":n+="&",e.maxWidth!=null&&e.params["maxwidth"]==null&&(e.params.maxwidth=e.maxWidth),e.maxHeight!=null&&e.params["maxheight"]==null&&(e.params.maxheight=e.maxHeight);for(o in e.params){if(o==e.callbackparameter)continue;e.params[o]!=null&&(r+="&"+i(o)+"="+e.params[o])}return n+="format=json&url="+i(t)+r+"&"+s+"=?",n}function h(e,n,r){var i=c(r,n),s=t.extend({url:i,type:"get",dataType:"json",success:function(r){var i=t.extend({},r);switch(i.type){case"photo":i.code=t.fn.oembed.getPhotoCode(n,i);break;case"video":i.code=t.fn.oembed.getVideoCode(n,i);break;case"rich":i.code=t.fn.oembed.getRichCode(n,i);break;default:i.code=t.fn.oembed.getGenericCode(n,i)}f.beforeEmbed.call(e,i),f.onEmbed.call(e,i),f.afterEmbed.call(e,i)},error:f.onError.call(e,n,r)},f.ajaxOptions||{});t.ajax(s)}function p(){l=[];var e,n=[],r,i;if(!v(f.allowedProviders)){for(r=0;r<t.fn.oembed.providers.length;r++)t.inArray(t.fn.oembed.providers[r].name,f.allowedProviders)>=0&&l.push(t.fn.oembed.providers[r]);f.greedy=!1}else l=t.fn.oembed.providers;if(!v(f.disallowedProviders)){for(r=0;r<l.length;r++)t.inArray(l[r].name,f.disallowedProviders)<0&&n.push(l[r]);l=n,f.greedy=!1}v(f.customProviders)||t.each(f.customProviders,function(e,n){n instanceof t.fn.oembed.OEmbedProvider?l.push(i):(i=new t.fn.oembed.OEmbedProvider,i.fromJSON(n)&&l.push(i))}),e=d(f.defaultOEmbedProvider),f.greedy==1&&l.push(e);for(r=0;r<l.length;r++)l[r].apiendpoint==null&&(l[r].apiendpoint=e.apiendpoint)}function d(e){var n="http://oohembed.com/oohembed/";return e=="embed.ly"&&(n="http://api.embed.ly/v1/api/oembed?"),new t.fn.oembed.OEmbedProvider(e,null,null,n,"callback")}function u(e){if(e==null)return null;var t,n={};for(t in e)t!=null&&(n[t.toLowerCase()]=e[t]);return n}function v(e){return typeof e=="undefined"?!0:e==null?!0:t.isArray(e)&&e.length==0?!0:!1}var r=window.GENTICS,i=window.escape,s,o,u,a;t.fn.oembed=function(e,n,r){return f=t.extend(!0,t.fn.oembed.defaults,n),p(),this.each(function(){var n=t(this),i=e!=null?e:n.attr("href"),s;return r?f.onEmbed=r:f.onEmbed=function(e){t.fn.oembed.insertCode(this,f.embedMethod,e)},i!=null&&(s=t.fn.oembed.getOEmbedProvider(i),s!=null?(s.params=u(f[s.name])||{},s.maxWidth=f.maxWidth,s.maxHeight=f.maxHeight,h(n,i,s)):f.onProviderNotFound.call(n,i)),n})};var f,l=[];t.fn.oembed.defaults={maxWidth:null,maxHeight:null,embedMethod:"replace",defaultOEmbedProvider:"oohembed",allowedProviders:null,disallowedProviders:null,customProviders:null,defaultProvider:null,greedy:!0,onProviderNotFound:function(){},beforeEmbed:function(){},afterEmbed:function(){},onEmbed:function(){},onError:function(){},ajaxOptions:{}},t.fn.oembed.embedCode=!1,t.fn.oembed.insertCode=function(e,n,r){if(r==null)return;t.fn.oembed.embedCode=r.code;switch(n){case"auto":e.attr("href")!=null?t.fn.oembed.insertCode(e,"append",r):t.fn.oembed.insertCode(e,"replace",r);break;case"replace":e.replaceWith(r.code);break;case"fill":e.html(r.code);break;case"append":var i=e.next();if(i==null||!i.hasClass("oembed-container"))i=e.after('<div class="oembed-container"></div>').next(".oembed-container"),r!=null&&r.provider_name!=null&&i.toggleClass("oembed-container-"+r.provider_name);i.html(r.code)}},t.fn.oembed.getInsertCode=function(e,t,n){if(n==null)return;return n.code},t.fn.oembed.getPhotoCode=function(e,t){var n,r=t.title?t.title:"";return r+=t.author_name?" - "+t.author_name:"",r+=t.provider_name?" - "+t.provider_name:"",n='<div><a href="'+e+"\" target='_blank'><img src=\""+
t.url+'" alt="'+r+'"/></a></div>',t.html&&(n+="<div>"+t.html+"</div>"),n},t.fn.oembed.getVideoCode=function(e,t){var n=t.html;return n},t.fn.oembed.getRichCode=function(e,t){var n=t.html;return n},t.fn.oembed.getGenericCode=function(e,t){var n=t.title!=null?t.title:e,r='<a href="'+e+'">'+n+"</a>";return t.html&&(r+="<div>"+t.html+"</div>"),r},t.fn.oembed.isProviderAvailable=function(e){var t=o(e);return t!=null},t.fn.oembed.getOEmbedProvider=function(e){for(var t=0;t<l.length;t++)if(l[t].matches(e))return l[t];return null},t.fn.oembed.OEmbedProvider=function(e,n,r,i,s){function f(e){return v(e)?["."]:t.isArray(e)?e:e.split(";")}this.name=e,this.type=n,this.urlschemes=f(r),this.apiendpoint=i,this.callbackparameter=s,this.maxWidth=500,this.maxHeight=400;var o,u,a;this.matches=function(e){for(o=0;o<this.urlschemes.length;o++){a=new RegExp(this.urlschemes[o],"i");if(e.match(a)!=null)return!0}return!1},this.fromJSON=function(e){for(u in e)u!="urlschemes"?this[u]=e[u]:this[u]=f(e[u]);return!0}},t.fn.oembed.providers=[new t.fn.oembed.OEmbedProvider("youtube","video",["youtube\\.com/watch.+v=[\\w-]+&?"]),new t.fn.oembed.OEmbedProvider("flickr","photo",["flickr\\.com/photos/[-.\\w@]+/\\d+/?"],"http://flickr.com/services/oembed","jsoncallback"),new t.fn.oembed.OEmbedProvider("viddler","video",["viddler.com"]),new t.fn.oembed.OEmbedProvider("blip","video",["blip\\.tv/.+"],"http://blip.tv/oembed/"),new t.fn.oembed.OEmbedProvider("hulu","video",["hulu\\.com/watch/.*"],"http://www.hulu.com/api/oembed.json"),new t.fn.oembed.OEmbedProvider("vimeo","video",["http://www.vimeo.com/groups/.*/videos/.*","http://www.vimeo.com/.*","http://vimeo.com/groups/.*/videos/.*","http://vimeo.com/.*"],"http://vimeo.com/api/oembed.json"),new t.fn.oembed.OEmbedProvider("dailymotion","video",["dailymotion\\.com/.+"]),new t.fn.oembed.OEmbedProvider("scribd","rich",["scribd\\.com/.+"]),new t.fn.oembed.OEmbedProvider("slideshare","rich",["slideshare.net"],"http://www.slideshare.net/api/oembed/1"),new t.fn.oembed.OEmbedProvider("photobucket","photo",["photobucket\\.com/(albums|groups)/.*"],"http://photobucket.com/oembed/")];var m=n.createHandler({handleContent:function(e){typeof e=="string"?e=t("<div>"+e+"</div>").get(0):e instanceof t&&(e=t("<div>").append(e).get(0)),e=t(e).oembed(t(e).text(),{embedMethod:"replace"});var n=setTimeout(function(){return e=t.fn.oembed.embedCode,t("<div>").append(e).html()},500)},replaceoEmbedContent:function(e){}});return m}),Sanitize.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,Sanitize.RELATIVE="__relative__",Sanitize.prototype.clean_node=function(e){function n(e,t){var n;for(n=0;n<t.length;n++)if(t[n]==e)return n;return-1}function r(){var e=[],t={},n,r;for(n=0;n<arguments.length;n++){if(!arguments[n]||!arguments[n].length)continue;for(r=0;r<arguments[n].length;r++){if(t[arguments[n][r]])continue;t[arguments[n][r]]=!0,e.push(arguments[n][r])}}return e}function s(e){var t;for(var n=0;n<this.filters.length;n++)if(!this.filters[n](e)){t=e.cloneNode(!0),this.current_element.appendChild(t);return}switch(e.nodeType){case 1:o.call(this,e);break;case 3:var t=e.cloneNode(!1);this.current_element.appendChild(t);break;case 5:var t=e.cloneNode(!1);this.current_element.appendChild(t);break;case 8:if(this.config.allow_comments){var t=e.cloneNode(!1);this.current_element.appendChild(t)};default:}}function o(e){var t,i,o,a,f,l,c,h,p,d,v,m,g=u.call(this,e),y=this.jQuery,b=!1;y&&y.browser&&y.browser.msie&&y.browser.version==="7.0"&&(b=!0),e=g.node,f=e.nodeName.toLowerCase(),a=this.current_element;if(this.allowed_elements[f]||g.whitelist){this.current_element=this.dom.createElement(e.nodeName),a.appendChild(this.current_element),l=r(this.config.attributes[f],this.config.attributes.__ALL__,g.attr_whitelist);for(t=0;t<l.length;t++)h=l[t],c=e.attributes[h],c&&(m=!0,this.config.protocols[f]&&this.config.protocols[f][h]&&(d=this.config.protocols[f][h],v=c.nodeValue.toLowerCase().match(Sanitize.REGEX_PROTOCOL),v?m=n(v[1],d)!=-1:m=n(Sanitize.RELATIVE,d)!=-1),m&&(!b||b&&"style"!==h)&&(p=document.createAttribute(h),p.value=c.nodeValue,this.current_element.setAttributeNode(p)));if(this.config.add_attributes[f])for(h in this.config.add_attributes[f])if(!b||b&&"style"!==h)p=document.createAttribute(h),p.value=this.config.add_attributes[f][h],this.current_element.setAttributeNode(p)}else if(n(e,this.whitelist_nodes)!=-1){this.current_element=e.cloneNode(!0);while(this.current_element.childNodes.length>0)this.current_element.removeChild(this.current_element.firstChild);a.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[f])for(t=0;t<e.childNodes.length;t++)s.call(this,e.childNodes[t]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=a}function u(e){var t={attr_whitelist:[],node:e,whitelist:!1},i,s,o;for(i=0;i<this.transformers.length;i++){o=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:e,node_name:e.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom});if(o==null)continue;if(typeof o!="object")throw new Error("transformer output must be an object or null");if(o.whitelist_nodes&&o.whitelist_nodes instanceof Array)for(s=0;s<o.whitelist_nodes.length;s++)n(o.whitelist_nodes[s],this.whitelist_nodes)==-1&&this.whitelist_nodes.push(o.whitelist_nodes[s]);t.whitelist=o.whitelist?!0:!1,o.attr_whitelist&&(t.attr_whitelist=r(t.attr_whitelist,o.attr_whitelist)),t.node=o.node?o.node:t.node}return t}var t=this.dom.createDocumentFragment();this.current_element=t,this.whitelist_nodes=[];for(i=0;i<e.childNodes.length;i++)s.call(this,e.childNodes[i]);return t.normalize&&t.normalize(),t},define("vendor/sanitize",function(){}),define("contenthandler/sanitizecontenthandler",["aloha/core","jquery","aloha/contenthandlermanager","aloha/plugin","aloha/console","vendor/sanitize"],function(e,t,n,r,i){function o(n){var r=["restricted","basic","relaxed"],i=e.defaults.supports;e.settings.contentHandler.sanitize&&t.inArray(e.settings.contentHandler.sanitize,r)>-1?i=e.defaults.sanitize[e.settings.contentHandler.sanitize]:i=e.defaults.sanitize.relaxed,e.settings.contentHandler.allows&&(i=e.settings.contentHandler.allows),n&&(i=n),i.filters=[function(e){return e.contentEditable!="false"}],s=new Sanitize(i,t)}var s;e.defaults.sanitize||(e.defaults.sanitize={}),e.defaults.sanitize.restricted={elements:["b","em","i","strong","u","del","p","span","div","br"]},e.defaults.sanitize.basic={elements:["a","abbr","b","blockquote","br","cite","code","dd","del","dl","dt","em","i","li","ol","p","pre","q","small","strike","strong","sub","sup","u","ul"],attributes:{a:["href"],blockquote:["cite"],q:["cite"],abbr:["title"]},protocols:{a:{href:["ftp","http","https","mailto","__relative__"]},blockquote:{cite:["http","https","__relative__"]},q:{cite:["http","https","__relative__"]}}},e.defaults.sanitize.relaxed={elements:["a","abbr","b","blockquote","br","caption","cite","code","col","colgroup","dd","del","dl","dt","em","h1","h2","h3","h4","h5","h6","i","img","li","ol","p","pre","q","small","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","tr","u","ul","span","hr","object","div"],attributes:{a:["href","title","id","class","target","data-gentics-aloha-repository","data-gentics-aloha-object-id"],div:["id","class","style"],abbr:["title"],blockquote:["cite"],br:["class"],col:["span","width"],colgroup:["span","width"],img:["align","alt","height","src","title","width","class","data-caption","data-align","data-width","data-original-image"],ol:["start","type"],p:["class","style","id"],q:["cite"],table:["summary","width"],td:["abbr","axis","colspan","rowspan","width"],th:["abbr","axis","colspan","rowspan","scope","width"],ul:["type"],span:["class","style","lang","xml:lang","role"]},protocols:{a:{href:["ftp","http","https","mailto","__relative__"]},blockquote:{cite:["http","https","__relative__"]},img:{src:["http","https","__relative__"]},q:{cite:["http","https","__relative__"]}}};var u=n.createHandler({handleContent:function(n){var r,i;if(e.activeEditable&&e.settings.contentHandler&&e.settings.contentHandler.handler&&e.settings.contentHandler.handler.sanitize){e.settings.contentHandler.handler.sanitize&&(i=e.settings.contentHandler.handler.sanitize);var u=i["#"+e.activeEditable.getId()];if(typeof u!="undefined")r=i;else{var a=e.activeEditable.obj.attr("class").split(" ");for(var f=0;f<a.length;f++)typeof i["."+a[f]]!="undefined"&&(r=i["."+a[f]])}}return(typeof s=="undefined"||typeof r!="undefined")&&o(r),typeof n=="string"?n=t("<div>"+n+"</div>").get(0):n instanceof t&&(n=t("<div>").append(n).get(0)),t("<div>").append(s.clean_node(n)).html()}});return u}),define("contenthandler/blockelementcontenthandler",["aloha","jquery","aloha/contenthandlermanager"],function(e,t,n){var r=function(){var e=t(this);e.filter("h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,p:empty,pre:empty,blockquote:empty").remove(),t.browser.msie&&e.filter("br.aloha-end-br").remove(),t.browser.msie||e.filter("li").each(function(){var e=t(this);(!this.lastChild||this.lastChild.nodeName.toLowerCase()!=="br"||!t(this.lastChild).hasClass("aloha-end-br"))&&e.append('<br class="aloha-end-br"/>')}),e.children(":not(.aloha-block)").each(r)},i=function(){var e=t(this);e.filter("h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,p:empty,pre:empty,blockquote:empty").append(""),e.children(":not(.aloha-block)").each(i)},s=function(){var e=t(this);e.filter("p,h1,h2,h3,h4,h5,h6,pre,blockquote").length>0&&(!this.lastChild||this.lastChild.nodeName.toLowerCase()!=="br"||!t(this.lastChild).hasClass("aloha-end-br"))&&e.append('<br class="aloha-end-br"/>'),e.children(":not(.aloha-block)").each(s)},o=n.createHandler({handleContent:function(e,n){return typeof e=="string"?e=t("<div>"+e+"</div>"):e instanceof t&&(e=t("<div>").append(e)),n=n||{},n.command==="initEditable"?(e.children(":not(.aloha-block)").each(r),t.browser.msie&&t.browser.version<=7&&e.children(":not(.aloha-block)").each(i)):n.command==="getContents"&&(e.children(":not(.aloha-block)").each(s),e.find("li > br.aloha-end-br").remove()),e.html()}});return o}),define("contenthandler/contenthandler-plugin",["aloha","aloha/plugin","jquery","aloha/contenthandlermanager","contenthandler/wordcontenthandler","contenthandler/genericcontenthandler","contenthandler/oembedcontenthandler","contenthandler/sanitizecontenthandler","contenthandler/blockelementcontenthandler"],function(e,t,n,r,i,s,o,u,a){var f=t.create("contenthandler",{settings:{},dependencies:[],init:function(){var e={word:i,generic:s,sanitize:u,blockelement:a},t;for(t in e)e.hasOwnProperty(t)&&r.register(t,e[t])}});return f}),define("commands/inserthtml",["aloha/core","jquery","aloha/command","aloha/selection","util/dom","aloha/contenthandlermanager","aloha/console"],function(e,t,n,r,i,s,o){n.register("inserthtml",{action:function(n,r){function h(e){var n=t(e),s;if(!i.insertIntoDOM(n,r,u,!1)){s=n.contents(),(i.isBlockLevelElement(e)||i.isListElement(e))&&h(t("<br/>").get(0));for(f=s.length-1;f>=0;--f)h(s[f])}}var u=t(i.getEditingHostOf(r.startContainer)),a=r.commonAncestorContainer,f,l,c=[];n=s.handleContent(n,{contenthandler:e.settings.contentHandler.insertHtml});if(typeof n=="string")n=t("<div>"+n+"</div>");else{if(!(n instanceof t))throw"INVALID_VALUE_ERR";n=t("<div>").append(n)}c=n.contents(),i.removeRange(r);for(f=c.length-1;f>=0;--f)h(c[f]);c.length>0?r=i.setCursorAfter(c.get(c.length-1)):r.select(),i.doCleanup({merge:!0,removeempty:!0},r,a);try{r.select()}catch(p){o.warn("Error:",p)}}})}),define("commands/commands-plugin",["aloha/command","./inserthtml"],function(e,t){}),define("block/blockmanager",["aloha","jquery","ui/scopes","aloha/observable","aloha/registry","util/class","util/strings","util/maps"],function(e,t,n,r,i,s,o,u){var a=window.GENTICS,f=new(s.extend(r,{defaults:{"aloha-block-type":"DefaultBlock"},blockTypes:null,blocks:null,_highlightedBlocks:null,_activeBlock:null,_dragdropEnabled:!0,_constructor:function(){n.createScope("Aloha.Block"),this.blockTypes=new i,this.blocks=new i,this._highlightedBlocks={}},registerEventHandlers:function(){var n=this;this._registerEventHandlersForDeactivatingAlohaBlock(),this._registerEventHandlersForDeterminingCurrentlyActiveBlock(),this._registerEventHandlersForBlockDeletion(),this._registerEventHandlersForCutCopyPaste(),e.bind("aloha-selection-changed",function(e,r,i){if(r&&t(r.getCommonAncestorContainer()).parents(".aloha-block").length>0)return;n._deactivateHighlightedBlocks()})},_registerEventHandlersForDeactivatingAlohaBlock:function(){var e=this;t(document).bind("click",function(n){if(u.isEmpty(e._highlightedBlocks))return;if(t(n.target).closest(".aloha-ui,.aloha-block-do-not-deactivate,.aloha-block").length>0)return;e._deactivateHighlightedBlocks()})},_registerEventHandlersForDeterminingCurrentlyActiveBlock:function(){var e=this;this.bind("block-selection-change",function(t){t.length>0?e._activeBlock=t[0]:e._activeBlock=null})},_registerEventHandlersForBlockDeletion:function(){var n=this;e.bind("aloha-command-will-execute",function(r,i){var s=i.commandId,o=e.getSelection().getRangeCount()===0||e.getSelection().getRangeCount()===1&&e.getSelection().getRangeAt(0).endContainer===e.getSelection().getRangeAt(0).startContainer&&e.getSelection().getRangeAt(0).endContainer===t("body")[0]||e.getSelection().getRangeCount()===1&&e.getSelection().getRangeAt(0).endContainer===e.getSelection().getRangeAt(0).startContainer&&e.getSelection().getRangeAt(0).startOffset+1===e.getSelection().getRangeAt(0).endOffset;if(n._activeBlock&&(s==="delete"||s==="forwarddelete")&&o)i.preventDefault=!0,n._activeBlock.destroy();else if(!n._activeBlock&&(s==="delete"||s==="forwarddelete")&&e.getSelection().getRangeCount()===1&&e.getSelection().getRangeAt(0).collapsed===!1){var u;u=function(e){var n;for(var r=0,i=e.length;r<i;r++){n=e[r];if(n.domobj.nodeType===1){var s=t(n.domobj);n.selection==="full"&&s.is(".aloha-block")?s.remove():u(n.children)}}},u(e.Selection.getSelectionTree())}}),t(window.document).keydown(function(e){if(typeof e.srcElement!="undefined"&&typeof e.srcElement.form!="undefined")return!0;if(n._activeBlock&&(e.which===46||e.which===8)&&n._activeBlock._isInsideNestedEditable===!1){if(t.browser.msie&&parseInt(t.browser.version,10)<=8&&n._activeBlock.$element.parents(".aloha-editable,.aloha-block").first().hasClass("aloha-editable"))return n._activeBlock.destroy(),e.preventDefault(),!1;if(n._activeBlock.shouldDestroy())return n._activeBlock.destroy(),e.preventDefault(),!1}})},_registerEventHandlersForCutCopyPaste:function(){var e=this,n=!1,r=!1,i=null;t(window.document).keydown(function(t){e._activeBlock&&(t.ctrlKey||t.metaKey)&&t.which===67&&(n=!0,e._activeBlock.$element.attr("data-aloha-block-copy-only-block","true"),a.Utils.Dom.selectDomNode(e._activeBlock.$element[0])),e._activeBlock&&(t.ctrlKey||t.metaKey)&&t.which===88&&(r=!0,e._activeBlock.$element.attr("data-aloha-block-copy-only-block","true"),a.Utils.Dom.selectDomNode(e._activeBlock.$element[0]))}),t(window.document).keyup(function(t){!r&&n&&(t.which===67||t.which===18||t.which===91)&&(n=!1,e._activeBlock.$element.removeAttr("data-aloha-block-copy-only-block"),i&&(i=null)),r&&(t.which===67||t.which===18||t.which===88)&&(r=!1)})},initializeBlockLevelDragDrop:function(){var n=this;t.each(e.editables,function(e,t){t.obj.data("block-dragdrop",n._dragdropEnabled),n.createBlockLevelSortableForEditableOrBlockCollection(t.obj)}),e.bind("aloha-editable-created",function(e,t){t.obj.data("block-dragdrop",n._dragdropEnabled),n.createBlockLevelSortableForEditableOrBlockCollection(t.obj)})},createBlockLevelSortableForEditableOrBlockCollection:function(e){var n=this;e.hasClass("aloha-block-blocklevel-sortable")||(e.addClass("aloha-block-blocklevel-sortable").sortable({revert:100,handle:".aloha-block-draghandle-blocklevel",connectWith:".aloha-block-blocklevel-sortable.aloha-block-dropzone",disabled:!n._dragdropEnabled,start:function(e,t){t.item.data("block-sort-allowed",t.item.parents(".aloha-block-dropzone").length>0)},change:function(e,t){t.item.data("block-sort-allowed",t.placeholder.parents(".aloha-block-dropzone").length>0)},stop:function(e,n){n.item.data("block-sort-allowed")||t(this).sortable("cancel"),n.item.removeData("block-sort-allowed")}}),e.get(0).ondragstart=function(e,t){if(!t||!t.helper||!t.helper.is(".aloha-block"))return!1})},setDragDropState:function(e){var t=this;t._dragdropEnabled=e},registerBlockType:function(e,t){n.createScope("Aloha.Block."+e,"Aloha.Block"),this.blockTypes.register(e,t)},_blockify:function(n,r){var i=this,s,o,u;u=t(n);var a=u[0].tagName.toLowerCase();if(a!=="span"&&a!=="div"){e.Log.error("block/blockmanager","Blocks can only be created from <div> or <span> element. You passed "+a+".");return}s=this.getConfig(u,r);if(!this.blockTypes.has(s["aloha-block-type"])){e.Log.error("block/blockmanager","Block Type "+s["aloha-block-type"]+" not found!");return}o=new(this.blockTypes.get(s["aloha-block-type"]))(u),o.$element.addClass("aloha-block-"+s["aloha-block-type"]),t.each(s,function(e,t){o._setAttribute(e,t)}),this.blocks.register(o.getId(),o)},getConfig:function(e,n){var r=e.clone(!0),i=r.data(),s={};r.removeData();for(var u in i)i.hasOwnProperty(u)&&(s[o.camelCaseToDashes(u)]=i[u]);return t.extend({},this.defaults,n,s)},getBlock:function(e){var n,r;return typeof e=="object"?(r=t(e),r.hasClass("aloha-block-inner")&&(r=r.parent()),n=r.attr("id")):n=e,this.blocks.get(n)},_unregisterBlock:function(e){var t;typeof e=="object"?t=e.getId():t=e,this.blocks.unregister(t)},_deactivateHighlightedBlocks:function(){t.each(t.extend({},this._highlightedBlocks),function(e){var t=f.getBlock(e);t&&t.deactivate()})},_getHighlightedBlocks:function(){var e={};return t.each(this.blocks.getEntries(),function(t,n){n.isActive()&&(e[t]=n)}),e},_setHighlighted:function(e){this._highlightedBlocks[e.id]=!0},_setUnhighlighted:function(e){delete this._highlightedBlocks[e.id]}}));return e.Block=e.Block||{},e.Block.BlockManager=f,f}),define("block/editormanager",["aloha/registry"],function(e){return new(e.extend({createEditor:function(e){if(!this.has(e.type))throw'Editor for type "'+e.type+'" not found.';var t=this.get(e.type);return new t(e)}}))}),define("block/sidebarattributeeditor",["jquery","block/blockmanager","aloha/sidebar","block/editormanager","util/class"],function(e,t,n,r,i){return new(i.extend({_sidebar:null,init:function(){this._sidebar=n.right.show(),t.bind("block-selection-change",this._onBlockSelectionChange,this)},_onBlockSelectionChange:function(t){var n=this;if(!this._sidebar)return;e.each(t,function(){var t=this.getSchema(),i=this,s=[];if(!t)return;n._sidebar.addPanel({title:i.getTitle(),expanded:!0,onInit:function(){var n=e("<form />");n.submit(function(){return!1}),e.each(t,function(e,t){var o=r.createEditor(t);o.bind("change",function(t){i.attr(e,t)}),i.bind("change",function(){o.setValue(i.attr(e))}),n.append(o.render()),o.setValue(i.attr(e)),s.push(o)}),this.setContent(n)},deactivate:function(){e.each(s,function(e,t){t._deactivate()}),this.isActive=!1,this.effectiveElement=null}})})}}))}),define("block/block",["aloha","jquery","block/blockmanager","aloha/observable","ui/scopes","util/class"],function(e,t,n,r,i,s){var o=window.GENTICS,u=s.extend(r,{title:null,id:null,$element:null,_currentlyRendering:!1,_initialized:!1,_isInsideNestedEditable:!1,_constructor:function(e){var n=this;this.$element=e,e.attr("id")?this.id=e.attr("id"):(this.id=o.Utils.guid(),e.attr("id",this.id)),e.contentEditable(!1),e.addClass("aloha-block"),this.isDraggable()&&(e.find("img").attr("draggable","false"),e.find("a").attr("draggable","false")),this._onElementClickHandler=function(e){t(e.target).closest(".aloha-block").get(0)===n.$element.get(0)&&(n._fixScrollPositionBugsInIE(),n.activate(e.target,e))},this._connectThisBlockToDomElement(e),this._initialized=!0},_onElementClickHandler:null,_preventSelectionChangedEventHandler:function(){e.Selection.preventSelectionChanged()},_connectThisBlockToDomElement:function(e){var n=this,r=t(e);this.$element&&(this.$element.unbind("click",this._onElementClickHandler),this.$element.unbind("mousedown",this._preventSelectionChangedEventHandler),this.$element.unbind("focus",this._preventSelectionChangedEventHandler),this.$element.unbind("dblclick",this._preventSelectionChangedEventHandler)),this.$element=r,this.$element.bind("click",this._onElementClickHandler),this.$element.bind("mousedown",this._preventSelectionChangedEventHandler),this.$element.bind("focus",this._preventSelectionChangedEventHandler),this.$element.bind("dblclick",this._preventSelectionChangedEventHandler),this.init(this.$element,function(){window.setTimeout(function(){n._postProcessElementIfNeeded()},5)})},_fixScrollPositionBugsInIE:function(){var e=t(window).scrollTop();window.setTimeout(function(){t(window).scrollTop()!==e&&t(window).scrollTop(e)},10)},init:function(e,t){t()},shouldDestroy:function(){var e=this.$element.parent().closest(".aloha-block,.aloha-editable,.aloha-block-collection");return e.hasClass("aloha-block-collection")&&this.$element[0].tagName.toLowerCase()==="div"?!0:e.hasClass("aloha-editable")},destroy:function(e){if(!this.shouldDestroy()&&e!==!0)return;var t=this,r=new o.Utils.RangeObject;r.startContainer=r.endContainer=this.$element.parent()[0],r.startOffset=r.endOffset=o.Utils.Dom.getIndexInParent(this.$element[0]),n.trigger("block-delete",this),this.free();var i=this.$element[0].tagName.toLowerCase()==="span";this.$element.fadeOut("fast",function(){t.$element.remove(),n.trigger("block-selection-change",[]),window.setTimeout(function(){i&&r.select()},5)})},free:function(){n._unregisterBlock(this),this.unbindAll()},getId:function(){return this.id},getSchema:function(){return null},getTitle:function(){return this.title},isDraggable:function(){return this.$element[0].tagName.toLowerCase()==="div"&&this.$element.parents(".aloha-editable,.aloha-block,.aloha-block-collection").first().hasClass("aloha-block-collection")?!0:this.$element.parents(".aloha-editable,.aloha-block").first().hasClass("aloha-editable")},activate:function(r,s){var o=[];t.each(n._getHighlightedBlocks(),function(){this.deactivate()}),this.$element.attr("data-block-skip-scope")!=="true"&&i.setScope("Aloha.Block."+this.attr("aloha-block-type")),this.$element.addClass("aloha-block-active"),this._highlight(),o.push(this),this.$element.parents(".aloha-block").each(function(){var e=n.getBlock(this);e&&(e._highlight(),o.push(e))}),t(r).closest(".aloha-editable,.aloha-block,.aloha-table-cell-editable").first().hasClass("aloha-block")?(this._isInsideNestedEditable=!1,e.getSelection().removeAllRanges()):(this._isInsideNestedEditable=!0,s&&e.Selection.updateSelection(s)),n.trigger("block-activate",o),n.trigger("block-selection-change",o)},deactivate:function(){var e=this,t=[this];this._unhighlight(),this.$element.parents(".aloha-block").each(function(){t.push(this),e._unhighlight()}),this.$element.removeClass("aloha-block-active"),n.trigger("block-deactivate",t),n.trigger("block-selection-change",[])},isActive:function(){return this.$element.hasClass("aloha-block-active")},_highlight:function(){this.$element.addClass("aloha-block-highlighted"),n._setHighlighted(this)},_unhighlight:function(){this.$element.removeClass("aloha-block-highlighted"),n._setUnhighlighted(this)},_update:function(){var e=this;if(this._currentlyRendering)return;if(!this._initialized)return;this._currentlyRendering=!0,this.update(this.$element,function(){e._postProcessElementIfNeeded()}),this._currentlyRendering=!1},update:function(e,t){t()},_postProcessElementIfNeeded:function(){this.createEditablesIfNeeded(),this._checkThatNestedBlocksAreStillConsistent(),this._makeNestedBlockCollectionsSortable(),this.renderBlockHandlesIfNeeded(),this.isDraggable()&&this.$element[0].tagName.toLowerCase()==="span"?(this._setupDragDropForInlineElements(),this._disableUglyInternetExplorerDragHandles()):this.isDraggable()&&this.$element[0].tagName.toLowerCase()==="div"&&(this._setupDragDropForBlockElements(),this._disableUglyInternetExplorerDragHandles()),this._hideDragHandlesIfDragDropDisabled(),this._attachDropzoneHighlightEvents()},_checkThatNestedBlocksAreStillConsistent:function(){this.$element.find(".aloha-block").each(function(){var e=n.getBlock(this);e&&e.$element[0]!==this&&e._connectThisBlockToDomElement(this)})},_makeNestedBlockCollectionsSortable:function(){var e=this;this.$element.find(".aloha-block-collection").each(function(){var r=t(this);r.closest(".aloha-block").get(0)===e.$element.get(0)&&n.createBlockLevelSortableForEditableOrBlockCollection(r)})},_disableUglyInternetExplorerDragHandles:function(){t.browser.msie&&(this.$element.get(0).onresizestart=function(e){return!1},this.$element.get(0).oncontrolselect=function(e){return!1},this.$element.get(0).onmovestart=function(e){return!1},this.$element.get(0).onselectstart=function(e){return!1})},_hideDragHandlesIfDragDropDisabled:function(){this._dd_isDragdropEnabled()||this.$element.find(".aloha-block-draghandle").removeClass("aloha-block-draghandle")},_attachDropzoneHighlightEvents:function(){var e=this;this.$element.delegate(".aloha-block-draghandle","mousedown",function(){var n=e.$element.parents(".aloha-editable").first().data("block-dropzones")||[];t.each(n,function(e,n){var r=t(n);t(r).each(function(){t(this).data("block-dragdrop")&&t(this).addClass("aloha-block-dropzone")})}),t(document).one("mouseup.aloha-block-dropzone",function(n){var r=e.$element.parents(".aloha-editable").first().data("block-dropzones")||[];t.each(r,function(e,n){t(n).removeClass("aloha-block-dropzone")})})})},_setupDragDropForInlineElements:function(){var e=this,n=null,r=!1,i=null,s=null,o=function(){if(n){var o=t(n);o.is(".aloha-block-dropInlineElementIntoEmptyBlock")?(o.children().remove(),o.append(i)):o.is(".aloha-block-droppable-right")?(o.html(o.html()+" "),o.after(i)):(o.prev("[data-i]").length>0&&o.prev("[data-i]").html(o.prev("[data-i]").html()+" "),o.html(" "+o.html()),o.before(i)),i.removeClass("ui-draggable").css({left:0,top:0}),e._fixScrollPositionBugsInIE()}t(".aloha-block-dropInlineElementIntoEmptyBlock").removeClass("aloha-block-dropInlineElementIntoEmptyBlock"),s.droppable("destroy"),s=null,r=!0},u=[];this.$element.draggable({handle:".aloha-block-draghandle",scope:"aloha-block-inlinedragdrop",disabled:!this._dd_isDragdropEnabled(),revert:function(){return n===null||!r},revertDuration:250,stop:function(){t.browser.msie&&7===parseInt(t.browser.version,10)&&o(),t.each(u,function(){e._dd_traverseDomTreeAndRemoveSpans(this)}),i=null,u=[]},start:function(){r=!1,u=[],t(".aloha-editable").children("p:empty").html("&nbsp;");var a={tolerance:"pointer",addClasses:!1,scope:"aloha-block-inlinedragdrop",over:function(r,s){t.inArray(this,u)===-1&&u.push(this);var o=1===t(this).contents().length&&1===t(this).children("br.aloha-end-br").length;i=s.draggable;if(t(this).is(":empty")||o||t(this).html()==="&nbsp;"){t(this).addClass("aloha-block-dropInlineElementIntoEmptyBlock"),n=this;return}e._dd_traverseDomTreeAndWrapCharactersWithSpans(this),t("span[data-i]",this).droppable({tolerance:"pointer",addClasses:!1,scope:"aloha-block-inlinedragdrop",over:function(){n&&t(n).removeClass("aloha-block-droppable"),n=this,t(this).addClass("aloha-block-droppable")},out:function(){t(this).removeClass("aloha-block-droppable"),n===this&&(n=null)}}),t.ui.ddmanager.prepareOffsets(s.draggable.data("draggable"),r)},out:function(){t(this).removeClass("aloha-block-dropInlineElementIntoEmptyBlock")},drop:function(){(!t.browser.msie||7!==parseInt(t.browser.version,10))&&o()}};s=t(".aloha-editable.aloha-block-dropzone").children(":not(.aloha-block)"),s.droppable(a),t(".aloha-table-cell-editable").droppable(a)}})},_dd_traverseDomTreeAndWrapCharactersWithSpans:function(e){var t;for(var n=0,r=e.childNodes.length;n<r;n++){t=e.childNodes[n];if(t.nodeType===1){if(!~t.className.indexOf("aloha-block")&&t.attributes["data-i"]===undefined)this._dd_traverseDomTreeAndWrapCharactersWithSpans(t);else if(t.attributes["data-i"])return}else if(t.nodeType===3){var i=this._dd_insertSpans(t);n+=i,r+=i}}},_dd_splitText:function(e){var t=e.split(/(?=\b)/),n=[],r=!1;for(var i=0,s=t.length;i<s;i++)/[^\t\n\r ]/.test(t[i])?r?(n.push(" "+t[i]),r=!1):n.push(t[i]):r=!0;return r&&(n[n.length-1]+=" "),n},_dd_insertSpans:function(e){var n=e.nodeValue;if(!/[^\t\n\r ]/.test(n))return 0;var r=document.createDocumentFragment(),i=this._dd_splitText(n),s=i.length,o,u,a,f,l=0;for(var c=0;c<s;c++){u=i[c];if(u.length===0)continue;a=Math.floor(u.length/2);var h=parseInt(t.browser.version,10);t.browser.msie&&(7===h||8===h)&&(a=0),a>0&&(o=document.createElement("span"),o.appendChild(document.createTextNode(u.substr(0,a))),o.setAttribute("data-i",c),r.appendChild(o),l++),o=document.createElement("span"),f=u.substr(a),o.appendChild(document.createTextNode(f)),o.setAttribute("data-i",c),o.setAttribute("class","aloha-block-droppable-right"),r.appendChild(o),l++}return e.parentNode.replaceChild(r,e),l-1},_dd_traverseDomTreeAndRemoveSpans:function(e){var t=[],n;n=function(e){var r=!1,i,s,o;for(var u=0,a=e.childNodes.length;u<a;u++)o=e.childNodes[u],o.nodeType===1&&(o.attributes["data-i"]!==undefined?(r||(r=!0,i="",s=undefined),r&&(i+=o.firstChild.nodeValue,s&&t.push(s),s=o)):(r&&(r=!1,s.parentNode.replaceChild(document.createTextNode(i),s)),~o.className.indexOf("aloha-block")||n(o)));r&&s.parentNode.replaceChild(document.createTextNode(i),s)},n(e);for(var r=0,i=t.length;r<i;r++)t[r].parentNode.removeChild(t[r])},_dd_isDragdropEnabled:function(){var e=this.$element.parents(".aloha-editable");return e?e.first().data("block-dragdrop"):!0},_setupDragDropForBlockElements:function(){this.$element.find(".aloha-block-draghandle").addClass("aloha-block-draghandle-blocklevel")},createEditablesIfNeeded:function(){this.$element.find(".aloha-editable").aloha()},renderBlockHandlesIfNeeded:function(){this.isDraggable()&&this.$element.children(".aloha-block-draghandle").length===0&&this.$element.prepend('<span class="aloha-block-handle aloha-block-draghandle"></span>')},attr:function(n,r,i){var s=this,o=!1;if(arguments.length>=2){if(n.substr(0,12)==="aloha-block-"){e.Log.error("block/block","It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set "+n+")");return}this._getAttribute(n)!==r&&(o=!0),this._setAttribute(n,r)}else{if(typeof n!="object")return typeof n=="string"?this._getAttribute(n):this._getAttributes();t.each(n,function(t,n){if(t.substr(0,12)==="aloha-block-"){e.Log.error("block/block","It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set "+t+")");return}s._getAttribute(t)!==n&&(o=!0),s._setAttribute(t,n)})}return o&&!i&&(this._update(),this.trigger("change"),e.activeEditable.smartContentChange({type:"block-change"})),null},_setAttribute:function(e,t){this.$element.attr("data-"+e.toLowerCase(),t)},_getAttribute:function(e){return this.$element.attr("data-"+e.toLowerCase())},_getAttributes:function(){var e={};return t.each(this.$element[0].attributes,function(t,n){n.name.substr(0,5)==="data-"&&(e[n.name.substr(5).toLowerCase()]=n.value)}),e}}),a=u.extend({update:function(e,t){t()}}),f=u.extend({title:"Debugging",init:function(e,t){this.update(e,t)},update:function(e,n){e.css({display:"block"});var r='<table class="debug-block">';t.each(this.attr(),function(e,t){r+="<tr><th>"+e+"</th><td>"+t+"</td></tr>"}),r+="</table>",e.html(r),n()}});return{AbstractBlock:u,DefaultBlock:a,DebugBlock:f}}),define("block/blockcontenthandler",["jquery","aloha/contenthandlermanager","block/blockmanager"],function(e,t,n){var r=t.createHandler({handleContent:function(t){return typeof t=="string"?t=e("<div>"+t+"</div>"):t instanceof e&&(t=e("<div>").append(t)),t.find('.aloha-block[data-aloha-block-copy-only-block="true"]').length>0&&(t.find(".aloha-block:not([id])").remove(),t.find(".aloha-block + span:empty").remove(),t.find("div:empty").remove(),t.find("br.Apple-interchange-newline").remove(),t.find(".aloha-block").prev("br").remove(),t.find("div > br:only-child").parent().remove()),t.find(".aloha-block").each(function(){var t=e(this),r={},i={};e.each(t[0].attributes,function(e,t){if(t.nodeName==="id")return;t.nodeName.match(/^data-/)?i[t.nodeName.substr(5)]=t.nodeValue:r[t.nodeName]=t.nodeValue});var s=GENTICS.Utils.guid(),o=e("<"+this.tagName+"/>").attr(r).attr("id",s).removeClass("aloha-block-active").removeClass("aloha-block").html(t.html());t.replaceWith(o),window.setTimeout(function(){n._blockify(e("#"+s),i)},50)}),t.html()}});return r}),define("block/editor",["jquery","aloha/observable","util/class"],function(e,t,n){var r=n.extend(t,{schema:null,_constructor:function(
e){this.schema=e},render:function(){},getValue:function(){},setValue:function(e){},destroy:function(){},_deactivate:function(){this.trigger("change",this.getValue()),this.destroy()}}),i=r.extend({formInputElementDefinition:null,_$formInputElement:null,render:function(){var t=e('<div class="aloha-block-editor" />'),n=GENTICS.Utils.guid();return t.append(this.renderLabel().attr("id",n)),t.append(this.renderFormElement().attr("id",n)),t},renderLabel:function(){var t=e("<label />");return t.html(this.schema.label),t},renderFormElement:function(){var t=this;return this._$formInputElement=e(this.formInputElementDefinition),this.afterRenderFormElement(this._$formInputElement),this._$formInputElement.change(function(){t.trigger("change",t.getValue())}),this._$formInputElement},afterRenderFormElement:function(e){},getValue:function(){return this._$formInputElement.val()},setValue:function(e){this._$formInputElement.val(e)},destroy:function(){this._$formInputElement.remove()}}),s=i.extend({formInputElementDefinition:'<input type="text" />'}),o=i.extend({formInputElementDefinition:'<input type="range" />',afterRenderFormElement:function(e){if(!this.schema.range)return;this.schema.range.min&&e.attr("min",this.schema.range.min),this.schema.range.max&&e.attr("max",this.schema.range.max),this.schema.range.step&&e.attr("step",this.schema.range.step)}}),u=i.extend({formInputElementDefinition:'<input type="url" />'}),a=i.extend({formInputElementDefinition:'<input type="email" />'}),f=i.extend({formInputElementDefinition:"<select />",afterRenderFormElement:function(t){e.each(this.schema.values,function(){var n=this;t.append(e("<option />").attr("value",n.key).html(n.label))})}}),l=i.extend({formInputElementDefinition:"<button />",afterRenderFormElement:function(e){var t=this;e.html(this.schema.buttonLabel),e.click(function(){t.schema.callback()})}});return{AbstractEditor:r,AbstractFormElementEditor:i,StringEditor:s,NumberEditor:o,UrlEditor:u,EmailEditor:a,SelectEditor:f,ButtonEditor:l}}),define("block/nls/i18n",{root:{"button.toggledragdrop.tooltip":"Toggle Drag & Drop"},fr:!0,en:!0}),define("block/block-plugin",["aloha","aloha/plugin","jquery","aloha/contenthandlermanager","block/blockmanager","block/sidebarattributeeditor","block/block","block/editormanager","block/blockcontenthandler","block/editor","ui/ui","ui/toggleButton","i18n!block/nls/i18n","i18n!aloha/nls/i18n","jqueryui"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=t.create("block",{config:[],settings:{},init:function(){var t=this;i.registerBlockType("DebugBlock",o.DebugBlock),i.registerBlockType("DefaultBlock",o.DefaultBlock),u.register("string",f.StringEditor),u.register("number",f.NumberEditor),u.register("url",f.UrlEditor),u.register("email",f.EmailEditor),u.register("select",f.SelectEditor),u.register("button",f.ButtonEditor),r.register("block",a),i.setDragDropState(t.isDragDropEnabled()),i.registerEventHandlers(),i.initializeBlockLevelDragDrop(),e.bind("aloha-ready",function(){t._createBlocks(),t.settings.sidebarAttributeEditor!==!1&&s.init()}),this.createButtons(),e.bind("aloha-editable-created",function(e,n){t.setDropzones(n.obj)}),e.bind("aloha-editable-activated",function(e,n){t.applyButtonConfig(n.editable.obj)})},applyButtonConfig:function(e){var t=this.getEditableConfig(e),n=function(){return t[0]==="toggleDragdrop"||t.toggleDragdrop==1||t.toggleDragdrop=="true"||t.toggleDragdrop==1||t.toggleDragdrop=="1"};n()&&this.isDragDropEnabled()?(this._toggleDragDropButton.show(!0),this._toggleDragDropButton.setState(e.data("block-dragdrop"))):this._toggleDragDropButton.show(!1)},createButtons:function(){var t=this;this._toggleDragDropButton=l.adopt("toggleDragDrop",c,{tooltip:h.t("button.toggledragdrop.tooltip"),icon:"aloha-icon aloha-icon-toggledragdrop",scope:"Aloha.continuoustext",click:function(){var n=e.activeEditable.obj;t._setDragDropStateForEditable(n,!n.data("block-dragdrop"))}})},setDropzones:function(e){var t=this,n=t.getEditableConfig(e),r=n&&n.dropzones||t.settings.dropzones;r?e.data("block-dropzones",r):e.data("block-dropzones",[".aloha-editable"])},isDragDropEnabled:function(){return this.settings&&typeof this.settings.dragdrop!="undefined"?this.settings.dragdrop===!0||this.settings.dragdrop==="true"||this.settings.dragdrop===1||this.settings.dragdrop==="1":!0},_createBlocks:function(){this.settings.defaults||(this.settings.defaults={}),n.each(this.settings.defaults,function(e,t){n(e).alohaBlock(t)})},_setDragDropStateForEditable:function(e,t){e.data("block-dragdrop",t),e.hasClass("ui-sortable")&&e.sortable("option","disabled",!t),e.find(".aloha-block.ui-draggable").each(function(){n(this).draggable("option","disabled",!t)}),e.find(".aloha-block-handle").each(function(){t?n(this).addClass("aloha-block-draghandle"):n(this).removeClass("aloha-block-draghandle")})}});return n.fn.alohaBlock=function(e){return e=e||{},n(this).each(function(t,n){i._blockify(n,e)}),n(this)},d}),define("align/nls/i18n",{root:{"button.alignright.tooltip":"Align to the right","button.alignleft.tooltip":"Align to the left","button.aligncenter.tooltip":"Center","button.alignjustify.tooltip":"Justify"},fr:!0,en:!0}),define("align/align-plugin",["aloha","aloha/plugin","ui/ui","ui/toggleButton","i18n!align/nls/i18n","i18n!aloha/nls/i18n","jquery","PubSub"],function(e,t,n,r,i,s,o,u){var a=window.GENTICS;return t.create("align",{_constructor:function(){this._super("align")},languages:["en","fr"],config:{alignment:["right","left","center","justify"]},alignment:"",lastAlignment:"",init:function(){this.createButtons();var t=this;e.bind("aloha-editable-activated",function(e,n){t.applyButtonConfig(n.editable.obj)}),u.sub("aloha.selection.context-change",function(n){var r=n.range;e.activeEditable&&t.buttonPressed(r)})},buttonPressed:function(t){var n=this;t.findMarkup(function(){n.alignment=o(this).css("text-align")},e.activeEditable.obj);if(this.alignment!=this.lastAlignment){this._alignRightButton.setState(!1),this._alignLeftButton.setState(!1),this._alignCenterButton.setState(!1),this._alignJustifyButton.setState(!1);switch(this.alignment){case"right":this._alignRightButton.setState(!0);break;case"center":this._alignCenterButton.setState(!0);break;case"justify":this._alignJustifyButton.setState(!0);break;default:this._alignLeftButton.setState(!0),this.alignment="left"}this.lastAlignment=this.alignment}},applyButtonConfig:function(e){var t=this.getEditableConfig(e);t&&t.alignment&&!this.settings.alignment?t=t:t[0]&&t[0].alignment?t=t[0]:this.settings.alignment&&(t.alignment=this.settings.alignment),typeof t.alignment=="undefined"&&(t=this.config),o.inArray("right",t.alignment)!=-1?this._alignRightButton.show(!0):this._alignRightButton.show(!1),o.inArray("left",t.alignment)!=-1?this._alignLeftButton.show(!0):this._alignLeftButton.show(!1),o.inArray("center",t.alignment)!=-1?this._alignCenterButton.show(!0):this._alignCenterButton.show(!1),o.inArray("justify",t.alignment)!=-1?this._alignJustifyButton.show(!0):this._alignJustifyButton.show(!1)},createButtons:function(){var e=this;this._alignLeftButton=n.adopt("alignLeft",r,{tooltip:i.t("button.alignleft.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-left",scope:"Aloha.continuoustext",click:function(){e.align("left")}}),this._alignCenterButton=n.adopt("alignCenter",r,{tooltip:i.t("button.aligncenter.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-center",scope:"Aloha.continuoustext",click:function(){e.align("center")}}),this._alignRightButton=n.adopt("alignRight",r,{tooltip:i.t("button.alignright.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-right",scope:"Aloha.continuoustext",click:function(){e.align("right")}}),this._alignJustifyButton=n.adopt("alignJustify",r,{tooltip:i.t("button.alignjustify.tooltip"),icon:"aloha-icon aloha-icon-align aloha-icon-align-justify",scope:"Aloha.continuoustext",click:function(){e.align("justify")}})},findAlignMarkup:function(t){var n=this;if(typeof t=="undefined")var t=e.Selection.getRangeObject();return e.activeEditable?t.findMarkup(function(){return o(this).css("text-align")==n.alignment},e.activeEditable.obj):null},align:function(t){var n=e.Selection.getRangeObject();this.lastAlignment=this.alignment,this.alignment=t,e.activeEditable&&(this.findAlignMarkup(n)?this.removeAlign():this.insertAlign())},insertAlign:function(){var t=this;if(this.findAlignMarkup(n))return;var n=e.Selection.getRangeObject();a.Utils.Dom.isEditingHost(n.getCommonAncestorContainer())?o.each(e.Selection.getRangeObject().getSelectionTree(),function(){this.selection!=="none"&&this.domobj.nodeType!==3&&o(this.domobj).css("text-align",t.alignment)}):o(n.getCommonAncestorContainer()).css("text-align",this.alignment);if(this.alignment!=this.lastAlignment)switch(this.lastAlignment){case"right":this._alignRightButton.setState(!1);break;case"left":this._alignLeftButton.setState(!1);break;case"center":this._alignCenterButton.setState(!1);break;case"justify":this._alignJustifyButton.setState(!1)}n.select()},removeAlign:function(){var t=e.Selection.getRangeObject();this.findAlignMarkup(t)&&(t.findMarkup(function(){o(this).css("text-align","")},e.activeEditable.obj),t.select())}})}),define("paste/paste-plugin",["aloha/core","aloha/plugin","jquery","aloha/command","aloha/console"],function(e,t,n,r,i){function l(){u=e.getSelection().getRangeAt(0),a=e.activeEditable,f.css({top:o.scrollTop(),left:o.scrollLeft()-200}),f.contents().remove(),a&&a.obj.blur(),e.getSelection().removeAllRanges();var t=e.createRange();t.setStart(f.get(0),0),t.setEnd(f.get(0),0),e.getSelection().addRange(t),f.focus()}function c(){var t=this,r;if(u&&a){a.obj.focus(),e.getSelection().removeAllRanges();var s=e.createRange();s.setStart(u.startContainer,u.startOffset),s.setEnd(u.endContainer,u.endOffset),e.getSelection().addRange(s),r=f.html(),n.browser.msie&&/^&nbsp;/.test(r)&&(r=r.substring(6));var o=u.startContainer;o.nodeType==3&&o.parentNode.nodeName=="P"&&o.parentNode.childNodes.length==1&&/^(\s|%A0)$/.test(escape(o.data))&&(o.data="",u.startOffset=0,u.endContainer==o&&(u.endOffset=0)),e.queryCommandSupported("insertHTML")?e.execCommand("insertHTML",!1,r):i.error("Common.Paste",'Command "insertHTML" not available. Enable the plugin "common/commands".')}u=void 0,a=void 0,f.contents().remove()}var s=window.GENTICS,o=n(window),u=null,a=null,f=n('<div id="pasteContainer" style="position:absolute; clip:rect(0px, 0px, 0px, 0px); width: 1px; height: 1px;"></div>').contentEditable(!0);return t.create("paste",{settings:{},init:function(){var t=this;n("body").append(f),e.bind("aloha-editable-created",function(r,i){n.browser.msie?t.settings.noclipboardaccess||!0?i.obj.bind("beforepaste",function(e){l(),e.stopPropagation()}):i.obj.bind("paste",function(t){l();var n=document.selection.createRange();return n.execCommand("paste"),c(),t.metaKey=void 0,e.activeEditable.smartContentChange(t),t.stopPropagation(),!1}):i.obj.bind("paste",function(t){l(),window.setTimeout(function(){c(),e.activeEditable.smartContentChange(t)},10),t.stopPropagation()})}),n.browser.msie&&(t.settings.noclipboardaccess||!0)&&f.bind("paste",function(t){window.setTimeout(function(){c(),e.activeEditable.smartContentChange(t)},10),t.stopPropagation()})},register:function(e){i.deprecated("Plugins.Paste","register() for pasteHandler is deprecated. Use the ContentHandler Plugin instead.")}})}),Aloha._load&&Aloha._load()})();